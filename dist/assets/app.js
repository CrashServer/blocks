var gS=Object.defineProperty;var xS=(fn,lo,Je)=>lo in fn?gS(fn,lo,{enumerable:!0,configurable:!0,writable:!0,value:Je}):fn[lo]=Je;var cs=(fn,lo,Je)=>xS(fn,typeof lo!="symbol"?lo+"":lo,Je);(function(){"use strict";var fn=document.createElement("style");fn.textContent=`*{margin:0;padding:0;box-sizing:border-box}body{overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;background:#1a1a2e;font-size:13px}#app{width:100vw;height:100vh;position:relative}#viewport{width:100%;height:100%;display:block}button{border:1px solid rgba(255,255,255,.2);border-radius:4px;background:#ffffff1a;color:#fff;cursor:pointer;transition:all .15s ease;font-size:12px;padding:6px 10px}button:hover{background:#fff3;border-color:#fff6}button:active{background:#ffffff4d}button:disabled{opacity:.4;cursor:not-allowed}#menubar{position:absolute;top:0;left:0;right:0;height:36px;background:#000c;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);display:flex;align-items:center;padding:0 12px;gap:6px;z-index:100;border-bottom:1px solid rgba(255,255,255,.1)}#menubar .separator{width:1px;height:20px;background:#fff3;margin:0 6px}#menubar button.active{background:#4a6fa5;border-color:#6a9fd5}#menubar select{border:1px solid rgba(255,255,255,.2);border-radius:4px;background:#ffffff1a;color:#fff;cursor:pointer;font-size:12px;padding:6px 10px;min-width:100px}#menubar select:hover{background:#fff3}#menubar select option{background:#2a2a3a;color:#fff}#toolbar{position:absolute;top:48px;left:12px;bottom:80px;display:flex;flex-direction:column;gap:10px;background:#000000b3;padding:10px;border-radius:8px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);z-index:50;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.3) transparent}.toolbar-section{display:flex;flex-direction:column;gap:4px}.toolbar-section:has(.block-type){flex-wrap:wrap;flex-direction:row;max-width:120px}.toolbar-section:has(.block-type) .section-label{width:100%}.section-label{font-size:10px;color:#ffffff80;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}.tools-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px}.tool{width:42px;height:42px;display:flex;align-items:center;justify-content:center;font-size:18px;padding:0;border-radius:6px;background:#ffffff14;border:1px solid rgba(255,255,255,.1);color:#ffffffe6;transition:all .15s}.tool:hover{background:#ffffff26;transform:scale(1.05)}#paint-section{margin-top:4px}.paint-options{display:flex;gap:4px}.paint-mode{flex:1;padding:8px 12px;font-size:11px;border-radius:4px;background:#ffffff14;border:1px solid rgba(255,255,255,.1);color:#fffc;cursor:pointer;transition:all .15s}.paint-mode:hover{background:#ffffff26}.paint-mode.active{background:#4a6fa5;border-color:#6a9fd5;color:#fff}.shape-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px}.block-type{width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:14px;padding:0}.tool.active,.shape-type.active{background:#4a6fa5;border-color:#6a9fd5;box-shadow:0 0 8px #6a9fd566}.shape-type{width:42px;height:42px;display:flex;align-items:center;justify-content:center;font-size:18px;padding:0;border-radius:6px;background:#ffffff14;border:1px solid rgba(255,255,255,.1);color:#ffffffe6;transition:all .15s}.shape-type:hover{background:#ffffff26;transform:scale(1.05)}#btn-rotate{width:36px;height:36px;font-size:18px;padding:0}.scale-toggle{display:flex;gap:4px;margin-top:6px}.scale-btn{flex:1;height:28px;font-size:12px;font-weight:600;padding:0;background:#ffffff14;border:1px solid rgba(255,255,255,.15);border-radius:4px;color:#fffc;transition:all .15s}.scale-btn:hover{background:#ffffff26}.scale-btn.active{background:#4a6fa5;border-color:#6a9fd5;color:#fff;box-shadow:0 0 6px #6a9fd54d}.scatter-row{display:flex;align-items:center;gap:6px;font-size:11px;color:#fffc}.scatter-row label{color:#fff9;min-width:50px}.scatter-row input[type=range]{flex:1;height:4px;-webkit-appearance:none;background:#fff3;border-radius:2px}.scatter-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#4a9fd5;border-radius:50%;cursor:pointer}.scatter-row select{flex:1;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:4px;color:#fff;padding:4px 8px;font-size:11px;cursor:pointer}.scatter-row select:hover{background:#ffffff26}.scatter-row select option{background:#1a1a2e;color:#fff}.scatter-row span{min-width:40px;text-align:right;font-family:monospace;font-size:10px}.scatter-hint{font-size:10px;color:#fff6;text-align:center;margin-top:6px;font-style:italic}.mirror-buttons{display:flex;gap:4px}.mirror-btn{flex:1;height:32px;font-size:12px;font-weight:600;padding:0;background:#ffffff14;border:1px solid rgba(255,255,255,.15);border-radius:4px;color:#ffffffe6;transition:all .15s}.mirror-btn:hover{background:#6a9fd54d;border-color:#6a9fd580}.mirror-btn:active{background:#6a9fd580}#block-search{width:100%;padding:8px 10px;border:1px solid rgba(255,255,255,.2);border-radius:4px;background:#0000004d;color:#fff;font-size:12px;outline:none;transition:border-color .15s,background .15s}#block-search:focus{border-color:#fff6;background:#00000080}#block-search::placeholder{color:#fff6}#block-palette{display:flex;flex-direction:column;gap:4px;max-height:calc(100vh - 250px);overflow-y:auto;overflow-x:visible;padding-right:4px;width:160px}.block-category{background:#ffffff0d;border-radius:6px}.block-category-header{display:flex;align-items:center;padding:8px 10px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:11px;color:#fffc;text-transform:uppercase;letter-spacing:.5px;background:#ffffff14;transition:background .15s;font-weight:500}.block-category-header:hover{background:#ffffff1f}.block-category-header .arrow{margin-right:8px;font-size:10px;transition:transform .15s}.block-category.collapsed .arrow{transform:rotate(-90deg)}.block-category-header .count{margin-left:auto;font-size:10px;color:#ffffff80;background:#0000004d;padding:2px 6px;border-radius:8px}.block-category-content{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;padding:10px;overflow:visible}.block-category.collapsed .block-category-content{display:none}.block-type{min-width:40px;min-height:40px;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:20px;line-height:1;padding:4px;border-radius:4px;background:#ffffff14;border:1px solid rgba(255,255,255,.1);color:#ffffffe6;transition:all .15s;overflow:visible;box-sizing:border-box}.block-type:hover{background:#ffffff26;border-color:#fff3;transform:scale(1.08)}.block-type.active{background:#4a6fa5;border-color:#6a9fd5;box-shadow:0 0 8px #6a9fd566}.block-type.search-hidden,.block-category.search-hidden{display:none}.block-category.search-match .block-category-content{display:grid!important}#right-panel{position:absolute;top:48px;right:12px;width:180px;display:flex;flex-direction:column;gap:12px;background:#000000b3;padding:10px;border-radius:8px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);z-index:50}.panel-section{display:flex;flex-direction:column;gap:8px}#color-picker{display:flex;align-items:center}#current-color{width:100%;height:32px;border:none;border-radius:4px;cursor:pointer;background:none}#current-color::-webkit-color-swatch-wrapper{padding:0}#current-color::-webkit-color-swatch{border:1px solid rgba(255,255,255,.3);border-radius:4px}#color-palette{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;max-height:180px;overflow-y:auto}.color-swatch{width:100%;aspect-ratio:1;border-radius:3px;border:1px solid rgba(255,255,255,.2);cursor:pointer;transition:transform .1s;min-width:14px;min-height:14px}.color-swatch:hover{transform:scale(1.1);border-color:#fff9}.color-swatch.active{border:2px solid #fff}.view-row{display:flex;align-items:center;gap:6px;font-size:11px;color:#fffc}.view-row label{color:#fff9}.view-row input[type=checkbox]{width:14px;height:14px}.view-row input[type=range]{flex:1;height:4px;-webkit-appearance:none;background:#fff3;border-radius:2px}.view-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#4a9fd5;border-radius:50%;cursor:pointer}.camera-presets{display:grid;grid-template-columns:repeat(6,1fr);gap:4px}.preset-btn{width:100%;height:28px;padding:0;font-size:11px;font-weight:600;background:#ffffff14;border:1px solid rgba(255,255,255,.15);border-radius:4px;color:#fffc;transition:all .15s}.preset-btn:hover{background:#6a9fd54d;border-color:#6a9fd580;color:#fff}.bookmark-controls{margin-top:6px}.bookmark-controls button{width:100%;padding:6px;font-size:11px}#camera-bookmarks{display:flex;flex-direction:column;gap:4px;margin-top:6px;max-height:100px;overflow-y:auto}.bookmark-item{display:flex;align-items:center;gap:6px;padding:6px 8px;background:#ffffff0d;border:1px solid transparent;border-radius:4px;cursor:pointer;transition:all .15s}.bookmark-item:hover{background:#ffffff1a}.bookmark-item .bookmark-name{flex:1;font-size:11px;color:#ffffffe6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.bookmark-item .bookmark-delete{width:18px;height:18px;padding:0;font-size:12px;background:#f003;border:none;border-radius:3px;color:#fff9;cursor:pointer}.bookmark-item .bookmark-delete:hover{background:#f006;color:#fff}.emissive-row{display:flex;align-items:center;gap:6px;font-size:11px;color:#fffc}.emissive-row label{color:#fff9;min-width:50px}.emissive-row input[type=color]{width:40px;height:24px;border:none;border-radius:3px;cursor:pointer;background:none}.emissive-row input[type=range]{flex:1;height:4px;-webkit-appearance:none;background:#fff3;border-radius:2px}.emissive-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#4a9fd5;border-radius:50%;cursor:pointer}.emissive-row input[type=checkbox]{width:14px;height:14px}.emissive-row span{min-width:28px;text-align:right;font-family:monospace}.tattoo-row{display:flex;align-items:center;gap:6px;font-size:11px;color:#fffc}.tattoo-row label{color:#fff9}.tattoo-row input[type=checkbox]{width:14px;height:14px}.tattoo-row input[type=range]{flex:1;height:4px;-webkit-appearance:none;background:#fff3;border-radius:2px}.tattoo-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:#4a9fd5;border-radius:50%;cursor:pointer}.tattoo-row span{min-width:28px;text-align:right;font-family:monospace}.tattoo-row select{flex:1;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:4px;color:#fff;padding:4px 8px;font-size:11px;cursor:pointer}.tattoo-row select:hover{background:#ffffff26}.tattoo-row select option{background:#1a1a2e;color:#fff}.tattoo-actions{display:flex;gap:6px;margin-top:6px}.tattoo-actions button{flex:1;padding:6px 10px;font-size:11px}#tattoo-section{border-top:1px solid rgba(255,255,255,.1);padding-top:8px}#layers-section .section-header{display:flex;justify-content:space-between;align-items:center}#layers-section .section-header button{padding:2px 8px;font-size:14px;line-height:1}#layer-list{display:flex;flex-direction:column;gap:4px;max-height:150px;overflow-y:auto}.layer-item{display:flex;align-items:center;gap:6px;padding:6px 8px;background:#ffffff0d;border:1px solid transparent;border-radius:4px;cursor:pointer;transition:all .15s}.layer-item:hover{background:#ffffff1a}.layer-item.active{background:#4a6fa566;border-color:#6a9fd580}.layer-item .layer-color{width:12px;height:12px;border-radius:2px;border:1px solid rgba(255,255,255,.3);flex-shrink:0}.layer-item .layer-name{flex:1;font-size:11px;color:#ffffffe6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.layer-item .layer-controls{display:flex;gap:2px}.layer-item .layer-btn{width:20px;height:20px;padding:0;display:flex;align-items:center;justify-content:center;font-size:11px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:3px;color:#ffffffb3}.layer-item .layer-btn:hover{background:#ffffff26;color:#fff}.layer-item .layer-btn.off{color:#ffffff4d}.layer-item .layer-btn.locked{color:#f39c12}#selection-props .prop-row{display:flex;justify-content:space-between;color:#fffc;font-size:11px}#selection-props .prop-row label{color:#ffffff80}.prop-row{display:flex;justify-content:space-between;align-items:center;color:#fffc;font-size:11px}.prop-row label{color:#fff9}.prop-row input[type=number]{background:#ffffff1a;border:1px solid rgba(255,255,255,.2);color:#fff;padding:4px 6px;border-radius:4px;font-size:11px}.prop-actions{display:flex;gap:6px;margin-top:4px}.prop-actions button{flex:1;padding:4px 8px;font-size:11px}.move-controls{margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,.1)}.move-grid{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr);gap:4px;margin:8px 0}.move-grid .move-btn[data-dir=up]{grid-column:2;grid-row:1}.move-grid .move-btn[data-dir=left]{grid-column:1;grid-row:2}.move-grid .move-btn[data-dir=down]{grid-column:2;grid-row:2}.move-grid .move-btn[data-dir=right]{grid-column:3;grid-row:2}.move-vertical{display:flex;gap:4px}.move-btn{padding:6px;font-size:12px;min-width:32px}.move-vertical .move-btn{flex:1}#timeline-panel{position:absolute;bottom:40px;left:70px;right:200px;background:#000c;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border-radius:8px;padding:10px;z-index:50}#timeline-controls{display:flex;align-items:center;gap:8px;margin-bottom:8px}#anim-select{background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:4px;color:#fff;padding:4px 8px;font-size:12px;min-width:140px}#anim-select option{background:#1a1a2e}#time-display{color:#ffffffb3;font-family:monospace;min-width:50px}#timeline-controls label{color:#ffffffb3;font-size:11px}.timeline-label{margin-left:8px}#anim-duration{width:70px;background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:4px;color:#fff;padding:4px 6px;font-size:11px}#anim-speed{background:#ffffff1a;border:1px solid rgba(255,255,255,.2);border-radius:4px;color:#fff;padding:4px 6px;font-size:11px}#anim-speed option{background:#1a1a2e}#btn-delete-anim{background:#e74c3c4d;border-color:#e74c3c80}#btn-delete-anim:hover{background:#e74c3c80}#timeline-track{position:relative;height:30px;background:#ffffff0d;border-radius:4px;margin-bottom:8px}#timeline-slider{width:100%;height:100%;-webkit-appearance:none;background:transparent;cursor:pointer}#timeline-slider::-webkit-slider-thumb{-webkit-appearance:none;width:4px;height:30px;background:#4a9fd5;border-radius:2px;cursor:ew-resize}#timeline-slider::-moz-range-thumb{width:4px;height:30px;background:#4a9fd5;border:none;border-radius:2px;cursor:ew-resize}#keyframes-container{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none}.keyframe-marker{position:absolute;width:8px;height:8px;background:#f1c40f;border-radius:2px;transform:translate(-50%) rotate(45deg);top:50%;margin-top:-4px;cursor:pointer;pointer-events:auto;transition:transform .1s,background-color .1s}.keyframe-marker:hover{transform:translate(-50%) rotate(45deg) scale(1.3);background:#f39c12}.keyframe-marker.selected{background:#3498db;box-shadow:0 0 4px #3498dbcc}.keyframe-marker.selected:hover{background:#2980b9}#timeline-actions{display:flex;gap:6px}#timeline-actions button{padding:4px 10px;font-size:11px}#info{position:absolute;bottom:0;left:0;right:0;height:28px;display:flex;align-items:center;gap:20px;padding:0 16px;background:#0009;font-size:11px;color:#fff9;font-family:SF Mono,Monaco,Cascadia Code,monospace;z-index:100}#tool-hint{margin-left:auto;color:#fff6}.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-content{background:#1a1a2e;border:1px solid rgba(255,255,255,.2);border-radius:8px;width:420px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 8px 32px #00000080}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.1)}.modal-header h3{margin:0;font-size:14px;font-weight:500;color:#fff}.modal-close{background:none;border:none;color:#fff9;font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}.modal-close:hover{color:#fff;background:none}.modal-body{padding:16px;overflow-y:auto;flex:1}.modal-footer{display:flex;justify-content:flex-end;gap:8px;padding:12px 16px;border-top:1px solid rgba(255,255,255,.1)}.modal-footer button.primary{background:#4a6fa5;border-color:#6a9fd5}.modal-footer button.primary:hover{background:#5a8fc5}.export-section{margin-bottom:16px}.export-section .section-label{display:block;margin-bottom:8px;font-size:11px;color:#ffffff80;text-transform:uppercase;letter-spacing:.5px}.export-row{display:flex;align-items:center;gap:8px;padding:6px 0;flex-wrap:wrap}.export-row input[type=checkbox],.export-row input[type=radio]{width:14px;height:14px}.export-row label{color:#ffffffe6;font-size:12px;cursor:pointer}.export-row .hint{width:100%;font-size:10px;color:#fff6;margin-left:22px;margin-top:-2px}.export-stats{background:#ffffff0d;border-radius:4px;padding:12px;margin-top:8px}.stats-row{display:flex;justify-content:space-between;font-size:11px;color:#ffffffb3;padding:4px 0}.stats-row span:last-child{font-family:monospace;color:#4a9fd5}.templates-modal-content{width:500px;max-height:70vh}.templates-modal-content .modal-body{padding:0;max-height:calc(70vh - 60px);overflow-y:auto}.template-category{border-bottom:1px solid rgba(255,255,255,.1)}.template-category:last-child{border-bottom:none}.template-category-header{display:flex;align-items:center;padding:12px 16px;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:13px;color:#ffffffe6;background:#ffffff0d;transition:background .15s;font-weight:500}.template-category-header:hover{background:#ffffff1a}.template-category-header .arrow{margin-right:10px;font-size:10px;transition:transform .15s;color:#ffffff80}.template-category.collapsed .arrow{transform:rotate(-90deg)}.template-category-header .count{margin-left:auto;font-size:11px;color:#fff6;background:#0000004d;padding:2px 8px;border-radius:10px}.template-category-content{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:12px 16px;background:#0003}.template-category.collapsed .template-category-content{display:none}.template-item{display:flex;flex-direction:column;padding:10px 12px;background:#ffffff0d;border:1px solid rgba(255,255,255,.1);border-radius:6px;cursor:pointer;transition:all .15s;text-align:left}.template-item:hover{background:#ffffff1f;border-color:#fff3;transform:translateY(-1px)}.template-item:active{transform:translateY(0)}.template-item .template-name{font-size:12px;font-weight:500;color:#ffffffe6;margin-bottom:4px}.template-item .template-desc{font-size:10px;color:#ffffff80;line-height:1.3}@media(max-width:800px){#right-panel{width:150px}#timeline-panel{left:60px;right:160px}.modal-content{width:90%;max-width:400px}}#notifications{position:fixed;bottom:90px;right:20px;z-index:1000;display:flex;flex-direction:column;gap:8px;pointer-events:none}.notification{display:flex;align-items:center;gap:10px;padding:12px 16px;border-radius:8px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);animation:slideIn .3s ease;pointer-events:auto;max-width:350px}.notification.info{background:#4a6fa5e6;border:1px solid rgba(106,159,213,.5);color:#fff}.notification.success{background:#4caf50e6;border:1px solid rgba(129,199,132,.5);color:#fff}.notification.warning{background:#ff9800e6;border:1px solid rgba(255,183,77,.5);color:#fff}.notification.error{background:#f44336e6;border:1px solid rgba(239,83,80,.5);color:#fff}.notification .icon{font-size:18px;flex-shrink:0}.notification .message{font-size:13px;line-height:1.4}.notification .close-btn{background:none;border:none;color:#ffffffb3;cursor:pointer;padding:4px;margin-left:auto;font-size:16px;line-height:1}.notification .close-btn:hover{color:#fff}.notification.fade-out{animation:slideOut .3s ease forwards}@keyframes slideIn{0%{opacity:0;transform:translate(100%)}to{opacity:1;transform:translate(0)}}@keyframes slideOut{0%{opacity:1;transform:translate(0)}to{opacity:0;transform:translate(100%)}}
/*$vite$:1*/`,document.head.appendChild(fn);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const lo="170",Je={ROTATE:0,DOLLY:1,PAN:2},pi={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},qd=0,Up=1,jd=2,Np=1,Op=2,Yo=3,Oo=0,Qe=1,Ze=2,$o=0,hi=1,Va=2,Vp=3,Hp=4,Kd=5,Dn=100,Jd=101,Qd=102,tf=103,ef=104,of=200,nf=201,sf=202,rf=203,Ha=204,Ga=205,af=206,lf=207,cf=208,pf=209,hf=210,uf=211,df=212,ff=213,mf=214,Xa=0,Wa=1,Za=2,ui=3,Ya=4,$a=5,qa=6,ja=7,Gp=0,yf=1,gf=2,mn=0,Xp=1,Wp=2,Zp=3,Yp=4,xf=5,$p=6,qp=7,jp=300,di=301,fi=302,Ka=303,Ja=304,Js=306,Qs=1e3,yn=1001,tr=1002,Se=1003,Kp=1004,ps=1005,uo=1006,er=1007,gn=1008,qo=1009,Jp=1010,Qp=1011,hs=1012,Qa=1013,In=1014,Vo=1015,jo=1016,tl=1017,el=1018,mi=1020,th=35902,eh=1021,oh=1022,fo=1023,nh=1024,ih=1025,yi=1026,gi=1027,ol=1028,nl=1029,sh=1030,il=1031,sl=1033,or=33776,nr=33777,ir=33778,sr=33779,rl=35840,al=35841,ll=35842,cl=35843,pl=36196,hl=37492,ul=37496,dl=37808,fl=37809,ml=37810,yl=37811,gl=37812,xl=37813,bl=37814,vl=37815,_l=37816,wl=37817,Ml=37818,zl=37819,Sl=37820,El=37821,rr=36492,Fl=36494,Al=36495,rh=36283,Tl=36284,Cl=36285,kl=36286,us=2300,ar=2301,Bl=2302,ah=2400,lh=2401,ch=2402,bf=2500,vf=3200,_f=3201,ph=0,wf=1,Ko="",to="srgb",xi="srgb-linear",lr="linear",ue="srgb",bi=7680,hh=519,Mf=512,zf=513,Sf=514,uh=515,Ef=516,Ff=517,Af=518,Tf=519,dh=35044,fh="300 es",Jo=2e3,cr=2001;class Ln{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const o=this._listeners;o[t]===void 0&&(o[t]=[]),o[t].indexOf(e)===-1&&o[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const o=this._listeners;return o[t]!==void 0&&o[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const o=this._listeners[t.type];if(o!==void 0){t.target=this;const n=o.slice(0);for(let s=0,r=n.length;s<r;s++)n[s].call(this,t);t.target=null}}}const Ye=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let mh=1234567;const vi=Math.PI/180,ds=180/Math.PI;function xn(){const i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,o=Math.random()*4294967295|0;return(Ye[i&255]+Ye[i>>8&255]+Ye[i>>16&255]+Ye[i>>24&255]+"-"+Ye[t&255]+Ye[t>>8&255]+"-"+Ye[t>>16&15|64]+Ye[t>>24&255]+"-"+Ye[e&63|128]+Ye[e>>8&255]+"-"+Ye[e>>16&255]+Ye[e>>24&255]+Ye[o&255]+Ye[o>>8&255]+Ye[o>>16&255]+Ye[o>>24&255]).toLowerCase()}function Ce(i,t,e){return Math.max(t,Math.min(e,i))}function Pl(i,t){return(i%t+t)%t}function Cf(i,t,e,o,n){return o+(i-t)*(n-o)/(e-t)}function kf(i,t,e){return i!==t?(e-i)/(t-i):0}function fs(i,t,e){return(1-e)*i+e*t}function Bf(i,t,e,o){return fs(i,t,1-Math.exp(-e*o))}function Pf(i,t=1){return t-Math.abs(Pl(i,t*2)-t)}function Rf(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t),i*i*(3-2*i))}function Df(i,t,e){return i<=t?0:i>=e?1:(i=(i-t)/(e-t),i*i*i*(i*(i*6-15)+10))}function If(i,t){return i+Math.floor(Math.random()*(t-i+1))}function Lf(i,t){return i+Math.random()*(t-i)}function Uf(i){return i*(.5-Math.random())}function Nf(i){i!==void 0&&(mh=i);let t=mh+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Of(i){return i*vi}function Vf(i){return i*ds}function Hf(i){return(i&i-1)===0&&i!==0}function Gf(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Xf(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Wf(i,t,e,o,n){const s=Math.cos,r=Math.sin,a=s(e/2),l=r(e/2),c=s((t+o)/2),p=r((t+o)/2),h=s((t-o)/2),u=r((t-o)/2),d=s((o-t)/2),y=r((o-t)/2);switch(n){case"XYX":i.set(a*p,l*h,l*u,a*c);break;case"YZY":i.set(l*u,a*p,l*h,a*c);break;case"ZXZ":i.set(l*h,l*u,a*p,a*c);break;case"XZX":i.set(a*p,l*y,l*d,a*c);break;case"YXY":i.set(l*d,a*p,l*y,a*c);break;case"ZYZ":i.set(l*y,l*d,a*p,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function _i(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function eo(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Me={DEG2RAD:vi,RAD2DEG:ds,generateUUID:xn,clamp:Ce,euclideanModulo:Pl,mapLinear:Cf,inverseLerp:kf,lerp:fs,damp:Bf,pingpong:Pf,smoothstep:Rf,smootherstep:Df,randInt:If,randFloat:Lf,randFloatSpread:Uf,seededRandom:Nf,degToRad:Of,radToDeg:Vf,isPowerOfTwo:Hf,ceilPowerOfTwo:Gf,floorPowerOfTwo:Xf,setQuaternionFromProperEuler:Wf,normalize:eo,denormalize:_i};class ct{constructor(t=0,e=0){ct.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,o=this.y,n=t.elements;return this.x=n[0]*e+n[3]*o+n[6],this.y=n[1]*e+n[4]*o+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(e,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const o=this.dot(t)/e;return Math.acos(Ce(o,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,o=this.y-t.y;return e*e+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,o){return this.x=t.x+(e.x-t.x)*o,this.y=t.y+(e.y-t.y)*o,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const o=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*o-r*n+t.x,this.y=s*n+r*o+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Kt{constructor(t,e,o,n,s,r,a,l,c){Kt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,o,n,s,r,a,l,c)}set(t,e,o,n,s,r,a,l,c){const p=this.elements;return p[0]=t,p[1]=n,p[2]=a,p[3]=e,p[4]=s,p[5]=l,p[6]=o,p[7]=r,p[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,o=t.elements;return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],this}extractBasis(t,e,o){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),o.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const o=t.elements,n=e.elements,s=this.elements,r=o[0],a=o[3],l=o[6],c=o[1],p=o[4],h=o[7],u=o[2],d=o[5],y=o[8],g=n[0],f=n[3],m=n[6],b=n[1],v=n[4],x=n[7],_=n[2],z=n[5],E=n[8];return s[0]=r*g+a*b+l*_,s[3]=r*f+a*v+l*z,s[6]=r*m+a*x+l*E,s[1]=c*g+p*b+h*_,s[4]=c*f+p*v+h*z,s[7]=c*m+p*x+h*E,s[2]=u*g+d*b+y*_,s[5]=u*f+d*v+y*z,s[8]=u*m+d*x+y*E,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],o=t[1],n=t[2],s=t[3],r=t[4],a=t[5],l=t[6],c=t[7],p=t[8];return e*r*p-e*a*c-o*s*p+o*a*l+n*s*c-n*r*l}invert(){const t=this.elements,e=t[0],o=t[1],n=t[2],s=t[3],r=t[4],a=t[5],l=t[6],c=t[7],p=t[8],h=p*r-a*c,u=a*l-p*s,d=c*s-r*l,y=e*h+o*u+n*d;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/y;return t[0]=h*g,t[1]=(n*c-p*o)*g,t[2]=(a*o-n*r)*g,t[3]=u*g,t[4]=(p*e-n*l)*g,t[5]=(n*s-a*e)*g,t[6]=d*g,t[7]=(o*l-c*e)*g,t[8]=(r*e-o*s)*g,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,o,n,s,r,a){const l=Math.cos(s),c=Math.sin(s);return this.set(o*l,o*c,-o*(l*r+c*a)+r+t,-n*c,n*l,-n*(-c*r+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Rl.makeScale(t,e)),this}rotate(t){return this.premultiply(Rl.makeRotation(-t)),this}translate(t,e){return this.premultiply(Rl.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),o=Math.sin(t);return this.set(e,-o,0,o,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,o=t.elements;for(let n=0;n<9;n++)if(e[n]!==o[n])return!1;return!0}fromArray(t,e=0){for(let o=0;o<9;o++)this.elements[o]=t[o+e];return this}toArray(t=[],e=0){const o=this.elements;return t[e]=o[0],t[e+1]=o[1],t[e+2]=o[2],t[e+3]=o[3],t[e+4]=o[4],t[e+5]=o[5],t[e+6]=o[6],t[e+7]=o[7],t[e+8]=o[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Rl=new Kt;function yh(i){for(let t=i.length-1;t>=0;--t)if(i[t]>=65535)return!0;return!1}function ms(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Zf(){const i=ms("canvas");return i.style.display="block",i}const gh={};function ys(i){i in gh||(gh[i]=!0,console.warn(i))}function Yf(i,t,e){return new Promise(function(o,n){function s(){switch(i.clientWaitSync(t,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:n();break;case i.TIMEOUT_EXPIRED:setTimeout(s,e);break;default:o()}}setTimeout(s,e)})}function $f(i){const t=i.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function qf(i){const t=i.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const re={enabled:!0,workingColorSpace:xi,spaces:{},convert:function(i,t,e){return this.enabled===!1||t===e||!t||!e||(this.spaces[t].transfer===ue&&(i.r=Qo(i.r),i.g=Qo(i.g),i.b=Qo(i.b)),this.spaces[t].primaries!==this.spaces[e].primaries&&(i.applyMatrix3(this.spaces[t].toXYZ),i.applyMatrix3(this.spaces[e].fromXYZ)),this.spaces[e].transfer===ue&&(i.r=wi(i.r),i.g=wi(i.g),i.b=wi(i.b))),i},fromWorkingColorSpace:function(i,t){return this.convert(i,this.workingColorSpace,t)},toWorkingColorSpace:function(i,t){return this.convert(i,t,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Ko?lr:this.spaces[i].transfer},getLuminanceCoefficients:function(i,t=this.workingColorSpace){return i.fromArray(this.spaces[t].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,t,e){return i.copy(this.spaces[t].toXYZ).multiply(this.spaces[e].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}};function Qo(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function wi(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const xh=[.64,.33,.3,.6,.15,.06],bh=[.2126,.7152,.0722],vh=[.3127,.329],_h=new Kt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),wh=new Kt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);re.define({[xi]:{primaries:xh,whitePoint:vh,transfer:lr,toXYZ:_h,fromXYZ:wh,luminanceCoefficients:bh,workingColorSpaceConfig:{unpackColorSpace:to},outputColorSpaceConfig:{drawingBufferColorSpace:to}},[to]:{primaries:xh,whitePoint:vh,transfer:ue,toXYZ:_h,fromXYZ:wh,luminanceCoefficients:bh,outputColorSpaceConfig:{drawingBufferColorSpace:to}}});let Mi;class jf{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Mi===void 0&&(Mi=ms("canvas")),Mi.width=t.width,Mi.height=t.height;const o=Mi.getContext("2d");t instanceof ImageData?o.putImageData(t,0,0):o.drawImage(t,0,0,t.width,t.height),e=Mi}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=ms("canvas");e.width=t.width,e.height=t.height;const o=e.getContext("2d");o.drawImage(t,0,0,t.width,t.height);const n=o.getImageData(0,0,t.width,t.height),s=n.data;for(let r=0;r<s.length;r++)s[r]=Qo(s[r]/255)*255;return o.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let o=0;o<e.length;o++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[o]=Math.floor(Qo(e[o]/255)*255):e[o]=Qo(e[o]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Kf=0;class Dl{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Kf++}),this.uuid=xn(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const o={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let r=0,a=n.length;r<a;r++)n[r].isDataTexture?s.push(Il(n[r].image)):s.push(Il(n[r]))}else s=Il(n);o.url=s}return e||(t.images[this.uuid]=o),o}}function Il(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?jf.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Jf=0;class Ue extends Ln{constructor(t=Ue.DEFAULT_IMAGE,e=Ue.DEFAULT_MAPPING,o=yn,n=yn,s=uo,r=gn,a=fo,l=qo,c=Ue.DEFAULT_ANISOTROPY,p=Ko){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Jf++}),this.uuid=xn(),this.name="",this.source=new Dl(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=o,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ct(0,0),this.repeat=new ct(1,1),this.center=new ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Kt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const o={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(o.userData=this.userData),e||(t.textures[this.uuid]=o),o}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==jp)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Qs:t.x=t.x-Math.floor(t.x);break;case yn:t.x=t.x<0?0:1;break;case tr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Qs:t.y=t.y-Math.floor(t.y);break;case yn:t.y=t.y<0?0:1;break;case tr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ue.DEFAULT_IMAGE=null,Ue.DEFAULT_MAPPING=jp,Ue.DEFAULT_ANISOTROPY=1;class se{constructor(t=0,e=0,o=0,n=1){se.prototype.isVector4=!0,this.x=t,this.y=e,this.z=o,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,o,n){return this.x=t,this.y=e,this.z=o,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,o=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*o+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*o+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*o+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*o+r[11]*n+r[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,o,n,s;const l=t.elements,c=l[0],p=l[4],h=l[8],u=l[1],d=l[5],y=l[9],g=l[2],f=l[6],m=l[10];if(Math.abs(p-u)<.01&&Math.abs(h-g)<.01&&Math.abs(y-f)<.01){if(Math.abs(p+u)<.1&&Math.abs(h+g)<.1&&Math.abs(y+f)<.1&&Math.abs(c+d+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const v=(c+1)/2,x=(d+1)/2,_=(m+1)/2,z=(p+u)/4,E=(h+g)/4,C=(y+f)/4;return v>x&&v>_?v<.01?(o=0,n=.707106781,s=.707106781):(o=Math.sqrt(v),n=z/o,s=E/o):x>_?x<.01?(o=.707106781,n=0,s=.707106781):(n=Math.sqrt(x),o=z/n,s=C/n):_<.01?(o=.707106781,n=.707106781,s=0):(s=Math.sqrt(_),o=E/s,n=C/s),this.set(o,n,s,e),this}let b=Math.sqrt((f-y)*(f-y)+(h-g)*(h-g)+(u-p)*(u-p));return Math.abs(b)<.001&&(b=1),this.x=(f-y)/b,this.y=(h-g)/b,this.z=(u-p)/b,this.w=Math.acos((c+d+m-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(e,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,o){return this.x=t.x+(e.x-t.x)*o,this.y=t.y+(e.y-t.y)*o,this.z=t.z+(e.z-t.z)*o,this.w=t.w+(e.w-t.w)*o,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Qf extends Ln{constructor(t=1,e=1,o={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new se(0,0,t,e),this.scissorTest=!1,this.viewport=new se(0,0,t,e);const n={width:t,height:e,depth:1};o=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:uo,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},o);const s=new Ue(n,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.colorSpace);s.flipY=!1,s.generateMipmaps=o.generateMipmaps,s.internalFormat=o.internalFormat,this.textures=[];const r=o.count;for(let a=0;a<r;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,this.resolveDepthBuffer=o.resolveDepthBuffer,this.resolveStencilBuffer=o.resolveStencilBuffer,this.depthTexture=o.depthTexture,this.samples=o.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,o=1){if(this.width!==t||this.height!==e||this.depth!==o){this.width=t,this.height=e,this.depth=o;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=t,this.textures[n].image.height=e,this.textures[n].image.depth=o;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let o=0,n=t.textures.length;o<n;o++)this.textures[o]=t.textures[o].clone(),this.textures[o].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Dl(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class mo extends Qf{constructor(t=1,e=1,o={}){super(t,e,o),this.isWebGLRenderTarget=!0}}class Mh extends Ue{constructor(t=null,e=1,o=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:o,depth:n},this.magFilter=Se,this.minFilter=Se,this.wrapR=yn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class tm extends Ue{constructor(t=null,e=1,o=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:o,depth:n},this.magFilter=Se,this.minFilter=Se,this.wrapR=yn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Mo{constructor(t=0,e=0,o=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=o,this._w=n}static slerpFlat(t,e,o,n,s,r,a){let l=o[n+0],c=o[n+1],p=o[n+2],h=o[n+3];const u=s[r+0],d=s[r+1],y=s[r+2],g=s[r+3];if(a===0){t[e+0]=l,t[e+1]=c,t[e+2]=p,t[e+3]=h;return}if(a===1){t[e+0]=u,t[e+1]=d,t[e+2]=y,t[e+3]=g;return}if(h!==g||l!==u||c!==d||p!==y){let f=1-a;const m=l*u+c*d+p*y+h*g,b=m>=0?1:-1,v=1-m*m;if(v>Number.EPSILON){const _=Math.sqrt(v),z=Math.atan2(_,m*b);f=Math.sin(f*z)/_,a=Math.sin(a*z)/_}const x=a*b;if(l=l*f+u*x,c=c*f+d*x,p=p*f+y*x,h=h*f+g*x,f===1-a){const _=1/Math.sqrt(l*l+c*c+p*p+h*h);l*=_,c*=_,p*=_,h*=_}}t[e]=l,t[e+1]=c,t[e+2]=p,t[e+3]=h}static multiplyQuaternionsFlat(t,e,o,n,s,r){const a=o[n],l=o[n+1],c=o[n+2],p=o[n+3],h=s[r],u=s[r+1],d=s[r+2],y=s[r+3];return t[e]=a*y+p*h+l*d-c*u,t[e+1]=l*y+p*u+c*h-a*d,t[e+2]=c*y+p*d+a*u-l*h,t[e+3]=p*y-a*h-l*u-c*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,o,n){return this._x=t,this._y=e,this._z=o,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const o=t._x,n=t._y,s=t._z,r=t._order,a=Math.cos,l=Math.sin,c=a(o/2),p=a(n/2),h=a(s/2),u=l(o/2),d=l(n/2),y=l(s/2);switch(r){case"XYZ":this._x=u*p*h+c*d*y,this._y=c*d*h-u*p*y,this._z=c*p*y+u*d*h,this._w=c*p*h-u*d*y;break;case"YXZ":this._x=u*p*h+c*d*y,this._y=c*d*h-u*p*y,this._z=c*p*y-u*d*h,this._w=c*p*h+u*d*y;break;case"ZXY":this._x=u*p*h-c*d*y,this._y=c*d*h+u*p*y,this._z=c*p*y+u*d*h,this._w=c*p*h-u*d*y;break;case"ZYX":this._x=u*p*h-c*d*y,this._y=c*d*h+u*p*y,this._z=c*p*y-u*d*h,this._w=c*p*h+u*d*y;break;case"YZX":this._x=u*p*h+c*d*y,this._y=c*d*h+u*p*y,this._z=c*p*y-u*d*h,this._w=c*p*h-u*d*y;break;case"XZY":this._x=u*p*h-c*d*y,this._y=c*d*h-u*p*y,this._z=c*p*y+u*d*h,this._w=c*p*h+u*d*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const o=e/2,n=Math.sin(o);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(o),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,o=e[0],n=e[4],s=e[8],r=e[1],a=e[5],l=e[9],c=e[2],p=e[6],h=e[10],u=o+a+h;if(u>0){const d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(p-l)*d,this._y=(s-c)*d,this._z=(r-n)*d}else if(o>a&&o>h){const d=2*Math.sqrt(1+o-a-h);this._w=(p-l)/d,this._x=.25*d,this._y=(n+r)/d,this._z=(s+c)/d}else if(a>h){const d=2*Math.sqrt(1+a-o-h);this._w=(s-c)/d,this._x=(n+r)/d,this._y=.25*d,this._z=(l+p)/d}else{const d=2*Math.sqrt(1+h-o-a);this._w=(r-n)/d,this._x=(s+c)/d,this._y=(l+p)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let o=t.dot(e)+1;return o<Number.EPSILON?(o=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=o):(this._x=0,this._y=-t.z,this._z=t.y,this._w=o)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=o),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ce(this.dot(t),-1,1)))}rotateTowards(t,e){const o=this.angleTo(t);if(o===0)return this;const n=Math.min(1,e/o);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const o=t._x,n=t._y,s=t._z,r=t._w,a=e._x,l=e._y,c=e._z,p=e._w;return this._x=o*p+r*a+n*c-s*l,this._y=n*p+r*l+s*a-o*c,this._z=s*p+r*c+o*l-n*a,this._w=r*p-o*a-n*l-s*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const o=this._x,n=this._y,s=this._z,r=this._w;let a=r*t._w+o*t._x+n*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=o,this._y=n,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const d=1-e;return this._w=d*r+e*this._w,this._x=d*o+e*this._x,this._y=d*n+e*this._y,this._z=d*s+e*this._z,this.normalize(),this}const c=Math.sqrt(l),p=Math.atan2(c,a),h=Math.sin((1-e)*p)/c,u=Math.sin(e*p)/c;return this._w=r*h+this._w*u,this._x=o*h+this._x*u,this._y=n*h+this._y*u,this._z=s*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,o){return this.copy(t).slerp(e,o)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),o=Math.random(),n=Math.sqrt(1-o),s=Math.sqrt(o);return this.set(n*Math.sin(t),n*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class R{constructor(t=0,e=0,o=0){R.prototype.isVector3=!0,this.x=t,this.y=e,this.z=o}set(t,e,o){return o===void 0&&(o=this.z),this.x=t,this.y=e,this.z=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(zh.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(zh.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,o=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*o+s[6]*n,this.y=s[1]*e+s[4]*o+s[7]*n,this.z=s[2]*e+s[5]*o+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,o=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*o+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*o+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*o+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*o+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,o=this.y,n=this.z,s=t.x,r=t.y,a=t.z,l=t.w,c=2*(r*n-a*o),p=2*(a*e-s*n),h=2*(s*o-r*e);return this.x=e+l*c+r*h-a*p,this.y=o+l*p+a*c-s*h,this.z=n+l*h+s*p-r*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,o=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*o+s[8]*n,this.y=s[1]*e+s[5]*o+s[9]*n,this.z=s[2]*e+s[6]*o+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(e,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,o){return this.x=t.x+(e.x-t.x)*o,this.y=t.y+(e.y-t.y)*o,this.z=t.z+(e.z-t.z)*o,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const o=t.x,n=t.y,s=t.z,r=e.x,a=e.y,l=e.z;return this.x=n*l-s*a,this.y=s*r-o*l,this.z=o*a-n*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const o=t.dot(this)/e;return this.copy(t).multiplyScalar(o)}projectOnPlane(t){return Ll.copy(this).projectOnVector(t),this.sub(Ll)}reflect(t){return this.sub(Ll.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const o=this.dot(t)/e;return Math.acos(Ce(o,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,o=this.y-t.y,n=this.z-t.z;return e*e+o*o+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,o){const n=Math.sin(e)*t;return this.x=n*Math.sin(o),this.y=Math.cos(e)*t,this.z=n*Math.cos(o),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,o){return this.x=t*Math.sin(e),this.y=o,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),o=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=o,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,o=Math.sqrt(1-e*e);return this.x=o*Math.cos(t),this.y=e,this.z=o*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ll=new R,zh=new Mo;class Ne{constructor(t=new R(1/0,1/0,1/0),e=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,o=t.length;e<o;e+=3)this.expandByPoint(Bo.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,o=t.count;e<o;e++)this.expandByPoint(Bo.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,o=t.length;e<o;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const o=Bo.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const o=t.geometry;if(o!==void 0){const s=o.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let r=0,a=s.count;r<a;r++)t.isMesh===!0?t.getVertexPosition(r,Bo):Bo.fromBufferAttribute(s,r),Bo.applyMatrix4(t.matrixWorld),this.expandByPoint(Bo);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),pr.copy(t.boundingBox)):(o.boundingBox===null&&o.computeBoundingBox(),pr.copy(o.boundingBox)),pr.applyMatrix4(t.matrixWorld),this.union(pr)}const n=t.children;for(let s=0,r=n.length;s<r;s++)this.expandByObject(n[s],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Bo),Bo.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,o;return t.normal.x>0?(e=t.normal.x*this.min.x,o=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,o=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,o+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,o+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,o+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,o+=t.normal.z*this.min.z),e<=-t.constant&&o>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(gs),hr.subVectors(this.max,gs),zi.subVectors(t.a,gs),Si.subVectors(t.b,gs),Ei.subVectors(t.c,gs),bn.subVectors(Si,zi),vn.subVectors(Ei,Si),Un.subVectors(zi,Ei);let e=[0,-bn.z,bn.y,0,-vn.z,vn.y,0,-Un.z,Un.y,bn.z,0,-bn.x,vn.z,0,-vn.x,Un.z,0,-Un.x,-bn.y,bn.x,0,-vn.y,vn.x,0,-Un.y,Un.x,0];return!Ul(e,zi,Si,Ei,hr)||(e=[1,0,0,0,1,0,0,0,1],!Ul(e,zi,Si,Ei,hr))?!1:(ur.crossVectors(bn,vn),e=[ur.x,ur.y,ur.z],Ul(e,zi,Si,Ei,hr))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Bo).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Bo).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(tn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),tn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),tn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),tn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),tn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),tn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),tn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),tn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(tn),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const tn=[new R,new R,new R,new R,new R,new R,new R,new R],Bo=new R,pr=new Ne,zi=new R,Si=new R,Ei=new R,bn=new R,vn=new R,Un=new R,gs=new R,hr=new R,ur=new R,Nn=new R;function Ul(i,t,e,o,n){for(let s=0,r=i.length-3;s<=r;s+=3){Nn.fromArray(i,s);const a=n.x*Math.abs(Nn.x)+n.y*Math.abs(Nn.y)+n.z*Math.abs(Nn.z),l=t.dot(Nn),c=e.dot(Nn),p=o.dot(Nn);if(Math.max(-Math.max(l,c,p),Math.min(l,c,p))>a)return!1}return!0}const em=new Ne,xs=new R,Nl=new R;class Fi{constructor(t=new R,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const o=this.center;e!==void 0?o.copy(e):em.setFromPoints(t).getCenter(o);let n=0;for(let s=0,r=t.length;s<r;s++)n=Math.max(n,o.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const o=this.center.distanceToSquared(t);return e.copy(t),o>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;xs.subVectors(t,this.center);const e=xs.lengthSq();if(e>this.radius*this.radius){const o=Math.sqrt(e),n=(o-this.radius)*.5;this.center.addScaledVector(xs,n/o),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Nl.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(xs.copy(t.center).add(Nl)),this.expandByPoint(xs.copy(t.center).sub(Nl))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const en=new R,Ol=new R,dr=new R,_n=new R,Vl=new R,fr=new R,Hl=new R;class On{constructor(t=new R,e=new R(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,en)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const o=e.dot(this.direction);return o<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,o)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=en.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(en.copy(this.origin).addScaledVector(this.direction,e),en.distanceToSquared(t))}distanceSqToSegment(t,e,o,n){Ol.copy(t).add(e).multiplyScalar(.5),dr.copy(e).sub(t).normalize(),_n.copy(this.origin).sub(Ol);const s=t.distanceTo(e)*.5,r=-this.direction.dot(dr),a=_n.dot(this.direction),l=-_n.dot(dr),c=_n.lengthSq(),p=Math.abs(1-r*r);let h,u,d,y;if(p>0)if(h=r*l-a,u=r*a-l,y=s*p,h>=0)if(u>=-y)if(u<=y){const g=1/p;h*=g,u*=g,d=h*(h+r*u+2*a)+u*(r*h+u+2*l)+c}else u=s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*l)+c;else u=-s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*l)+c;else u<=-y?(h=Math.max(0,-(-r*s+a)),u=h>0?-s:Math.min(Math.max(-s,-l),s),d=-h*h+u*(u+2*l)+c):u<=y?(h=0,u=Math.min(Math.max(-s,-l),s),d=u*(u+2*l)+c):(h=Math.max(0,-(r*s+a)),u=h>0?s:Math.min(Math.max(-s,-l),s),d=-h*h+u*(u+2*l)+c);else u=r>0?-s:s,h=Math.max(0,-(r*u+a)),d=-h*h+u*(u+2*l)+c;return o&&o.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(Ol).addScaledVector(dr,u),d}intersectSphere(t,e){en.subVectors(t.center,this.origin);const o=en.dot(this.direction),n=en.dot(en)-o*o,s=t.radius*t.radius;if(n>s)return null;const r=Math.sqrt(s-n),a=o-r,l=o+r;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const o=-(this.origin.dot(t.normal)+t.constant)/e;return o>=0?o:null}intersectPlane(t,e){const o=this.distanceToPlane(t);return o===null?null:this.at(o,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let o,n,s,r,a,l;const c=1/this.direction.x,p=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(o=(t.min.x-u.x)*c,n=(t.max.x-u.x)*c):(o=(t.max.x-u.x)*c,n=(t.min.x-u.x)*c),p>=0?(s=(t.min.y-u.y)*p,r=(t.max.y-u.y)*p):(s=(t.max.y-u.y)*p,r=(t.min.y-u.y)*p),o>r||s>n||((s>o||isNaN(o))&&(o=s),(r<n||isNaN(n))&&(n=r),h>=0?(a=(t.min.z-u.z)*h,l=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,l=(t.min.z-u.z)*h),o>l||a>n)||((a>o||o!==o)&&(o=a),(l<n||n!==n)&&(n=l),n<0)?null:this.at(o>=0?o:n,e)}intersectsBox(t){return this.intersectBox(t,en)!==null}intersectTriangle(t,e,o,n,s){Vl.subVectors(e,t),fr.subVectors(o,t),Hl.crossVectors(Vl,fr);let r=this.direction.dot(Hl),a;if(r>0){if(n)return null;a=1}else if(r<0)a=-1,r=-r;else return null;_n.subVectors(this.origin,t);const l=a*this.direction.dot(fr.crossVectors(_n,fr));if(l<0)return null;const c=a*this.direction.dot(Vl.cross(_n));if(c<0||l+c>r)return null;const p=-a*_n.dot(Hl);return p<0?null:this.at(p/r,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class $t{constructor(t,e,o,n,s,r,a,l,c,p,h,u,d,y,g,f){$t.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,o,n,s,r,a,l,c,p,h,u,d,y,g,f)}set(t,e,o,n,s,r,a,l,c,p,h,u,d,y,g,f){const m=this.elements;return m[0]=t,m[4]=e,m[8]=o,m[12]=n,m[1]=s,m[5]=r,m[9]=a,m[13]=l,m[2]=c,m[6]=p,m[10]=h,m[14]=u,m[3]=d,m[7]=y,m[11]=g,m[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new $t().fromArray(this.elements)}copy(t){const e=this.elements,o=t.elements;return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],this}copyPosition(t){const e=this.elements,o=t.elements;return e[12]=o[12],e[13]=o[13],e[14]=o[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,o){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),o.setFromMatrixColumn(this,2),this}makeBasis(t,e,o){return this.set(t.x,e.x,o.x,0,t.y,e.y,o.y,0,t.z,e.z,o.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,o=t.elements,n=1/Ai.setFromMatrixColumn(t,0).length(),s=1/Ai.setFromMatrixColumn(t,1).length(),r=1/Ai.setFromMatrixColumn(t,2).length();return e[0]=o[0]*n,e[1]=o[1]*n,e[2]=o[2]*n,e[3]=0,e[4]=o[4]*s,e[5]=o[5]*s,e[6]=o[6]*s,e[7]=0,e[8]=o[8]*r,e[9]=o[9]*r,e[10]=o[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,o=t.x,n=t.y,s=t.z,r=Math.cos(o),a=Math.sin(o),l=Math.cos(n),c=Math.sin(n),p=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const u=r*p,d=r*h,y=a*p,g=a*h;e[0]=l*p,e[4]=-l*h,e[8]=c,e[1]=d+y*c,e[5]=u-g*c,e[9]=-a*l,e[2]=g-u*c,e[6]=y+d*c,e[10]=r*l}else if(t.order==="YXZ"){const u=l*p,d=l*h,y=c*p,g=c*h;e[0]=u+g*a,e[4]=y*a-d,e[8]=r*c,e[1]=r*h,e[5]=r*p,e[9]=-a,e[2]=d*a-y,e[6]=g+u*a,e[10]=r*l}else if(t.order==="ZXY"){const u=l*p,d=l*h,y=c*p,g=c*h;e[0]=u-g*a,e[4]=-r*h,e[8]=y+d*a,e[1]=d+y*a,e[5]=r*p,e[9]=g-u*a,e[2]=-r*c,e[6]=a,e[10]=r*l}else if(t.order==="ZYX"){const u=r*p,d=r*h,y=a*p,g=a*h;e[0]=l*p,e[4]=y*c-d,e[8]=u*c+g,e[1]=l*h,e[5]=g*c+u,e[9]=d*c-y,e[2]=-c,e[6]=a*l,e[10]=r*l}else if(t.order==="YZX"){const u=r*l,d=r*c,y=a*l,g=a*c;e[0]=l*p,e[4]=g-u*h,e[8]=y*h+d,e[1]=h,e[5]=r*p,e[9]=-a*p,e[2]=-c*p,e[6]=d*h+y,e[10]=u-g*h}else if(t.order==="XZY"){const u=r*l,d=r*c,y=a*l,g=a*c;e[0]=l*p,e[4]=-h,e[8]=c*p,e[1]=u*h+g,e[5]=r*p,e[9]=d*h-y,e[2]=y*h-d,e[6]=a*p,e[10]=g*h+u}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(om,t,nm)}lookAt(t,e,o){const n=this.elements;return yo.subVectors(t,e),yo.lengthSq()===0&&(yo.z=1),yo.normalize(),wn.crossVectors(o,yo),wn.lengthSq()===0&&(Math.abs(o.z)===1?yo.x+=1e-4:yo.z+=1e-4,yo.normalize(),wn.crossVectors(o,yo)),wn.normalize(),mr.crossVectors(yo,wn),n[0]=wn.x,n[4]=mr.x,n[8]=yo.x,n[1]=wn.y,n[5]=mr.y,n[9]=yo.y,n[2]=wn.z,n[6]=mr.z,n[10]=yo.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const o=t.elements,n=e.elements,s=this.elements,r=o[0],a=o[4],l=o[8],c=o[12],p=o[1],h=o[5],u=o[9],d=o[13],y=o[2],g=o[6],f=o[10],m=o[14],b=o[3],v=o[7],x=o[11],_=o[15],z=n[0],E=n[4],C=n[8],M=n[12],S=n[1],k=n[5],A=n[9],B=n[13],F=n[2],N=n[6],G=n[10],W=n[14],et=n[3],K=n[7],pt=n[11],X=n[15];return s[0]=r*z+a*S+l*F+c*et,s[4]=r*E+a*k+l*N+c*K,s[8]=r*C+a*A+l*G+c*pt,s[12]=r*M+a*B+l*W+c*X,s[1]=p*z+h*S+u*F+d*et,s[5]=p*E+h*k+u*N+d*K,s[9]=p*C+h*A+u*G+d*pt,s[13]=p*M+h*B+u*W+d*X,s[2]=y*z+g*S+f*F+m*et,s[6]=y*E+g*k+f*N+m*K,s[10]=y*C+g*A+f*G+m*pt,s[14]=y*M+g*B+f*W+m*X,s[3]=b*z+v*S+x*F+_*et,s[7]=b*E+v*k+x*N+_*K,s[11]=b*C+v*A+x*G+_*pt,s[15]=b*M+v*B+x*W+_*X,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],o=t[4],n=t[8],s=t[12],r=t[1],a=t[5],l=t[9],c=t[13],p=t[2],h=t[6],u=t[10],d=t[14],y=t[3],g=t[7],f=t[11],m=t[15];return y*(+s*l*h-n*c*h-s*a*u+o*c*u+n*a*d-o*l*d)+g*(+e*l*d-e*c*u+s*r*u-n*r*d+n*c*p-s*l*p)+f*(+e*c*h-e*a*d-s*r*h+o*r*d+s*a*p-o*c*p)+m*(-n*a*p-e*l*h+e*a*u+n*r*h-o*r*u+o*l*p)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,o){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=o),this}invert(){const t=this.elements,e=t[0],o=t[1],n=t[2],s=t[3],r=t[4],a=t[5],l=t[6],c=t[7],p=t[8],h=t[9],u=t[10],d=t[11],y=t[12],g=t[13],f=t[14],m=t[15],b=h*f*c-g*u*c+g*l*d-a*f*d-h*l*m+a*u*m,v=y*u*c-p*f*c-y*l*d+r*f*d+p*l*m-r*u*m,x=p*g*c-y*h*c+y*a*d-r*g*d-p*a*m+r*h*m,_=y*h*l-p*g*l-y*a*u+r*g*u+p*a*f-r*h*f,z=e*b+o*v+n*x+s*_;if(z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/z;return t[0]=b*E,t[1]=(g*u*s-h*f*s-g*n*d+o*f*d+h*n*m-o*u*m)*E,t[2]=(a*f*s-g*l*s+g*n*c-o*f*c-a*n*m+o*l*m)*E,t[3]=(h*l*s-a*u*s-h*n*c+o*u*c+a*n*d-o*l*d)*E,t[4]=v*E,t[5]=(p*f*s-y*u*s+y*n*d-e*f*d-p*n*m+e*u*m)*E,t[6]=(y*l*s-r*f*s-y*n*c+e*f*c+r*n*m-e*l*m)*E,t[7]=(r*u*s-p*l*s+p*n*c-e*u*c-r*n*d+e*l*d)*E,t[8]=x*E,t[9]=(y*h*s-p*g*s-y*o*d+e*g*d+p*o*m-e*h*m)*E,t[10]=(r*g*s-y*a*s+y*o*c-e*g*c-r*o*m+e*a*m)*E,t[11]=(p*a*s-r*h*s-p*o*c+e*h*c+r*o*d-e*a*d)*E,t[12]=_*E,t[13]=(p*g*n-y*h*n+y*o*u-e*g*u-p*o*f+e*h*f)*E,t[14]=(y*a*n-r*g*n-y*o*l+e*g*l+r*o*f-e*a*f)*E,t[15]=(r*h*n-p*a*n+p*o*l-e*h*l-r*o*u+e*a*u)*E,this}scale(t){const e=this.elements,o=t.x,n=t.y,s=t.z;return e[0]*=o,e[4]*=n,e[8]*=s,e[1]*=o,e[5]*=n,e[9]*=s,e[2]*=o,e[6]*=n,e[10]*=s,e[3]*=o,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,o,n))}makeTranslation(t,e,o){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,o,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),o=Math.sin(t);return this.set(1,0,0,0,0,e,-o,0,0,o,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),o=Math.sin(t);return this.set(e,0,o,0,0,1,0,0,-o,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),o=Math.sin(t);return this.set(e,-o,0,0,o,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const o=Math.cos(e),n=Math.sin(e),s=1-o,r=t.x,a=t.y,l=t.z,c=s*r,p=s*a;return this.set(c*r+o,c*a-n*l,c*l+n*a,0,c*a+n*l,p*a+o,p*l-n*r,0,c*l-n*a,p*l+n*r,s*l*l+o,0,0,0,0,1),this}makeScale(t,e,o){return this.set(t,0,0,0,0,e,0,0,0,0,o,0,0,0,0,1),this}makeShear(t,e,o,n,s,r){return this.set(1,o,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,o){const n=this.elements,s=e._x,r=e._y,a=e._z,l=e._w,c=s+s,p=r+r,h=a+a,u=s*c,d=s*p,y=s*h,g=r*p,f=r*h,m=a*h,b=l*c,v=l*p,x=l*h,_=o.x,z=o.y,E=o.z;return n[0]=(1-(g+m))*_,n[1]=(d+x)*_,n[2]=(y-v)*_,n[3]=0,n[4]=(d-x)*z,n[5]=(1-(u+m))*z,n[6]=(f+b)*z,n[7]=0,n[8]=(y+v)*E,n[9]=(f-b)*E,n[10]=(1-(u+g))*E,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,o){const n=this.elements;let s=Ai.set(n[0],n[1],n[2]).length();const r=Ai.set(n[4],n[5],n[6]).length(),a=Ai.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],Po.copy(this);const c=1/s,p=1/r,h=1/a;return Po.elements[0]*=c,Po.elements[1]*=c,Po.elements[2]*=c,Po.elements[4]*=p,Po.elements[5]*=p,Po.elements[6]*=p,Po.elements[8]*=h,Po.elements[9]*=h,Po.elements[10]*=h,e.setFromRotationMatrix(Po),o.x=s,o.y=r,o.z=a,this}makePerspective(t,e,o,n,s,r,a=Jo){const l=this.elements,c=2*s/(e-t),p=2*s/(o-n),h=(e+t)/(e-t),u=(o+n)/(o-n);let d,y;if(a===Jo)d=-(r+s)/(r-s),y=-2*r*s/(r-s);else if(a===cr)d=-r/(r-s),y=-r*s/(r-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=p,l[9]=u,l[13]=0,l[2]=0,l[6]=0,l[10]=d,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,o,n,s,r,a=Jo){const l=this.elements,c=1/(e-t),p=1/(o-n),h=1/(r-s),u=(e+t)*c,d=(o+n)*p;let y,g;if(a===Jo)y=(r+s)*h,g=-2*h;else if(a===cr)y=s*h,g=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-u,l[1]=0,l[5]=2*p,l[9]=0,l[13]=-d,l[2]=0,l[6]=0,l[10]=g,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,o=t.elements;for(let n=0;n<16;n++)if(e[n]!==o[n])return!1;return!0}fromArray(t,e=0){for(let o=0;o<16;o++)this.elements[o]=t[o+e];return this}toArray(t=[],e=0){const o=this.elements;return t[e]=o[0],t[e+1]=o[1],t[e+2]=o[2],t[e+3]=o[3],t[e+4]=o[4],t[e+5]=o[5],t[e+6]=o[6],t[e+7]=o[7],t[e+8]=o[8],t[e+9]=o[9],t[e+10]=o[10],t[e+11]=o[11],t[e+12]=o[12],t[e+13]=o[13],t[e+14]=o[14],t[e+15]=o[15],t}}const Ai=new R,Po=new $t,om=new R(0,0,0),nm=new R(1,1,1),wn=new R,mr=new R,yo=new R,Sh=new $t,Eh=new Mo;class oo{constructor(t=0,e=0,o=0,n=oo.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=o,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,o,n=this._order){return this._x=t,this._y=e,this._z=o,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,o=!0){const n=t.elements,s=n[0],r=n[4],a=n[8],l=n[1],c=n[5],p=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(Ce(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-p,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ce(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ce(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ce(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(Ce(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-p,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Ce(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-p,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,o===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,o){return Sh.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Sh,e,o)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Eh.setFromEuler(this),this.setFromQuaternion(Eh,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}oo.DEFAULT_ORDER="XYZ";class Gl{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let im=0;const Fh=new R,Ti=new Mo,on=new $t,yr=new R,bs=new R,sm=new R,rm=new Mo,Ah=new R(1,0,0),Th=new R(0,1,0),Ch=new R(0,0,1),kh={type:"added"},am={type:"removed"},Ci={type:"childadded",child:null},Xl={type:"childremoved",child:null};class Oe extends Ln{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:im++}),this.uuid=xn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oe.DEFAULT_UP.clone();const t=new R,e=new oo,o=new Mo,n=new R(1,1,1);function s(){o.setFromEuler(e,!1)}function r(){e.setFromQuaternion(o,void 0,!1)}e._onChange(s),o._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new $t},normalMatrix:{value:new Kt}}),this.matrix=new $t,this.matrixWorld=new $t,this.matrixAutoUpdate=Oe.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Gl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ti.setFromAxisAngle(t,e),this.quaternion.multiply(Ti),this}rotateOnWorldAxis(t,e){return Ti.setFromAxisAngle(t,e),this.quaternion.premultiply(Ti),this}rotateX(t){return this.rotateOnAxis(Ah,t)}rotateY(t){return this.rotateOnAxis(Th,t)}rotateZ(t){return this.rotateOnAxis(Ch,t)}translateOnAxis(t,e){return Fh.copy(t).applyQuaternion(this.quaternion),this.position.add(Fh.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ah,t)}translateY(t){return this.translateOnAxis(Th,t)}translateZ(t){return this.translateOnAxis(Ch,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(on.copy(this.matrixWorld).invert())}lookAt(t,e,o){t.isVector3?yr.copy(t):yr.set(t,e,o);const n=this.parent;this.updateWorldMatrix(!0,!1),bs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?on.lookAt(bs,yr,this.up):on.lookAt(yr,bs,this.up),this.quaternion.setFromRotationMatrix(on),n&&(on.extractRotation(n.matrixWorld),Ti.setFromRotationMatrix(on),this.quaternion.premultiply(Ti.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(kh),Ci.child=t,this.dispatchEvent(Ci),Ci.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(am),Xl.child=t,this.dispatchEvent(Xl),Xl.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),on.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),on.multiply(t.parent.matrixWorld)),t.applyMatrix4(on),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(kh),Ci.child=t,this.dispatchEvent(Ci),Ci.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let o=0,n=this.children.length;o<n;o++){const r=this.children[o].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,o=[]){this[t]===e&&o.push(this);const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].getObjectsByProperty(t,e,o);return o}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bs,t,sm),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bs,rm,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let o=0,n=e.length;o<n;o++)e[o].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let o=0,n=e.length;o<n;o++)e[o].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let o=0,n=e.length;o<n;o++)e[o].updateMatrixWorld(t)}updateWorldMatrix(t,e){const o=this.parent;if(t===!0&&o!==null&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",o={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},o.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,p=l.length;c<p;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(t.materials,this.material[l]));n.material=a}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let a=0;a<this.children.length;a++)n.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];n.animations.push(s(t.animations,l))}}if(e){const a=r(t.geometries),l=r(t.materials),c=r(t.textures),p=r(t.images),h=r(t.shapes),u=r(t.skeletons),d=r(t.animations),y=r(t.nodes);a.length>0&&(o.geometries=a),l.length>0&&(o.materials=l),c.length>0&&(o.textures=c),p.length>0&&(o.images=p),h.length>0&&(o.shapes=h),u.length>0&&(o.skeletons=u),d.length>0&&(o.animations=d),y.length>0&&(o.nodes=y)}return o.object=n,o;function r(a){const l=[];for(const c in a){const p=a[c];delete p.metadata,l.push(p)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let o=0;o<t.children.length;o++){const n=t.children[o];this.add(n.clone())}return this}}Oe.DEFAULT_UP=new R(0,1,0),Oe.DEFAULT_MATRIX_AUTO_UPDATE=!0,Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ro=new R,nn=new R,Wl=new R,sn=new R,ki=new R,Bi=new R,Bh=new R,Zl=new R,Yl=new R,$l=new R,ql=new se,jl=new se,Kl=new se;class ye{constructor(t=new R,e=new R,o=new R){this.a=t,this.b=e,this.c=o}static getNormal(t,e,o,n){n.subVectors(o,e),Ro.subVectors(t,e),n.cross(Ro);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,o,n,s){Ro.subVectors(n,e),nn.subVectors(o,e),Wl.subVectors(t,e);const r=Ro.dot(Ro),a=Ro.dot(nn),l=Ro.dot(Wl),c=nn.dot(nn),p=nn.dot(Wl),h=r*c-a*a;if(h===0)return s.set(0,0,0),null;const u=1/h,d=(c*l-a*p)*u,y=(r*p-a*l)*u;return s.set(1-d-y,y,d)}static containsPoint(t,e,o,n){return this.getBarycoord(t,e,o,n,sn)===null?!1:sn.x>=0&&sn.y>=0&&sn.x+sn.y<=1}static getInterpolation(t,e,o,n,s,r,a,l){return this.getBarycoord(t,e,o,n,sn)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,sn.x),l.addScaledVector(r,sn.y),l.addScaledVector(a,sn.z),l)}static getInterpolatedAttribute(t,e,o,n,s,r){return ql.setScalar(0),jl.setScalar(0),Kl.setScalar(0),ql.fromBufferAttribute(t,e),jl.fromBufferAttribute(t,o),Kl.fromBufferAttribute(t,n),r.setScalar(0),r.addScaledVector(ql,s.x),r.addScaledVector(jl,s.y),r.addScaledVector(Kl,s.z),r}static isFrontFacing(t,e,o,n){return Ro.subVectors(o,e),nn.subVectors(t,e),Ro.cross(nn).dot(n)<0}set(t,e,o){return this.a.copy(t),this.b.copy(e),this.c.copy(o),this}setFromPointsAndIndices(t,e,o,n){return this.a.copy(t[e]),this.b.copy(t[o]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,o,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,o),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ro.subVectors(this.c,this.b),nn.subVectors(this.a,this.b),Ro.cross(nn).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ye.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ye.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,o,n,s){return ye.getInterpolation(t,this.a,this.b,this.c,e,o,n,s)}containsPoint(t){return ye.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ye.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const o=this.a,n=this.b,s=this.c;let r,a;ki.subVectors(n,o),Bi.subVectors(s,o),Zl.subVectors(t,o);const l=ki.dot(Zl),c=Bi.dot(Zl);if(l<=0&&c<=0)return e.copy(o);Yl.subVectors(t,n);const p=ki.dot(Yl),h=Bi.dot(Yl);if(p>=0&&h<=p)return e.copy(n);const u=l*h-p*c;if(u<=0&&l>=0&&p<=0)return r=l/(l-p),e.copy(o).addScaledVector(ki,r);$l.subVectors(t,s);const d=ki.dot($l),y=Bi.dot($l);if(y>=0&&d<=y)return e.copy(s);const g=d*c-l*y;if(g<=0&&c>=0&&y<=0)return a=c/(c-y),e.copy(o).addScaledVector(Bi,a);const f=p*y-d*h;if(f<=0&&h-p>=0&&d-y>=0)return Bh.subVectors(s,n),a=(h-p)/(h-p+(d-y)),e.copy(n).addScaledVector(Bh,a);const m=1/(f+g+u);return r=g*m,a=u*m,e.copy(o).addScaledVector(ki,r).addScaledVector(Bi,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Ph={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mn={h:0,s:0,l:0},gr={h:0,s:0,l:0};function Jl(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}class bt{constructor(t,e,o){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,o)}set(t,e,o){if(e===void 0&&o===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,e,o);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=to){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,re.toWorkingColorSpace(this,e),this}setRGB(t,e,o,n=re.workingColorSpace){return this.r=t,this.g=e,this.b=o,re.toWorkingColorSpace(this,n),this}setHSL(t,e,o,n=re.workingColorSpace){if(t=Pl(t,1),e=Ce(e,0,1),o=Ce(o,0,1),e===0)this.r=this.g=this.b=o;else{const s=o<=.5?o*(1+e):o+e-o*e,r=2*o-s;this.r=Jl(r,s,t+1/3),this.g=Jl(r,s,t),this.b=Jl(r,s,t-1/3)}return re.toWorkingColorSpace(this,n),this}setStyle(t,e=to){function o(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return o(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return o(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return o(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],r=s.length;if(r===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(r===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=to){const o=Ph[t.toLowerCase()];return o!==void 0?this.setHex(o,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Qo(t.r),this.g=Qo(t.g),this.b=Qo(t.b),this}copyLinearToSRGB(t){return this.r=wi(t.r),this.g=wi(t.g),this.b=wi(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=to){return re.fromWorkingColorSpace($e.copy(this),t),Math.round(Ce($e.r*255,0,255))*65536+Math.round(Ce($e.g*255,0,255))*256+Math.round(Ce($e.b*255,0,255))}getHexString(t=to){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=re.workingColorSpace){re.fromWorkingColorSpace($e.copy(this),e);const o=$e.r,n=$e.g,s=$e.b,r=Math.max(o,n,s),a=Math.min(o,n,s);let l,c;const p=(a+r)/2;if(a===r)l=0,c=0;else{const h=r-a;switch(c=p<=.5?h/(r+a):h/(2-r-a),r){case o:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-o)/h+2;break;case s:l=(o-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=p,t}getRGB(t,e=re.workingColorSpace){return re.fromWorkingColorSpace($e.copy(this),e),t.r=$e.r,t.g=$e.g,t.b=$e.b,t}getStyle(t=to){re.fromWorkingColorSpace($e.copy(this),t);const e=$e.r,o=$e.g,n=$e.b;return t!==to?`color(${t} ${e.toFixed(3)} ${o.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(o*255)},${Math.round(n*255)})`}offsetHSL(t,e,o){return this.getHSL(Mn),this.setHSL(Mn.h+t,Mn.s+e,Mn.l+o)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,o){return this.r=t.r+(e.r-t.r)*o,this.g=t.g+(e.g-t.g)*o,this.b=t.b+(e.b-t.b)*o,this}lerpHSL(t,e){this.getHSL(Mn),t.getHSL(gr);const o=fs(Mn.h,gr.h,e),n=fs(Mn.s,gr.s,e),s=fs(Mn.l,gr.l,e);return this.setHSL(o,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,o=this.g,n=this.b,s=t.elements;return this.r=s[0]*e+s[3]*o+s[6]*n,this.g=s[1]*e+s[4]*o+s[7]*n,this.b=s[2]*e+s[5]*o+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const $e=new bt;bt.NAMES=Ph;let lm=0;class Pi extends Ln{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:lm++}),this.uuid=xn(),this.name="",this.blending=hi,this.side=Oo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ha,this.blendDst=Ga,this.blendEquation=Dn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bt(0,0,0),this.blendAlpha=0,this.depthFunc=ui,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bi,this.stencilZFail=bi,this.stencilZPass=bi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const o=t[e];if(o===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];if(n===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(o):n&&n.isVector3&&o&&o.isVector3?n.copy(o):this[e]=o}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const o={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),this.roughness!==void 0&&(o.roughness=this.roughness),this.metalness!==void 0&&(o.metalness=this.metalness),this.sheen!==void 0&&(o.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(o.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(o.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(o.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(o.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(o.shininess=this.shininess),this.clearcoat!==void 0&&(o.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(o.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(o.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(o.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,o.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(o.dispersion=this.dispersion),this.iridescence!==void 0&&(o.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(o.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(o.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(o.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(o.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(o.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(o.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(o.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(t).uuid,o.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(t).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(t).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(t).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(t).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(o.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(o.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(o.combine=this.combine)),this.envMapRotation!==void 0&&(o.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(o.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(o.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(o.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(o.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(o.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(o.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(o.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(o.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(o.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(o.size=this.size),this.shadowSide!==null&&(o.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(o.sizeAttenuation=this.sizeAttenuation),this.blending!==hi&&(o.blending=this.blending),this.side!==Oo&&(o.side=this.side),this.vertexColors===!0&&(o.vertexColors=!0),this.opacity<1&&(o.opacity=this.opacity),this.transparent===!0&&(o.transparent=!0),this.blendSrc!==Ha&&(o.blendSrc=this.blendSrc),this.blendDst!==Ga&&(o.blendDst=this.blendDst),this.blendEquation!==Dn&&(o.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(o.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(o.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(o.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(o.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(o.blendAlpha=this.blendAlpha),this.depthFunc!==ui&&(o.depthFunc=this.depthFunc),this.depthTest===!1&&(o.depthTest=this.depthTest),this.depthWrite===!1&&(o.depthWrite=this.depthWrite),this.colorWrite===!1&&(o.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(o.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==hh&&(o.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(o.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(o.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==bi&&(o.stencilFail=this.stencilFail),this.stencilZFail!==bi&&(o.stencilZFail=this.stencilZFail),this.stencilZPass!==bi&&(o.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(o.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(o.rotation=this.rotation),this.polygonOffset===!0&&(o.polygonOffset=!0),this.polygonOffsetFactor!==0&&(o.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(o.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(o.linewidth=this.linewidth),this.dashSize!==void 0&&(o.dashSize=this.dashSize),this.gapSize!==void 0&&(o.gapSize=this.gapSize),this.scale!==void 0&&(o.scale=this.scale),this.dithering===!0&&(o.dithering=!0),this.alphaTest>0&&(o.alphaTest=this.alphaTest),this.alphaHash===!0&&(o.alphaHash=!0),this.alphaToCoverage===!0&&(o.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(o.premultipliedAlpha=!0),this.forceSinglePass===!0&&(o.forceSinglePass=!0),this.wireframe===!0&&(o.wireframe=!0),this.wireframeLinewidth>1&&(o.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(o.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(o.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(o.flatShading=!0),this.visible===!1&&(o.visible=!1),this.toneMapped===!1&&(o.toneMapped=!1),this.fog===!1&&(o.fog=!1),Object.keys(this.userData).length>0&&(o.userData=this.userData);function n(s){const r=[];for(const a in s){const l=s[a];delete l.metadata,r.push(l)}return r}if(e){const s=n(t.textures),r=n(t.images);s.length>0&&(o.textures=s),r.length>0&&(o.images=r)}return o}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let o=null;if(e!==null){const n=e.length;o=new Array(n);for(let s=0;s!==n;++s)o[s]=e[s].clone()}return this.clippingPlanes=o,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ri extends Pi{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oo,this.combine=Gp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ke=new R,xr=new ct;class Gt{constructor(t,e,o=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=o,this.usage=dh,this.updateRanges=[],this.gpuType=Vo,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,o){t*=this.itemSize,o*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[o+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,o=this.count;e<o;e++)xr.fromBufferAttribute(this,e),xr.applyMatrix3(t),this.setXY(e,xr.x,xr.y);else if(this.itemSize===3)for(let e=0,o=this.count;e<o;e++)ke.fromBufferAttribute(this,e),ke.applyMatrix3(t),this.setXYZ(e,ke.x,ke.y,ke.z);return this}applyMatrix4(t){for(let e=0,o=this.count;e<o;e++)ke.fromBufferAttribute(this,e),ke.applyMatrix4(t),this.setXYZ(e,ke.x,ke.y,ke.z);return this}applyNormalMatrix(t){for(let e=0,o=this.count;e<o;e++)ke.fromBufferAttribute(this,e),ke.applyNormalMatrix(t),this.setXYZ(e,ke.x,ke.y,ke.z);return this}transformDirection(t){for(let e=0,o=this.count;e<o;e++)ke.fromBufferAttribute(this,e),ke.transformDirection(t),this.setXYZ(e,ke.x,ke.y,ke.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let o=this.array[t*this.itemSize+e];return this.normalized&&(o=_i(o,this.array)),o}setComponent(t,e,o){return this.normalized&&(o=eo(o,this.array)),this.array[t*this.itemSize+e]=o,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=_i(e,this.array)),e}setX(t,e){return this.normalized&&(e=eo(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=_i(e,this.array)),e}setY(t,e){return this.normalized&&(e=eo(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=_i(e,this.array)),e}setZ(t,e){return this.normalized&&(e=eo(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=_i(e,this.array)),e}setW(t,e){return this.normalized&&(e=eo(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,o){return t*=this.itemSize,this.normalized&&(e=eo(e,this.array),o=eo(o,this.array)),this.array[t+0]=e,this.array[t+1]=o,this}setXYZ(t,e,o,n){return t*=this.itemSize,this.normalized&&(e=eo(e,this.array),o=eo(o,this.array),n=eo(n,this.array)),this.array[t+0]=e,this.array[t+1]=o,this.array[t+2]=n,this}setXYZW(t,e,o,n,s){return t*=this.itemSize,this.normalized&&(e=eo(e,this.array),o=eo(o,this.array),n=eo(n,this.array),s=eo(s,this.array)),this.array[t+0]=e,this.array[t+1]=o,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==dh&&(t.usage=this.usage),t}}class Rh extends Gt{constructor(t,e,o){super(new Uint16Array(t),e,o)}}class Dh extends Gt{constructor(t,e,o){super(new Uint32Array(t),e,o)}}class Yt extends Gt{constructor(t,e,o){super(new Float32Array(t),e,o)}}let cm=0;const zo=new $t,Ql=new Oe,Di=new R,go=new Ne,vs=new Ne,Ve=new R;class Xt extends Ln{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:cm++}),this.uuid=xn(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(yh(t)?Dh:Rh)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,o=0){this.groups.push({start:t,count:e,materialIndex:o})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const o=this.attributes.normal;if(o!==void 0){const s=new Kt().getNormalMatrix(t);o.applyNormalMatrix(s),o.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return zo.makeRotationFromQuaternion(t),this.applyMatrix4(zo),this}rotateX(t){return zo.makeRotationX(t),this.applyMatrix4(zo),this}rotateY(t){return zo.makeRotationY(t),this.applyMatrix4(zo),this}rotateZ(t){return zo.makeRotationZ(t),this.applyMatrix4(zo),this}translate(t,e,o){return zo.makeTranslation(t,e,o),this.applyMatrix4(zo),this}scale(t,e,o){return zo.makeScale(t,e,o),this.applyMatrix4(zo),this}lookAt(t){return Ql.lookAt(t),Ql.updateMatrix(),this.applyMatrix4(Ql.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Di).negate(),this.translate(Di.x,Di.y,Di.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const o=[];for(let n=0,s=t.length;n<s;n++){const r=t[n];o.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Yt(o,3))}else{for(let o=0,n=e.count;o<n;o++){const s=t[o];e.setXYZ(o,s.x,s.y,s.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ne);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new R(-1/0,-1/0,-1/0),new R(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let o=0,n=e.length;o<n;o++){const s=e[o];go.setFromBufferAttribute(s),this.morphTargetsRelative?(Ve.addVectors(this.boundingBox.min,go.min),this.boundingBox.expandByPoint(Ve),Ve.addVectors(this.boundingBox.max,go.max),this.boundingBox.expandByPoint(Ve)):(this.boundingBox.expandByPoint(go.min),this.boundingBox.expandByPoint(go.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new R,1/0);return}if(t){const o=this.boundingSphere.center;if(go.setFromBufferAttribute(t),e)for(let s=0,r=e.length;s<r;s++){const a=e[s];vs.setFromBufferAttribute(a),this.morphTargetsRelative?(Ve.addVectors(go.min,vs.min),go.expandByPoint(Ve),Ve.addVectors(go.max,vs.max),go.expandByPoint(Ve)):(go.expandByPoint(vs.min),go.expandByPoint(vs.max))}go.getCenter(o);let n=0;for(let s=0,r=t.count;s<r;s++)Ve.fromBufferAttribute(t,s),n=Math.max(n,o.distanceToSquared(Ve));if(e)for(let s=0,r=e.length;s<r;s++){const a=e[s],l=this.morphTargetsRelative;for(let c=0,p=a.count;c<p;c++)Ve.fromBufferAttribute(a,c),l&&(Di.fromBufferAttribute(t,c),Ve.add(Di)),n=Math.max(n,o.distanceToSquared(Ve))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const o=e.position,n=e.normal,s=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Gt(new Float32Array(4*o.count),4));const r=this.getAttribute("tangent"),a=[],l=[];for(let C=0;C<o.count;C++)a[C]=new R,l[C]=new R;const c=new R,p=new R,h=new R,u=new ct,d=new ct,y=new ct,g=new R,f=new R;function m(C,M,S){c.fromBufferAttribute(o,C),p.fromBufferAttribute(o,M),h.fromBufferAttribute(o,S),u.fromBufferAttribute(s,C),d.fromBufferAttribute(s,M),y.fromBufferAttribute(s,S),p.sub(c),h.sub(c),d.sub(u),y.sub(u);const k=1/(d.x*y.y-y.x*d.y);isFinite(k)&&(g.copy(p).multiplyScalar(y.y).addScaledVector(h,-d.y).multiplyScalar(k),f.copy(h).multiplyScalar(d.x).addScaledVector(p,-y.x).multiplyScalar(k),a[C].add(g),a[M].add(g),a[S].add(g),l[C].add(f),l[M].add(f),l[S].add(f))}let b=this.groups;b.length===0&&(b=[{start:0,count:t.count}]);for(let C=0,M=b.length;C<M;++C){const S=b[C],k=S.start,A=S.count;for(let B=k,F=k+A;B<F;B+=3)m(t.getX(B+0),t.getX(B+1),t.getX(B+2))}const v=new R,x=new R,_=new R,z=new R;function E(C){_.fromBufferAttribute(n,C),z.copy(_);const M=a[C];v.copy(M),v.sub(_.multiplyScalar(_.dot(M))).normalize(),x.crossVectors(z,M);const k=x.dot(l[C])<0?-1:1;r.setXYZW(C,v.x,v.y,v.z,k)}for(let C=0,M=b.length;C<M;++C){const S=b[C],k=S.start,A=S.count;for(let B=k,F=k+A;B<F;B+=3)E(t.getX(B+0)),E(t.getX(B+1)),E(t.getX(B+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let o=this.getAttribute("normal");if(o===void 0)o=new Gt(new Float32Array(e.count*3),3),this.setAttribute("normal",o);else for(let u=0,d=o.count;u<d;u++)o.setXYZ(u,0,0,0);const n=new R,s=new R,r=new R,a=new R,l=new R,c=new R,p=new R,h=new R;if(t)for(let u=0,d=t.count;u<d;u+=3){const y=t.getX(u+0),g=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,y),s.fromBufferAttribute(e,g),r.fromBufferAttribute(e,f),p.subVectors(r,s),h.subVectors(n,s),p.cross(h),a.fromBufferAttribute(o,y),l.fromBufferAttribute(o,g),c.fromBufferAttribute(o,f),a.add(p),l.add(p),c.add(p),o.setXYZ(y,a.x,a.y,a.z),o.setXYZ(g,l.x,l.y,l.z),o.setXYZ(f,c.x,c.y,c.z)}else for(let u=0,d=e.count;u<d;u+=3)n.fromBufferAttribute(e,u+0),s.fromBufferAttribute(e,u+1),r.fromBufferAttribute(e,u+2),p.subVectors(r,s),h.subVectors(n,s),p.cross(h),o.setXYZ(u+0,p.x,p.y,p.z),o.setXYZ(u+1,p.x,p.y,p.z),o.setXYZ(u+2,p.x,p.y,p.z);this.normalizeNormals(),o.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,o=t.count;e<o;e++)Ve.fromBufferAttribute(t,e),Ve.normalize(),t.setXYZ(e,Ve.x,Ve.y,Ve.z)}toNonIndexed(){function t(a,l){const c=a.array,p=a.itemSize,h=a.normalized,u=new c.constructor(l.length*p);let d=0,y=0;for(let g=0,f=l.length;g<f;g++){a.isInterleavedBufferAttribute?d=l[g]*a.data.stride+a.offset:d=l[g]*p;for(let m=0;m<p;m++)u[y++]=c[d++]}return new Gt(u,p,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Xt,o=this.index.array,n=this.attributes;for(const a in n){const l=n[a],c=t(l,o);e.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let p=0,h=c.length;p<h;p++){const u=c[p],d=t(u,o);l.push(d)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,l=r.length;a<l;a++){const c=r[a];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const o=this.attributes;for(const l in o){const c=o[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],p=[];for(let h=0,u=c.length;h<u;h++){const d=c[h];p.push(d.toJSON(t.data))}p.length>0&&(n[l]=p,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const o=t.index;o!==null&&this.setIndex(o.clone(e));const n=t.attributes;for(const c in n){const p=n[c];this.setAttribute(c,p.clone(e))}const s=t.morphAttributes;for(const c in s){const p=[],h=s[c];for(let u=0,d=h.length;u<d;u++)p.push(h[u].clone(e));this.morphAttributes[c]=p}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let c=0,p=r.length;c<p;c++){const h=r[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ih=new $t,Vn=new On,br=new Fi,Lh=new R,vr=new R,_r=new R,wr=new R,tc=new R,Mr=new R,Uh=new R,zr=new R;class ge extends Oe{constructor(t=new Xt,e=new Ri){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,o=Object.keys(e);if(o.length>0){const n=e[o[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=n.length;s<r;s++){const a=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(t,e){const o=this.geometry,n=o.attributes.position,s=o.morphAttributes.position,r=o.morphTargetsRelative;e.fromBufferAttribute(n,t);const a=this.morphTargetInfluences;if(s&&a){Mr.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const p=a[l],h=s[l];p!==0&&(tc.fromBufferAttribute(h,t),r?Mr.addScaledVector(tc,p):Mr.addScaledVector(tc.sub(e),p))}e.add(Mr)}return e}raycast(t,e){const o=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(o.boundingSphere===null&&o.computeBoundingSphere(),br.copy(o.boundingSphere),br.applyMatrix4(s),Vn.copy(t.ray).recast(t.near),!(br.containsPoint(Vn.origin)===!1&&(Vn.intersectSphere(br,Lh)===null||Vn.origin.distanceToSquared(Lh)>(t.far-t.near)**2))&&(Ih.copy(s).invert(),Vn.copy(t.ray).applyMatrix4(Ih),!(o.boundingBox!==null&&Vn.intersectsBox(o.boundingBox)===!1)&&this._computeIntersections(t,e,Vn)))}_computeIntersections(t,e,o){let n;const s=this.geometry,r=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,p=s.attributes.uv1,h=s.attributes.normal,u=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(r))for(let y=0,g=u.length;y<g;y++){const f=u[y],m=r[f.materialIndex],b=Math.max(f.start,d.start),v=Math.min(a.count,Math.min(f.start+f.count,d.start+d.count));for(let x=b,_=v;x<_;x+=3){const z=a.getX(x),E=a.getX(x+1),C=a.getX(x+2);n=Sr(this,m,t,o,c,p,h,z,E,C),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=f.materialIndex,e.push(n))}}else{const y=Math.max(0,d.start),g=Math.min(a.count,d.start+d.count);for(let f=y,m=g;f<m;f+=3){const b=a.getX(f),v=a.getX(f+1),x=a.getX(f+2);n=Sr(this,r,t,o,c,p,h,b,v,x),n&&(n.faceIndex=Math.floor(f/3),e.push(n))}}else if(l!==void 0)if(Array.isArray(r))for(let y=0,g=u.length;y<g;y++){const f=u[y],m=r[f.materialIndex],b=Math.max(f.start,d.start),v=Math.min(l.count,Math.min(f.start+f.count,d.start+d.count));for(let x=b,_=v;x<_;x+=3){const z=x,E=x+1,C=x+2;n=Sr(this,m,t,o,c,p,h,z,E,C),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=f.materialIndex,e.push(n))}}else{const y=Math.max(0,d.start),g=Math.min(l.count,d.start+d.count);for(let f=y,m=g;f<m;f+=3){const b=f,v=f+1,x=f+2;n=Sr(this,r,t,o,c,p,h,b,v,x),n&&(n.faceIndex=Math.floor(f/3),e.push(n))}}}}function pm(i,t,e,o,n,s,r,a){let l;if(t.side===Qe?l=o.intersectTriangle(r,s,n,!0,a):l=o.intersectTriangle(n,s,r,t.side===Oo,a),l===null)return null;zr.copy(a),zr.applyMatrix4(i.matrixWorld);const c=e.ray.origin.distanceTo(zr);return c<e.near||c>e.far?null:{distance:c,point:zr.clone(),object:i}}function Sr(i,t,e,o,n,s,r,a,l,c){i.getVertexPosition(a,vr),i.getVertexPosition(l,_r),i.getVertexPosition(c,wr);const p=pm(i,t,e,o,vr,_r,wr,Uh);if(p){const h=new R;ye.getBarycoord(Uh,vr,_r,wr,h),n&&(p.uv=ye.getInterpolatedAttribute(n,a,l,c,h,new ct)),s&&(p.uv1=ye.getInterpolatedAttribute(s,a,l,c,h,new ct)),r&&(p.normal=ye.getInterpolatedAttribute(r,a,l,c,h,new R),p.normal.dot(o.direction)>0&&p.normal.multiplyScalar(-1));const u={a,b:l,c,normal:new R,materialIndex:0};ye.getNormal(vr,_r,wr,u.normal),p.face=u,p.barycoord=h}return p}class I extends Xt{constructor(t=1,e=1,o=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:o,widthSegments:n,heightSegments:s,depthSegments:r};const a=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const l=[],c=[],p=[],h=[];let u=0,d=0;y("z","y","x",-1,-1,o,e,t,r,s,0),y("z","y","x",1,-1,o,e,-t,r,s,1),y("x","z","y",1,1,t,o,e,n,r,2),y("x","z","y",1,-1,t,o,-e,n,r,3),y("x","y","z",1,-1,t,e,o,n,s,4),y("x","y","z",-1,-1,t,e,-o,n,s,5),this.setIndex(l),this.setAttribute("position",new Yt(c,3)),this.setAttribute("normal",new Yt(p,3)),this.setAttribute("uv",new Yt(h,2));function y(g,f,m,b,v,x,_,z,E,C,M){const S=x/E,k=_/C,A=x/2,B=_/2,F=z/2,N=E+1,G=C+1;let W=0,et=0;const K=new R;for(let pt=0;pt<G;pt++){const X=pt*k-B;for(let Z=0;Z<N;Z++){const gt=Z*S-A;K[g]=gt*b,K[f]=X*v,K[m]=F,c.push(K.x,K.y,K.z),K[g]=0,K[f]=0,K[m]=z>0?1:-1,p.push(K.x,K.y,K.z),h.push(Z/E),h.push(1-pt/C),W+=1}}for(let pt=0;pt<C;pt++)for(let X=0;X<E;X++){const Z=u+X+N*pt,gt=u+X+N*(pt+1),Y=u+(X+1)+N*(pt+1),tt=u+(X+1)+N*pt;l.push(Z,gt,tt),l.push(gt,Y,tt),et+=6}a.addGroup(d,et,M),d+=et,u+=W}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new I(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ii(i){const t={};for(const e in i){t[e]={};for(const o in i[e]){const n=i[e][o];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][o]=null):t[e][o]=n.clone():Array.isArray(n)?t[e][o]=n.slice():t[e][o]=n}}return t}function no(i){const t={};for(let e=0;e<i.length;e++){const o=Ii(i[e]);for(const n in o)t[n]=o[n]}return t}function hm(i){const t=[];for(let e=0;e<i.length;e++)t.push(i[e].clone());return t}function Nh(i){const t=i.getRenderTarget();return t===null?i.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:re.workingColorSpace}const _s={clone:Ii,merge:no};var um=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,dm=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class io extends Pi{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=um,this.fragmentShader=dm,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ii(t.uniforms),this.uniformsGroups=hm(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?e.uniforms[n]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[n]={type:"m4",value:r.toArray()}:e.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const o={};for(const n in this.extensions)this.extensions[n]===!0&&(o[n]=!0);return Object.keys(o).length>0&&(e.extensions=o),e}}class Oh extends Oe{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new $t,this.projectionMatrix=new $t,this.projectionMatrixInverse=new $t,this.coordinateSystem=Jo}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const zn=new R,Vh=new ct,Hh=new ct;class xo extends Oh{constructor(t=50,e=1,o=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=o,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=ds*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(vi*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return ds*2*Math.atan(Math.tan(vi*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,o){zn.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(zn.x,zn.y).multiplyScalar(-t/zn.z),zn.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),o.set(zn.x,zn.y).multiplyScalar(-t/zn.z)}getViewSize(t,e){return this.getViewBounds(t,Vh,Hh),e.subVectors(Hh,Vh)}setViewOffset(t,e,o,n,s,r){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=o,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(vi*.5*this.fov)/this.zoom,o=2*e,n=this.aspect*o,s=-.5*n;const r=this.view;if(this.view!==null&&this.view.enabled){const l=r.fullWidth,c=r.fullHeight;s+=r.offsetX*n/l,e-=r.offsetY*o/c,n*=r.width/l,o*=r.height/c}const a=this.filmOffset;a!==0&&(s+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-o,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Li=-90,Ui=1;class fm extends Oe{constructor(t,e,o){super(),this.type="CubeCamera",this.renderTarget=o,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new xo(Li,Ui,t,e);n.layers=this.layers,this.add(n);const s=new xo(Li,Ui,t,e);s.layers=this.layers,this.add(s);const r=new xo(Li,Ui,t,e);r.layers=this.layers,this.add(r);const a=new xo(Li,Ui,t,e);a.layers=this.layers,this.add(a);const l=new xo(Li,Ui,t,e);l.layers=this.layers,this.add(l);const c=new xo(Li,Ui,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[o,n,s,r,a,l]=e;for(const c of e)this.remove(c);if(t===Jo)o.up.set(0,1,0),o.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===cr)o.up.set(0,-1,0),o.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of e)this.add(c),c.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:o,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,r,a,l,c,p]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),y=t.xr.enabled;t.xr.enabled=!1;const g=o.texture.generateMipmaps;o.texture.generateMipmaps=!1,t.setRenderTarget(o,0,n),t.render(e,s),t.setRenderTarget(o,1,n),t.render(e,r),t.setRenderTarget(o,2,n),t.render(e,a),t.setRenderTarget(o,3,n),t.render(e,l),t.setRenderTarget(o,4,n),t.render(e,c),o.texture.generateMipmaps=g,t.setRenderTarget(o,5,n),t.render(e,p),t.setRenderTarget(h,u,d),t.xr.enabled=y,o.texture.needsPMREMUpdate=!0}}class Gh extends Ue{constructor(t,e,o,n,s,r,a,l,c,p){t=t!==void 0?t:[],e=e!==void 0?e:di,super(t,e,o,n,s,r,a,l,c,p),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class mm extends mo{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const o={width:t,height:t,depth:1},n=[o,o,o,o,o,o];this.texture=new Gh(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:uo}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const o={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new I(5,5,5),s=new io({name:"CubemapFromEquirect",uniforms:Ii(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,side:Qe,blending:$o});s.uniforms.tEquirect.value=e;const r=new ge(n,s),a=e.minFilter;return e.minFilter===gn&&(e.minFilter=uo),new fm(1,10,this).update(t,r),e.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(t,e,o,n){const s=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,o,n);t.setRenderTarget(s)}}const ec=new R,ym=new R,gm=new Kt;class Do{constructor(t=new R(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,o,n){return this.normal.set(t,e,o),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,o){const n=ec.subVectors(o,e).cross(ym.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const o=t.delta(ec),n=this.normal.dot(o);if(n===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(t.start).addScaledVector(o,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),o=this.distanceToPoint(t.end);return e<0&&o>0||o<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const o=e||gm.getNormalMatrix(t),n=this.coplanarPoint(ec).applyMatrix4(t),s=this.normal.applyMatrix3(o).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Hn=new Fi,Er=new R;class oc{constructor(t=new Do,e=new Do,o=new Do,n=new Do,s=new Do,r=new Do){this.planes=[t,e,o,n,s,r]}set(t,e,o,n,s,r){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(o),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}copy(t){const e=this.planes;for(let o=0;o<6;o++)e[o].copy(t.planes[o]);return this}setFromProjectionMatrix(t,e=Jo){const o=this.planes,n=t.elements,s=n[0],r=n[1],a=n[2],l=n[3],c=n[4],p=n[5],h=n[6],u=n[7],d=n[8],y=n[9],g=n[10],f=n[11],m=n[12],b=n[13],v=n[14],x=n[15];if(o[0].setComponents(l-s,u-c,f-d,x-m).normalize(),o[1].setComponents(l+s,u+c,f+d,x+m).normalize(),o[2].setComponents(l+r,u+p,f+y,x+b).normalize(),o[3].setComponents(l-r,u-p,f-y,x-b).normalize(),o[4].setComponents(l-a,u-h,f-g,x-v).normalize(),e===Jo)o[5].setComponents(l+a,u+h,f+g,x+v).normalize();else if(e===cr)o[5].setComponents(a,h,g,v).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Hn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Hn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Hn)}intersectsSprite(t){return Hn.center.set(0,0,0),Hn.radius=.7071067811865476,Hn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Hn)}intersectsSphere(t){const e=this.planes,o=t.center,n=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(o)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let o=0;o<6;o++){const n=e[o];if(Er.x=n.normal.x>0?t.max.x:t.min.x,Er.y=n.normal.y>0?t.max.y:t.min.y,Er.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Er)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let o=0;o<6;o++)if(e[o].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Xh(){let i=null,t=!1,e=null,o=null;function n(s,r){e(s,r),o=i.requestAnimationFrame(n)}return{start:function(){t!==!0&&e!==null&&(o=i.requestAnimationFrame(n),t=!0)},stop:function(){i.cancelAnimationFrame(o),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){i=s}}}function xm(i){const t=new WeakMap;function e(a,l){const c=a.array,p=a.usage,h=c.byteLength,u=i.createBuffer();i.bindBuffer(l,u),i.bufferData(l,c,p),a.onUploadCallback();let d;if(c instanceof Float32Array)d=i.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?d=i.HALF_FLOAT:d=i.UNSIGNED_SHORT;else if(c instanceof Int16Array)d=i.SHORT;else if(c instanceof Uint32Array)d=i.UNSIGNED_INT;else if(c instanceof Int32Array)d=i.INT;else if(c instanceof Int8Array)d=i.BYTE;else if(c instanceof Uint8Array)d=i.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)d=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:u,type:d,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:h}}function o(a,l,c){const p=l.array,h=l.updateRanges;if(i.bindBuffer(c,a),h.length===0)i.bufferSubData(c,0,p);else{h.sort((d,y)=>d.start-y.start);let u=0;for(let d=1;d<h.length;d++){const y=h[u],g=h[d];g.start<=y.start+y.count+1?y.count=Math.max(y.count,g.start+g.count-y.start):(++u,h[u]=g)}h.length=u+1;for(let d=0,y=h.length;d<y;d++){const g=h[d];i.bufferSubData(c,g.start*p.BYTES_PER_ELEMENT,p,g.start,g.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(a){return a.isInterleavedBufferAttribute&&(a=a.data),t.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=t.get(a);l&&(i.deleteBuffer(l.buffer),t.delete(a))}function r(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const p=t.get(a);(!p||p.version<a.version)&&t.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=t.get(a);if(c===void 0)t.set(a,e(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");o(c.buffer,a,l),c.version=a.version}}return{get:n,remove:s,update:r}}class Ni extends Xt{constructor(t=1,e=1,o=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:o,heightSegments:n};const s=t/2,r=e/2,a=Math.floor(o),l=Math.floor(n),c=a+1,p=l+1,h=t/a,u=e/l,d=[],y=[],g=[],f=[];for(let m=0;m<p;m++){const b=m*u-r;for(let v=0;v<c;v++){const x=v*h-s;y.push(x,-b,0),g.push(0,0,1),f.push(v/a),f.push(1-m/l)}}for(let m=0;m<l;m++)for(let b=0;b<a;b++){const v=b+c*m,x=b+c*(m+1),_=b+1+c*(m+1),z=b+1+c*m;d.push(v,x,z),d.push(x,_,z)}this.setIndex(d),this.setAttribute("position",new Yt(y,3)),this.setAttribute("normal",new Yt(g,3)),this.setAttribute("uv",new Yt(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ni(t.width,t.height,t.widthSegments,t.heightSegments)}}var bm=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,vm=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,_m=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,wm=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Mm=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,zm=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Sm=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Em=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Fm=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Am=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Tm=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Cm=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,km=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Bm=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Pm=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Rm=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Dm=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Im=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Lm=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Um=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Nm=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Om=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Vm=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Hm=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Gm=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Xm=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Wm=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Zm=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Ym=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$m=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,qm="gl_FragColor = linearToOutputTexel( gl_FragColor );",jm=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Km=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Jm=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Qm=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ty=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,ey=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,oy=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,ny=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,iy=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,sy=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ry=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,ay=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ly=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,cy=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,py=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,hy=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,uy=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,dy=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,fy=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,my=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,yy=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,gy=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,xy=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,by=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vy=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,_y=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,wy=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,My=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,zy=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Sy=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Ey=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Fy=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Ay=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ty=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Cy=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ky=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,By=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Py=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Ry=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Dy=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Iy=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Ly=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Uy=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ny=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Oy=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Vy=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Hy=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Gy=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Xy=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Wy=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Zy=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Yy=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$y=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,qy=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,jy=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ky=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Jy=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Qy=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,tg=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,eg=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,og=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,ng=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ig=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,sg=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,rg=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,ag=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,lg=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cg=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,pg=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,hg=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ug=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,dg=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,fg=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,mg=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yg=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,gg=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const oe={alphahash_fragment:bm,alphahash_pars_fragment:vm,alphamap_fragment:_m,alphamap_pars_fragment:wm,alphatest_fragment:Mm,alphatest_pars_fragment:zm,aomap_fragment:Sm,aomap_pars_fragment:Em,batching_pars_vertex:Fm,batching_vertex:Am,begin_vertex:Tm,beginnormal_vertex:Cm,bsdfs:km,iridescence_fragment:Bm,bumpmap_pars_fragment:Pm,clipping_planes_fragment:Rm,clipping_planes_pars_fragment:Dm,clipping_planes_pars_vertex:Im,clipping_planes_vertex:Lm,color_fragment:Um,color_pars_fragment:Nm,color_pars_vertex:Om,color_vertex:Vm,common:Hm,cube_uv_reflection_fragment:Gm,defaultnormal_vertex:Xm,displacementmap_pars_vertex:Wm,displacementmap_vertex:Zm,emissivemap_fragment:Ym,emissivemap_pars_fragment:$m,colorspace_fragment:qm,colorspace_pars_fragment:jm,envmap_fragment:Km,envmap_common_pars_fragment:Jm,envmap_pars_fragment:Qm,envmap_pars_vertex:ty,envmap_physical_pars_fragment:hy,envmap_vertex:ey,fog_vertex:oy,fog_pars_vertex:ny,fog_fragment:iy,fog_pars_fragment:sy,gradientmap_pars_fragment:ry,lightmap_pars_fragment:ay,lights_lambert_fragment:ly,lights_lambert_pars_fragment:cy,lights_pars_begin:py,lights_toon_fragment:uy,lights_toon_pars_fragment:dy,lights_phong_fragment:fy,lights_phong_pars_fragment:my,lights_physical_fragment:yy,lights_physical_pars_fragment:gy,lights_fragment_begin:xy,lights_fragment_maps:by,lights_fragment_end:vy,logdepthbuf_fragment:_y,logdepthbuf_pars_fragment:wy,logdepthbuf_pars_vertex:My,logdepthbuf_vertex:zy,map_fragment:Sy,map_pars_fragment:Ey,map_particle_fragment:Fy,map_particle_pars_fragment:Ay,metalnessmap_fragment:Ty,metalnessmap_pars_fragment:Cy,morphinstance_vertex:ky,morphcolor_vertex:By,morphnormal_vertex:Py,morphtarget_pars_vertex:Ry,morphtarget_vertex:Dy,normal_fragment_begin:Iy,normal_fragment_maps:Ly,normal_pars_fragment:Uy,normal_pars_vertex:Ny,normal_vertex:Oy,normalmap_pars_fragment:Vy,clearcoat_normal_fragment_begin:Hy,clearcoat_normal_fragment_maps:Gy,clearcoat_pars_fragment:Xy,iridescence_pars_fragment:Wy,opaque_fragment:Zy,packing:Yy,premultiplied_alpha_fragment:$y,project_vertex:qy,dithering_fragment:jy,dithering_pars_fragment:Ky,roughnessmap_fragment:Jy,roughnessmap_pars_fragment:Qy,shadowmap_pars_fragment:tg,shadowmap_pars_vertex:eg,shadowmap_vertex:og,shadowmask_pars_fragment:ng,skinbase_vertex:ig,skinning_pars_vertex:sg,skinning_vertex:rg,skinnormal_vertex:ag,specularmap_fragment:lg,specularmap_pars_fragment:cg,tonemapping_fragment:pg,tonemapping_pars_fragment:hg,transmission_fragment:ug,transmission_pars_fragment:dg,uv_pars_fragment:fg,uv_pars_vertex:mg,uv_vertex:yg,worldpos_vertex:gg,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},At={common:{diffuse:{value:new bt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Kt},alphaMap:{value:null},alphaMapTransform:{value:new Kt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Kt}},envmap:{envMap:{value:null},envMapRotation:{value:new Kt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Kt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Kt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Kt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Kt},normalScale:{value:new ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Kt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Kt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Kt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Kt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Kt},alphaTest:{value:0},uvTransform:{value:new Kt}},sprite:{diffuse:{value:new bt(16777215)},opacity:{value:1},center:{value:new ct(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Kt},alphaMap:{value:null},alphaMapTransform:{value:new Kt},alphaTest:{value:0}}},Ho={basic:{uniforms:no([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.fog]),vertexShader:oe.meshbasic_vert,fragmentShader:oe.meshbasic_frag},lambert:{uniforms:no([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.fog,At.lights,{emissive:{value:new bt(0)}}]),vertexShader:oe.meshlambert_vert,fragmentShader:oe.meshlambert_frag},phong:{uniforms:no([At.common,At.specularmap,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.fog,At.lights,{emissive:{value:new bt(0)},specular:{value:new bt(1118481)},shininess:{value:30}}]),vertexShader:oe.meshphong_vert,fragmentShader:oe.meshphong_frag},standard:{uniforms:no([At.common,At.envmap,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.roughnessmap,At.metalnessmap,At.fog,At.lights,{emissive:{value:new bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag},toon:{uniforms:no([At.common,At.aomap,At.lightmap,At.emissivemap,At.bumpmap,At.normalmap,At.displacementmap,At.gradientmap,At.fog,At.lights,{emissive:{value:new bt(0)}}]),vertexShader:oe.meshtoon_vert,fragmentShader:oe.meshtoon_frag},matcap:{uniforms:no([At.common,At.bumpmap,At.normalmap,At.displacementmap,At.fog,{matcap:{value:null}}]),vertexShader:oe.meshmatcap_vert,fragmentShader:oe.meshmatcap_frag},points:{uniforms:no([At.points,At.fog]),vertexShader:oe.points_vert,fragmentShader:oe.points_frag},dashed:{uniforms:no([At.common,At.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oe.linedashed_vert,fragmentShader:oe.linedashed_frag},depth:{uniforms:no([At.common,At.displacementmap]),vertexShader:oe.depth_vert,fragmentShader:oe.depth_frag},normal:{uniforms:no([At.common,At.bumpmap,At.normalmap,At.displacementmap,{opacity:{value:1}}]),vertexShader:oe.meshnormal_vert,fragmentShader:oe.meshnormal_frag},sprite:{uniforms:no([At.sprite,At.fog]),vertexShader:oe.sprite_vert,fragmentShader:oe.sprite_frag},background:{uniforms:{uvTransform:{value:new Kt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:oe.background_vert,fragmentShader:oe.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Kt}},vertexShader:oe.backgroundCube_vert,fragmentShader:oe.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:oe.cube_vert,fragmentShader:oe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oe.equirect_vert,fragmentShader:oe.equirect_frag},distanceRGBA:{uniforms:no([At.common,At.displacementmap,{referencePosition:{value:new R},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oe.distanceRGBA_vert,fragmentShader:oe.distanceRGBA_frag},shadow:{uniforms:no([At.lights,At.fog,{color:{value:new bt(0)},opacity:{value:1}}]),vertexShader:oe.shadow_vert,fragmentShader:oe.shadow_frag}};Ho.physical={uniforms:no([Ho.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Kt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Kt},clearcoatNormalScale:{value:new ct(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Kt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Kt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Kt},sheen:{value:0},sheenColor:{value:new bt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Kt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Kt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Kt},transmissionSamplerSize:{value:new ct},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Kt},attenuationDistance:{value:0},attenuationColor:{value:new bt(0)},specularColor:{value:new bt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Kt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Kt},anisotropyVector:{value:new ct},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Kt}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag};const Fr={r:0,b:0,g:0},Gn=new oo,xg=new $t;function bg(i,t,e,o,n,s,r){const a=new bt(0);let l=s===!0?0:1,c,p,h=null,u=0,d=null;function y(b){let v=b.isScene===!0?b.background:null;return v&&v.isTexture&&(v=(b.backgroundBlurriness>0?e:t).get(v)),v}function g(b){let v=!1;const x=y(b);x===null?m(a,l):x&&x.isColor&&(m(x,1),v=!0);const _=i.xr.getEnvironmentBlendMode();_==="additive"?o.buffers.color.setClear(0,0,0,1,r):_==="alpha-blend"&&o.buffers.color.setClear(0,0,0,0,r),(i.autoClear||v)&&(o.buffers.depth.setTest(!0),o.buffers.depth.setMask(!0),o.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function f(b,v){const x=y(v);x&&(x.isCubeTexture||x.mapping===Js)?(p===void 0&&(p=new ge(new I(1,1,1),new io({name:"BackgroundCubeMaterial",uniforms:Ii(Ho.backgroundCube.uniforms),vertexShader:Ho.backgroundCube.vertexShader,fragmentShader:Ho.backgroundCube.fragmentShader,side:Qe,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(_,z,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(p)),Gn.copy(v.backgroundRotation),Gn.x*=-1,Gn.y*=-1,Gn.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Gn.y*=-1,Gn.z*=-1),p.material.uniforms.envMap.value=x,p.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,p.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,p.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,p.material.uniforms.backgroundRotation.value.setFromMatrix4(xg.makeRotationFromEuler(Gn)),p.material.toneMapped=re.getTransfer(x.colorSpace)!==ue,(h!==x||u!==x.version||d!==i.toneMapping)&&(p.material.needsUpdate=!0,h=x,u=x.version,d=i.toneMapping),p.layers.enableAll(),b.unshift(p,p.geometry,p.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new ge(new Ni(2,2),new io({name:"BackgroundMaterial",uniforms:Ii(Ho.background.uniforms),vertexShader:Ho.background.vertexShader,fragmentShader:Ho.background.fragmentShader,side:Oo,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=re.getTransfer(x.colorSpace)!==ue,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||u!==x.version||d!==i.toneMapping)&&(c.material.needsUpdate=!0,h=x,u=x.version,d=i.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null))}function m(b,v){b.getRGB(Fr,Nh(i)),o.buffers.color.setClear(Fr.r,Fr.g,Fr.b,v,r)}return{getClearColor:function(){return a},setClearColor:function(b,v=1){a.set(b),l=v,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,m(a,l)},render:g,addToRenderList:f}}function vg(i,t){const e=i.getParameter(i.MAX_VERTEX_ATTRIBS),o={},n=u(null);let s=n,r=!1;function a(S,k,A,B,F){let N=!1;const G=h(B,A,k);s!==G&&(s=G,c(s.object)),N=d(S,B,A,F),N&&y(S,B,A,F),F!==null&&t.update(F,i.ELEMENT_ARRAY_BUFFER),(N||r)&&(r=!1,x(S,k,A,B),F!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(F).buffer))}function l(){return i.createVertexArray()}function c(S){return i.bindVertexArray(S)}function p(S){return i.deleteVertexArray(S)}function h(S,k,A){const B=A.wireframe===!0;let F=o[S.id];F===void 0&&(F={},o[S.id]=F);let N=F[k.id];N===void 0&&(N={},F[k.id]=N);let G=N[B];return G===void 0&&(G=u(l()),N[B]=G),G}function u(S){const k=[],A=[],B=[];for(let F=0;F<e;F++)k[F]=0,A[F]=0,B[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:A,attributeDivisors:B,object:S,attributes:{},index:null}}function d(S,k,A,B){const F=s.attributes,N=k.attributes;let G=0;const W=A.getAttributes();for(const et in W)if(W[et].location>=0){const pt=F[et];let X=N[et];if(X===void 0&&(et==="instanceMatrix"&&S.instanceMatrix&&(X=S.instanceMatrix),et==="instanceColor"&&S.instanceColor&&(X=S.instanceColor)),pt===void 0||pt.attribute!==X||X&&pt.data!==X.data)return!0;G++}return s.attributesNum!==G||s.index!==B}function y(S,k,A,B){const F={},N=k.attributes;let G=0;const W=A.getAttributes();for(const et in W)if(W[et].location>=0){let pt=N[et];pt===void 0&&(et==="instanceMatrix"&&S.instanceMatrix&&(pt=S.instanceMatrix),et==="instanceColor"&&S.instanceColor&&(pt=S.instanceColor));const X={};X.attribute=pt,pt&&pt.data&&(X.data=pt.data),F[et]=X,G++}s.attributes=F,s.attributesNum=G,s.index=B}function g(){const S=s.newAttributes;for(let k=0,A=S.length;k<A;k++)S[k]=0}function f(S){m(S,0)}function m(S,k){const A=s.newAttributes,B=s.enabledAttributes,F=s.attributeDivisors;A[S]=1,B[S]===0&&(i.enableVertexAttribArray(S),B[S]=1),F[S]!==k&&(i.vertexAttribDivisor(S,k),F[S]=k)}function b(){const S=s.newAttributes,k=s.enabledAttributes;for(let A=0,B=k.length;A<B;A++)k[A]!==S[A]&&(i.disableVertexAttribArray(A),k[A]=0)}function v(S,k,A,B,F,N,G){G===!0?i.vertexAttribIPointer(S,k,A,F,N):i.vertexAttribPointer(S,k,A,B,F,N)}function x(S,k,A,B){g();const F=B.attributes,N=A.getAttributes(),G=k.defaultAttributeValues;for(const W in N){const et=N[W];if(et.location>=0){let K=F[W];if(K===void 0&&(W==="instanceMatrix"&&S.instanceMatrix&&(K=S.instanceMatrix),W==="instanceColor"&&S.instanceColor&&(K=S.instanceColor)),K!==void 0){const pt=K.normalized,X=K.itemSize,Z=t.get(K);if(Z===void 0)continue;const gt=Z.buffer,Y=Z.type,tt=Z.bytesPerElement,_t=Y===i.INT||Y===i.UNSIGNED_INT||K.gpuType===Qa;if(K.isInterleavedBufferAttribute){const ft=K.data,xt=ft.stride,Ft=K.offset;if(ft.isInstancedInterleavedBuffer){for(let Dt=0;Dt<et.locationSize;Dt++)m(et.location+Dt,ft.meshPerAttribute);S.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=ft.meshPerAttribute*ft.count)}else for(let Dt=0;Dt<et.locationSize;Dt++)f(et.location+Dt);i.bindBuffer(i.ARRAY_BUFFER,gt);for(let Dt=0;Dt<et.locationSize;Dt++)v(et.location+Dt,X/et.locationSize,Y,pt,xt*tt,(Ft+X/et.locationSize*Dt)*tt,_t)}else{if(K.isInstancedBufferAttribute){for(let ft=0;ft<et.locationSize;ft++)m(et.location+ft,K.meshPerAttribute);S.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let ft=0;ft<et.locationSize;ft++)f(et.location+ft);i.bindBuffer(i.ARRAY_BUFFER,gt);for(let ft=0;ft<et.locationSize;ft++)v(et.location+ft,X/et.locationSize,Y,pt,X*tt,X/et.locationSize*ft*tt,_t)}}else if(G!==void 0){const pt=G[W];if(pt!==void 0)switch(pt.length){case 2:i.vertexAttrib2fv(et.location,pt);break;case 3:i.vertexAttrib3fv(et.location,pt);break;case 4:i.vertexAttrib4fv(et.location,pt);break;default:i.vertexAttrib1fv(et.location,pt)}}}}b()}function _(){C();for(const S in o){const k=o[S];for(const A in k){const B=k[A];for(const F in B)p(B[F].object),delete B[F];delete k[A]}delete o[S]}}function z(S){if(o[S.id]===void 0)return;const k=o[S.id];for(const A in k){const B=k[A];for(const F in B)p(B[F].object),delete B[F];delete k[A]}delete o[S.id]}function E(S){for(const k in o){const A=o[k];if(A[S.id]===void 0)continue;const B=A[S.id];for(const F in B)p(B[F].object),delete B[F];delete A[S.id]}}function C(){M(),r=!0,s!==n&&(s=n,c(s.object))}function M(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:a,reset:C,resetDefaultState:M,dispose:_,releaseStatesOfGeometry:z,releaseStatesOfProgram:E,initAttributes:g,enableAttribute:f,disableUnusedAttributes:b}}function _g(i,t,e){let o;function n(c){o=c}function s(c,p){i.drawArrays(o,c,p),e.update(p,o,1)}function r(c,p,h){h!==0&&(i.drawArraysInstanced(o,c,p,h),e.update(p,o,h))}function a(c,p,h){if(h===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(o,c,0,p,0,h);let d=0;for(let y=0;y<h;y++)d+=p[y];e.update(d,o,1)}function l(c,p,h,u){if(h===0)return;const d=t.get("WEBGL_multi_draw");if(d===null)for(let y=0;y<c.length;y++)r(c[y],p[y],u[y]);else{d.multiDrawArraysInstancedWEBGL(o,c,0,p,0,u,0,h);let y=0;for(let g=0;g<h;g++)y+=p[g]*u[g];e.update(y,o,1)}}this.setMode=n,this.render=s,this.renderInstances=r,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function wg(i,t,e,o){let n;function s(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const E=t.get("EXT_texture_filter_anisotropic");n=i.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(E){return!(E!==fo&&o.convert(E)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(E){const C=E===jo&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(E!==qo&&o.convert(E)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&E!==Vo&&!C)}function l(E){if(E==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";E="mediump"}return E==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=e.precision!==void 0?e.precision:"highp";const p=l(c);p!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",p,"instead."),c=p);const h=e.logarithmicDepthBuffer===!0,u=e.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),d=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),y=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=i.getParameter(i.MAX_TEXTURE_SIZE),f=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),m=i.getParameter(i.MAX_VERTEX_ATTRIBS),b=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),v=i.getParameter(i.MAX_VARYING_VECTORS),x=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),_=y>0,z=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:r,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:u,maxTextures:d,maxVertexTextures:y,maxTextureSize:g,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:b,maxVaryings:v,maxFragmentUniforms:x,vertexTextures:_,maxSamples:z}}function Mg(i){const t=this;let e=null,o=0,n=!1,s=!1;const r=new Do,a=new Kt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,u){const d=h.length!==0||u||o!==0||n;return n=u,o=h.length,d},this.beginShadows=function(){s=!0,p(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,u){e=p(h,u,0)},this.setState=function(h,u,d){const y=h.clippingPlanes,g=h.clipIntersection,f=h.clipShadows,m=i.get(h);if(!n||y===null||y.length===0||s&&!f)s?p(null):c();else{const b=s?0:o,v=b*4;let x=m.clippingState||null;l.value=x,x=p(y,u,v,d);for(let _=0;_!==v;++_)x[_]=e[_];m.clippingState=x,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==e&&(l.value=e,l.needsUpdate=o>0),t.numPlanes=o,t.numIntersection=0}function p(h,u,d,y){const g=h!==null?h.length:0;let f=null;if(g!==0){if(f=l.value,y!==!0||f===null){const m=d+g*4,b=u.matrixWorldInverse;a.getNormalMatrix(b),(f===null||f.length<m)&&(f=new Float32Array(m));for(let v=0,x=d;v!==g;++v,x+=4)r.copy(h[v]).applyMatrix4(b,a),r.normal.toArray(f,x),f[x+3]=r.constant}l.value=f,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,f}}function zg(i){let t=new WeakMap;function e(r,a){return a===Ka?r.mapping=di:a===Ja&&(r.mapping=fi),r}function o(r){if(r&&r.isTexture){const a=r.mapping;if(a===Ka||a===Ja)if(t.has(r)){const l=t.get(r).texture;return e(l,r.mapping)}else{const l=r.image;if(l&&l.height>0){const c=new mm(l.height);return c.fromEquirectangularTexture(i,r),t.set(r,c),r.addEventListener("dispose",n),e(c.texture,r.mapping)}else return null}}return r}function n(r){const a=r.target;a.removeEventListener("dispose",n);const l=t.get(a);l!==void 0&&(t.delete(a),l.dispose())}function s(){t=new WeakMap}return{get:o,dispose:s}}class nc extends Oh{constructor(t=-1,e=1,o=1,n=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=o,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,o,n,s,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=o,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=o-t,r=o+t,a=n+e,l=n-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,r=s+c*this.view.width,a-=p*this.view.offsetY,l=a-p*this.view.height}this.projectionMatrix.makeOrthographic(s,r,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Oi=4,Wh=[.125,.215,.35,.446,.526,.582],Xn=20,ic=new nc,Zh=new bt;let sc=null,rc=0,ac=0,lc=!1;const Wn=(1+Math.sqrt(5))/2,Vi=1/Wn,Yh=[new R(-Wn,Vi,0),new R(Wn,Vi,0),new R(-Vi,0,Wn),new R(Vi,0,Wn),new R(0,Wn,-Vi),new R(0,Wn,Vi),new R(-1,1,-1),new R(1,1,-1),new R(-1,1,1),new R(1,1,1)];class $h{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,o=.1,n=100){sc=this._renderer.getRenderTarget(),rc=this._renderer.getActiveCubeFace(),ac=this._renderer.getActiveMipmapLevel(),lc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,o,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Kh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=jh(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(sc,rc,ac),this._renderer.xr.enabled=lc,t.scissorTest=!1,Ar(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===di||t.mapping===fi?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),sc=this._renderer.getRenderTarget(),rc=this._renderer.getActiveCubeFace(),ac=this._renderer.getActiveMipmapLevel(),lc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const o=e||this._allocateTargets();return this._textureToCubeUV(t,o),this._applyPMREM(o),this._cleanup(o),o}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,o={magFilter:uo,minFilter:uo,generateMipmaps:!1,type:jo,format:fo,colorSpace:xi,depthBuffer:!1},n=qh(t,e,o);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=qh(t,e,o);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Sg(s)),this._blurMaterial=Eg(s,t,e)}return n}_compileMaterial(t){const e=new ge(this._lodPlanes[0],t);this._renderer.compile(e,ic)}_sceneToCubeUV(t,e,o,n){const a=new xo(90,1,e,o),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],p=this._renderer,h=p.autoClear,u=p.toneMapping;p.getClearColor(Zh),p.toneMapping=mn,p.autoClear=!1;const d=new Ri({name:"PMREM.Background",side:Qe,depthWrite:!1,depthTest:!1}),y=new ge(new I,d);let g=!1;const f=t.background;f?f.isColor&&(d.color.copy(f),t.background=null,g=!0):(d.color.copy(Zh),g=!0);for(let m=0;m<6;m++){const b=m%3;b===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):b===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const v=this._cubeSize;Ar(n,b*v,m>2?v:0,v,v),p.setRenderTarget(n),g&&p.render(y,a),p.render(t,a)}y.geometry.dispose(),y.material.dispose(),p.toneMapping=u,p.autoClear=h,t.background=f}_textureToCubeUV(t,e){const o=this._renderer,n=t.mapping===di||t.mapping===fi;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=Kh()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=jh());const s=n?this._cubemapMaterial:this._equirectMaterial,r=new ge(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=t;const l=this._cubeSize;Ar(e,0,0,3*l,2*l),o.setRenderTarget(e),o.render(r,ic)}_applyPMREM(t){const e=this._renderer,o=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=Yh[(n-s-1)%Yh.length];this._blur(t,s-1,s,r,a)}e.autoClear=o}_blur(t,e,o,n,s){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,o,n,"latitudinal",s),this._halfBlur(r,t,o,o,n,"longitudinal",s)}_halfBlur(t,e,o,n,s,r,a){const l=this._renderer,c=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const p=3,h=new ge(this._lodPlanes[n],c),u=c.uniforms,d=this._sizeLods[o]-1,y=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*Xn-1),g=s/y,f=isFinite(s)?1+Math.floor(p*g):Xn;f>Xn&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Xn}`);const m=[];let b=0;for(let E=0;E<Xn;++E){const C=E/g,M=Math.exp(-C*C/2);m.push(M),E===0?b+=M:E<f&&(b+=2*M)}for(let E=0;E<m.length;E++)m[E]=m[E]/b;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value=r==="latitudinal",a&&(u.poleAxis.value=a);const{_lodMax:v}=this;u.dTheta.value=y,u.mipInt.value=v-o;const x=this._sizeLods[n],_=3*x*(n>v-Oi?n-v+Oi:0),z=4*(this._cubeSize-x);Ar(e,_,z,3*x,2*x),l.setRenderTarget(e),l.render(h,ic)}}function Sg(i){const t=[],e=[],o=[];let n=i;const s=i-Oi+1+Wh.length;for(let r=0;r<s;r++){const a=Math.pow(2,n);e.push(a);let l=1/a;r>i-Oi?l=Wh[r-i+Oi-1]:r===0&&(l=0),o.push(l);const c=1/(a-2),p=-c,h=1+c,u=[p,p,h,p,h,h,p,p,h,h,p,h],d=6,y=6,g=3,f=2,m=1,b=new Float32Array(g*y*d),v=new Float32Array(f*y*d),x=new Float32Array(m*y*d);for(let z=0;z<d;z++){const E=z%3*2/3-1,C=z>2?0:-1,M=[E,C,0,E+2/3,C,0,E+2/3,C+1,0,E,C,0,E+2/3,C+1,0,E,C+1,0];b.set(M,g*y*z),v.set(u,f*y*z);const S=[z,z,z,z,z,z];x.set(S,m*y*z)}const _=new Xt;_.setAttribute("position",new Gt(b,g)),_.setAttribute("uv",new Gt(v,f)),_.setAttribute("faceIndex",new Gt(x,m)),t.push(_),n>Oi&&n--}return{lodPlanes:t,sizeLods:e,sigmas:o}}function qh(i,t,e){const o=new mo(i,t,e);return o.texture.mapping=Js,o.texture.name="PMREM.cubeUv",o.scissorTest=!0,o}function Ar(i,t,e,o,n){i.viewport.set(t,e,o,n),i.scissor.set(t,e,o,n)}function Eg(i,t,e){const o=new Float32Array(Xn),n=new R(0,1,0);return new io({name:"SphericalGaussianBlur",defines:{n:Xn,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:o},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:cc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:$o,depthTest:!1,depthWrite:!1})}function jh(){return new io({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:cc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:$o,depthTest:!1,depthWrite:!1})}function Kh(){return new io({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:cc(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:$o,depthTest:!1,depthWrite:!1})}function cc(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Fg(i){let t=new WeakMap,e=null;function o(a){if(a&&a.isTexture){const l=a.mapping,c=l===Ka||l===Ja,p=l===di||l===fi;if(c||p){let h=t.get(a);const u=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==u)return e===null&&(e=new $h(i)),h=c?e.fromEquirectangular(a,h):e.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,t.set(a,h),h.texture;if(h!==void 0)return h.texture;{const d=a.image;return c&&d&&d.height>0||p&&d&&n(d)?(e===null&&(e=new $h(i)),h=c?e.fromEquirectangular(a):e.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,t.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function n(a){let l=0;const c=6;for(let p=0;p<c;p++)a[p]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function r(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:o,dispose:r}}function Ag(i){const t={};function e(o){if(t[o]!==void 0)return t[o];let n;switch(o){case"WEBGL_depth_texture":n=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=i.getExtension(o)}return t[o]=n,n}return{has:function(o){return e(o)!==null},init:function(){e("EXT_color_buffer_float"),e("WEBGL_clip_cull_distance"),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture"),e("WEBGL_render_shared_exponent")},get:function(o){const n=e(o);return n===null&&ys("THREE.WebGLRenderer: "+o+" extension not supported."),n}}}function Tg(i,t,e,o){const n={},s=new WeakMap;function r(h){const u=h.target;u.index!==null&&t.remove(u.index);for(const y in u.attributes)t.remove(u.attributes[y]);for(const y in u.morphAttributes){const g=u.morphAttributes[y];for(let f=0,m=g.length;f<m;f++)t.remove(g[f])}u.removeEventListener("dispose",r),delete n[u.id];const d=s.get(u);d&&(t.remove(d),s.delete(u)),o.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,e.memory.geometries--}function a(h,u){return n[u.id]===!0||(u.addEventListener("dispose",r),n[u.id]=!0,e.memory.geometries++),u}function l(h){const u=h.attributes;for(const y in u)t.update(u[y],i.ARRAY_BUFFER);const d=h.morphAttributes;for(const y in d){const g=d[y];for(let f=0,m=g.length;f<m;f++)t.update(g[f],i.ARRAY_BUFFER)}}function c(h){const u=[],d=h.index,y=h.attributes.position;let g=0;if(d!==null){const b=d.array;g=d.version;for(let v=0,x=b.length;v<x;v+=3){const _=b[v+0],z=b[v+1],E=b[v+2];u.push(_,z,z,E,E,_)}}else if(y!==void 0){const b=y.array;g=y.version;for(let v=0,x=b.length/3-1;v<x;v+=3){const _=v+0,z=v+1,E=v+2;u.push(_,z,z,E,E,_)}}else return;const f=new(yh(u)?Dh:Rh)(u,1);f.version=g;const m=s.get(h);m&&t.remove(m),s.set(h,f)}function p(h){const u=s.get(h);if(u){const d=h.index;d!==null&&u.version<d.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:p}}function Cg(i,t,e){let o;function n(u){o=u}let s,r;function a(u){s=u.type,r=u.bytesPerElement}function l(u,d){i.drawElements(o,d,s,u*r),e.update(d,o,1)}function c(u,d,y){y!==0&&(i.drawElementsInstanced(o,d,s,u*r,y),e.update(d,o,y))}function p(u,d,y){if(y===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(o,d,0,s,u,0,y);let f=0;for(let m=0;m<y;m++)f+=d[m];e.update(f,o,1)}function h(u,d,y,g){if(y===0)return;const f=t.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<u.length;m++)c(u[m]/r,d[m],g[m]);else{f.multiDrawElementsInstancedWEBGL(o,d,0,s,u,0,g,0,y);let m=0;for(let b=0;b<y;b++)m+=d[b]*g[b];e.update(m,o,1)}}this.setMode=n,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=p,this.renderMultiDrawInstances=h}function kg(i){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function o(s,r,a){switch(e.calls++,r){case i.TRIANGLES:e.triangles+=a*(s/3);break;case i.LINES:e.lines+=a*(s/2);break;case i.LINE_STRIP:e.lines+=a*(s-1);break;case i.LINE_LOOP:e.lines+=a*s;break;case i.POINTS:e.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function n(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:n,update:o}}function Bg(i,t,e){const o=new WeakMap,n=new se;function s(r,a,l){const c=r.morphTargetInfluences,p=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=p!==void 0?p.length:0;let u=o.get(a);if(u===void 0||u.count!==h){let M=function(){E.dispose(),o.delete(a),a.removeEventListener("dispose",M)};u!==void 0&&u.texture.dispose();const d=a.morphAttributes.position!==void 0,y=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,f=a.morphAttributes.position||[],m=a.morphAttributes.normal||[],b=a.morphAttributes.color||[];let v=0;d===!0&&(v=1),y===!0&&(v=2),g===!0&&(v=3);let x=a.attributes.position.count*v,_=1;x>t.maxTextureSize&&(_=Math.ceil(x/t.maxTextureSize),x=t.maxTextureSize);const z=new Float32Array(x*_*4*h),E=new Mh(z,x,_,h);E.type=Vo,E.needsUpdate=!0;const C=v*4;for(let S=0;S<h;S++){const k=f[S],A=m[S],B=b[S],F=x*_*4*S;for(let N=0;N<k.count;N++){const G=N*C;d===!0&&(n.fromBufferAttribute(k,N),z[F+G+0]=n.x,z[F+G+1]=n.y,z[F+G+2]=n.z,z[F+G+3]=0),y===!0&&(n.fromBufferAttribute(A,N),z[F+G+4]=n.x,z[F+G+5]=n.y,z[F+G+6]=n.z,z[F+G+7]=0),g===!0&&(n.fromBufferAttribute(B,N),z[F+G+8]=n.x,z[F+G+9]=n.y,z[F+G+10]=n.z,z[F+G+11]=B.itemSize===4?n.w:1)}}u={count:h,texture:E,size:new ct(x,_)},o.set(a,u),a.addEventListener("dispose",M)}if(r.isInstancedMesh===!0&&r.morphTexture!==null)l.getUniforms().setValue(i,"morphTexture",r.morphTexture,e);else{let d=0;for(let g=0;g<c.length;g++)d+=c[g];const y=a.morphTargetsRelative?1:1-d;l.getUniforms().setValue(i,"morphTargetBaseInfluence",y),l.getUniforms().setValue(i,"morphTargetInfluences",c)}l.getUniforms().setValue(i,"morphTargetsTexture",u.texture,e),l.getUniforms().setValue(i,"morphTargetsTextureSize",u.size)}return{update:s}}function Pg(i,t,e,o){let n=new WeakMap;function s(l){const c=o.render.frame,p=l.geometry,h=t.get(l,p);if(n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),n.get(l)!==c&&(e.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&e.update(l.instanceColor,i.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const u=l.skeleton;n.get(u)!==c&&(u.update(),n.set(u,c))}return h}function r(){n=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),e.remove(c.instanceMatrix),c.instanceColor!==null&&e.remove(c.instanceColor)}return{update:s,dispose:r}}class Jh extends Ue{constructor(t,e,o,n,s,r,a,l,c,p=yi){if(p!==yi&&p!==gi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");o===void 0&&p===yi&&(o=In),o===void 0&&p===gi&&(o=mi),super(null,n,s,r,a,l,p,o,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Se,this.minFilter=l!==void 0?l:Se,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Qh=new Ue,tu=new Jh(1,1),eu=new Mh,ou=new tm,nu=new Gh,iu=[],su=[],ru=new Float32Array(16),au=new Float32Array(9),lu=new Float32Array(4);function Hi(i,t,e){const o=i[0];if(o<=0||o>0)return i;const n=t*e;let s=iu[n];if(s===void 0&&(s=new Float32Array(n),iu[n]=s),t!==0){o.toArray(s,0);for(let r=1,a=0;r!==t;++r)a+=e,i[r].toArray(s,a)}return s}function Pe(i,t){if(i.length!==t.length)return!1;for(let e=0,o=i.length;e<o;e++)if(i[e]!==t[e])return!1;return!0}function Re(i,t){for(let e=0,o=t.length;e<o;e++)i[e]=t[e]}function Tr(i,t){let e=su[t];e===void 0&&(e=new Int32Array(t),su[t]=e);for(let o=0;o!==t;++o)e[o]=i.allocateTextureUnit();return e}function Rg(i,t){const e=this.cache;e[0]!==t&&(i.uniform1f(this.addr,t),e[0]=t)}function Dg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Pe(e,t))return;i.uniform2fv(this.addr,t),Re(e,t)}}function Ig(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(Pe(e,t))return;i.uniform3fv(this.addr,t),Re(e,t)}}function Lg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Pe(e,t))return;i.uniform4fv(this.addr,t),Re(e,t)}}function Ug(i,t){const e=this.cache,o=t.elements;if(o===void 0){if(Pe(e,t))return;i.uniformMatrix2fv(this.addr,!1,t),Re(e,t)}else{if(Pe(e,o))return;lu.set(o),i.uniformMatrix2fv(this.addr,!1,lu),Re(e,o)}}function Ng(i,t){const e=this.cache,o=t.elements;if(o===void 0){if(Pe(e,t))return;i.uniformMatrix3fv(this.addr,!1,t),Re(e,t)}else{if(Pe(e,o))return;au.set(o),i.uniformMatrix3fv(this.addr,!1,au),Re(e,o)}}function Og(i,t){const e=this.cache,o=t.elements;if(o===void 0){if(Pe(e,t))return;i.uniformMatrix4fv(this.addr,!1,t),Re(e,t)}else{if(Pe(e,o))return;ru.set(o),i.uniformMatrix4fv(this.addr,!1,ru),Re(e,o)}}function Vg(i,t){const e=this.cache;e[0]!==t&&(i.uniform1i(this.addr,t),e[0]=t)}function Hg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Pe(e,t))return;i.uniform2iv(this.addr,t),Re(e,t)}}function Gg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Pe(e,t))return;i.uniform3iv(this.addr,t),Re(e,t)}}function Xg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Pe(e,t))return;i.uniform4iv(this.addr,t),Re(e,t)}}function Wg(i,t){const e=this.cache;e[0]!==t&&(i.uniform1ui(this.addr,t),e[0]=t)}function Zg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Pe(e,t))return;i.uniform2uiv(this.addr,t),Re(e,t)}}function Yg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Pe(e,t))return;i.uniform3uiv(this.addr,t),Re(e,t)}}function $g(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Pe(e,t))return;i.uniform4uiv(this.addr,t),Re(e,t)}}function qg(i,t,e){const o=this.cache,n=e.allocateTextureUnit();o[0]!==n&&(i.uniform1i(this.addr,n),o[0]=n);let s;this.type===i.SAMPLER_2D_SHADOW?(tu.compareFunction=uh,s=tu):s=Qh,e.setTexture2D(t||s,n)}function jg(i,t,e){const o=this.cache,n=e.allocateTextureUnit();o[0]!==n&&(i.uniform1i(this.addr,n),o[0]=n),e.setTexture3D(t||ou,n)}function Kg(i,t,e){const o=this.cache,n=e.allocateTextureUnit();o[0]!==n&&(i.uniform1i(this.addr,n),o[0]=n),e.setTextureCube(t||nu,n)}function Jg(i,t,e){const o=this.cache,n=e.allocateTextureUnit();o[0]!==n&&(i.uniform1i(this.addr,n),o[0]=n),e.setTexture2DArray(t||eu,n)}function Qg(i){switch(i){case 5126:return Rg;case 35664:return Dg;case 35665:return Ig;case 35666:return Lg;case 35674:return Ug;case 35675:return Ng;case 35676:return Og;case 5124:case 35670:return Vg;case 35667:case 35671:return Hg;case 35668:case 35672:return Gg;case 35669:case 35673:return Xg;case 5125:return Wg;case 36294:return Zg;case 36295:return Yg;case 36296:return $g;case 35678:case 36198:case 36298:case 36306:case 35682:return qg;case 35679:case 36299:case 36307:return jg;case 35680:case 36300:case 36308:case 36293:return Kg;case 36289:case 36303:case 36311:case 36292:return Jg}}function tx(i,t){i.uniform1fv(this.addr,t)}function ex(i,t){const e=Hi(t,this.size,2);i.uniform2fv(this.addr,e)}function ox(i,t){const e=Hi(t,this.size,3);i.uniform3fv(this.addr,e)}function nx(i,t){const e=Hi(t,this.size,4);i.uniform4fv(this.addr,e)}function ix(i,t){const e=Hi(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,e)}function sx(i,t){const e=Hi(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,e)}function rx(i,t){const e=Hi(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,e)}function ax(i,t){i.uniform1iv(this.addr,t)}function lx(i,t){i.uniform2iv(this.addr,t)}function cx(i,t){i.uniform3iv(this.addr,t)}function px(i,t){i.uniform4iv(this.addr,t)}function hx(i,t){i.uniform1uiv(this.addr,t)}function ux(i,t){i.uniform2uiv(this.addr,t)}function dx(i,t){i.uniform3uiv(this.addr,t)}function fx(i,t){i.uniform4uiv(this.addr,t)}function mx(i,t,e){const o=this.cache,n=t.length,s=Tr(e,n);Pe(o,s)||(i.uniform1iv(this.addr,s),Re(o,s));for(let r=0;r!==n;++r)e.setTexture2D(t[r]||Qh,s[r])}function yx(i,t,e){const o=this.cache,n=t.length,s=Tr(e,n);Pe(o,s)||(i.uniform1iv(this.addr,s),Re(o,s));for(let r=0;r!==n;++r)e.setTexture3D(t[r]||ou,s[r])}function gx(i,t,e){const o=this.cache,n=t.length,s=Tr(e,n);Pe(o,s)||(i.uniform1iv(this.addr,s),Re(o,s));for(let r=0;r!==n;++r)e.setTextureCube(t[r]||nu,s[r])}function xx(i,t,e){const o=this.cache,n=t.length,s=Tr(e,n);Pe(o,s)||(i.uniform1iv(this.addr,s),Re(o,s));for(let r=0;r!==n;++r)e.setTexture2DArray(t[r]||eu,s[r])}function bx(i){switch(i){case 5126:return tx;case 35664:return ex;case 35665:return ox;case 35666:return nx;case 35674:return ix;case 35675:return sx;case 35676:return rx;case 5124:case 35670:return ax;case 35667:case 35671:return lx;case 35668:case 35672:return cx;case 35669:case 35673:return px;case 5125:return hx;case 36294:return ux;case 36295:return dx;case 36296:return fx;case 35678:case 36198:case 36298:case 36306:case 35682:return mx;case 35679:case 36299:case 36307:return yx;case 35680:case 36300:case 36308:case 36293:return gx;case 36289:case 36303:case 36311:case 36292:return xx}}class vx{constructor(t,e,o){this.id=t,this.addr=o,this.cache=[],this.type=e.type,this.setValue=Qg(e.type)}}class _x{constructor(t,e,o){this.id=t,this.addr=o,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=bx(e.type)}}class wx{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,o){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const a=n[s];a.setValue(t,e[a.id],o)}}}const pc=/(\w+)(\])?(\[|\.)?/g;function cu(i,t){i.seq.push(t),i.map[t.id]=t}function Mx(i,t,e){const o=i.name,n=o.length;for(pc.lastIndex=0;;){const s=pc.exec(o),r=pc.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&r+2===n){cu(e,c===void 0?new vx(a,i,t):new _x(a,i,t));break}else{let h=e.map[a];h===void 0&&(h=new wx(a),cu(e,h)),e=h}}}class Cr{constructor(t,e){this.seq=[],this.map={};const o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<o;++n){const s=t.getActiveUniform(e,n),r=t.getUniformLocation(e,s.name);Mx(s,r,this)}}setValue(t,e,o,n){const s=this.map[e];s!==void 0&&s.setValue(t,o,n)}setOptional(t,e,o){const n=e[o];n!==void 0&&this.setValue(t,o,n)}static upload(t,e,o,n){for(let s=0,r=e.length;s!==r;++s){const a=e[s],l=o[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,n)}}static seqWithValue(t,e){const o=[];for(let n=0,s=t.length;n!==s;++n){const r=t[n];r.id in e&&o.push(r)}return o}}function pu(i,t,e){const o=i.createShader(t);return i.shaderSource(o,e),i.compileShader(o),o}const zx=37297;let Sx=0;function Ex(i,t){const e=i.split(`
`),o=[],n=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let r=n;r<s;r++){const a=r+1;o.push(`${a===t?">":" "} ${a}: ${e[r]}`)}return o.join(`
`)}const hu=new Kt;function Fx(i){re._getMatrix(hu,re.workingColorSpace,i);const t=`mat3( ${hu.elements.map(e=>e.toFixed(4))} )`;switch(re.getTransfer(i)){case lr:return[t,"LinearTransferOETF"];case ue:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[t,"LinearTransferOETF"]}}function uu(i,t,e){const o=i.getShaderParameter(t,i.COMPILE_STATUS),n=i.getShaderInfoLog(t).trim();if(o&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const r=parseInt(s[1]);return e.toUpperCase()+`

`+n+`

`+Ex(i.getShaderSource(t),r)}else return n}function Ax(i,t){const e=Fx(t);return[`vec4 ${i}( vec4 value ) {`,`	return ${e[1]}( vec4( value.rgb * ${e[0]}, value.a ) );`,"}"].join(`
`)}function Tx(i,t){let e;switch(t){case Xp:e="Linear";break;case Wp:e="Reinhard";break;case Zp:e="Cineon";break;case Yp:e="ACESFilmic";break;case $p:e="AgX";break;case qp:e="Neutral";break;case xf:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+i+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}const kr=new R;function Cx(){re.getLuminanceCoefficients(kr);const i=kr.x.toFixed(4),t=kr.y.toFixed(4),e=kr.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${i}, ${t}, ${e} );`,"	return dot( weights, rgb );","}"].join(`
`)}function kx(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ws).join(`
`)}function Bx(i){const t=[];for(const e in i){const o=i[e];o!==!1&&t.push("#define "+e+" "+o)}return t.join(`
`)}function Px(i,t){const e={},o=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);for(let n=0;n<o;n++){const s=i.getActiveAttrib(t,n),r=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),e[r]={type:s.type,location:i.getAttribLocation(t,r),locationSize:a}}return e}function ws(i){return i!==""}function du(i,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function fu(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Rx=/^[ \t]*#include +<([\w\d./]+)>/gm;function hc(i){return i.replace(Rx,Ix)}const Dx=new Map;function Ix(i,t){let e=oe[t];if(e===void 0){const o=Dx.get(t);if(o!==void 0)e=oe[o],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,o);else throw new Error("Can not resolve #include <"+t+">")}return hc(e)}const Lx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mu(i){return i.replace(Lx,Ux)}function Ux(i,t,e,o){let n="";for(let s=parseInt(t);s<parseInt(e);s++)n+=o.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function yu(i){let t=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?t+=`
#define HIGH_PRECISION`:i.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Nx(i){let t="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Np?t="SHADOWMAP_TYPE_PCF":i.shadowMapType===Op?t="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Yo&&(t="SHADOWMAP_TYPE_VSM"),t}function Ox(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case di:case fi:t="ENVMAP_TYPE_CUBE";break;case Js:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Vx(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case fi:t="ENVMAP_MODE_REFRACTION";break}return t}function Hx(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Gp:t="ENVMAP_BLENDING_MULTIPLY";break;case yf:t="ENVMAP_BLENDING_MIX";break;case gf:t="ENVMAP_BLENDING_ADD";break}return t}function Gx(i){const t=i.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,o=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:o,maxMip:e}}function Xx(i,t,e,o){const n=i.getContext(),s=e.defines;let r=e.vertexShader,a=e.fragmentShader;const l=Nx(e),c=Ox(e),p=Vx(e),h=Hx(e),u=Gx(e),d=kx(e),y=Bx(s),g=n.createProgram();let f,m,b=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(f=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,y].filter(ws).join(`
`),f.length>0&&(f+=`
`),m=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,y].filter(ws).join(`
`),m.length>0&&(m+=`
`)):(f=[yu(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,y,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.batchingColor?"#define USE_BATCHING_COLOR":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+p:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ws).join(`
`),m=[yu(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,y,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.envMap?"#define "+p:"",e.envMap?"#define "+h:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor||e.batchingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==mn?"#define TONE_MAPPING":"",e.toneMapping!==mn?oe.tonemapping_pars_fragment:"",e.toneMapping!==mn?Tx("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",oe.colorspace_pars_fragment,Ax("linearToOutputTexel",e.outputColorSpace),Cx(),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(ws).join(`
`)),r=hc(r),r=du(r,e),r=fu(r,e),a=hc(a),a=du(a,e),a=fu(a,e),r=mu(r),a=mu(a),e.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,f=[d,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+f,m=["#define varying in",e.glslVersion===fh?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===fh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+m);const v=b+f+r,x=b+m+a,_=pu(n,n.VERTEX_SHADER,v),z=pu(n,n.FRAGMENT_SHADER,x);n.attachShader(g,_),n.attachShader(g,z),e.index0AttributeName!==void 0?n.bindAttribLocation(g,0,e.index0AttributeName):e.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g);function E(k){if(i.debug.checkShaderErrors){const A=n.getProgramInfoLog(g).trim(),B=n.getShaderInfoLog(_).trim(),F=n.getShaderInfoLog(z).trim();let N=!0,G=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1)if(N=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(n,g,_,z);else{const W=uu(n,_,"vertex"),et=uu(n,z,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Material Name: `+k.name+`
Material Type: `+k.type+`

Program Info Log: `+A+`
`+W+`
`+et)}else A!==""?console.warn("THREE.WebGLProgram: Program Info Log:",A):(B===""||F==="")&&(G=!1);G&&(k.diagnostics={runnable:N,programLog:A,vertexShader:{log:B,prefix:f},fragmentShader:{log:F,prefix:m}})}n.deleteShader(_),n.deleteShader(z),C=new Cr(n,g),M=Px(n,g)}let C;this.getUniforms=function(){return C===void 0&&E(this),C};let M;this.getAttributes=function(){return M===void 0&&E(this),M};let S=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=n.getProgramParameter(g,zx)),S},this.destroy=function(){o.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=Sx++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=_,this.fragmentShader=z,this}let Wx=0;class Zx{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,o=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(o),r=this._getShaderCacheForMaterial(t);return r.has(n)===!1&&(r.add(n),n.usedTimes++),r.has(s)===!1&&(r.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const o of e)o.usedTimes--,o.usedTimes===0&&this.shaderCache.delete(o.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let o=e.get(t);return o===void 0&&(o=new Set,e.set(t,o)),o}_getShaderStage(t){const e=this.shaderCache;let o=e.get(t);return o===void 0&&(o=new Yx(t),e.set(t,o)),o}}class Yx{constructor(t){this.id=Wx++,this.code=t,this.usedTimes=0}}function $x(i,t,e,o,n,s,r){const a=new Gl,l=new Zx,c=new Set,p=[],h=n.logarithmicDepthBuffer,u=n.vertexTextures;let d=n.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(M){return c.add(M),M===0?"uv":`uv${M}`}function f(M,S,k,A,B){const F=A.fog,N=B.geometry,G=M.isMeshStandardMaterial?A.environment:null,W=(M.isMeshStandardMaterial?e:t).get(M.envMap||G),et=W&&W.mapping===Js?W.image.height:null,K=y[M.type];M.precision!==null&&(d=n.getMaxPrecision(M.precision),d!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",d,"instead."));const pt=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,X=pt!==void 0?pt.length:0;let Z=0;N.morphAttributes.position!==void 0&&(Z=1),N.morphAttributes.normal!==void 0&&(Z=2),N.morphAttributes.color!==void 0&&(Z=3);let gt,Y,tt,_t;if(K){const de=Ho[K];gt=de.vertexShader,Y=de.fragmentShader}else gt=M.vertexShader,Y=M.fragmentShader,l.update(M),tt=l.getVertexShaderID(M),_t=l.getFragmentShaderID(M);const ft=i.getRenderTarget(),xt=i.state.buffers.depth.getReversed(),Ft=B.isInstancedMesh===!0,Dt=B.isBatchedMesh===!0,Ot=!!M.map,ht=!!M.matcap,yt=!!W,w=!!M.aoMap,ot=!!M.lightMap,V=!!M.bumpMap,U=!!M.normalMap,D=!!M.displacementMap,H=!!M.emissiveMap,nt=!!M.metalnessMap,P=!!M.roughnessMap,T=M.anisotropy>0,O=M.clearcoat>0,j=M.dispersion>0,$=M.iridescence>0,it=M.sheen>0,wt=M.transmission>0,dt=T&&!!M.anisotropyMap,St=O&&!!M.clearcoatMap,Qt=O&&!!M.clearcoatNormalMap,mt=O&&!!M.clearcoatRoughnessMap,Rt=$&&!!M.iridescenceMap,kt=$&&!!M.iridescenceThicknessMap,Zt=it&&!!M.sheenColorMap,It=it&&!!M.sheenRoughnessMap,qt=!!M.specularMap,Jt=!!M.specularColorMap,me=!!M.specularIntensityMap,q=wt&&!!M.transmissionMap,Tt=wt&&!!M.thicknessMap,lt=!!M.gradientMap,ut=!!M.alphaMap,Ct=M.alphaTest>0,Bt=!!M.alphaHash,te=!!M.extensions;let Fe=mn;M.toneMapped&&(ft===null||ft.isXRRenderTarget===!0)&&(Fe=i.toneMapping);const Ke={shaderID:K,shaderType:M.type,shaderName:M.name,vertexShader:gt,fragmentShader:Y,defines:M.defines,customVertexShaderID:tt,customFragmentShaderID:_t,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:d,batching:Dt,batchingColor:Dt&&B._colorsTexture!==null,instancing:Ft,instancingColor:Ft&&B.instanceColor!==null,instancingMorph:Ft&&B.morphTexture!==null,supportsVertexTextures:u,outputColorSpace:ft===null?i.outputColorSpace:ft.isXRRenderTarget===!0?ft.texture.colorSpace:xi,alphaToCoverage:!!M.alphaToCoverage,map:Ot,matcap:ht,envMap:yt,envMapMode:yt&&W.mapping,envMapCubeUVHeight:et,aoMap:w,lightMap:ot,bumpMap:V,normalMap:U,displacementMap:u&&D,emissiveMap:H,normalMapObjectSpace:U&&M.normalMapType===wf,normalMapTangentSpace:U&&M.normalMapType===ph,metalnessMap:nt,roughnessMap:P,anisotropy:T,anisotropyMap:dt,clearcoat:O,clearcoatMap:St,clearcoatNormalMap:Qt,clearcoatRoughnessMap:mt,dispersion:j,iridescence:$,iridescenceMap:Rt,iridescenceThicknessMap:kt,sheen:it,sheenColorMap:Zt,sheenRoughnessMap:It,specularMap:qt,specularColorMap:Jt,specularIntensityMap:me,transmission:wt,transmissionMap:q,thicknessMap:Tt,gradientMap:lt,opaque:M.transparent===!1&&M.blending===hi&&M.alphaToCoverage===!1,alphaMap:ut,alphaTest:Ct,alphaHash:Bt,combine:M.combine,mapUv:Ot&&g(M.map.channel),aoMapUv:w&&g(M.aoMap.channel),lightMapUv:ot&&g(M.lightMap.channel),bumpMapUv:V&&g(M.bumpMap.channel),normalMapUv:U&&g(M.normalMap.channel),displacementMapUv:D&&g(M.displacementMap.channel),emissiveMapUv:H&&g(M.emissiveMap.channel),metalnessMapUv:nt&&g(M.metalnessMap.channel),roughnessMapUv:P&&g(M.roughnessMap.channel),anisotropyMapUv:dt&&g(M.anisotropyMap.channel),clearcoatMapUv:St&&g(M.clearcoatMap.channel),clearcoatNormalMapUv:Qt&&g(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:mt&&g(M.clearcoatRoughnessMap.channel),iridescenceMapUv:Rt&&g(M.iridescenceMap.channel),iridescenceThicknessMapUv:kt&&g(M.iridescenceThicknessMap.channel),sheenColorMapUv:Zt&&g(M.sheenColorMap.channel),sheenRoughnessMapUv:It&&g(M.sheenRoughnessMap.channel),specularMapUv:qt&&g(M.specularMap.channel),specularColorMapUv:Jt&&g(M.specularColorMap.channel),specularIntensityMapUv:me&&g(M.specularIntensityMap.channel),transmissionMapUv:q&&g(M.transmissionMap.channel),thicknessMapUv:Tt&&g(M.thicknessMap.channel),alphaMapUv:ut&&g(M.alphaMap.channel),vertexTangents:!!N.attributes.tangent&&(U||T),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!N.attributes.uv&&(Ot||ut),fog:!!F,useFog:M.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:xt,skinning:B.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:X,morphTextureStride:Z,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:M.dithering,shadowMapEnabled:i.shadowMap.enabled&&k.length>0,shadowMapType:i.shadowMap.type,toneMapping:Fe,decodeVideoTexture:Ot&&M.map.isVideoTexture===!0&&re.getTransfer(M.map.colorSpace)===ue,decodeVideoTextureEmissive:H&&M.emissiveMap.isVideoTexture===!0&&re.getTransfer(M.emissiveMap.colorSpace)===ue,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Ze,flipSided:M.side===Qe,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:te&&M.extensions.clipCullDistance===!0&&o.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(te&&M.extensions.multiDraw===!0||Dt)&&o.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:o.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return Ke.vertexUv1s=c.has(1),Ke.vertexUv2s=c.has(2),Ke.vertexUv3s=c.has(3),c.clear(),Ke}function m(M){const S=[];if(M.shaderID?S.push(M.shaderID):(S.push(M.customVertexShaderID),S.push(M.customFragmentShaderID)),M.defines!==void 0)for(const k in M.defines)S.push(k),S.push(M.defines[k]);return M.isRawShaderMaterial===!1&&(b(S,M),v(S,M),S.push(i.outputColorSpace)),S.push(M.customProgramCacheKey),S.join()}function b(M,S){M.push(S.precision),M.push(S.outputColorSpace),M.push(S.envMapMode),M.push(S.envMapCubeUVHeight),M.push(S.mapUv),M.push(S.alphaMapUv),M.push(S.lightMapUv),M.push(S.aoMapUv),M.push(S.bumpMapUv),M.push(S.normalMapUv),M.push(S.displacementMapUv),M.push(S.emissiveMapUv),M.push(S.metalnessMapUv),M.push(S.roughnessMapUv),M.push(S.anisotropyMapUv),M.push(S.clearcoatMapUv),M.push(S.clearcoatNormalMapUv),M.push(S.clearcoatRoughnessMapUv),M.push(S.iridescenceMapUv),M.push(S.iridescenceThicknessMapUv),M.push(S.sheenColorMapUv),M.push(S.sheenRoughnessMapUv),M.push(S.specularMapUv),M.push(S.specularColorMapUv),M.push(S.specularIntensityMapUv),M.push(S.transmissionMapUv),M.push(S.thicknessMapUv),M.push(S.combine),M.push(S.fogExp2),M.push(S.sizeAttenuation),M.push(S.morphTargetsCount),M.push(S.morphAttributeCount),M.push(S.numDirLights),M.push(S.numPointLights),M.push(S.numSpotLights),M.push(S.numSpotLightMaps),M.push(S.numHemiLights),M.push(S.numRectAreaLights),M.push(S.numDirLightShadows),M.push(S.numPointLightShadows),M.push(S.numSpotLightShadows),M.push(S.numSpotLightShadowsWithMaps),M.push(S.numLightProbes),M.push(S.shadowMapType),M.push(S.toneMapping),M.push(S.numClippingPlanes),M.push(S.numClipIntersection),M.push(S.depthPacking)}function v(M,S){a.disableAll(),S.supportsVertexTextures&&a.enable(0),S.instancing&&a.enable(1),S.instancingColor&&a.enable(2),S.instancingMorph&&a.enable(3),S.matcap&&a.enable(4),S.envMap&&a.enable(5),S.normalMapObjectSpace&&a.enable(6),S.normalMapTangentSpace&&a.enable(7),S.clearcoat&&a.enable(8),S.iridescence&&a.enable(9),S.alphaTest&&a.enable(10),S.vertexColors&&a.enable(11),S.vertexAlphas&&a.enable(12),S.vertexUv1s&&a.enable(13),S.vertexUv2s&&a.enable(14),S.vertexUv3s&&a.enable(15),S.vertexTangents&&a.enable(16),S.anisotropy&&a.enable(17),S.alphaHash&&a.enable(18),S.batching&&a.enable(19),S.dispersion&&a.enable(20),S.batchingColor&&a.enable(21),M.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.reverseDepthBuffer&&a.enable(4),S.skinning&&a.enable(5),S.morphTargets&&a.enable(6),S.morphNormals&&a.enable(7),S.morphColors&&a.enable(8),S.premultipliedAlpha&&a.enable(9),S.shadowMapEnabled&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.transmission&&a.enable(15),S.sheen&&a.enable(16),S.opaque&&a.enable(17),S.pointsUvs&&a.enable(18),S.decodeVideoTexture&&a.enable(19),S.decodeVideoTextureEmissive&&a.enable(20),S.alphaToCoverage&&a.enable(21),M.push(a.mask)}function x(M){const S=y[M.type];let k;if(S){const A=Ho[S];k=_s.clone(A.uniforms)}else k=M.uniforms;return k}function _(M,S){let k;for(let A=0,B=p.length;A<B;A++){const F=p[A];if(F.cacheKey===S){k=F,++k.usedTimes;break}}return k===void 0&&(k=new Xx(i,S,M,s),p.push(k)),k}function z(M){if(--M.usedTimes===0){const S=p.indexOf(M);p[S]=p[p.length-1],p.pop(),M.destroy()}}function E(M){l.remove(M)}function C(){l.dispose()}return{getParameters:f,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:z,releaseShaderCache:E,programs:p,dispose:C}}function qx(){let i=new WeakMap;function t(r){return i.has(r)}function e(r){let a=i.get(r);return a===void 0&&(a={},i.set(r,a)),a}function o(r){i.delete(r)}function n(r,a,l){i.get(r)[a]=l}function s(){i=new WeakMap}return{has:t,get:e,remove:o,update:n,dispose:s}}function jx(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function gu(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function xu(){const i=[];let t=0;const e=[],o=[],n=[];function s(){t=0,e.length=0,o.length=0,n.length=0}function r(h,u,d,y,g,f){let m=i[t];return m===void 0?(m={id:h.id,object:h,geometry:u,material:d,groupOrder:y,renderOrder:h.renderOrder,z:g,group:f},i[t]=m):(m.id=h.id,m.object=h,m.geometry=u,m.material=d,m.groupOrder=y,m.renderOrder=h.renderOrder,m.z=g,m.group=f),t++,m}function a(h,u,d,y,g,f){const m=r(h,u,d,y,g,f);d.transmission>0?o.push(m):d.transparent===!0?n.push(m):e.push(m)}function l(h,u,d,y,g,f){const m=r(h,u,d,y,g,f);d.transmission>0?o.unshift(m):d.transparent===!0?n.unshift(m):e.unshift(m)}function c(h,u){e.length>1&&e.sort(h||jx),o.length>1&&o.sort(u||gu),n.length>1&&n.sort(u||gu)}function p(){for(let h=t,u=i.length;h<u;h++){const d=i[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:e,transmissive:o,transparent:n,init:s,push:a,unshift:l,finish:p,sort:c}}function Kx(){let i=new WeakMap;function t(o,n){const s=i.get(o);let r;return s===void 0?(r=new xu,i.set(o,[r])):n>=s.length?(r=new xu,s.push(r)):r=s[n],r}function e(){i=new WeakMap}return{get:t,dispose:e}}function Jx(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new R,color:new bt};break;case"SpotLight":e={position:new R,direction:new R,color:new bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new R,color:new bt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new R,skyColor:new bt,groundColor:new bt};break;case"RectAreaLight":e={color:new bt,position:new R,halfWidth:new R,halfHeight:new R};break}return i[t.id]=e,e}}}function Qx(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"SpotLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"PointLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[t.id]=e,e}}}let t1=0;function e1(i,t){return(t.castShadow?2:0)-(i.castShadow?2:0)+(t.map?1:0)-(i.map?1:0)}function o1(i){const t=new Jx,e=Qx(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)o.probe.push(new R);const n=new R,s=new $t,r=new $t;function a(c){let p=0,h=0,u=0;for(let M=0;M<9;M++)o.probe[M].set(0,0,0);let d=0,y=0,g=0,f=0,m=0,b=0,v=0,x=0,_=0,z=0,E=0;c.sort(e1);for(let M=0,S=c.length;M<S;M++){const k=c[M],A=k.color,B=k.intensity,F=k.distance,N=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)p+=A.r*B,h+=A.g*B,u+=A.b*B;else if(k.isLightProbe){for(let G=0;G<9;G++)o.probe[G].addScaledVector(k.sh.coefficients[G],B);E++}else if(k.isDirectionalLight){const G=t.get(k);if(G.color.copy(k.color).multiplyScalar(k.intensity),k.castShadow){const W=k.shadow,et=e.get(k);et.shadowIntensity=W.intensity,et.shadowBias=W.bias,et.shadowNormalBias=W.normalBias,et.shadowRadius=W.radius,et.shadowMapSize=W.mapSize,o.directionalShadow[d]=et,o.directionalShadowMap[d]=N,o.directionalShadowMatrix[d]=k.shadow.matrix,b++}o.directional[d]=G,d++}else if(k.isSpotLight){const G=t.get(k);G.position.setFromMatrixPosition(k.matrixWorld),G.color.copy(A).multiplyScalar(B),G.distance=F,G.coneCos=Math.cos(k.angle),G.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),G.decay=k.decay,o.spot[g]=G;const W=k.shadow;if(k.map&&(o.spotLightMap[_]=k.map,_++,W.updateMatrices(k),k.castShadow&&z++),o.spotLightMatrix[g]=W.matrix,k.castShadow){const et=e.get(k);et.shadowIntensity=W.intensity,et.shadowBias=W.bias,et.shadowNormalBias=W.normalBias,et.shadowRadius=W.radius,et.shadowMapSize=W.mapSize,o.spotShadow[g]=et,o.spotShadowMap[g]=N,x++}g++}else if(k.isRectAreaLight){const G=t.get(k);G.color.copy(A).multiplyScalar(B),G.halfWidth.set(k.width*.5,0,0),G.halfHeight.set(0,k.height*.5,0),o.rectArea[f]=G,f++}else if(k.isPointLight){const G=t.get(k);if(G.color.copy(k.color).multiplyScalar(k.intensity),G.distance=k.distance,G.decay=k.decay,k.castShadow){const W=k.shadow,et=e.get(k);et.shadowIntensity=W.intensity,et.shadowBias=W.bias,et.shadowNormalBias=W.normalBias,et.shadowRadius=W.radius,et.shadowMapSize=W.mapSize,et.shadowCameraNear=W.camera.near,et.shadowCameraFar=W.camera.far,o.pointShadow[y]=et,o.pointShadowMap[y]=N,o.pointShadowMatrix[y]=k.shadow.matrix,v++}o.point[y]=G,y++}else if(k.isHemisphereLight){const G=t.get(k);G.skyColor.copy(k.color).multiplyScalar(B),G.groundColor.copy(k.groundColor).multiplyScalar(B),o.hemi[m]=G,m++}}f>0&&(i.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=At.LTC_FLOAT_1,o.rectAreaLTC2=At.LTC_FLOAT_2):(o.rectAreaLTC1=At.LTC_HALF_1,o.rectAreaLTC2=At.LTC_HALF_2)),o.ambient[0]=p,o.ambient[1]=h,o.ambient[2]=u;const C=o.hash;(C.directionalLength!==d||C.pointLength!==y||C.spotLength!==g||C.rectAreaLength!==f||C.hemiLength!==m||C.numDirectionalShadows!==b||C.numPointShadows!==v||C.numSpotShadows!==x||C.numSpotMaps!==_||C.numLightProbes!==E)&&(o.directional.length=d,o.spot.length=g,o.rectArea.length=f,o.point.length=y,o.hemi.length=m,o.directionalShadow.length=b,o.directionalShadowMap.length=b,o.pointShadow.length=v,o.pointShadowMap.length=v,o.spotShadow.length=x,o.spotShadowMap.length=x,o.directionalShadowMatrix.length=b,o.pointShadowMatrix.length=v,o.spotLightMatrix.length=x+_-z,o.spotLightMap.length=_,o.numSpotLightShadowsWithMaps=z,o.numLightProbes=E,C.directionalLength=d,C.pointLength=y,C.spotLength=g,C.rectAreaLength=f,C.hemiLength=m,C.numDirectionalShadows=b,C.numPointShadows=v,C.numSpotShadows=x,C.numSpotMaps=_,C.numLightProbes=E,o.version=t1++)}function l(c,p){let h=0,u=0,d=0,y=0,g=0;const f=p.matrixWorldInverse;for(let m=0,b=c.length;m<b;m++){const v=c[m];if(v.isDirectionalLight){const x=o.directional[h];x.direction.setFromMatrixPosition(v.matrixWorld),n.setFromMatrixPosition(v.target.matrixWorld),x.direction.sub(n),x.direction.transformDirection(f),h++}else if(v.isSpotLight){const x=o.spot[d];x.position.setFromMatrixPosition(v.matrixWorld),x.position.applyMatrix4(f),x.direction.setFromMatrixPosition(v.matrixWorld),n.setFromMatrixPosition(v.target.matrixWorld),x.direction.sub(n),x.direction.transformDirection(f),d++}else if(v.isRectAreaLight){const x=o.rectArea[y];x.position.setFromMatrixPosition(v.matrixWorld),x.position.applyMatrix4(f),r.identity(),s.copy(v.matrixWorld),s.premultiply(f),r.extractRotation(s),x.halfWidth.set(v.width*.5,0,0),x.halfHeight.set(0,v.height*.5,0),x.halfWidth.applyMatrix4(r),x.halfHeight.applyMatrix4(r),y++}else if(v.isPointLight){const x=o.point[u];x.position.setFromMatrixPosition(v.matrixWorld),x.position.applyMatrix4(f),u++}else if(v.isHemisphereLight){const x=o.hemi[g];x.direction.setFromMatrixPosition(v.matrixWorld),x.direction.transformDirection(f),g++}}}return{setup:a,setupView:l,state:o}}function bu(i){const t=new o1(i),e=[],o=[];function n(p){c.camera=p,e.length=0,o.length=0}function s(p){e.push(p)}function r(p){o.push(p)}function a(){t.setup(e)}function l(p){t.setupView(e,p)}const c={lightsArray:e,shadowsArray:o,camera:null,lights:t,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:r}}function n1(i){let t=new WeakMap;function e(n,s=0){const r=t.get(n);let a;return r===void 0?(a=new bu(i),t.set(n,[a])):s>=r.length?(a=new bu(i),r.push(a)):a=r[s],a}function o(){t=new WeakMap}return{get:e,dispose:o}}class i1 extends Pi{static get type(){return"MeshDepthMaterial"}constructor(t){super(),this.isMeshDepthMaterial=!0,this.depthPacking=vf,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class s1 extends Pi{static get type(){return"MeshDistanceMaterial"}constructor(t){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const r1=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,a1=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function l1(i,t,e){let o=new oc;const n=new ct,s=new ct,r=new se,a=new i1({depthPacking:_f}),l=new s1,c={},p=e.maxTextureSize,h={[Oo]:Qe,[Qe]:Oo,[Ze]:Ze},u=new io({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ct},radius:{value:4}},vertexShader:r1,fragmentShader:a1}),d=u.clone();d.defines.HORIZONTAL_PASS=1;const y=new Xt;y.setAttribute("position",new Gt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new ge(y,u),f=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Np;let m=this.type;this.render=function(z,E,C){if(f.enabled===!1||f.autoUpdate===!1&&f.needsUpdate===!1||z.length===0)return;const M=i.getRenderTarget(),S=i.getActiveCubeFace(),k=i.getActiveMipmapLevel(),A=i.state;A.setBlending($o),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);const B=m!==Yo&&this.type===Yo,F=m===Yo&&this.type!==Yo;for(let N=0,G=z.length;N<G;N++){const W=z[N],et=W.shadow;if(et===void 0){console.warn("THREE.WebGLShadowMap:",W,"has no shadow.");continue}if(et.autoUpdate===!1&&et.needsUpdate===!1)continue;n.copy(et.mapSize);const K=et.getFrameExtents();if(n.multiply(K),s.copy(et.mapSize),(n.x>p||n.y>p)&&(n.x>p&&(s.x=Math.floor(p/K.x),n.x=s.x*K.x,et.mapSize.x=s.x),n.y>p&&(s.y=Math.floor(p/K.y),n.y=s.y*K.y,et.mapSize.y=s.y)),et.map===null||B===!0||F===!0){const X=this.type!==Yo?{minFilter:Se,magFilter:Se}:{};et.map!==null&&et.map.dispose(),et.map=new mo(n.x,n.y,X),et.map.texture.name=W.name+".shadowMap",et.camera.updateProjectionMatrix()}i.setRenderTarget(et.map),i.clear();const pt=et.getViewportCount();for(let X=0;X<pt;X++){const Z=et.getViewport(X);r.set(s.x*Z.x,s.y*Z.y,s.x*Z.z,s.y*Z.w),A.viewport(r),et.updateMatrices(W,X),o=et.getFrustum(),x(E,C,et.camera,W,this.type)}et.isPointLightShadow!==!0&&this.type===Yo&&b(et,C),et.needsUpdate=!1}m=this.type,f.needsUpdate=!1,i.setRenderTarget(M,S,k)};function b(z,E){const C=t.update(g);u.defines.VSM_SAMPLES!==z.blurSamples&&(u.defines.VSM_SAMPLES=z.blurSamples,d.defines.VSM_SAMPLES=z.blurSamples,u.needsUpdate=!0,d.needsUpdate=!0),z.mapPass===null&&(z.mapPass=new mo(n.x,n.y)),u.uniforms.shadow_pass.value=z.map.texture,u.uniforms.resolution.value=z.mapSize,u.uniforms.radius.value=z.radius,i.setRenderTarget(z.mapPass),i.clear(),i.renderBufferDirect(E,null,C,u,g,null),d.uniforms.shadow_pass.value=z.mapPass.texture,d.uniforms.resolution.value=z.mapSize,d.uniforms.radius.value=z.radius,i.setRenderTarget(z.map),i.clear(),i.renderBufferDirect(E,null,C,d,g,null)}function v(z,E,C,M){let S=null;const k=C.isPointLight===!0?z.customDistanceMaterial:z.customDepthMaterial;if(k!==void 0)S=k;else if(S=C.isPointLight===!0?l:a,i.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const A=S.uuid,B=E.uuid;let F=c[A];F===void 0&&(F={},c[A]=F);let N=F[B];N===void 0&&(N=S.clone(),F[B]=N,E.addEventListener("dispose",_)),S=N}if(S.visible=E.visible,S.wireframe=E.wireframe,M===Yo?S.side=E.shadowSide!==null?E.shadowSide:E.side:S.side=E.shadowSide!==null?E.shadowSide:h[E.side],S.alphaMap=E.alphaMap,S.alphaTest=E.alphaTest,S.map=E.map,S.clipShadows=E.clipShadows,S.clippingPlanes=E.clippingPlanes,S.clipIntersection=E.clipIntersection,S.displacementMap=E.displacementMap,S.displacementScale=E.displacementScale,S.displacementBias=E.displacementBias,S.wireframeLinewidth=E.wireframeLinewidth,S.linewidth=E.linewidth,C.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const A=i.properties.get(S);A.light=C}return S}function x(z,E,C,M,S){if(z.visible===!1)return;if(z.layers.test(E.layers)&&(z.isMesh||z.isLine||z.isPoints)&&(z.castShadow||z.receiveShadow&&S===Yo)&&(!z.frustumCulled||o.intersectsObject(z))){z.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,z.matrixWorld);const B=t.update(z),F=z.material;if(Array.isArray(F)){const N=B.groups;for(let G=0,W=N.length;G<W;G++){const et=N[G],K=F[et.materialIndex];if(K&&K.visible){const pt=v(z,K,M,S);z.onBeforeShadow(i,z,E,C,B,pt,et),i.renderBufferDirect(C,null,B,pt,z,et),z.onAfterShadow(i,z,E,C,B,pt,et)}}}else if(F.visible){const N=v(z,F,M,S);z.onBeforeShadow(i,z,E,C,B,N,null),i.renderBufferDirect(C,null,B,N,z,null),z.onAfterShadow(i,z,E,C,B,N,null)}}const A=z.children;for(let B=0,F=A.length;B<F;B++)x(A[B],E,C,M,S)}function _(z){z.target.removeEventListener("dispose",_);for(const C in c){const M=c[C],S=z.target.uuid;S in M&&(M[S].dispose(),delete M[S])}}}const c1={[Xa]:Wa,[Za]:qa,[Ya]:ja,[ui]:$a,[Wa]:Xa,[qa]:Za,[ja]:Ya,[$a]:ui};function p1(i,t){function e(){let q=!1;const Tt=new se;let lt=null;const ut=new se(0,0,0,0);return{setMask:function(Ct){lt!==Ct&&!q&&(i.colorMask(Ct,Ct,Ct,Ct),lt=Ct)},setLocked:function(Ct){q=Ct},setClear:function(Ct,Bt,te,Fe,Ke){Ke===!0&&(Ct*=Fe,Bt*=Fe,te*=Fe),Tt.set(Ct,Bt,te,Fe),ut.equals(Tt)===!1&&(i.clearColor(Ct,Bt,te,Fe),ut.copy(Tt))},reset:function(){q=!1,lt=null,ut.set(-1,0,0,0)}}}function o(){let q=!1,Tt=!1,lt=null,ut=null,Ct=null;return{setReversed:function(Bt){if(Tt!==Bt){const te=t.get("EXT_clip_control");Tt?te.clipControlEXT(te.LOWER_LEFT_EXT,te.ZERO_TO_ONE_EXT):te.clipControlEXT(te.LOWER_LEFT_EXT,te.NEGATIVE_ONE_TO_ONE_EXT);const Fe=Ct;Ct=null,this.setClear(Fe)}Tt=Bt},getReversed:function(){return Tt},setTest:function(Bt){Bt?ft(i.DEPTH_TEST):xt(i.DEPTH_TEST)},setMask:function(Bt){lt!==Bt&&!q&&(i.depthMask(Bt),lt=Bt)},setFunc:function(Bt){if(Tt&&(Bt=c1[Bt]),ut!==Bt){switch(Bt){case Xa:i.depthFunc(i.NEVER);break;case Wa:i.depthFunc(i.ALWAYS);break;case Za:i.depthFunc(i.LESS);break;case ui:i.depthFunc(i.LEQUAL);break;case Ya:i.depthFunc(i.EQUAL);break;case $a:i.depthFunc(i.GEQUAL);break;case qa:i.depthFunc(i.GREATER);break;case ja:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}ut=Bt}},setLocked:function(Bt){q=Bt},setClear:function(Bt){Ct!==Bt&&(Tt&&(Bt=1-Bt),i.clearDepth(Bt),Ct=Bt)},reset:function(){q=!1,lt=null,ut=null,Ct=null,Tt=!1}}}function n(){let q=!1,Tt=null,lt=null,ut=null,Ct=null,Bt=null,te=null,Fe=null,Ke=null;return{setTest:function(de){q||(de?ft(i.STENCIL_TEST):xt(i.STENCIL_TEST))},setMask:function(de){Tt!==de&&!q&&(i.stencilMask(de),Tt=de)},setFunc:function(de,Uo,un){(lt!==de||ut!==Uo||Ct!==un)&&(i.stencilFunc(de,Uo,un),lt=de,ut=Uo,Ct=un)},setOp:function(de,Uo,un){(Bt!==de||te!==Uo||Fe!==un)&&(i.stencilOp(de,Uo,un),Bt=de,te=Uo,Fe=un)},setLocked:function(de){q=de},setClear:function(de){Ke!==de&&(i.clearStencil(de),Ke=de)},reset:function(){q=!1,Tt=null,lt=null,ut=null,Ct=null,Bt=null,te=null,Fe=null,Ke=null}}}const s=new e,r=new o,a=new n,l=new WeakMap,c=new WeakMap;let p={},h={},u=new WeakMap,d=[],y=null,g=!1,f=null,m=null,b=null,v=null,x=null,_=null,z=null,E=new bt(0,0,0),C=0,M=!1,S=null,k=null,A=null,B=null,F=null;const N=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let G=!1,W=0;const et=i.getParameter(i.VERSION);et.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(et)[1]),G=W>=1):et.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(et)[1]),G=W>=2);let K=null,pt={};const X=i.getParameter(i.SCISSOR_BOX),Z=i.getParameter(i.VIEWPORT),gt=new se().fromArray(X),Y=new se().fromArray(Z);function tt(q,Tt,lt,ut){const Ct=new Uint8Array(4),Bt=i.createTexture();i.bindTexture(q,Bt),i.texParameteri(q,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(q,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let te=0;te<lt;te++)q===i.TEXTURE_3D||q===i.TEXTURE_2D_ARRAY?i.texImage3D(Tt,0,i.RGBA,1,1,ut,0,i.RGBA,i.UNSIGNED_BYTE,Ct):i.texImage2D(Tt+te,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Ct);return Bt}const _t={};_t[i.TEXTURE_2D]=tt(i.TEXTURE_2D,i.TEXTURE_2D,1),_t[i.TEXTURE_CUBE_MAP]=tt(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),_t[i.TEXTURE_2D_ARRAY]=tt(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),_t[i.TEXTURE_3D]=tt(i.TEXTURE_3D,i.TEXTURE_3D,1,1),s.setClear(0,0,0,1),r.setClear(1),a.setClear(0),ft(i.DEPTH_TEST),r.setFunc(ui),V(!1),U(Up),ft(i.CULL_FACE),w($o);function ft(q){p[q]!==!0&&(i.enable(q),p[q]=!0)}function xt(q){p[q]!==!1&&(i.disable(q),p[q]=!1)}function Ft(q,Tt){return h[q]!==Tt?(i.bindFramebuffer(q,Tt),h[q]=Tt,q===i.DRAW_FRAMEBUFFER&&(h[i.FRAMEBUFFER]=Tt),q===i.FRAMEBUFFER&&(h[i.DRAW_FRAMEBUFFER]=Tt),!0):!1}function Dt(q,Tt){let lt=d,ut=!1;if(q){lt=u.get(Tt),lt===void 0&&(lt=[],u.set(Tt,lt));const Ct=q.textures;if(lt.length!==Ct.length||lt[0]!==i.COLOR_ATTACHMENT0){for(let Bt=0,te=Ct.length;Bt<te;Bt++)lt[Bt]=i.COLOR_ATTACHMENT0+Bt;lt.length=Ct.length,ut=!0}}else lt[0]!==i.BACK&&(lt[0]=i.BACK,ut=!0);ut&&i.drawBuffers(lt)}function Ot(q){return y!==q?(i.useProgram(q),y=q,!0):!1}const ht={[Dn]:i.FUNC_ADD,[Jd]:i.FUNC_SUBTRACT,[Qd]:i.FUNC_REVERSE_SUBTRACT};ht[tf]=i.MIN,ht[ef]=i.MAX;const yt={[of]:i.ZERO,[nf]:i.ONE,[sf]:i.SRC_COLOR,[Ha]:i.SRC_ALPHA,[hf]:i.SRC_ALPHA_SATURATE,[cf]:i.DST_COLOR,[af]:i.DST_ALPHA,[rf]:i.ONE_MINUS_SRC_COLOR,[Ga]:i.ONE_MINUS_SRC_ALPHA,[pf]:i.ONE_MINUS_DST_COLOR,[lf]:i.ONE_MINUS_DST_ALPHA,[uf]:i.CONSTANT_COLOR,[df]:i.ONE_MINUS_CONSTANT_COLOR,[ff]:i.CONSTANT_ALPHA,[mf]:i.ONE_MINUS_CONSTANT_ALPHA};function w(q,Tt,lt,ut,Ct,Bt,te,Fe,Ke,de){if(q===$o){g===!0&&(xt(i.BLEND),g=!1);return}if(g===!1&&(ft(i.BLEND),g=!0),q!==Kd){if(q!==f||de!==M){if((m!==Dn||x!==Dn)&&(i.blendEquation(i.FUNC_ADD),m=Dn,x=Dn),de)switch(q){case hi:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case Va:i.blendFunc(i.ONE,i.ONE);break;case Vp:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case Hp:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case hi:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case Va:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case Vp:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case Hp:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}b=null,v=null,_=null,z=null,E.set(0,0,0),C=0,f=q,M=de}return}Ct=Ct||Tt,Bt=Bt||lt,te=te||ut,(Tt!==m||Ct!==x)&&(i.blendEquationSeparate(ht[Tt],ht[Ct]),m=Tt,x=Ct),(lt!==b||ut!==v||Bt!==_||te!==z)&&(i.blendFuncSeparate(yt[lt],yt[ut],yt[Bt],yt[te]),b=lt,v=ut,_=Bt,z=te),(Fe.equals(E)===!1||Ke!==C)&&(i.blendColor(Fe.r,Fe.g,Fe.b,Ke),E.copy(Fe),C=Ke),f=q,M=!1}function ot(q,Tt){q.side===Ze?xt(i.CULL_FACE):ft(i.CULL_FACE);let lt=q.side===Qe;Tt&&(lt=!lt),V(lt),q.blending===hi&&q.transparent===!1?w($o):w(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.blendColor,q.blendAlpha,q.premultipliedAlpha),r.setFunc(q.depthFunc),r.setTest(q.depthTest),r.setMask(q.depthWrite),s.setMask(q.colorWrite);const ut=q.stencilWrite;a.setTest(ut),ut&&(a.setMask(q.stencilWriteMask),a.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),a.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),H(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?ft(i.SAMPLE_ALPHA_TO_COVERAGE):xt(i.SAMPLE_ALPHA_TO_COVERAGE)}function V(q){S!==q&&(q?i.frontFace(i.CW):i.frontFace(i.CCW),S=q)}function U(q){q!==qd?(ft(i.CULL_FACE),q!==k&&(q===Up?i.cullFace(i.BACK):q===jd?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):xt(i.CULL_FACE),k=q}function D(q){q!==A&&(G&&i.lineWidth(q),A=q)}function H(q,Tt,lt){q?(ft(i.POLYGON_OFFSET_FILL),(B!==Tt||F!==lt)&&(i.polygonOffset(Tt,lt),B=Tt,F=lt)):xt(i.POLYGON_OFFSET_FILL)}function nt(q){q?ft(i.SCISSOR_TEST):xt(i.SCISSOR_TEST)}function P(q){q===void 0&&(q=i.TEXTURE0+N-1),K!==q&&(i.activeTexture(q),K=q)}function T(q,Tt,lt){lt===void 0&&(K===null?lt=i.TEXTURE0+N-1:lt=K);let ut=pt[lt];ut===void 0&&(ut={type:void 0,texture:void 0},pt[lt]=ut),(ut.type!==q||ut.texture!==Tt)&&(K!==lt&&(i.activeTexture(lt),K=lt),i.bindTexture(q,Tt||_t[q]),ut.type=q,ut.texture=Tt)}function O(){const q=pt[K];q!==void 0&&q.type!==void 0&&(i.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function j(){try{i.compressedTexImage2D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function $(){try{i.compressedTexImage3D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function it(){try{i.texSubImage2D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function wt(){try{i.texSubImage3D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function dt(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function St(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Qt(){try{i.texStorage2D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function mt(){try{i.texStorage3D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Rt(){try{i.texImage2D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function kt(){try{i.texImage3D.apply(i,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Zt(q){gt.equals(q)===!1&&(i.scissor(q.x,q.y,q.z,q.w),gt.copy(q))}function It(q){Y.equals(q)===!1&&(i.viewport(q.x,q.y,q.z,q.w),Y.copy(q))}function qt(q,Tt){let lt=c.get(Tt);lt===void 0&&(lt=new WeakMap,c.set(Tt,lt));let ut=lt.get(q);ut===void 0&&(ut=i.getUniformBlockIndex(Tt,q.name),lt.set(q,ut))}function Jt(q,Tt){const ut=c.get(Tt).get(q);l.get(Tt)!==ut&&(i.uniformBlockBinding(Tt,ut,q.__bindingPointIndex),l.set(Tt,ut))}function me(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),r.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),p={},K=null,pt={},h={},u=new WeakMap,d=[],y=null,g=!1,f=null,m=null,b=null,v=null,x=null,_=null,z=null,E=new bt(0,0,0),C=0,M=!1,S=null,k=null,A=null,B=null,F=null,gt.set(0,0,i.canvas.width,i.canvas.height),Y.set(0,0,i.canvas.width,i.canvas.height),s.reset(),r.reset(),a.reset()}return{buffers:{color:s,depth:r,stencil:a},enable:ft,disable:xt,bindFramebuffer:Ft,drawBuffers:Dt,useProgram:Ot,setBlending:w,setMaterial:ot,setFlipSided:V,setCullFace:U,setLineWidth:D,setPolygonOffset:H,setScissorTest:nt,activeTexture:P,bindTexture:T,unbindTexture:O,compressedTexImage2D:j,compressedTexImage3D:$,texImage2D:Rt,texImage3D:kt,updateUBOMapping:qt,uniformBlockBinding:Jt,texStorage2D:Qt,texStorage3D:mt,texSubImage2D:it,texSubImage3D:wt,compressedTexSubImage2D:dt,compressedTexSubImage3D:St,scissor:Zt,viewport:It,reset:me}}function vu(i,t,e,o){const n=h1(o);switch(e){case eh:return i*t;case nh:return i*t;case ih:return i*t*2;case ol:return i*t/n.components*n.byteLength;case nl:return i*t/n.components*n.byteLength;case sh:return i*t*2/n.components*n.byteLength;case il:return i*t*2/n.components*n.byteLength;case oh:return i*t*3/n.components*n.byteLength;case fo:return i*t*4/n.components*n.byteLength;case sl:return i*t*4/n.components*n.byteLength;case or:case nr:return Math.floor((i+3)/4)*Math.floor((t+3)/4)*8;case ir:case sr:return Math.floor((i+3)/4)*Math.floor((t+3)/4)*16;case al:case cl:return Math.max(i,16)*Math.max(t,8)/4;case rl:case ll:return Math.max(i,8)*Math.max(t,8)/2;case pl:case hl:return Math.floor((i+3)/4)*Math.floor((t+3)/4)*8;case ul:return Math.floor((i+3)/4)*Math.floor((t+3)/4)*16;case dl:return Math.floor((i+3)/4)*Math.floor((t+3)/4)*16;case fl:return Math.floor((i+4)/5)*Math.floor((t+3)/4)*16;case ml:return Math.floor((i+4)/5)*Math.floor((t+4)/5)*16;case yl:return Math.floor((i+5)/6)*Math.floor((t+4)/5)*16;case gl:return Math.floor((i+5)/6)*Math.floor((t+5)/6)*16;case xl:return Math.floor((i+7)/8)*Math.floor((t+4)/5)*16;case bl:return Math.floor((i+7)/8)*Math.floor((t+5)/6)*16;case vl:return Math.floor((i+7)/8)*Math.floor((t+7)/8)*16;case _l:return Math.floor((i+9)/10)*Math.floor((t+4)/5)*16;case wl:return Math.floor((i+9)/10)*Math.floor((t+5)/6)*16;case Ml:return Math.floor((i+9)/10)*Math.floor((t+7)/8)*16;case zl:return Math.floor((i+9)/10)*Math.floor((t+9)/10)*16;case Sl:return Math.floor((i+11)/12)*Math.floor((t+9)/10)*16;case El:return Math.floor((i+11)/12)*Math.floor((t+11)/12)*16;case rr:case Fl:case Al:return Math.ceil(i/4)*Math.ceil(t/4)*16;case rh:case Tl:return Math.ceil(i/4)*Math.ceil(t/4)*8;case Cl:case kl:return Math.ceil(i/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function h1(i){switch(i){case qo:case Jp:return{byteLength:1,components:1};case hs:case Qp:case jo:return{byteLength:2,components:1};case tl:case el:return{byteLength:2,components:4};case In:case Qa:case Vo:return{byteLength:4,components:1};case th:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${i}.`)}function u1(i,t,e,o,n,s,r){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ct,p=new WeakMap;let h;const u=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(P,T){return d?new OffscreenCanvas(P,T):ms("canvas")}function g(P,T,O){let j=1;const $=nt(P);if(($.width>O||$.height>O)&&(j=O/Math.max($.width,$.height)),j<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){const it=Math.floor(j*$.width),wt=Math.floor(j*$.height);h===void 0&&(h=y(it,wt));const dt=T?y(it,wt):h;return dt.width=it,dt.height=wt,dt.getContext("2d").drawImage(P,0,0,it,wt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$.width+"x"+$.height+") to ("+it+"x"+wt+")."),dt}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$.width+"x"+$.height+")."),P;return P}function f(P){return P.generateMipmaps}function m(P){i.generateMipmap(P)}function b(P){return P.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:P.isWebGL3DRenderTarget?i.TEXTURE_3D:P.isWebGLArrayRenderTarget||P.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function v(P,T,O,j,$=!1){if(P!==null){if(i[P]!==void 0)return i[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let it=T;if(T===i.RED&&(O===i.FLOAT&&(it=i.R32F),O===i.HALF_FLOAT&&(it=i.R16F),O===i.UNSIGNED_BYTE&&(it=i.R8)),T===i.RED_INTEGER&&(O===i.UNSIGNED_BYTE&&(it=i.R8UI),O===i.UNSIGNED_SHORT&&(it=i.R16UI),O===i.UNSIGNED_INT&&(it=i.R32UI),O===i.BYTE&&(it=i.R8I),O===i.SHORT&&(it=i.R16I),O===i.INT&&(it=i.R32I)),T===i.RG&&(O===i.FLOAT&&(it=i.RG32F),O===i.HALF_FLOAT&&(it=i.RG16F),O===i.UNSIGNED_BYTE&&(it=i.RG8)),T===i.RG_INTEGER&&(O===i.UNSIGNED_BYTE&&(it=i.RG8UI),O===i.UNSIGNED_SHORT&&(it=i.RG16UI),O===i.UNSIGNED_INT&&(it=i.RG32UI),O===i.BYTE&&(it=i.RG8I),O===i.SHORT&&(it=i.RG16I),O===i.INT&&(it=i.RG32I)),T===i.RGB_INTEGER&&(O===i.UNSIGNED_BYTE&&(it=i.RGB8UI),O===i.UNSIGNED_SHORT&&(it=i.RGB16UI),O===i.UNSIGNED_INT&&(it=i.RGB32UI),O===i.BYTE&&(it=i.RGB8I),O===i.SHORT&&(it=i.RGB16I),O===i.INT&&(it=i.RGB32I)),T===i.RGBA_INTEGER&&(O===i.UNSIGNED_BYTE&&(it=i.RGBA8UI),O===i.UNSIGNED_SHORT&&(it=i.RGBA16UI),O===i.UNSIGNED_INT&&(it=i.RGBA32UI),O===i.BYTE&&(it=i.RGBA8I),O===i.SHORT&&(it=i.RGBA16I),O===i.INT&&(it=i.RGBA32I)),T===i.RGB&&O===i.UNSIGNED_INT_5_9_9_9_REV&&(it=i.RGB9_E5),T===i.RGBA){const wt=$?lr:re.getTransfer(j);O===i.FLOAT&&(it=i.RGBA32F),O===i.HALF_FLOAT&&(it=i.RGBA16F),O===i.UNSIGNED_BYTE&&(it=wt===ue?i.SRGB8_ALPHA8:i.RGBA8),O===i.UNSIGNED_SHORT_4_4_4_4&&(it=i.RGBA4),O===i.UNSIGNED_SHORT_5_5_5_1&&(it=i.RGB5_A1)}return(it===i.R16F||it===i.R32F||it===i.RG16F||it===i.RG32F||it===i.RGBA16F||it===i.RGBA32F)&&t.get("EXT_color_buffer_float"),it}function x(P,T){let O;return P?T===null||T===In||T===mi?O=i.DEPTH24_STENCIL8:T===Vo?O=i.DEPTH32F_STENCIL8:T===hs&&(O=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):T===null||T===In||T===mi?O=i.DEPTH_COMPONENT24:T===Vo?O=i.DEPTH_COMPONENT32F:T===hs&&(O=i.DEPTH_COMPONENT16),O}function _(P,T){return f(P)===!0||P.isFramebufferTexture&&P.minFilter!==Se&&P.minFilter!==uo?Math.log2(Math.max(T.width,T.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?T.mipmaps.length:1}function z(P){const T=P.target;T.removeEventListener("dispose",z),C(T),T.isVideoTexture&&p.delete(T)}function E(P){const T=P.target;T.removeEventListener("dispose",E),S(T)}function C(P){const T=o.get(P);if(T.__webglInit===void 0)return;const O=P.source,j=u.get(O);if(j){const $=j[T.__cacheKey];$.usedTimes--,$.usedTimes===0&&M(P),Object.keys(j).length===0&&u.delete(O)}o.remove(P)}function M(P){const T=o.get(P);i.deleteTexture(T.__webglTexture);const O=P.source,j=u.get(O);delete j[T.__cacheKey],r.memory.textures--}function S(P){const T=o.get(P);if(P.depthTexture&&(P.depthTexture.dispose(),o.remove(P.depthTexture)),P.isWebGLCubeRenderTarget)for(let j=0;j<6;j++){if(Array.isArray(T.__webglFramebuffer[j]))for(let $=0;$<T.__webglFramebuffer[j].length;$++)i.deleteFramebuffer(T.__webglFramebuffer[j][$]);else i.deleteFramebuffer(T.__webglFramebuffer[j]);T.__webglDepthbuffer&&i.deleteRenderbuffer(T.__webglDepthbuffer[j])}else{if(Array.isArray(T.__webglFramebuffer))for(let j=0;j<T.__webglFramebuffer.length;j++)i.deleteFramebuffer(T.__webglFramebuffer[j]);else i.deleteFramebuffer(T.__webglFramebuffer);if(T.__webglDepthbuffer&&i.deleteRenderbuffer(T.__webglDepthbuffer),T.__webglMultisampledFramebuffer&&i.deleteFramebuffer(T.__webglMultisampledFramebuffer),T.__webglColorRenderbuffer)for(let j=0;j<T.__webglColorRenderbuffer.length;j++)T.__webglColorRenderbuffer[j]&&i.deleteRenderbuffer(T.__webglColorRenderbuffer[j]);T.__webglDepthRenderbuffer&&i.deleteRenderbuffer(T.__webglDepthRenderbuffer)}const O=P.textures;for(let j=0,$=O.length;j<$;j++){const it=o.get(O[j]);it.__webglTexture&&(i.deleteTexture(it.__webglTexture),r.memory.textures--),o.remove(O[j])}o.remove(P)}let k=0;function A(){k=0}function B(){const P=k;return P>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+n.maxTextures),k+=1,P}function F(P){const T=[];return T.push(P.wrapS),T.push(P.wrapT),T.push(P.wrapR||0),T.push(P.magFilter),T.push(P.minFilter),T.push(P.anisotropy),T.push(P.internalFormat),T.push(P.format),T.push(P.type),T.push(P.generateMipmaps),T.push(P.premultiplyAlpha),T.push(P.flipY),T.push(P.unpackAlignment),T.push(P.colorSpace),T.join()}function N(P,T){const O=o.get(P);if(P.isVideoTexture&&D(P),P.isRenderTargetTexture===!1&&P.version>0&&O.__version!==P.version){const j=P.image;if(j===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(j.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Y(O,P,T);return}}e.bindTexture(i.TEXTURE_2D,O.__webglTexture,i.TEXTURE0+T)}function G(P,T){const O=o.get(P);if(P.version>0&&O.__version!==P.version){Y(O,P,T);return}e.bindTexture(i.TEXTURE_2D_ARRAY,O.__webglTexture,i.TEXTURE0+T)}function W(P,T){const O=o.get(P);if(P.version>0&&O.__version!==P.version){Y(O,P,T);return}e.bindTexture(i.TEXTURE_3D,O.__webglTexture,i.TEXTURE0+T)}function et(P,T){const O=o.get(P);if(P.version>0&&O.__version!==P.version){tt(O,P,T);return}e.bindTexture(i.TEXTURE_CUBE_MAP,O.__webglTexture,i.TEXTURE0+T)}const K={[Qs]:i.REPEAT,[yn]:i.CLAMP_TO_EDGE,[tr]:i.MIRRORED_REPEAT},pt={[Se]:i.NEAREST,[Kp]:i.NEAREST_MIPMAP_NEAREST,[ps]:i.NEAREST_MIPMAP_LINEAR,[uo]:i.LINEAR,[er]:i.LINEAR_MIPMAP_NEAREST,[gn]:i.LINEAR_MIPMAP_LINEAR},X={[Mf]:i.NEVER,[Tf]:i.ALWAYS,[zf]:i.LESS,[uh]:i.LEQUAL,[Sf]:i.EQUAL,[Af]:i.GEQUAL,[Ef]:i.GREATER,[Ff]:i.NOTEQUAL};function Z(P,T){if(T.type===Vo&&t.has("OES_texture_float_linear")===!1&&(T.magFilter===uo||T.magFilter===er||T.magFilter===ps||T.magFilter===gn||T.minFilter===uo||T.minFilter===er||T.minFilter===ps||T.minFilter===gn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(P,i.TEXTURE_WRAP_S,K[T.wrapS]),i.texParameteri(P,i.TEXTURE_WRAP_T,K[T.wrapT]),(P===i.TEXTURE_3D||P===i.TEXTURE_2D_ARRAY)&&i.texParameteri(P,i.TEXTURE_WRAP_R,K[T.wrapR]),i.texParameteri(P,i.TEXTURE_MAG_FILTER,pt[T.magFilter]),i.texParameteri(P,i.TEXTURE_MIN_FILTER,pt[T.minFilter]),T.compareFunction&&(i.texParameteri(P,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(P,i.TEXTURE_COMPARE_FUNC,X[T.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(T.magFilter===Se||T.minFilter!==ps&&T.minFilter!==gn||T.type===Vo&&t.has("OES_texture_float_linear")===!1)return;if(T.anisotropy>1||o.get(T).__currentAnisotropy){const O=t.get("EXT_texture_filter_anisotropic");i.texParameterf(P,O.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,n.getMaxAnisotropy())),o.get(T).__currentAnisotropy=T.anisotropy}}}function gt(P,T){let O=!1;P.__webglInit===void 0&&(P.__webglInit=!0,T.addEventListener("dispose",z));const j=T.source;let $=u.get(j);$===void 0&&($={},u.set(j,$));const it=F(T);if(it!==P.__cacheKey){$[it]===void 0&&($[it]={texture:i.createTexture(),usedTimes:0},r.memory.textures++,O=!0),$[it].usedTimes++;const wt=$[P.__cacheKey];wt!==void 0&&($[P.__cacheKey].usedTimes--,wt.usedTimes===0&&M(T)),P.__cacheKey=it,P.__webglTexture=$[it].texture}return O}function Y(P,T,O){let j=i.TEXTURE_2D;(T.isDataArrayTexture||T.isCompressedArrayTexture)&&(j=i.TEXTURE_2D_ARRAY),T.isData3DTexture&&(j=i.TEXTURE_3D);const $=gt(P,T),it=T.source;e.bindTexture(j,P.__webglTexture,i.TEXTURE0+O);const wt=o.get(it);if(it.version!==wt.__version||$===!0){e.activeTexture(i.TEXTURE0+O);const dt=re.getPrimaries(re.workingColorSpace),St=T.colorSpace===Ko?null:re.getPrimaries(T.colorSpace),Qt=T.colorSpace===Ko||dt===St?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,T.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,T.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qt);let mt=g(T.image,!1,n.maxTextureSize);mt=H(T,mt);const Rt=s.convert(T.format,T.colorSpace),kt=s.convert(T.type);let Zt=v(T.internalFormat,Rt,kt,T.colorSpace,T.isVideoTexture);Z(j,T);let It;const qt=T.mipmaps,Jt=T.isVideoTexture!==!0,me=wt.__version===void 0||$===!0,q=it.dataReady,Tt=_(T,mt);if(T.isDepthTexture)Zt=x(T.format===gi,T.type),me&&(Jt?e.texStorage2D(i.TEXTURE_2D,1,Zt,mt.width,mt.height):e.texImage2D(i.TEXTURE_2D,0,Zt,mt.width,mt.height,0,Rt,kt,null));else if(T.isDataTexture)if(qt.length>0){Jt&&me&&e.texStorage2D(i.TEXTURE_2D,Tt,Zt,qt[0].width,qt[0].height);for(let lt=0,ut=qt.length;lt<ut;lt++)It=qt[lt],Jt?q&&e.texSubImage2D(i.TEXTURE_2D,lt,0,0,It.width,It.height,Rt,kt,It.data):e.texImage2D(i.TEXTURE_2D,lt,Zt,It.width,It.height,0,Rt,kt,It.data);T.generateMipmaps=!1}else Jt?(me&&e.texStorage2D(i.TEXTURE_2D,Tt,Zt,mt.width,mt.height),q&&e.texSubImage2D(i.TEXTURE_2D,0,0,0,mt.width,mt.height,Rt,kt,mt.data)):e.texImage2D(i.TEXTURE_2D,0,Zt,mt.width,mt.height,0,Rt,kt,mt.data);else if(T.isCompressedTexture)if(T.isCompressedArrayTexture){Jt&&me&&e.texStorage3D(i.TEXTURE_2D_ARRAY,Tt,Zt,qt[0].width,qt[0].height,mt.depth);for(let lt=0,ut=qt.length;lt<ut;lt++)if(It=qt[lt],T.format!==fo)if(Rt!==null)if(Jt){if(q)if(T.layerUpdates.size>0){const Ct=vu(It.width,It.height,T.format,T.type);for(const Bt of T.layerUpdates){const te=It.data.subarray(Bt*Ct/It.data.BYTES_PER_ELEMENT,(Bt+1)*Ct/It.data.BYTES_PER_ELEMENT);e.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,lt,0,0,Bt,It.width,It.height,1,Rt,te)}T.clearLayerUpdates()}else e.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,lt,0,0,0,It.width,It.height,mt.depth,Rt,It.data)}else e.compressedTexImage3D(i.TEXTURE_2D_ARRAY,lt,Zt,It.width,It.height,mt.depth,0,It.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Jt?q&&e.texSubImage3D(i.TEXTURE_2D_ARRAY,lt,0,0,0,It.width,It.height,mt.depth,Rt,kt,It.data):e.texImage3D(i.TEXTURE_2D_ARRAY,lt,Zt,It.width,It.height,mt.depth,0,Rt,kt,It.data)}else{Jt&&me&&e.texStorage2D(i.TEXTURE_2D,Tt,Zt,qt[0].width,qt[0].height);for(let lt=0,ut=qt.length;lt<ut;lt++)It=qt[lt],T.format!==fo?Rt!==null?Jt?q&&e.compressedTexSubImage2D(i.TEXTURE_2D,lt,0,0,It.width,It.height,Rt,It.data):e.compressedTexImage2D(i.TEXTURE_2D,lt,Zt,It.width,It.height,0,It.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Jt?q&&e.texSubImage2D(i.TEXTURE_2D,lt,0,0,It.width,It.height,Rt,kt,It.data):e.texImage2D(i.TEXTURE_2D,lt,Zt,It.width,It.height,0,Rt,kt,It.data)}else if(T.isDataArrayTexture)if(Jt){if(me&&e.texStorage3D(i.TEXTURE_2D_ARRAY,Tt,Zt,mt.width,mt.height,mt.depth),q)if(T.layerUpdates.size>0){const lt=vu(mt.width,mt.height,T.format,T.type);for(const ut of T.layerUpdates){const Ct=mt.data.subarray(ut*lt/mt.data.BYTES_PER_ELEMENT,(ut+1)*lt/mt.data.BYTES_PER_ELEMENT);e.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,ut,mt.width,mt.height,1,Rt,kt,Ct)}T.clearLayerUpdates()}else e.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,mt.width,mt.height,mt.depth,Rt,kt,mt.data)}else e.texImage3D(i.TEXTURE_2D_ARRAY,0,Zt,mt.width,mt.height,mt.depth,0,Rt,kt,mt.data);else if(T.isData3DTexture)Jt?(me&&e.texStorage3D(i.TEXTURE_3D,Tt,Zt,mt.width,mt.height,mt.depth),q&&e.texSubImage3D(i.TEXTURE_3D,0,0,0,0,mt.width,mt.height,mt.depth,Rt,kt,mt.data)):e.texImage3D(i.TEXTURE_3D,0,Zt,mt.width,mt.height,mt.depth,0,Rt,kt,mt.data);else if(T.isFramebufferTexture){if(me)if(Jt)e.texStorage2D(i.TEXTURE_2D,Tt,Zt,mt.width,mt.height);else{let lt=mt.width,ut=mt.height;for(let Ct=0;Ct<Tt;Ct++)e.texImage2D(i.TEXTURE_2D,Ct,Zt,lt,ut,0,Rt,kt,null),lt>>=1,ut>>=1}}else if(qt.length>0){if(Jt&&me){const lt=nt(qt[0]);e.texStorage2D(i.TEXTURE_2D,Tt,Zt,lt.width,lt.height)}for(let lt=0,ut=qt.length;lt<ut;lt++)It=qt[lt],Jt?q&&e.texSubImage2D(i.TEXTURE_2D,lt,0,0,Rt,kt,It):e.texImage2D(i.TEXTURE_2D,lt,Zt,Rt,kt,It);T.generateMipmaps=!1}else if(Jt){if(me){const lt=nt(mt);e.texStorage2D(i.TEXTURE_2D,Tt,Zt,lt.width,lt.height)}q&&e.texSubImage2D(i.TEXTURE_2D,0,0,0,Rt,kt,mt)}else e.texImage2D(i.TEXTURE_2D,0,Zt,Rt,kt,mt);f(T)&&m(j),wt.__version=it.version,T.onUpdate&&T.onUpdate(T)}P.__version=T.version}function tt(P,T,O){if(T.image.length!==6)return;const j=gt(P,T),$=T.source;e.bindTexture(i.TEXTURE_CUBE_MAP,P.__webglTexture,i.TEXTURE0+O);const it=o.get($);if($.version!==it.__version||j===!0){e.activeTexture(i.TEXTURE0+O);const wt=re.getPrimaries(re.workingColorSpace),dt=T.colorSpace===Ko?null:re.getPrimaries(T.colorSpace),St=T.colorSpace===Ko||wt===dt?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,T.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,T.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,T.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,St);const Qt=T.isCompressedTexture||T.image[0].isCompressedTexture,mt=T.image[0]&&T.image[0].isDataTexture,Rt=[];for(let ut=0;ut<6;ut++)!Qt&&!mt?Rt[ut]=g(T.image[ut],!0,n.maxCubemapSize):Rt[ut]=mt?T.image[ut].image:T.image[ut],Rt[ut]=H(T,Rt[ut]);const kt=Rt[0],Zt=s.convert(T.format,T.colorSpace),It=s.convert(T.type),qt=v(T.internalFormat,Zt,It,T.colorSpace),Jt=T.isVideoTexture!==!0,me=it.__version===void 0||j===!0,q=$.dataReady;let Tt=_(T,kt);Z(i.TEXTURE_CUBE_MAP,T);let lt;if(Qt){Jt&&me&&e.texStorage2D(i.TEXTURE_CUBE_MAP,Tt,qt,kt.width,kt.height);for(let ut=0;ut<6;ut++){lt=Rt[ut].mipmaps;for(let Ct=0;Ct<lt.length;Ct++){const Bt=lt[Ct];T.format!==fo?Zt!==null?Jt?q&&e.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct,0,0,Bt.width,Bt.height,Zt,Bt.data):e.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct,qt,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Jt?q&&e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct,0,0,Bt.width,Bt.height,Zt,It,Bt.data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct,qt,Bt.width,Bt.height,0,Zt,It,Bt.data)}}}else{if(lt=T.mipmaps,Jt&&me){lt.length>0&&Tt++;const ut=nt(Rt[0]);e.texStorage2D(i.TEXTURE_CUBE_MAP,Tt,qt,ut.width,ut.height)}for(let ut=0;ut<6;ut++)if(mt){Jt?q&&e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,0,0,Rt[ut].width,Rt[ut].height,Zt,It,Rt[ut].data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,qt,Rt[ut].width,Rt[ut].height,0,Zt,It,Rt[ut].data);for(let Ct=0;Ct<lt.length;Ct++){const te=lt[Ct].image[ut].image;Jt?q&&e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct+1,0,0,te.width,te.height,Zt,It,te.data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct+1,qt,te.width,te.height,0,Zt,It,te.data)}}else{Jt?q&&e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,0,0,Zt,It,Rt[ut]):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,qt,Zt,It,Rt[ut]);for(let Ct=0;Ct<lt.length;Ct++){const Bt=lt[Ct];Jt?q&&e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct+1,0,0,Zt,It,Bt.image[ut]):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+ut,Ct+1,qt,Zt,It,Bt.image[ut])}}}f(T)&&m(i.TEXTURE_CUBE_MAP),it.__version=$.version,T.onUpdate&&T.onUpdate(T)}P.__version=T.version}function _t(P,T,O,j,$,it){const wt=s.convert(O.format,O.colorSpace),dt=s.convert(O.type),St=v(O.internalFormat,wt,dt,O.colorSpace),Qt=o.get(T),mt=o.get(O);if(mt.__renderTarget=T,!Qt.__hasExternalTextures){const Rt=Math.max(1,T.width>>it),kt=Math.max(1,T.height>>it);$===i.TEXTURE_3D||$===i.TEXTURE_2D_ARRAY?e.texImage3D($,it,St,Rt,kt,T.depth,0,wt,dt,null):e.texImage2D($,it,St,Rt,kt,0,wt,dt,null)}e.bindFramebuffer(i.FRAMEBUFFER,P),U(T)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,j,$,mt.__webglTexture,0,V(T)):($===i.TEXTURE_2D||$>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&$<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,j,$,mt.__webglTexture,it),e.bindFramebuffer(i.FRAMEBUFFER,null)}function ft(P,T,O){if(i.bindRenderbuffer(i.RENDERBUFFER,P),T.depthBuffer){const j=T.depthTexture,$=j&&j.isDepthTexture?j.type:null,it=x(T.stencilBuffer,$),wt=T.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,dt=V(T);U(T)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,dt,it,T.width,T.height):O?i.renderbufferStorageMultisample(i.RENDERBUFFER,dt,it,T.width,T.height):i.renderbufferStorage(i.RENDERBUFFER,it,T.width,T.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,wt,i.RENDERBUFFER,P)}else{const j=T.textures;for(let $=0;$<j.length;$++){const it=j[$],wt=s.convert(it.format,it.colorSpace),dt=s.convert(it.type),St=v(it.internalFormat,wt,dt,it.colorSpace),Qt=V(T);O&&U(T)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Qt,St,T.width,T.height):U(T)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Qt,St,T.width,T.height):i.renderbufferStorage(i.RENDERBUFFER,St,T.width,T.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function xt(P,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(i.FRAMEBUFFER,P),!(T.depthTexture&&T.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const j=o.get(T.depthTexture);j.__renderTarget=T,(!j.__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),N(T.depthTexture,0);const $=j.__webglTexture,it=V(T);if(T.depthTexture.format===yi)U(T)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$,0,it):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,$,0);else if(T.depthTexture.format===gi)U(T)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$,0,it):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,$,0);else throw new Error("Unknown depthTexture format")}function Ft(P){const T=o.get(P),O=P.isWebGLCubeRenderTarget===!0;if(T.__boundDepthTexture!==P.depthTexture){const j=P.depthTexture;if(T.__depthDisposeCallback&&T.__depthDisposeCallback(),j){const $=()=>{delete T.__boundDepthTexture,delete T.__depthDisposeCallback,j.removeEventListener("dispose",$)};j.addEventListener("dispose",$),T.__depthDisposeCallback=$}T.__boundDepthTexture=j}if(P.depthTexture&&!T.__autoAllocateDepthBuffer){if(O)throw new Error("target.depthTexture not supported in Cube render targets");xt(T.__webglFramebuffer,P)}else if(O){T.__webglDepthbuffer=[];for(let j=0;j<6;j++)if(e.bindFramebuffer(i.FRAMEBUFFER,T.__webglFramebuffer[j]),T.__webglDepthbuffer[j]===void 0)T.__webglDepthbuffer[j]=i.createRenderbuffer(),ft(T.__webglDepthbuffer[j],P,!1);else{const $=P.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,it=T.__webglDepthbuffer[j];i.bindRenderbuffer(i.RENDERBUFFER,it),i.framebufferRenderbuffer(i.FRAMEBUFFER,$,i.RENDERBUFFER,it)}}else if(e.bindFramebuffer(i.FRAMEBUFFER,T.__webglFramebuffer),T.__webglDepthbuffer===void 0)T.__webglDepthbuffer=i.createRenderbuffer(),ft(T.__webglDepthbuffer,P,!1);else{const j=P.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,$=T.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,$),i.framebufferRenderbuffer(i.FRAMEBUFFER,j,i.RENDERBUFFER,$)}e.bindFramebuffer(i.FRAMEBUFFER,null)}function Dt(P,T,O){const j=o.get(P);T!==void 0&&_t(j.__webglFramebuffer,P,P.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),O!==void 0&&Ft(P)}function Ot(P){const T=P.texture,O=o.get(P),j=o.get(T);P.addEventListener("dispose",E);const $=P.textures,it=P.isWebGLCubeRenderTarget===!0,wt=$.length>1;if(wt||(j.__webglTexture===void 0&&(j.__webglTexture=i.createTexture()),j.__version=T.version,r.memory.textures++),it){O.__webglFramebuffer=[];for(let dt=0;dt<6;dt++)if(T.mipmaps&&T.mipmaps.length>0){O.__webglFramebuffer[dt]=[];for(let St=0;St<T.mipmaps.length;St++)O.__webglFramebuffer[dt][St]=i.createFramebuffer()}else O.__webglFramebuffer[dt]=i.createFramebuffer()}else{if(T.mipmaps&&T.mipmaps.length>0){O.__webglFramebuffer=[];for(let dt=0;dt<T.mipmaps.length;dt++)O.__webglFramebuffer[dt]=i.createFramebuffer()}else O.__webglFramebuffer=i.createFramebuffer();if(wt)for(let dt=0,St=$.length;dt<St;dt++){const Qt=o.get($[dt]);Qt.__webglTexture===void 0&&(Qt.__webglTexture=i.createTexture(),r.memory.textures++)}if(P.samples>0&&U(P)===!1){O.__webglMultisampledFramebuffer=i.createFramebuffer(),O.__webglColorRenderbuffer=[],e.bindFramebuffer(i.FRAMEBUFFER,O.__webglMultisampledFramebuffer);for(let dt=0;dt<$.length;dt++){const St=$[dt];O.__webglColorRenderbuffer[dt]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,O.__webglColorRenderbuffer[dt]);const Qt=s.convert(St.format,St.colorSpace),mt=s.convert(St.type),Rt=v(St.internalFormat,Qt,mt,St.colorSpace,P.isXRRenderTarget===!0),kt=V(P);i.renderbufferStorageMultisample(i.RENDERBUFFER,kt,Rt,P.width,P.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+dt,i.RENDERBUFFER,O.__webglColorRenderbuffer[dt])}i.bindRenderbuffer(i.RENDERBUFFER,null),P.depthBuffer&&(O.__webglDepthRenderbuffer=i.createRenderbuffer(),ft(O.__webglDepthRenderbuffer,P,!0)),e.bindFramebuffer(i.FRAMEBUFFER,null)}}if(it){e.bindTexture(i.TEXTURE_CUBE_MAP,j.__webglTexture),Z(i.TEXTURE_CUBE_MAP,T);for(let dt=0;dt<6;dt++)if(T.mipmaps&&T.mipmaps.length>0)for(let St=0;St<T.mipmaps.length;St++)_t(O.__webglFramebuffer[dt][St],P,T,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+dt,St);else _t(O.__webglFramebuffer[dt],P,T,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0);f(T)&&m(i.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(wt){for(let dt=0,St=$.length;dt<St;dt++){const Qt=$[dt],mt=o.get(Qt);e.bindTexture(i.TEXTURE_2D,mt.__webglTexture),Z(i.TEXTURE_2D,Qt),_t(O.__webglFramebuffer,P,Qt,i.COLOR_ATTACHMENT0+dt,i.TEXTURE_2D,0),f(Qt)&&m(i.TEXTURE_2D)}e.unbindTexture()}else{let dt=i.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(dt=P.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),e.bindTexture(dt,j.__webglTexture),Z(dt,T),T.mipmaps&&T.mipmaps.length>0)for(let St=0;St<T.mipmaps.length;St++)_t(O.__webglFramebuffer[St],P,T,i.COLOR_ATTACHMENT0,dt,St);else _t(O.__webglFramebuffer,P,T,i.COLOR_ATTACHMENT0,dt,0);f(T)&&m(dt),e.unbindTexture()}P.depthBuffer&&Ft(P)}function ht(P){const T=P.textures;for(let O=0,j=T.length;O<j;O++){const $=T[O];if(f($)){const it=b(P),wt=o.get($).__webglTexture;e.bindTexture(it,wt),m(it),e.unbindTexture()}}}const yt=[],w=[];function ot(P){if(P.samples>0){if(U(P)===!1){const T=P.textures,O=P.width,j=P.height;let $=i.COLOR_BUFFER_BIT;const it=P.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,wt=o.get(P),dt=T.length>1;if(dt)for(let St=0;St<T.length;St++)e.bindFramebuffer(i.FRAMEBUFFER,wt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+St,i.RENDERBUFFER,null),e.bindFramebuffer(i.FRAMEBUFFER,wt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+St,i.TEXTURE_2D,null,0);e.bindFramebuffer(i.READ_FRAMEBUFFER,wt.__webglMultisampledFramebuffer),e.bindFramebuffer(i.DRAW_FRAMEBUFFER,wt.__webglFramebuffer);for(let St=0;St<T.length;St++){if(P.resolveDepthBuffer&&(P.depthBuffer&&($|=i.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&($|=i.STENCIL_BUFFER_BIT)),dt){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,wt.__webglColorRenderbuffer[St]);const Qt=o.get(T[St]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Qt,0)}i.blitFramebuffer(0,0,O,j,0,0,O,j,$,i.NEAREST),l===!0&&(yt.length=0,w.length=0,yt.push(i.COLOR_ATTACHMENT0+St),P.depthBuffer&&P.resolveDepthBuffer===!1&&(yt.push(it),w.push(it),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,w)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,yt))}if(e.bindFramebuffer(i.READ_FRAMEBUFFER,null),e.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),dt)for(let St=0;St<T.length;St++){e.bindFramebuffer(i.FRAMEBUFFER,wt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+St,i.RENDERBUFFER,wt.__webglColorRenderbuffer[St]);const Qt=o.get(T[St]).__webglTexture;e.bindFramebuffer(i.FRAMEBUFFER,wt.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+St,i.TEXTURE_2D,Qt,0)}e.bindFramebuffer(i.DRAW_FRAMEBUFFER,wt.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&l){const T=P.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[T])}}}function V(P){return Math.min(n.maxSamples,P.samples)}function U(P){const T=o.get(P);return P.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&T.__useRenderToTexture!==!1}function D(P){const T=r.render.frame;p.get(P)!==T&&(p.set(P,T),P.update())}function H(P,T){const O=P.colorSpace,j=P.format,$=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||O!==xi&&O!==Ko&&(re.getTransfer(O)===ue?(j!==fo||$!==qo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",O)),T}function nt(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(c.width=P.naturalWidth||P.width,c.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(c.width=P.displayWidth,c.height=P.displayHeight):(c.width=P.width,c.height=P.height),c}this.allocateTextureUnit=B,this.resetTextureUnits=A,this.setTexture2D=N,this.setTexture2DArray=G,this.setTexture3D=W,this.setTextureCube=et,this.rebindTextures=Dt,this.setupRenderTarget=Ot,this.updateRenderTargetMipmap=ht,this.updateMultisampleRenderTarget=ot,this.setupDepthRenderbuffer=Ft,this.setupFrameBufferTexture=_t,this.useMultisampledRTT=U}function d1(i,t){function e(o,n=Ko){let s;const r=re.getTransfer(n);if(o===qo)return i.UNSIGNED_BYTE;if(o===tl)return i.UNSIGNED_SHORT_4_4_4_4;if(o===el)return i.UNSIGNED_SHORT_5_5_5_1;if(o===th)return i.UNSIGNED_INT_5_9_9_9_REV;if(o===Jp)return i.BYTE;if(o===Qp)return i.SHORT;if(o===hs)return i.UNSIGNED_SHORT;if(o===Qa)return i.INT;if(o===In)return i.UNSIGNED_INT;if(o===Vo)return i.FLOAT;if(o===jo)return i.HALF_FLOAT;if(o===eh)return i.ALPHA;if(o===oh)return i.RGB;if(o===fo)return i.RGBA;if(o===nh)return i.LUMINANCE;if(o===ih)return i.LUMINANCE_ALPHA;if(o===yi)return i.DEPTH_COMPONENT;if(o===gi)return i.DEPTH_STENCIL;if(o===ol)return i.RED;if(o===nl)return i.RED_INTEGER;if(o===sh)return i.RG;if(o===il)return i.RG_INTEGER;if(o===sl)return i.RGBA_INTEGER;if(o===or||o===nr||o===ir||o===sr)if(r===ue)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(o===or)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===nr)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===ir)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===sr)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(o===or)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===nr)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===ir)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===sr)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===rl||o===al||o===ll||o===cl)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(o===rl)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===al)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===ll)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===cl)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===pl||o===hl||o===ul)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(o===pl||o===hl)return r===ue?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(o===ul)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===dl||o===fl||o===ml||o===yl||o===gl||o===xl||o===bl||o===vl||o===_l||o===wl||o===Ml||o===zl||o===Sl||o===El)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(o===dl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===fl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===ml)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===yl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===gl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===xl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===bl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===vl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===_l)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===wl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===Ml)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===zl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===Sl)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===El)return r===ue?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===rr||o===Fl||o===Al)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(o===rr)return r===ue?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===Fl)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===Al)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===rh||o===Tl||o===Cl||o===kl)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(o===rr)return s.COMPRESSED_RED_RGTC1_EXT;if(o===Tl)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===Cl)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===kl)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===mi?i.UNSIGNED_INT_24_8:i[o]!==void 0?i[o]:null}return{convert:e}}class f1 extends xo{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Zn extends Oe{constructor(){super(),this.isGroup=!0,this.type="Group"}}const m1={type:"move"};class uc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new R,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new R),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new R,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new R),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const o of t.hand.values())this._getHandJoint(e,o)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,o){let n=null,s=null,r=null;const a=this._targetRay,l=this._grip,c=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(c&&t.hand){r=!0;for(const g of t.hand.values()){const f=e.getJointPose(g,o),m=this._getHandJoint(c,g);f!==null&&(m.matrix.fromArray(f.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=f.radius),m.visible=f!==null}const p=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],u=p.position.distanceTo(h.position),d=.02,y=.005;c.inputState.pinching&&u>d+y?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&u<=d-y&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,o),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(n=e.getPose(t.targetRaySpace,o),n===null&&s!==null&&(n=s),n!==null&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(m1)))}return a!==null&&(a.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=r!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const o=new Zn;o.matrixAutoUpdate=!1,o.visible=!1,t.joints[e.jointName]=o,t.add(o)}return t.joints[e.jointName]}}const y1=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,g1=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class x1{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,o){if(this.texture===null){const n=new Ue,s=t.properties.get(n);s.__webglTexture=e.texture,(e.depthNear!=o.depthNear||e.depthFar!=o.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(t){if(this.texture!==null&&this.mesh===null){const e=t.cameras[0].viewport,o=new io({vertexShader:y1,fragmentShader:g1,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new ge(new Ni(20,20),o)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class b1 extends Ln{constructor(t,e){super();const o=this;let n=null,s=1,r=null,a="local-floor",l=1,c=null,p=null,h=null,u=null,d=null,y=null;const g=new x1,f=e.getContextAttributes();let m=null,b=null;const v=[],x=[],_=new ct;let z=null;const E=new xo;E.viewport=new se;const C=new xo;C.viewport=new se;const M=[E,C],S=new f1;let k=null,A=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Y){let tt=v[Y];return tt===void 0&&(tt=new uc,v[Y]=tt),tt.getTargetRaySpace()},this.getControllerGrip=function(Y){let tt=v[Y];return tt===void 0&&(tt=new uc,v[Y]=tt),tt.getGripSpace()},this.getHand=function(Y){let tt=v[Y];return tt===void 0&&(tt=new uc,v[Y]=tt),tt.getHandSpace()};function B(Y){const tt=x.indexOf(Y.inputSource);if(tt===-1)return;const _t=v[tt];_t!==void 0&&(_t.update(Y.inputSource,Y.frame,c||r),_t.dispatchEvent({type:Y.type,data:Y.inputSource}))}function F(){n.removeEventListener("select",B),n.removeEventListener("selectstart",B),n.removeEventListener("selectend",B),n.removeEventListener("squeeze",B),n.removeEventListener("squeezestart",B),n.removeEventListener("squeezeend",B),n.removeEventListener("end",F),n.removeEventListener("inputsourceschange",N);for(let Y=0;Y<v.length;Y++){const tt=x[Y];tt!==null&&(x[Y]=null,v[Y].disconnect(tt))}k=null,A=null,g.reset(),t.setRenderTarget(m),d=null,u=null,h=null,n=null,b=null,gt.stop(),o.isPresenting=!1,t.setPixelRatio(z),t.setSize(_.width,_.height,!1),o.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Y){s=Y,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Y){a=Y,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||r},this.setReferenceSpace=function(Y){c=Y},this.getBaseLayer=function(){return u!==null?u:d},this.getBinding=function(){return h},this.getFrame=function(){return y},this.getSession=function(){return n},this.setSession=async function(Y){if(n=Y,n!==null){if(m=t.getRenderTarget(),n.addEventListener("select",B),n.addEventListener("selectstart",B),n.addEventListener("selectend",B),n.addEventListener("squeeze",B),n.addEventListener("squeezestart",B),n.addEventListener("squeezeend",B),n.addEventListener("end",F),n.addEventListener("inputsourceschange",N),f.xrCompatible!==!0&&await e.makeXRCompatible(),z=t.getPixelRatio(),t.getSize(_),n.renderState.layers===void 0){const tt={antialias:f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(n,e,tt),n.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),b=new mo(d.framebufferWidth,d.framebufferHeight,{format:fo,type:qo,colorSpace:t.outputColorSpace,stencilBuffer:f.stencil})}else{let tt=null,_t=null,ft=null;f.depth&&(ft=f.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,tt=f.stencil?gi:yi,_t=f.stencil?mi:In);const xt={colorFormat:e.RGBA8,depthFormat:ft,scaleFactor:s};h=new XRWebGLBinding(n,e),u=h.createProjectionLayer(xt),n.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),b=new mo(u.textureWidth,u.textureHeight,{format:fo,type:qo,depthTexture:new Jh(u.textureWidth,u.textureHeight,_t,void 0,void 0,void 0,void 0,void 0,void 0,tt),stencilBuffer:f.stencil,colorSpace:t.outputColorSpace,samples:f.antialias?4:0,resolveDepthBuffer:u.ignoreDepthValues===!1})}b.isXRRenderTarget=!0,this.setFoveation(l),c=null,r=await n.requestReferenceSpace(a),gt.setContext(n),gt.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function N(Y){for(let tt=0;tt<Y.removed.length;tt++){const _t=Y.removed[tt],ft=x.indexOf(_t);ft>=0&&(x[ft]=null,v[ft].disconnect(_t))}for(let tt=0;tt<Y.added.length;tt++){const _t=Y.added[tt];let ft=x.indexOf(_t);if(ft===-1){for(let Ft=0;Ft<v.length;Ft++)if(Ft>=x.length){x.push(_t),ft=Ft;break}else if(x[Ft]===null){x[Ft]=_t,ft=Ft;break}if(ft===-1)break}const xt=v[ft];xt&&xt.connect(_t)}}const G=new R,W=new R;function et(Y,tt,_t){G.setFromMatrixPosition(tt.matrixWorld),W.setFromMatrixPosition(_t.matrixWorld);const ft=G.distanceTo(W),xt=tt.projectionMatrix.elements,Ft=_t.projectionMatrix.elements,Dt=xt[14]/(xt[10]-1),Ot=xt[14]/(xt[10]+1),ht=(xt[9]+1)/xt[5],yt=(xt[9]-1)/xt[5],w=(xt[8]-1)/xt[0],ot=(Ft[8]+1)/Ft[0],V=Dt*w,U=Dt*ot,D=ft/(-w+ot),H=D*-w;if(tt.matrixWorld.decompose(Y.position,Y.quaternion,Y.scale),Y.translateX(H),Y.translateZ(D),Y.matrixWorld.compose(Y.position,Y.quaternion,Y.scale),Y.matrixWorldInverse.copy(Y.matrixWorld).invert(),xt[10]===-1)Y.projectionMatrix.copy(tt.projectionMatrix),Y.projectionMatrixInverse.copy(tt.projectionMatrixInverse);else{const nt=Dt+D,P=Ot+D,T=V-H,O=U+(ft-H),j=ht*Ot/P*nt,$=yt*Ot/P*nt;Y.projectionMatrix.makePerspective(T,O,j,$,nt,P),Y.projectionMatrixInverse.copy(Y.projectionMatrix).invert()}}function K(Y,tt){tt===null?Y.matrixWorld.copy(Y.matrix):Y.matrixWorld.multiplyMatrices(tt.matrixWorld,Y.matrix),Y.matrixWorldInverse.copy(Y.matrixWorld).invert()}this.updateCamera=function(Y){if(n===null)return;let tt=Y.near,_t=Y.far;g.texture!==null&&(g.depthNear>0&&(tt=g.depthNear),g.depthFar>0&&(_t=g.depthFar)),S.near=C.near=E.near=tt,S.far=C.far=E.far=_t,(k!==S.near||A!==S.far)&&(n.updateRenderState({depthNear:S.near,depthFar:S.far}),k=S.near,A=S.far),E.layers.mask=Y.layers.mask|2,C.layers.mask=Y.layers.mask|4,S.layers.mask=E.layers.mask|C.layers.mask;const ft=Y.parent,xt=S.cameras;K(S,ft);for(let Ft=0;Ft<xt.length;Ft++)K(xt[Ft],ft);xt.length===2?et(S,E,C):S.projectionMatrix.copy(E.projectionMatrix),pt(Y,S,ft)};function pt(Y,tt,_t){_t===null?Y.matrix.copy(tt.matrixWorld):(Y.matrix.copy(_t.matrixWorld),Y.matrix.invert(),Y.matrix.multiply(tt.matrixWorld)),Y.matrix.decompose(Y.position,Y.quaternion,Y.scale),Y.updateMatrixWorld(!0),Y.projectionMatrix.copy(tt.projectionMatrix),Y.projectionMatrixInverse.copy(tt.projectionMatrixInverse),Y.isPerspectiveCamera&&(Y.fov=ds*2*Math.atan(1/Y.projectionMatrix.elements[5]),Y.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(u===null&&d===null))return l},this.setFoveation=function(Y){l=Y,u!==null&&(u.fixedFoveation=Y),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=Y)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(S)};let X=null;function Z(Y,tt){if(p=tt.getViewerPose(c||r),y=tt,p!==null){const _t=p.views;d!==null&&(t.setRenderTargetFramebuffer(b,d.framebuffer),t.setRenderTarget(b));let ft=!1;_t.length!==S.cameras.length&&(S.cameras.length=0,ft=!0);for(let Ft=0;Ft<_t.length;Ft++){const Dt=_t[Ft];let Ot=null;if(d!==null)Ot=d.getViewport(Dt);else{const yt=h.getViewSubImage(u,Dt);Ot=yt.viewport,Ft===0&&(t.setRenderTargetTextures(b,yt.colorTexture,u.ignoreDepthValues?void 0:yt.depthStencilTexture),t.setRenderTarget(b))}let ht=M[Ft];ht===void 0&&(ht=new xo,ht.layers.enable(Ft),ht.viewport=new se,M[Ft]=ht),ht.matrix.fromArray(Dt.transform.matrix),ht.matrix.decompose(ht.position,ht.quaternion,ht.scale),ht.projectionMatrix.fromArray(Dt.projectionMatrix),ht.projectionMatrixInverse.copy(ht.projectionMatrix).invert(),ht.viewport.set(Ot.x,Ot.y,Ot.width,Ot.height),Ft===0&&(S.matrix.copy(ht.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),ft===!0&&S.cameras.push(ht)}const xt=n.enabledFeatures;if(xt&&xt.includes("depth-sensing")){const Ft=h.getDepthInformation(_t[0]);Ft&&Ft.isValid&&Ft.texture&&g.init(t,Ft,n.renderState)}}for(let _t=0;_t<v.length;_t++){const ft=x[_t],xt=v[_t];ft!==null&&xt!==void 0&&xt.update(ft,tt,c||r)}X&&X(Y,tt),tt.detectedPlanes&&o.dispatchEvent({type:"planesdetected",data:tt}),y=null}const gt=new Xh;gt.setAnimationLoop(Z),this.setAnimationLoop=function(Y){X=Y},this.dispose=function(){}}}const Yn=new oo,v1=new $t;function _1(i,t){function e(f,m){f.matrixAutoUpdate===!0&&f.updateMatrix(),m.value.copy(f.matrix)}function o(f,m){m.color.getRGB(f.fogColor.value,Nh(i)),m.isFog?(f.fogNear.value=m.near,f.fogFar.value=m.far):m.isFogExp2&&(f.fogDensity.value=m.density)}function n(f,m,b,v,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(f,m):m.isMeshToonMaterial?(s(f,m),h(f,m)):m.isMeshPhongMaterial?(s(f,m),p(f,m)):m.isMeshStandardMaterial?(s(f,m),u(f,m),m.isMeshPhysicalMaterial&&d(f,m,x)):m.isMeshMatcapMaterial?(s(f,m),y(f,m)):m.isMeshDepthMaterial?s(f,m):m.isMeshDistanceMaterial?(s(f,m),g(f,m)):m.isMeshNormalMaterial?s(f,m):m.isLineBasicMaterial?(r(f,m),m.isLineDashedMaterial&&a(f,m)):m.isPointsMaterial?l(f,m,b,v):m.isSpriteMaterial?c(f,m):m.isShadowMaterial?(f.color.value.copy(m.color),f.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(f,m){f.opacity.value=m.opacity,m.color&&f.diffuse.value.copy(m.color),m.emissive&&f.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(f.map.value=m.map,e(m.map,f.mapTransform)),m.alphaMap&&(f.alphaMap.value=m.alphaMap,e(m.alphaMap,f.alphaMapTransform)),m.bumpMap&&(f.bumpMap.value=m.bumpMap,e(m.bumpMap,f.bumpMapTransform),f.bumpScale.value=m.bumpScale,m.side===Qe&&(f.bumpScale.value*=-1)),m.normalMap&&(f.normalMap.value=m.normalMap,e(m.normalMap,f.normalMapTransform),f.normalScale.value.copy(m.normalScale),m.side===Qe&&f.normalScale.value.negate()),m.displacementMap&&(f.displacementMap.value=m.displacementMap,e(m.displacementMap,f.displacementMapTransform),f.displacementScale.value=m.displacementScale,f.displacementBias.value=m.displacementBias),m.emissiveMap&&(f.emissiveMap.value=m.emissiveMap,e(m.emissiveMap,f.emissiveMapTransform)),m.specularMap&&(f.specularMap.value=m.specularMap,e(m.specularMap,f.specularMapTransform)),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);const b=t.get(m),v=b.envMap,x=b.envMapRotation;v&&(f.envMap.value=v,Yn.copy(x),Yn.x*=-1,Yn.y*=-1,Yn.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(Yn.y*=-1,Yn.z*=-1),f.envMapRotation.value.setFromMatrix4(v1.makeRotationFromEuler(Yn)),f.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=m.reflectivity,f.ior.value=m.ior,f.refractionRatio.value=m.refractionRatio),m.lightMap&&(f.lightMap.value=m.lightMap,f.lightMapIntensity.value=m.lightMapIntensity,e(m.lightMap,f.lightMapTransform)),m.aoMap&&(f.aoMap.value=m.aoMap,f.aoMapIntensity.value=m.aoMapIntensity,e(m.aoMap,f.aoMapTransform))}function r(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,m.map&&(f.map.value=m.map,e(m.map,f.mapTransform))}function a(f,m){f.dashSize.value=m.dashSize,f.totalSize.value=m.dashSize+m.gapSize,f.scale.value=m.scale}function l(f,m,b,v){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.size.value=m.size*b,f.scale.value=v*.5,m.map&&(f.map.value=m.map,e(m.map,f.uvTransform)),m.alphaMap&&(f.alphaMap.value=m.alphaMap,e(m.alphaMap,f.alphaMapTransform)),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest)}function c(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.rotation.value=m.rotation,m.map&&(f.map.value=m.map,e(m.map,f.mapTransform)),m.alphaMap&&(f.alphaMap.value=m.alphaMap,e(m.alphaMap,f.alphaMapTransform)),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest)}function p(f,m){f.specular.value.copy(m.specular),f.shininess.value=Math.max(m.shininess,1e-4)}function h(f,m){m.gradientMap&&(f.gradientMap.value=m.gradientMap)}function u(f,m){f.metalness.value=m.metalness,m.metalnessMap&&(f.metalnessMap.value=m.metalnessMap,e(m.metalnessMap,f.metalnessMapTransform)),f.roughness.value=m.roughness,m.roughnessMap&&(f.roughnessMap.value=m.roughnessMap,e(m.roughnessMap,f.roughnessMapTransform)),m.envMap&&(f.envMapIntensity.value=m.envMapIntensity)}function d(f,m,b){f.ior.value=m.ior,m.sheen>0&&(f.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),f.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(f.sheenColorMap.value=m.sheenColorMap,e(m.sheenColorMap,f.sheenColorMapTransform)),m.sheenRoughnessMap&&(f.sheenRoughnessMap.value=m.sheenRoughnessMap,e(m.sheenRoughnessMap,f.sheenRoughnessMapTransform))),m.clearcoat>0&&(f.clearcoat.value=m.clearcoat,f.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(f.clearcoatMap.value=m.clearcoatMap,e(m.clearcoatMap,f.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,e(m.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(f.clearcoatNormalMap.value=m.clearcoatNormalMap,e(m.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===Qe&&f.clearcoatNormalScale.value.negate())),m.dispersion>0&&(f.dispersion.value=m.dispersion),m.iridescence>0&&(f.iridescence.value=m.iridescence,f.iridescenceIOR.value=m.iridescenceIOR,f.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(f.iridescenceMap.value=m.iridescenceMap,e(m.iridescenceMap,f.iridescenceMapTransform)),m.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=m.iridescenceThicknessMap,e(m.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),m.transmission>0&&(f.transmission.value=m.transmission,f.transmissionSamplerMap.value=b.texture,f.transmissionSamplerSize.value.set(b.width,b.height),m.transmissionMap&&(f.transmissionMap.value=m.transmissionMap,e(m.transmissionMap,f.transmissionMapTransform)),f.thickness.value=m.thickness,m.thicknessMap&&(f.thicknessMap.value=m.thicknessMap,e(m.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=m.attenuationDistance,f.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(f.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(f.anisotropyMap.value=m.anisotropyMap,e(m.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=m.specularIntensity,f.specularColor.value.copy(m.specularColor),m.specularColorMap&&(f.specularColorMap.value=m.specularColorMap,e(m.specularColorMap,f.specularColorMapTransform)),m.specularIntensityMap&&(f.specularIntensityMap.value=m.specularIntensityMap,e(m.specularIntensityMap,f.specularIntensityMapTransform))}function y(f,m){m.matcap&&(f.matcap.value=m.matcap)}function g(f,m){const b=t.get(m).light;f.referencePosition.value.setFromMatrixPosition(b.matrixWorld),f.nearDistance.value=b.shadow.camera.near,f.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:o,refreshMaterialUniforms:n}}function w1(i,t,e,o){let n={},s={},r=[];const a=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,v){const x=v.program;o.uniformBlockBinding(b,x)}function c(b,v){let x=n[b.id];x===void 0&&(y(b),x=p(b),n[b.id]=x,b.addEventListener("dispose",f));const _=v.program;o.updateUBOMapping(b,_);const z=t.render.frame;s[b.id]!==z&&(u(b),s[b.id]=z)}function p(b){const v=h();b.__bindingPointIndex=v;const x=i.createBuffer(),_=b.__size,z=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,x),i.bufferData(i.UNIFORM_BUFFER,_,z),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,v,x),x}function h(){for(let b=0;b<a;b++)if(r.indexOf(b)===-1)return r.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(b){const v=n[b.id],x=b.uniforms,_=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,v);for(let z=0,E=x.length;z<E;z++){const C=Array.isArray(x[z])?x[z]:[x[z]];for(let M=0,S=C.length;M<S;M++){const k=C[M];if(d(k,z,M,_)===!0){const A=k.__offset,B=Array.isArray(k.value)?k.value:[k.value];let F=0;for(let N=0;N<B.length;N++){const G=B[N],W=g(G);typeof G=="number"||typeof G=="boolean"?(k.__data[0]=G,i.bufferSubData(i.UNIFORM_BUFFER,A+F,k.__data)):G.isMatrix3?(k.__data[0]=G.elements[0],k.__data[1]=G.elements[1],k.__data[2]=G.elements[2],k.__data[3]=0,k.__data[4]=G.elements[3],k.__data[5]=G.elements[4],k.__data[6]=G.elements[5],k.__data[7]=0,k.__data[8]=G.elements[6],k.__data[9]=G.elements[7],k.__data[10]=G.elements[8],k.__data[11]=0):(G.toArray(k.__data,F),F+=W.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,A,k.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function d(b,v,x,_){const z=b.value,E=v+"_"+x;if(_[E]===void 0)return typeof z=="number"||typeof z=="boolean"?_[E]=z:_[E]=z.clone(),!0;{const C=_[E];if(typeof z=="number"||typeof z=="boolean"){if(C!==z)return _[E]=z,!0}else if(C.equals(z)===!1)return C.copy(z),!0}return!1}function y(b){const v=b.uniforms;let x=0;const _=16;for(let E=0,C=v.length;E<C;E++){const M=Array.isArray(v[E])?v[E]:[v[E]];for(let S=0,k=M.length;S<k;S++){const A=M[S],B=Array.isArray(A.value)?A.value:[A.value];for(let F=0,N=B.length;F<N;F++){const G=B[F],W=g(G),et=x%_,K=et%W.boundary,pt=et+K;x+=K,pt!==0&&_-pt<W.storage&&(x+=_-pt),A.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),A.__offset=x,x+=W.storage}}}const z=x%_;return z>0&&(x+=_-z),b.__size=x,b.__cache={},this}function g(b){const v={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(v.boundary=4,v.storage=4):b.isVector2?(v.boundary=8,v.storage=8):b.isVector3||b.isColor?(v.boundary=16,v.storage=12):b.isVector4?(v.boundary=16,v.storage=16):b.isMatrix3?(v.boundary=48,v.storage=48):b.isMatrix4?(v.boundary=64,v.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),v}function f(b){const v=b.target;v.removeEventListener("dispose",f);const x=r.indexOf(v.__bindingPointIndex);r.splice(x,1),i.deleteBuffer(n[v.id]),delete n[v.id],delete s[v.id]}function m(){for(const b in n)i.deleteBuffer(n[b]);r=[],n={},s={}}return{bind:l,update:c,dispose:m}}class M1{constructor(t={}){const{canvas:e=Zf(),context:o=null,depth:n=!0,stencil:s=!1,alpha:r=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:p="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:u=!1}=t;this.isWebGLRenderer=!0;let d;if(o!==null){if(typeof WebGLRenderingContext<"u"&&o instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=o.getContextAttributes().alpha}else d=r;const y=new Uint32Array(4),g=new Int32Array(4);let f=null,m=null;const b=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=to,this.toneMapping=mn,this.toneMappingExposure=1;const x=this;let _=!1,z=0,E=0,C=null,M=-1,S=null;const k=new se,A=new se;let B=null;const F=new bt(0);let N=0,G=e.width,W=e.height,et=1,K=null,pt=null;const X=new se(0,0,G,W),Z=new se(0,0,G,W);let gt=!1;const Y=new oc;let tt=!1,_t=!1;const ft=new $t,xt=new $t,Ft=new R,Dt=new se,Ot={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ht=!1;function yt(){return C===null?et:1}let w=o;function ot(L,J){return e.getContext(L,J)}try{const L={alpha:!0,depth:n,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:p,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${lo}`),e.addEventListener("webglcontextlost",ut,!1),e.addEventListener("webglcontextrestored",Ct,!1),e.addEventListener("webglcontextcreationerror",Bt,!1),w===null){const J="webgl2";if(w=ot(J,L),w===null)throw ot(J)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(L){throw console.error("THREE.WebGLRenderer: "+L.message),L}let V,U,D,H,nt,P,T,O,j,$,it,wt,dt,St,Qt,mt,Rt,kt,Zt,It,qt,Jt,me,q;function Tt(){V=new Ag(w),V.init(),Jt=new d1(w,V),U=new wg(w,V,t,Jt),D=new p1(w,V),U.reverseDepthBuffer&&u&&D.buffers.depth.setReversed(!0),H=new kg(w),nt=new qx,P=new u1(w,V,D,nt,U,Jt,H),T=new zg(x),O=new Fg(x),j=new xm(w),me=new vg(w,j),$=new Tg(w,j,H,me),it=new Pg(w,$,j,H),Zt=new Bg(w,U,P),mt=new Mg(nt),wt=new $x(x,T,O,V,U,me,mt),dt=new _1(x,nt),St=new Kx,Qt=new n1(V),kt=new bg(x,T,O,D,it,d,l),Rt=new l1(x,it,U),q=new w1(w,H,U,D),It=new _g(w,V,H),qt=new Cg(w,V,H),H.programs=wt.programs,x.capabilities=U,x.extensions=V,x.properties=nt,x.renderLists=St,x.shadowMap=Rt,x.state=D,x.info=H}Tt();const lt=new b1(x,w);this.xr=lt,this.getContext=function(){return w},this.getContextAttributes=function(){return w.getContextAttributes()},this.forceContextLoss=function(){const L=V.get("WEBGL_lose_context");L&&L.loseContext()},this.forceContextRestore=function(){const L=V.get("WEBGL_lose_context");L&&L.restoreContext()},this.getPixelRatio=function(){return et},this.setPixelRatio=function(L){L!==void 0&&(et=L,this.setSize(G,W,!1))},this.getSize=function(L){return L.set(G,W)},this.setSize=function(L,J,rt=!0){if(lt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=L,W=J,e.width=Math.floor(L*et),e.height=Math.floor(J*et),rt===!0&&(e.style.width=L+"px",e.style.height=J+"px"),this.setViewport(0,0,L,J)},this.getDrawingBufferSize=function(L){return L.set(G*et,W*et).floor()},this.setDrawingBufferSize=function(L,J,rt){G=L,W=J,et=rt,e.width=Math.floor(L*rt),e.height=Math.floor(J*rt),this.setViewport(0,0,L,J)},this.getCurrentViewport=function(L){return L.copy(k)},this.getViewport=function(L){return L.copy(X)},this.setViewport=function(L,J,rt,at){L.isVector4?X.set(L.x,L.y,L.z,L.w):X.set(L,J,rt,at),D.viewport(k.copy(X).multiplyScalar(et).round())},this.getScissor=function(L){return L.copy(Z)},this.setScissor=function(L,J,rt,at){L.isVector4?Z.set(L.x,L.y,L.z,L.w):Z.set(L,J,rt,at),D.scissor(A.copy(Z).multiplyScalar(et).round())},this.getScissorTest=function(){return gt},this.setScissorTest=function(L){D.setScissorTest(gt=L)},this.setOpaqueSort=function(L){K=L},this.setTransparentSort=function(L){pt=L},this.getClearColor=function(L){return L.copy(kt.getClearColor())},this.setClearColor=function(){kt.setClearColor.apply(kt,arguments)},this.getClearAlpha=function(){return kt.getClearAlpha()},this.setClearAlpha=function(){kt.setClearAlpha.apply(kt,arguments)},this.clear=function(L=!0,J=!0,rt=!0){let at=0;if(L){let Q=!1;if(C!==null){const Mt=C.texture.format;Q=Mt===sl||Mt===il||Mt===nl}if(Q){const Mt=C.texture.type,Pt=Mt===qo||Mt===In||Mt===hs||Mt===mi||Mt===tl||Mt===el,Lt=kt.getClearColor(),Ut=kt.getClearAlpha(),jt=Lt.r,ee=Lt.g,Nt=Lt.b;Pt?(y[0]=jt,y[1]=ee,y[2]=Nt,y[3]=Ut,w.clearBufferuiv(w.COLOR,0,y)):(g[0]=jt,g[1]=ee,g[2]=Nt,g[3]=Ut,w.clearBufferiv(w.COLOR,0,g))}else at|=w.COLOR_BUFFER_BIT}J&&(at|=w.DEPTH_BUFFER_BIT),rt&&(at|=w.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),w.clear(at)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ut,!1),e.removeEventListener("webglcontextrestored",Ct,!1),e.removeEventListener("webglcontextcreationerror",Bt,!1),St.dispose(),Qt.dispose(),nt.dispose(),T.dispose(),O.dispose(),it.dispose(),me.dispose(),q.dispose(),wt.dispose(),lt.dispose(),lt.removeEventListener("sessionstart",Vd),lt.removeEventListener("sessionend",Hd),ci.stop()};function ut(L){L.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function Ct(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const L=H.autoReset,J=Rt.enabled,rt=Rt.autoUpdate,at=Rt.needsUpdate,Q=Rt.type;Tt(),H.autoReset=L,Rt.enabled=J,Rt.autoUpdate=rt,Rt.needsUpdate=at,Rt.type=Q}function Bt(L){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",L.statusMessage)}function te(L){const J=L.target;J.removeEventListener("dispose",te),Fe(J)}function Fe(L){Ke(L),nt.remove(L)}function Ke(L){const J=nt.get(L).programs;J!==void 0&&(J.forEach(function(rt){wt.releaseProgram(rt)}),L.isShaderMaterial&&wt.releaseShaderCache(L))}this.renderBufferDirect=function(L,J,rt,at,Q,Mt){J===null&&(J=Ot);const Pt=Q.isMesh&&Q.matrixWorld.determinant()<0,Lt=fS(L,J,rt,at,Q);D.setMaterial(at,Pt);let Ut=rt.index,jt=1;if(at.wireframe===!0){if(Ut=$.getWireframeAttribute(rt),Ut===void 0)return;jt=2}const ee=rt.drawRange,Nt=rt.attributes.position;let ce=ee.start*jt,be=(ee.start+ee.count)*jt;Mt!==null&&(ce=Math.max(ce,Mt.start*jt),be=Math.min(be,(Mt.start+Mt.count)*jt)),Ut!==null?(ce=Math.max(ce,0),be=Math.min(be,Ut.count)):Nt!=null&&(ce=Math.max(ce,0),be=Math.min(be,Nt.count));const _e=be-ce;if(_e<0||_e===1/0)return;me.setup(Q,at,Lt,rt,Ut);let ho,pe=It;if(Ut!==null&&(ho=j.get(Ut),pe=qt,pe.setIndex(ho)),Q.isMesh)at.wireframe===!0?(D.setLineWidth(at.wireframeLinewidth*yt()),pe.setMode(w.LINES)):pe.setMode(w.TRIANGLES);else if(Q.isLine){let Vt=at.linewidth;Vt===void 0&&(Vt=1),D.setLineWidth(Vt*yt()),Q.isLineSegments?pe.setMode(w.LINES):Q.isLineLoop?pe.setMode(w.LINE_LOOP):pe.setMode(w.LINE_STRIP)}else Q.isPoints?pe.setMode(w.POINTS):Q.isSprite&&pe.setMode(w.TRIANGLES);if(Q.isBatchedMesh)if(Q._multiDrawInstances!==null)pe.renderMultiDrawInstances(Q._multiDrawStarts,Q._multiDrawCounts,Q._multiDrawCount,Q._multiDrawInstances);else if(V.get("WEBGL_multi_draw"))pe.renderMultiDraw(Q._multiDrawStarts,Q._multiDrawCounts,Q._multiDrawCount);else{const Vt=Q._multiDrawStarts,dn=Q._multiDrawCounts,he=Q._multiDrawCount,No=Ut?j.get(Ut).bytesPerElement:1,ls=nt.get(at).currentProgram.getUniforms();for(let wo=0;wo<he;wo++)ls.setValue(w,"_gl_DrawID",wo),pe.render(Vt[wo]/No,dn[wo])}else if(Q.isInstancedMesh)pe.renderInstances(ce,_e,Q.count);else if(rt.isInstancedBufferGeometry){const Vt=rt._maxInstanceCount!==void 0?rt._maxInstanceCount:1/0,dn=Math.min(rt.instanceCount,Vt);pe.renderInstances(ce,_e,dn)}else pe.render(ce,_e)};function de(L,J,rt){L.transparent===!0&&L.side===Ze&&L.forceSinglePass===!1?(L.side=Qe,L.needsUpdate=!0,Oa(L,J,rt),L.side=Oo,L.needsUpdate=!0,Oa(L,J,rt),L.side=Ze):Oa(L,J,rt)}this.compile=function(L,J,rt=null){rt===null&&(rt=L),m=Qt.get(rt),m.init(J),v.push(m),rt.traverseVisible(function(Q){Q.isLight&&Q.layers.test(J.layers)&&(m.pushLight(Q),Q.castShadow&&m.pushShadow(Q))}),L!==rt&&L.traverseVisible(function(Q){Q.isLight&&Q.layers.test(J.layers)&&(m.pushLight(Q),Q.castShadow&&m.pushShadow(Q))}),m.setupLights();const at=new Set;return L.traverse(function(Q){if(!(Q.isMesh||Q.isPoints||Q.isLine||Q.isSprite))return;const Mt=Q.material;if(Mt)if(Array.isArray(Mt))for(let Pt=0;Pt<Mt.length;Pt++){const Lt=Mt[Pt];de(Lt,rt,Q),at.add(Lt)}else de(Mt,rt,Q),at.add(Mt)}),v.pop(),m=null,at},this.compileAsync=function(L,J,rt=null){const at=this.compile(L,J,rt);return new Promise(Q=>{function Mt(){if(at.forEach(function(Pt){nt.get(Pt).currentProgram.isReady()&&at.delete(Pt)}),at.size===0){Q(L);return}setTimeout(Mt,10)}V.get("KHR_parallel_shader_compile")!==null?Mt():setTimeout(Mt,10)})};let Uo=null;function un(L){Uo&&Uo(L)}function Vd(){ci.stop()}function Hd(){ci.start()}const ci=new Xh;ci.setAnimationLoop(un),typeof self<"u"&&ci.setContext(self),this.setAnimationLoop=function(L){Uo=L,lt.setAnimationLoop(L),L===null?ci.stop():ci.start()},lt.addEventListener("sessionstart",Vd),lt.addEventListener("sessionend",Hd),this.render=function(L,J){if(J!==void 0&&J.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;if(L.matrixWorldAutoUpdate===!0&&L.updateMatrixWorld(),J.parent===null&&J.matrixWorldAutoUpdate===!0&&J.updateMatrixWorld(),lt.enabled===!0&&lt.isPresenting===!0&&(lt.cameraAutoUpdate===!0&&lt.updateCamera(J),J=lt.getCamera()),L.isScene===!0&&L.onBeforeRender(x,L,J,C),m=Qt.get(L,v.length),m.init(J),v.push(m),xt.multiplyMatrices(J.projectionMatrix,J.matrixWorldInverse),Y.setFromProjectionMatrix(xt),_t=this.localClippingEnabled,tt=mt.init(this.clippingPlanes,_t),f=St.get(L,b.length),f.init(),b.push(f),lt.enabled===!0&&lt.isPresenting===!0){const Mt=x.xr.getDepthSensingMesh();Mt!==null&&Lp(Mt,J,-1/0,x.sortObjects)}Lp(L,J,0,x.sortObjects),f.finish(),x.sortObjects===!0&&f.sort(K,pt),ht=lt.enabled===!1||lt.isPresenting===!1||lt.hasDepthSensing()===!1,ht&&kt.addToRenderList(f,L),this.info.render.frame++,tt===!0&&mt.beginShadows();const rt=m.state.shadowsArray;Rt.render(rt,L,J),tt===!0&&mt.endShadows(),this.info.autoReset===!0&&this.info.reset();const at=f.opaque,Q=f.transmissive;if(m.setupLights(),J.isArrayCamera){const Mt=J.cameras;if(Q.length>0)for(let Pt=0,Lt=Mt.length;Pt<Lt;Pt++){const Ut=Mt[Pt];Xd(at,Q,L,Ut)}ht&&kt.render(L);for(let Pt=0,Lt=Mt.length;Pt<Lt;Pt++){const Ut=Mt[Pt];Gd(f,L,Ut,Ut.viewport)}}else Q.length>0&&Xd(at,Q,L,J),ht&&kt.render(L),Gd(f,L,J);C!==null&&(P.updateMultisampleRenderTarget(C),P.updateRenderTargetMipmap(C)),L.isScene===!0&&L.onAfterRender(x,L,J),me.resetDefaultState(),M=-1,S=null,v.pop(),v.length>0?(m=v[v.length-1],tt===!0&&mt.setGlobalState(x.clippingPlanes,m.state.camera)):m=null,b.pop(),b.length>0?f=b[b.length-1]:f=null};function Lp(L,J,rt,at){if(L.visible===!1)return;if(L.layers.test(J.layers)){if(L.isGroup)rt=L.renderOrder;else if(L.isLOD)L.autoUpdate===!0&&L.update(J);else if(L.isLight)m.pushLight(L),L.castShadow&&m.pushShadow(L);else if(L.isSprite){if(!L.frustumCulled||Y.intersectsSprite(L)){at&&Dt.setFromMatrixPosition(L.matrixWorld).applyMatrix4(xt);const Pt=it.update(L),Lt=L.material;Lt.visible&&f.push(L,Pt,Lt,rt,Dt.z,null)}}else if((L.isMesh||L.isLine||L.isPoints)&&(!L.frustumCulled||Y.intersectsObject(L))){const Pt=it.update(L),Lt=L.material;if(at&&(L.boundingSphere!==void 0?(L.boundingSphere===null&&L.computeBoundingSphere(),Dt.copy(L.boundingSphere.center)):(Pt.boundingSphere===null&&Pt.computeBoundingSphere(),Dt.copy(Pt.boundingSphere.center)),Dt.applyMatrix4(L.matrixWorld).applyMatrix4(xt)),Array.isArray(Lt)){const Ut=Pt.groups;for(let jt=0,ee=Ut.length;jt<ee;jt++){const Nt=Ut[jt],ce=Lt[Nt.materialIndex];ce&&ce.visible&&f.push(L,Pt,ce,rt,Dt.z,Nt)}}else Lt.visible&&f.push(L,Pt,Lt,rt,Dt.z,null)}}const Mt=L.children;for(let Pt=0,Lt=Mt.length;Pt<Lt;Pt++)Lp(Mt[Pt],J,rt,at)}function Gd(L,J,rt,at){const Q=L.opaque,Mt=L.transmissive,Pt=L.transparent;m.setupLightsView(rt),tt===!0&&mt.setGlobalState(x.clippingPlanes,rt),at&&D.viewport(k.copy(at)),Q.length>0&&Na(Q,J,rt),Mt.length>0&&Na(Mt,J,rt),Pt.length>0&&Na(Pt,J,rt),D.buffers.depth.setTest(!0),D.buffers.depth.setMask(!0),D.buffers.color.setMask(!0),D.setPolygonOffset(!1)}function Xd(L,J,rt,at){if((rt.isScene===!0?rt.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[at.id]===void 0&&(m.state.transmissionRenderTarget[at.id]=new mo(1,1,{generateMipmaps:!0,type:V.has("EXT_color_buffer_half_float")||V.has("EXT_color_buffer_float")?jo:qo,minFilter:gn,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:re.workingColorSpace}));const Mt=m.state.transmissionRenderTarget[at.id],Pt=at.viewport||k;Mt.setSize(Pt.z,Pt.w);const Lt=x.getRenderTarget();x.setRenderTarget(Mt),x.getClearColor(F),N=x.getClearAlpha(),N<1&&x.setClearColor(16777215,.5),x.clear(),ht&&kt.render(rt);const Ut=x.toneMapping;x.toneMapping=mn;const jt=at.viewport;if(at.viewport!==void 0&&(at.viewport=void 0),m.setupLightsView(at),tt===!0&&mt.setGlobalState(x.clippingPlanes,at),Na(L,rt,at),P.updateMultisampleRenderTarget(Mt),P.updateRenderTargetMipmap(Mt),V.has("WEBGL_multisampled_render_to_texture")===!1){let ee=!1;for(let Nt=0,ce=J.length;Nt<ce;Nt++){const be=J[Nt],_e=be.object,ho=be.geometry,pe=be.material,Vt=be.group;if(pe.side===Ze&&_e.layers.test(at.layers)){const dn=pe.side;pe.side=Qe,pe.needsUpdate=!0,Wd(_e,rt,at,ho,pe,Vt),pe.side=dn,pe.needsUpdate=!0,ee=!0}}ee===!0&&(P.updateMultisampleRenderTarget(Mt),P.updateRenderTargetMipmap(Mt))}x.setRenderTarget(Lt),x.setClearColor(F,N),jt!==void 0&&(at.viewport=jt),x.toneMapping=Ut}function Na(L,J,rt){const at=J.isScene===!0?J.overrideMaterial:null;for(let Q=0,Mt=L.length;Q<Mt;Q++){const Pt=L[Q],Lt=Pt.object,Ut=Pt.geometry,jt=at===null?Pt.material:at,ee=Pt.group;Lt.layers.test(rt.layers)&&Wd(Lt,J,rt,Ut,jt,ee)}}function Wd(L,J,rt,at,Q,Mt){L.onBeforeRender(x,J,rt,at,Q,Mt),L.modelViewMatrix.multiplyMatrices(rt.matrixWorldInverse,L.matrixWorld),L.normalMatrix.getNormalMatrix(L.modelViewMatrix),Q.onBeforeRender(x,J,rt,at,L,Mt),Q.transparent===!0&&Q.side===Ze&&Q.forceSinglePass===!1?(Q.side=Qe,Q.needsUpdate=!0,x.renderBufferDirect(rt,J,at,Q,L,Mt),Q.side=Oo,Q.needsUpdate=!0,x.renderBufferDirect(rt,J,at,Q,L,Mt),Q.side=Ze):x.renderBufferDirect(rt,J,at,Q,L,Mt),L.onAfterRender(x,J,rt,at,Q,Mt)}function Oa(L,J,rt){J.isScene!==!0&&(J=Ot);const at=nt.get(L),Q=m.state.lights,Mt=m.state.shadowsArray,Pt=Q.state.version,Lt=wt.getParameters(L,Q.state,Mt,J,rt),Ut=wt.getProgramCacheKey(Lt);let jt=at.programs;at.environment=L.isMeshStandardMaterial?J.environment:null,at.fog=J.fog,at.envMap=(L.isMeshStandardMaterial?O:T).get(L.envMap||at.environment),at.envMapRotation=at.environment!==null&&L.envMap===null?J.environmentRotation:L.envMapRotation,jt===void 0&&(L.addEventListener("dispose",te),jt=new Map,at.programs=jt);let ee=jt.get(Ut);if(ee!==void 0){if(at.currentProgram===ee&&at.lightsStateVersion===Pt)return Yd(L,Lt),ee}else Lt.uniforms=wt.getUniforms(L),L.onBeforeCompile(Lt,x),ee=wt.acquireProgram(Lt,Ut),jt.set(Ut,ee),at.uniforms=Lt.uniforms;const Nt=at.uniforms;return(!L.isShaderMaterial&&!L.isRawShaderMaterial||L.clipping===!0)&&(Nt.clippingPlanes=mt.uniform),Yd(L,Lt),at.needsLights=yS(L),at.lightsStateVersion=Pt,at.needsLights&&(Nt.ambientLightColor.value=Q.state.ambient,Nt.lightProbe.value=Q.state.probe,Nt.directionalLights.value=Q.state.directional,Nt.directionalLightShadows.value=Q.state.directionalShadow,Nt.spotLights.value=Q.state.spot,Nt.spotLightShadows.value=Q.state.spotShadow,Nt.rectAreaLights.value=Q.state.rectArea,Nt.ltc_1.value=Q.state.rectAreaLTC1,Nt.ltc_2.value=Q.state.rectAreaLTC2,Nt.pointLights.value=Q.state.point,Nt.pointLightShadows.value=Q.state.pointShadow,Nt.hemisphereLights.value=Q.state.hemi,Nt.directionalShadowMap.value=Q.state.directionalShadowMap,Nt.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,Nt.spotShadowMap.value=Q.state.spotShadowMap,Nt.spotLightMatrix.value=Q.state.spotLightMatrix,Nt.spotLightMap.value=Q.state.spotLightMap,Nt.pointShadowMap.value=Q.state.pointShadowMap,Nt.pointShadowMatrix.value=Q.state.pointShadowMatrix),at.currentProgram=ee,at.uniformsList=null,ee}function Zd(L){if(L.uniformsList===null){const J=L.currentProgram.getUniforms();L.uniformsList=Cr.seqWithValue(J.seq,L.uniforms)}return L.uniformsList}function Yd(L,J){const rt=nt.get(L);rt.outputColorSpace=J.outputColorSpace,rt.batching=J.batching,rt.batchingColor=J.batchingColor,rt.instancing=J.instancing,rt.instancingColor=J.instancingColor,rt.instancingMorph=J.instancingMorph,rt.skinning=J.skinning,rt.morphTargets=J.morphTargets,rt.morphNormals=J.morphNormals,rt.morphColors=J.morphColors,rt.morphTargetsCount=J.morphTargetsCount,rt.numClippingPlanes=J.numClippingPlanes,rt.numIntersection=J.numClipIntersection,rt.vertexAlphas=J.vertexAlphas,rt.vertexTangents=J.vertexTangents,rt.toneMapping=J.toneMapping}function fS(L,J,rt,at,Q){J.isScene!==!0&&(J=Ot),P.resetTextureUnits();const Mt=J.fog,Pt=at.isMeshStandardMaterial?J.environment:null,Lt=C===null?x.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:xi,Ut=(at.isMeshStandardMaterial?O:T).get(at.envMap||Pt),jt=at.vertexColors===!0&&!!rt.attributes.color&&rt.attributes.color.itemSize===4,ee=!!rt.attributes.tangent&&(!!at.normalMap||at.anisotropy>0),Nt=!!rt.morphAttributes.position,ce=!!rt.morphAttributes.normal,be=!!rt.morphAttributes.color;let _e=mn;at.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(_e=x.toneMapping);const ho=rt.morphAttributes.position||rt.morphAttributes.normal||rt.morphAttributes.color,pe=ho!==void 0?ho.length:0,Vt=nt.get(at),dn=m.state.lights;if(tt===!0&&(_t===!0||L!==S)){const ko=L===S&&at.id===M;mt.setState(at,L,ko)}let he=!1;at.version===Vt.__version?(Vt.needsLights&&Vt.lightsStateVersion!==dn.state.version||Vt.outputColorSpace!==Lt||Q.isBatchedMesh&&Vt.batching===!1||!Q.isBatchedMesh&&Vt.batching===!0||Q.isBatchedMesh&&Vt.batchingColor===!0&&Q.colorTexture===null||Q.isBatchedMesh&&Vt.batchingColor===!1&&Q.colorTexture!==null||Q.isInstancedMesh&&Vt.instancing===!1||!Q.isInstancedMesh&&Vt.instancing===!0||Q.isSkinnedMesh&&Vt.skinning===!1||!Q.isSkinnedMesh&&Vt.skinning===!0||Q.isInstancedMesh&&Vt.instancingColor===!0&&Q.instanceColor===null||Q.isInstancedMesh&&Vt.instancingColor===!1&&Q.instanceColor!==null||Q.isInstancedMesh&&Vt.instancingMorph===!0&&Q.morphTexture===null||Q.isInstancedMesh&&Vt.instancingMorph===!1&&Q.morphTexture!==null||Vt.envMap!==Ut||at.fog===!0&&Vt.fog!==Mt||Vt.numClippingPlanes!==void 0&&(Vt.numClippingPlanes!==mt.numPlanes||Vt.numIntersection!==mt.numIntersection)||Vt.vertexAlphas!==jt||Vt.vertexTangents!==ee||Vt.morphTargets!==Nt||Vt.morphNormals!==ce||Vt.morphColors!==be||Vt.toneMapping!==_e||Vt.morphTargetsCount!==pe)&&(he=!0):(he=!0,Vt.__version=at.version);let No=Vt.currentProgram;he===!0&&(No=Oa(at,J,Q));let ls=!1,wo=!1,js=!1;const we=No.getUniforms(),Zo=Vt.uniforms;if(D.useProgram(No.program)&&(ls=!0,wo=!0,js=!0),at.id!==M&&(M=at.id,wo=!0),ls||S!==L){D.buffers.depth.getReversed()?(ft.copy(L.projectionMatrix),$f(ft),qf(ft),we.setValue(w,"projectionMatrix",ft)):we.setValue(w,"projectionMatrix",L.projectionMatrix),we.setValue(w,"viewMatrix",L.matrixWorldInverse);const Pn=we.map.cameraPosition;Pn!==void 0&&Pn.setValue(w,Ft.setFromMatrixPosition(L.matrixWorld)),U.logarithmicDepthBuffer&&we.setValue(w,"logDepthBufFC",2/(Math.log(L.far+1)/Math.LN2)),(at.isMeshPhongMaterial||at.isMeshToonMaterial||at.isMeshLambertMaterial||at.isMeshBasicMaterial||at.isMeshStandardMaterial||at.isShaderMaterial)&&we.setValue(w,"isOrthographic",L.isOrthographicCamera===!0),S!==L&&(S=L,wo=!0,js=!0)}if(Q.isSkinnedMesh){we.setOptional(w,Q,"bindMatrix"),we.setOptional(w,Q,"bindMatrixInverse");const ko=Q.skeleton;ko&&(ko.boneTexture===null&&ko.computeBoneTexture(),we.setValue(w,"boneTexture",ko.boneTexture,P))}Q.isBatchedMesh&&(we.setOptional(w,Q,"batchingTexture"),we.setValue(w,"batchingTexture",Q._matricesTexture,P),we.setOptional(w,Q,"batchingIdTexture"),we.setValue(w,"batchingIdTexture",Q._indirectTexture,P),we.setOptional(w,Q,"batchingColorTexture"),Q._colorsTexture!==null&&we.setValue(w,"batchingColorTexture",Q._colorsTexture,P));const Ks=rt.morphAttributes;if((Ks.position!==void 0||Ks.normal!==void 0||Ks.color!==void 0)&&Zt.update(Q,rt,No),(wo||Vt.receiveShadow!==Q.receiveShadow)&&(Vt.receiveShadow=Q.receiveShadow,we.setValue(w,"receiveShadow",Q.receiveShadow)),at.isMeshGouraudMaterial&&at.envMap!==null&&(Zo.envMap.value=Ut,Zo.flipEnvMap.value=Ut.isCubeTexture&&Ut.isRenderTargetTexture===!1?-1:1),at.isMeshStandardMaterial&&at.envMap===null&&J.environment!==null&&(Zo.envMapIntensity.value=J.environmentIntensity),wo&&(we.setValue(w,"toneMappingExposure",x.toneMappingExposure),Vt.needsLights&&mS(Zo,js),Mt&&at.fog===!0&&dt.refreshFogUniforms(Zo,Mt),dt.refreshMaterialUniforms(Zo,at,et,W,m.state.transmissionRenderTarget[L.id]),Cr.upload(w,Zd(Vt),Zo,P)),at.isShaderMaterial&&at.uniformsNeedUpdate===!0&&(Cr.upload(w,Zd(Vt),Zo,P),at.uniformsNeedUpdate=!1),at.isSpriteMaterial&&we.setValue(w,"center",Q.center),we.setValue(w,"modelViewMatrix",Q.modelViewMatrix),we.setValue(w,"normalMatrix",Q.normalMatrix),we.setValue(w,"modelMatrix",Q.matrixWorld),at.isShaderMaterial||at.isRawShaderMaterial){const ko=at.uniformsGroups;for(let Pn=0,Rn=ko.length;Pn<Rn;Pn++){const $d=ko[Pn];q.update($d,No),q.bind($d,No)}}return No}function mS(L,J){L.ambientLightColor.needsUpdate=J,L.lightProbe.needsUpdate=J,L.directionalLights.needsUpdate=J,L.directionalLightShadows.needsUpdate=J,L.pointLights.needsUpdate=J,L.pointLightShadows.needsUpdate=J,L.spotLights.needsUpdate=J,L.spotLightShadows.needsUpdate=J,L.rectAreaLights.needsUpdate=J,L.hemisphereLights.needsUpdate=J}function yS(L){return L.isMeshLambertMaterial||L.isMeshToonMaterial||L.isMeshPhongMaterial||L.isMeshStandardMaterial||L.isShadowMaterial||L.isShaderMaterial&&L.lights===!0}this.getActiveCubeFace=function(){return z},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(L,J,rt){nt.get(L.texture).__webglTexture=J,nt.get(L.depthTexture).__webglTexture=rt;const at=nt.get(L);at.__hasExternalTextures=!0,at.__autoAllocateDepthBuffer=rt===void 0,at.__autoAllocateDepthBuffer||V.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),at.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(L,J){const rt=nt.get(L);rt.__webglFramebuffer=J,rt.__useDefaultFramebuffer=J===void 0},this.setRenderTarget=function(L,J=0,rt=0){C=L,z=J,E=rt;let at=!0,Q=null,Mt=!1,Pt=!1;if(L){const Ut=nt.get(L);if(Ut.__useDefaultFramebuffer!==void 0)D.bindFramebuffer(w.FRAMEBUFFER,null),at=!1;else if(Ut.__webglFramebuffer===void 0)P.setupRenderTarget(L);else if(Ut.__hasExternalTextures)P.rebindTextures(L,nt.get(L.texture).__webglTexture,nt.get(L.depthTexture).__webglTexture);else if(L.depthBuffer){const Nt=L.depthTexture;if(Ut.__boundDepthTexture!==Nt){if(Nt!==null&&nt.has(Nt)&&(L.width!==Nt.image.width||L.height!==Nt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");P.setupDepthRenderbuffer(L)}}const jt=L.texture;(jt.isData3DTexture||jt.isDataArrayTexture||jt.isCompressedArrayTexture)&&(Pt=!0);const ee=nt.get(L).__webglFramebuffer;L.isWebGLCubeRenderTarget?(Array.isArray(ee[J])?Q=ee[J][rt]:Q=ee[J],Mt=!0):L.samples>0&&P.useMultisampledRTT(L)===!1?Q=nt.get(L).__webglMultisampledFramebuffer:Array.isArray(ee)?Q=ee[rt]:Q=ee,k.copy(L.viewport),A.copy(L.scissor),B=L.scissorTest}else k.copy(X).multiplyScalar(et).floor(),A.copy(Z).multiplyScalar(et).floor(),B=gt;if(D.bindFramebuffer(w.FRAMEBUFFER,Q)&&at&&D.drawBuffers(L,Q),D.viewport(k),D.scissor(A),D.setScissorTest(B),Mt){const Ut=nt.get(L.texture);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+J,Ut.__webglTexture,rt)}else if(Pt){const Ut=nt.get(L.texture),jt=J||0;w.framebufferTextureLayer(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,Ut.__webglTexture,rt||0,jt)}M=-1},this.readRenderTargetPixels=function(L,J,rt,at,Q,Mt,Pt){if(!(L&&L.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Lt=nt.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&Pt!==void 0&&(Lt=Lt[Pt]),Lt){D.bindFramebuffer(w.FRAMEBUFFER,Lt);try{const Ut=L.texture,jt=Ut.format,ee=Ut.type;if(!U.textureFormatReadable(jt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!U.textureTypeReadable(ee)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}J>=0&&J<=L.width-at&&rt>=0&&rt<=L.height-Q&&w.readPixels(J,rt,at,Q,Jt.convert(jt),Jt.convert(ee),Mt)}finally{const Ut=C!==null?nt.get(C).__webglFramebuffer:null;D.bindFramebuffer(w.FRAMEBUFFER,Ut)}}},this.readRenderTargetPixelsAsync=async function(L,J,rt,at,Q,Mt,Pt){if(!(L&&L.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Lt=nt.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&Pt!==void 0&&(Lt=Lt[Pt]),Lt){const Ut=L.texture,jt=Ut.format,ee=Ut.type;if(!U.textureFormatReadable(jt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!U.textureTypeReadable(ee))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(J>=0&&J<=L.width-at&&rt>=0&&rt<=L.height-Q){D.bindFramebuffer(w.FRAMEBUFFER,Lt);const Nt=w.createBuffer();w.bindBuffer(w.PIXEL_PACK_BUFFER,Nt),w.bufferData(w.PIXEL_PACK_BUFFER,Mt.byteLength,w.STREAM_READ),w.readPixels(J,rt,at,Q,Jt.convert(jt),Jt.convert(ee),0);const ce=C!==null?nt.get(C).__webglFramebuffer:null;D.bindFramebuffer(w.FRAMEBUFFER,ce);const be=w.fenceSync(w.SYNC_GPU_COMMANDS_COMPLETE,0);return w.flush(),await Yf(w,be,4),w.bindBuffer(w.PIXEL_PACK_BUFFER,Nt),w.getBufferSubData(w.PIXEL_PACK_BUFFER,0,Mt),w.deleteBuffer(Nt),w.deleteSync(be),Mt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(L,J=null,rt=0){L.isTexture!==!0&&(ys("WebGLRenderer: copyFramebufferToTexture function signature has changed."),J=arguments[0]||null,L=arguments[1]);const at=Math.pow(2,-rt),Q=Math.floor(L.image.width*at),Mt=Math.floor(L.image.height*at),Pt=J!==null?J.x:0,Lt=J!==null?J.y:0;P.setTexture2D(L,0),w.copyTexSubImage2D(w.TEXTURE_2D,rt,0,0,Pt,Lt,Q,Mt),D.unbindTexture()},this.copyTextureToTexture=function(L,J,rt=null,at=null,Q=0){L.isTexture!==!0&&(ys("WebGLRenderer: copyTextureToTexture function signature has changed."),at=arguments[0]||null,L=arguments[1],J=arguments[2],Q=arguments[3]||0,rt=null);let Mt,Pt,Lt,Ut,jt,ee,Nt,ce,be;const _e=L.isCompressedTexture?L.mipmaps[Q]:L.image;rt!==null?(Mt=rt.max.x-rt.min.x,Pt=rt.max.y-rt.min.y,Lt=rt.isBox3?rt.max.z-rt.min.z:1,Ut=rt.min.x,jt=rt.min.y,ee=rt.isBox3?rt.min.z:0):(Mt=_e.width,Pt=_e.height,Lt=_e.depth||1,Ut=0,jt=0,ee=0),at!==null?(Nt=at.x,ce=at.y,be=at.z):(Nt=0,ce=0,be=0);const ho=Jt.convert(J.format),pe=Jt.convert(J.type);let Vt;J.isData3DTexture?(P.setTexture3D(J,0),Vt=w.TEXTURE_3D):J.isDataArrayTexture||J.isCompressedArrayTexture?(P.setTexture2DArray(J,0),Vt=w.TEXTURE_2D_ARRAY):(P.setTexture2D(J,0),Vt=w.TEXTURE_2D),w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,J.flipY),w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),w.pixelStorei(w.UNPACK_ALIGNMENT,J.unpackAlignment);const dn=w.getParameter(w.UNPACK_ROW_LENGTH),he=w.getParameter(w.UNPACK_IMAGE_HEIGHT),No=w.getParameter(w.UNPACK_SKIP_PIXELS),ls=w.getParameter(w.UNPACK_SKIP_ROWS),wo=w.getParameter(w.UNPACK_SKIP_IMAGES);w.pixelStorei(w.UNPACK_ROW_LENGTH,_e.width),w.pixelStorei(w.UNPACK_IMAGE_HEIGHT,_e.height),w.pixelStorei(w.UNPACK_SKIP_PIXELS,Ut),w.pixelStorei(w.UNPACK_SKIP_ROWS,jt),w.pixelStorei(w.UNPACK_SKIP_IMAGES,ee);const js=L.isDataArrayTexture||L.isData3DTexture,we=J.isDataArrayTexture||J.isData3DTexture;if(L.isRenderTargetTexture||L.isDepthTexture){const Zo=nt.get(L),Ks=nt.get(J),ko=nt.get(Zo.__renderTarget),Pn=nt.get(Ks.__renderTarget);D.bindFramebuffer(w.READ_FRAMEBUFFER,ko.__webglFramebuffer),D.bindFramebuffer(w.DRAW_FRAMEBUFFER,Pn.__webglFramebuffer);for(let Rn=0;Rn<Lt;Rn++)js&&w.framebufferTextureLayer(w.READ_FRAMEBUFFER,w.COLOR_ATTACHMENT0,nt.get(L).__webglTexture,Q,ee+Rn),L.isDepthTexture?(we&&w.framebufferTextureLayer(w.DRAW_FRAMEBUFFER,w.COLOR_ATTACHMENT0,nt.get(J).__webglTexture,Q,be+Rn),w.blitFramebuffer(Ut,jt,Mt,Pt,Nt,ce,Mt,Pt,w.DEPTH_BUFFER_BIT,w.NEAREST)):we?w.copyTexSubImage3D(Vt,Q,Nt,ce,be+Rn,Ut,jt,Mt,Pt):w.copyTexSubImage2D(Vt,Q,Nt,ce,be+Rn,Ut,jt,Mt,Pt);D.bindFramebuffer(w.READ_FRAMEBUFFER,null),D.bindFramebuffer(w.DRAW_FRAMEBUFFER,null)}else we?L.isDataTexture||L.isData3DTexture?w.texSubImage3D(Vt,Q,Nt,ce,be,Mt,Pt,Lt,ho,pe,_e.data):J.isCompressedArrayTexture?w.compressedTexSubImage3D(Vt,Q,Nt,ce,be,Mt,Pt,Lt,ho,_e.data):w.texSubImage3D(Vt,Q,Nt,ce,be,Mt,Pt,Lt,ho,pe,_e):L.isDataTexture?w.texSubImage2D(w.TEXTURE_2D,Q,Nt,ce,Mt,Pt,ho,pe,_e.data):L.isCompressedTexture?w.compressedTexSubImage2D(w.TEXTURE_2D,Q,Nt,ce,_e.width,_e.height,ho,_e.data):w.texSubImage2D(w.TEXTURE_2D,Q,Nt,ce,Mt,Pt,ho,pe,_e);w.pixelStorei(w.UNPACK_ROW_LENGTH,dn),w.pixelStorei(w.UNPACK_IMAGE_HEIGHT,he),w.pixelStorei(w.UNPACK_SKIP_PIXELS,No),w.pixelStorei(w.UNPACK_SKIP_ROWS,ls),w.pixelStorei(w.UNPACK_SKIP_IMAGES,wo),Q===0&&J.generateMipmaps&&w.generateMipmap(Vt),D.unbindTexture()},this.copyTextureToTexture3D=function(L,J,rt=null,at=null,Q=0){return L.isTexture!==!0&&(ys("WebGLRenderer: copyTextureToTexture3D function signature has changed."),rt=arguments[0]||null,at=arguments[1]||null,L=arguments[2],J=arguments[3],Q=arguments[4]||0),ys('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(L,J,rt,at,Q)},this.initRenderTarget=function(L){nt.get(L).__webglFramebuffer===void 0&&P.setupRenderTarget(L)},this.initTexture=function(L){L.isCubeTexture?P.setTextureCube(L,0):L.isData3DTexture?P.setTexture3D(L,0):L.isDataArrayTexture||L.isCompressedArrayTexture?P.setTexture2DArray(L,0):P.setTexture2D(L,0),D.unbindTexture()},this.resetState=function(){z=0,E=0,C=null,D.reset(),me.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Jo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=re._getDrawingBufferColorSpace(t),e.unpackColorSpace=re._getUnpackColorSpace()}}class Br extends Oe{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new oo,this.environmentIntensity=1,this.environmentRotation=new oo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class z1 extends Ue{constructor(t=null,e=1,o=1,n,s,r,a,l,c=Se,p=Se,h,u){super(null,r,a,l,c,p,n,s,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:o},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class dc extends Gt{constructor(t,e,o,n=1){super(t,e,o),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Gi=new $t,_u=new $t,Pr=[],wu=new Ne,S1=new $t,Ms=new ge,zs=new Fi;class E1 extends ge{constructor(t,e,o){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new dc(new Float32Array(o*16),16),this.instanceColor=null,this.morphTexture=null,this.count=o,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<o;n++)this.setMatrixAt(n,S1)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Ne),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let o=0;o<e;o++)this.getMatrixAt(o,Gi),wu.copy(t.boundingBox).applyMatrix4(Gi),this.boundingBox.union(wu)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Fi),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let o=0;o<e;o++)this.getMatrixAt(o,Gi),zs.copy(t.boundingSphere).applyMatrix4(Gi),this.boundingSphere.union(zs)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const o=e.morphTargetInfluences,n=this.morphTexture.source.data.data,s=o.length+1,r=t*s+1;for(let a=0;a<o.length;a++)o[a]=n[r+a]}raycast(t,e){const o=this.matrixWorld,n=this.count;if(Ms.geometry=this.geometry,Ms.material=this.material,Ms.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),zs.copy(this.boundingSphere),zs.applyMatrix4(o),t.ray.intersectsSphere(zs)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,Gi),_u.multiplyMatrices(o,Gi),Ms.matrixWorld=_u,Ms.raycast(t,Pr);for(let r=0,a=Pr.length;r<a;r++){const l=Pr[r];l.instanceId=s,l.object=this,e.push(l)}Pr.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new dc(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const o=e.morphTargetInfluences,n=o.length+1;this.morphTexture===null&&(this.morphTexture=new z1(new Float32Array(n*this.count),n,this.count,ol,Vo));const s=this.morphTexture.source.data.data;let r=0;for(let c=0;c<o.length;c++)r+=o[c];const a=this.geometry.morphTargetsRelative?1:1-r,l=n*t;s[l]=a,s.set(o,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class $n extends Pi{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new bt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Rr=new R,Dr=new R,Mu=new $t,Ss=new On,Ir=new Fi,fc=new R,zu=new R;class F1 extends Oe{constructor(t=new Xt,e=new $n){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,o=[0];for(let n=1,s=e.count;n<s;n++)Rr.fromBufferAttribute(e,n-1),Dr.fromBufferAttribute(e,n),o[n]=o[n-1],o[n]+=Rr.distanceTo(Dr);t.setAttribute("lineDistance",new Yt(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const o=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,r=o.drawRange;if(o.boundingSphere===null&&o.computeBoundingSphere(),Ir.copy(o.boundingSphere),Ir.applyMatrix4(n),Ir.radius+=s,t.ray.intersectsSphere(Ir)===!1)return;Mu.copy(n).invert(),Ss.copy(t.ray).applyMatrix4(Mu);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,p=o.index,u=o.attributes.position;if(p!==null){const d=Math.max(0,r.start),y=Math.min(p.count,r.start+r.count);for(let g=d,f=y-1;g<f;g+=c){const m=p.getX(g),b=p.getX(g+1),v=Lr(this,t,Ss,l,m,b);v&&e.push(v)}if(this.isLineLoop){const g=p.getX(y-1),f=p.getX(d),m=Lr(this,t,Ss,l,g,f);m&&e.push(m)}}else{const d=Math.max(0,r.start),y=Math.min(u.count,r.start+r.count);for(let g=d,f=y-1;g<f;g+=c){const m=Lr(this,t,Ss,l,g,g+1);m&&e.push(m)}if(this.isLineLoop){const g=Lr(this,t,Ss,l,y-1,d);g&&e.push(g)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,o=Object.keys(e);if(o.length>0){const n=e[o[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=n.length;s<r;s++){const a=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Lr(i,t,e,o,n,s){const r=i.geometry.attributes.position;if(Rr.fromBufferAttribute(r,n),Dr.fromBufferAttribute(r,s),e.distanceSqToSegment(Rr,Dr,fc,zu)>o)return;fc.applyMatrix4(i.matrixWorld);const l=t.ray.origin.distanceTo(fc);if(!(l<t.near||l>t.far))return{distance:l,point:zu.clone().applyMatrix4(i.matrixWorld),index:n,face:null,faceIndex:null,barycoord:null,object:i}}const Su=new R,Eu=new R;class Xi extends F1{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,o=[];for(let n=0,s=e.count;n<s;n+=2)Su.fromBufferAttribute(e,n),Eu.fromBufferAttribute(e,n+1),o[n]=n===0?0:o[n-1],o[n+1]=o[n]+Su.distanceTo(Eu);t.setAttribute("lineDistance",new Yt(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class mc extends Ue{constructor(t,e,o,n,s,r,a,l,c,p,h,u){super(null,r,a,l,c,p,n,s,h,u),this.isCompressedTexture=!0,this.image={width:e,height:o},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class yc extends Ue{constructor(t,e,o,n,s,r,a,l,c){super(t,e,o,n,s,r,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class bo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const o=this.getUtoTmapping(t);return this.getPoint(o,e)}getPoints(t=5){const e=[];for(let o=0;o<=t;o++)e.push(this.getPoint(o/t));return e}getSpacedPoints(t=5){const e=[];for(let o=0;o<=t;o++)e.push(this.getPointAt(o/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let o,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=t;r++)o=this.getPoint(r/t),s+=o.distanceTo(n),e.push(s),n=o;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const o=this.getLengths();let n=0;const s=o.length;let r;e?r=e:r=t*o[s-1];let a=0,l=s-1,c;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),c=o[n]-r,c<0)a=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,o[n]===r)return n/(s-1);const p=o[n],u=o[n+1]-p,d=(r-p)/u;return(n+d)/(s-1)}getTangent(t,e){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),a=this.getPoint(s),l=e||(r.isVector2?new ct:new R);return l.copy(a).sub(r).normalize(),l}getTangentAt(t,e){const o=this.getUtoTmapping(t);return this.getTangent(o,e)}computeFrenetFrames(t,e){const o=new R,n=[],s=[],r=[],a=new R,l=new $t;for(let d=0;d<=t;d++){const y=d/t;n[d]=this.getTangentAt(y,new R)}s[0]=new R,r[0]=new R;let c=Number.MAX_VALUE;const p=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);p<=c&&(c=p,o.set(1,0,0)),h<=c&&(c=h,o.set(0,1,0)),u<=c&&o.set(0,0,1),a.crossVectors(n[0],o).normalize(),s[0].crossVectors(n[0],a),r[0].crossVectors(n[0],s[0]);for(let d=1;d<=t;d++){if(s[d]=s[d-1].clone(),r[d]=r[d-1].clone(),a.crossVectors(n[d-1],n[d]),a.length()>Number.EPSILON){a.normalize();const y=Math.acos(Ce(n[d-1].dot(n[d]),-1,1));s[d].applyMatrix4(l.makeRotationAxis(a,y))}r[d].crossVectors(n[d],s[d])}if(e===!0){let d=Math.acos(Ce(s[0].dot(s[t]),-1,1));d/=t,n[0].dot(a.crossVectors(s[0],s[t]))>0&&(d=-d);for(let y=1;y<=t;y++)s[y].applyMatrix4(l.makeRotationAxis(n[y],d*y)),r[y].crossVectors(n[y],s[y])}return{tangents:n,normals:s,binormals:r}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class gc extends bo{constructor(t=0,e=0,o=1,n=1,s=0,r=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=o,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=a,this.aRotation=l}getPoint(t,e=new ct){const o=e,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(r?s=0:s=n),this.aClockwise===!0&&!r&&(s===n?s=-n:s=s-n);const a=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const p=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=l-this.aX,d=c-this.aY;l=u*p-d*h+this.aX,c=u*h+d*p+this.aY}return o.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class A1 extends gc{constructor(t,e,o,n,s,r){super(t,e,o,o,n,s,r),this.isArcCurve=!0,this.type="ArcCurve"}}function xc(){let i=0,t=0,e=0,o=0;function n(s,r,a,l){i=s,t=a,e=-3*s+3*r-2*a-l,o=2*s-2*r+a+l}return{initCatmullRom:function(s,r,a,l,c){n(r,a,c*(a-s),c*(l-r))},initNonuniformCatmullRom:function(s,r,a,l,c,p,h){let u=(r-s)/c-(a-s)/(c+p)+(a-r)/p,d=(a-r)/p-(l-r)/(p+h)+(l-a)/h;u*=p,d*=p,n(r,a,u,d)},calc:function(s){const r=s*s,a=r*s;return i+t*s+e*r+o*a}}}const Ur=new R,bc=new xc,vc=new xc,_c=new xc;class T1 extends bo{constructor(t=[],e=!1,o="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=o,this.tension=n}getPoint(t,e=new R){const o=e,n=this.points,s=n.length,r=(s-(this.closed?0:1))*t;let a=Math.floor(r),l=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,p;this.closed||a>0?c=n[(a-1)%s]:(Ur.subVectors(n[0],n[1]).add(n[0]),c=Ur);const h=n[a%s],u=n[(a+1)%s];if(this.closed||a+2<s?p=n[(a+2)%s]:(Ur.subVectors(n[s-1],n[s-2]).add(n[s-1]),p=Ur),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let y=Math.pow(c.distanceToSquared(h),d),g=Math.pow(h.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(p),d);g<1e-4&&(g=1),y<1e-4&&(y=g),f<1e-4&&(f=g),bc.initNonuniformCatmullRom(c.x,h.x,u.x,p.x,y,g,f),vc.initNonuniformCatmullRom(c.y,h.y,u.y,p.y,y,g,f),_c.initNonuniformCatmullRom(c.z,h.z,u.z,p.z,y,g,f)}else this.curveType==="catmullrom"&&(bc.initCatmullRom(c.x,h.x,u.x,p.x,this.tension),vc.initCatmullRom(c.y,h.y,u.y,p.y,this.tension),_c.initCatmullRom(c.z,h.z,u.z,p.z,this.tension));return o.set(bc.calc(l),vc.calc(l),_c.calc(l)),o}copy(t){super.copy(t),this.points=[];for(let e=0,o=t.points.length;e<o;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,o=this.points.length;e<o;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,o=t.points.length;e<o;e++){const n=t.points[e];this.points.push(new R().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Fu(i,t,e,o,n){const s=(o-t)*.5,r=(n-e)*.5,a=i*i,l=i*a;return(2*e-2*o+s+r)*l+(-3*e+3*o-2*s-r)*a+s*i+e}function C1(i,t){const e=1-i;return e*e*t}function k1(i,t){return 2*(1-i)*i*t}function B1(i,t){return i*i*t}function Es(i,t,e,o){return C1(i,t)+k1(i,e)+B1(i,o)}function P1(i,t){const e=1-i;return e*e*e*t}function R1(i,t){const e=1-i;return 3*e*e*i*t}function D1(i,t){return 3*(1-i)*i*i*t}function I1(i,t){return i*i*i*t}function Fs(i,t,e,o,n){return P1(i,t)+R1(i,e)+D1(i,o)+I1(i,n)}class Au extends bo{constructor(t=new ct,e=new ct,o=new ct,n=new ct){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=o,this.v3=n}getPoint(t,e=new ct){const o=e,n=this.v0,s=this.v1,r=this.v2,a=this.v3;return o.set(Fs(t,n.x,s.x,r.x,a.x),Fs(t,n.y,s.y,r.y,a.y)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class L1 extends bo{constructor(t=new R,e=new R,o=new R,n=new R){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=o,this.v3=n}getPoint(t,e=new R){const o=e,n=this.v0,s=this.v1,r=this.v2,a=this.v3;return o.set(Fs(t,n.x,s.x,r.x,a.x),Fs(t,n.y,s.y,r.y,a.y),Fs(t,n.z,s.z,r.z,a.z)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Tu extends bo{constructor(t=new ct,e=new ct){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ct){const o=e;return t===1?o.copy(this.v2):(o.copy(this.v2).sub(this.v1),o.multiplyScalar(t).add(this.v1)),o}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ct){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class U1 extends bo{constructor(t=new R,e=new R){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new R){const o=e;return t===1?o.copy(this.v2):(o.copy(this.v2).sub(this.v1),o.multiplyScalar(t).add(this.v1)),o}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new R){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Cu extends bo{constructor(t=new ct,e=new ct,o=new ct){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=o}getPoint(t,e=new ct){const o=e,n=this.v0,s=this.v1,r=this.v2;return o.set(Es(t,n.x,s.x,r.x),Es(t,n.y,s.y,r.y)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ku extends bo{constructor(t=new R,e=new R,o=new R){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=o}getPoint(t,e=new R){const o=e,n=this.v0,s=this.v1,r=this.v2;return o.set(Es(t,n.x,s.x,r.x),Es(t,n.y,s.y,r.y),Es(t,n.z,s.z,r.z)),o}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Bu extends bo{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ct){const o=e,n=this.points,s=(n.length-1)*t,r=Math.floor(s),a=s-r,l=n[r===0?r:r-1],c=n[r],p=n[r>n.length-2?n.length-1:r+1],h=n[r>n.length-3?n.length-1:r+2];return o.set(Fu(a,l.x,c.x,p.x,h.x),Fu(a,l.y,c.y,p.y,h.y)),o}copy(t){super.copy(t),this.points=[];for(let e=0,o=t.points.length;e<o;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,o=this.points.length;e<o;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,o=t.points.length;e<o;e++){const n=t.points[e];this.points.push(new ct().fromArray(n))}return this}}var Nr=Object.freeze({__proto__:null,ArcCurve:A1,CatmullRomCurve3:T1,CubicBezierCurve:Au,CubicBezierCurve3:L1,EllipseCurve:gc,LineCurve:Tu,LineCurve3:U1,QuadraticBezierCurve:Cu,QuadraticBezierCurve3:ku,SplineCurve:Bu});class N1 extends bo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const o=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Nr[o](e,t))}return this}getPoint(t,e){const o=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=o){const r=n[s]-o,a=this.curves[s],l=a.getLength(),c=l===0?0:1-r/l;return a.getPointAt(c,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let o=0,n=this.curves.length;o<n;o++)e+=this.curves[o].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let o=0;o<=t;o++)e.push(this.getPoint(o/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let o;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],a=r.isEllipseCurve?t*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?t*r.points.length:t,l=r.getPoints(a);for(let c=0;c<l.length;c++){const p=l[c];o&&o.equals(p)||(e.push(p),o=p)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,o=t.curves.length;e<o;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,o=this.curves.length;e<o;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,o=t.curves.length;e<o;e++){const n=t.curves[e];this.curves.push(new Nr[n.type]().fromJSON(n))}return this}}class Wi extends N1{constructor(t){super(),this.type="Path",this.currentPoint=new ct,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,o=t.length;e<o;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const o=new Tu(this.currentPoint.clone(),new ct(t,e));return this.curves.push(o),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,o,n){const s=new Cu(this.currentPoint.clone(),new ct(t,e),new ct(o,n));return this.curves.push(s),this.currentPoint.set(o,n),this}bezierCurveTo(t,e,o,n,s,r){const a=new Au(this.currentPoint.clone(),new ct(t,e),new ct(o,n),new ct(s,r));return this.curves.push(a),this.currentPoint.set(s,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),o=new Bu(e);return this.curves.push(o),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,o,n,s,r){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+a,e+l,o,n,s,r),this}absarc(t,e,o,n,s,r){return this.absellipse(t,e,o,o,n,s,r),this}ellipse(t,e,o,n,s,r,a,l){const c=this.currentPoint.x,p=this.currentPoint.y;return this.absellipse(t+c,e+p,o,n,s,r,a,l),this}absellipse(t,e,o,n,s,r,a,l){const c=new gc(t,e,o,n,s,r,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const p=c.getPoint(1);return this.currentPoint.copy(p),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class wc extends Xt{constructor(t=[new ct(0,-.5),new ct(.5,0),new ct(0,.5)],e=12,o=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:o,phiLength:n},e=Math.floor(e),n=Ce(n,0,Math.PI*2);const s=[],r=[],a=[],l=[],c=[],p=1/e,h=new R,u=new ct,d=new R,y=new R,g=new R;let f=0,m=0;for(let b=0;b<=t.length-1;b++)switch(b){case 0:f=t[b+1].x-t[b].x,m=t[b+1].y-t[b].y,d.x=m*1,d.y=-f,d.z=m*0,g.copy(d),d.normalize(),l.push(d.x,d.y,d.z);break;case t.length-1:l.push(g.x,g.y,g.z);break;default:f=t[b+1].x-t[b].x,m=t[b+1].y-t[b].y,d.x=m*1,d.y=-f,d.z=m*0,y.copy(d),d.x+=g.x,d.y+=g.y,d.z+=g.z,d.normalize(),l.push(d.x,d.y,d.z),g.copy(y)}for(let b=0;b<=e;b++){const v=o+b*p*n,x=Math.sin(v),_=Math.cos(v);for(let z=0;z<=t.length-1;z++){h.x=t[z].x*x,h.y=t[z].y,h.z=t[z].x*_,r.push(h.x,h.y,h.z),u.x=b/e,u.y=z/(t.length-1),a.push(u.x,u.y);const E=l[3*z+0]*x,C=l[3*z+1],M=l[3*z+0]*_;c.push(E,C,M)}}for(let b=0;b<e;b++)for(let v=0;v<t.length-1;v++){const x=v+b*t.length,_=x,z=x+t.length,E=x+t.length+1,C=x+1;s.push(_,z,C),s.push(E,C,z)}this.setIndex(s),this.setAttribute("position",new Yt(r,3)),this.setAttribute("uv",new Yt(a,2)),this.setAttribute("normal",new Yt(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wc(t.points,t.segments,t.phiStart,t.phiLength)}}class Or extends wc{constructor(t=1,e=1,o=4,n=8){const s=new Wi;s.absarc(0,-e/2,t,Math.PI*1.5,0),s.absarc(0,e/2,t,0,Math.PI*.5),super(s.getPoints(o),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:o,radialSegments:n}}static fromJSON(t){return new Or(t.radius,t.length,t.capSegments,t.radialSegments)}}class zt extends Xt{constructor(t=1,e=1,o=1,n=32,s=1,r=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:o,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const p=[],h=[],u=[],d=[];let y=0;const g=[],f=o/2;let m=0;b(),r===!1&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(p),this.setAttribute("position",new Yt(h,3)),this.setAttribute("normal",new Yt(u,3)),this.setAttribute("uv",new Yt(d,2));function b(){const x=new R,_=new R;let z=0;const E=(e-t)/o;for(let C=0;C<=s;C++){const M=[],S=C/s,k=S*(e-t)+t;for(let A=0;A<=n;A++){const B=A/n,F=B*l+a,N=Math.sin(F),G=Math.cos(F);_.x=k*N,_.y=-S*o+f,_.z=k*G,h.push(_.x,_.y,_.z),x.set(N,E,G).normalize(),u.push(x.x,x.y,x.z),d.push(B,1-S),M.push(y++)}g.push(M)}for(let C=0;C<n;C++)for(let M=0;M<s;M++){const S=g[M][C],k=g[M+1][C],A=g[M+1][C+1],B=g[M][C+1];(t>0||M!==0)&&(p.push(S,k,B),z+=3),(e>0||M!==s-1)&&(p.push(k,A,B),z+=3)}c.addGroup(m,z,0),m+=z}function v(x){const _=y,z=new ct,E=new R;let C=0;const M=x===!0?t:e,S=x===!0?1:-1;for(let A=1;A<=n;A++)h.push(0,f*S,0),u.push(0,S,0),d.push(.5,.5),y++;const k=y;for(let A=0;A<=n;A++){const F=A/n*l+a,N=Math.cos(F),G=Math.sin(F);E.x=M*G,E.y=f*S,E.z=M*N,h.push(E.x,E.y,E.z),u.push(0,S,0),z.x=N*.5+.5,z.y=G*.5*S+.5,d.push(z.x,z.y),y++}for(let A=0;A<n;A++){const B=_+A,F=k+A;x===!0?p.push(F,F+1,B):p.push(F+1,F,B),C+=3}c.addGroup(m,C,x===!0?1:2),m+=C}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new zt(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class He extends zt{constructor(t=1,e=1,o=32,n=1,s=!1,r=0,a=Math.PI*2){super(0,t,e,o,n,s,r,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:o,heightSegments:n,openEnded:s,thetaStart:r,thetaLength:a}}static fromJSON(t){return new He(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class As extends Xt{constructor(t=[],e=[],o=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:o,detail:n};const s=[],r=[];a(n),c(o),p(),this.setAttribute("position",new Yt(s,3)),this.setAttribute("normal",new Yt(s.slice(),3)),this.setAttribute("uv",new Yt(r,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const v=new R,x=new R,_=new R;for(let z=0;z<e.length;z+=3)d(e[z+0],v),d(e[z+1],x),d(e[z+2],_),l(v,x,_,b)}function l(b,v,x,_){const z=_+1,E=[];for(let C=0;C<=z;C++){E[C]=[];const M=b.clone().lerp(x,C/z),S=v.clone().lerp(x,C/z),k=z-C;for(let A=0;A<=k;A++)A===0&&C===z?E[C][A]=M:E[C][A]=M.clone().lerp(S,A/k)}for(let C=0;C<z;C++)for(let M=0;M<2*(z-C)-1;M++){const S=Math.floor(M/2);M%2===0?(u(E[C][S+1]),u(E[C+1][S]),u(E[C][S])):(u(E[C][S+1]),u(E[C+1][S+1]),u(E[C+1][S]))}}function c(b){const v=new R;for(let x=0;x<s.length;x+=3)v.x=s[x+0],v.y=s[x+1],v.z=s[x+2],v.normalize().multiplyScalar(b),s[x+0]=v.x,s[x+1]=v.y,s[x+2]=v.z}function p(){const b=new R;for(let v=0;v<s.length;v+=3){b.x=s[v+0],b.y=s[v+1],b.z=s[v+2];const x=f(b)/2/Math.PI+.5,_=m(b)/Math.PI+.5;r.push(x,1-_)}y(),h()}function h(){for(let b=0;b<r.length;b+=6){const v=r[b+0],x=r[b+2],_=r[b+4],z=Math.max(v,x,_),E=Math.min(v,x,_);z>.9&&E<.1&&(v<.2&&(r[b+0]+=1),x<.2&&(r[b+2]+=1),_<.2&&(r[b+4]+=1))}}function u(b){s.push(b.x,b.y,b.z)}function d(b,v){const x=b*3;v.x=t[x+0],v.y=t[x+1],v.z=t[x+2]}function y(){const b=new R,v=new R,x=new R,_=new R,z=new ct,E=new ct,C=new ct;for(let M=0,S=0;M<s.length;M+=9,S+=6){b.set(s[M+0],s[M+1],s[M+2]),v.set(s[M+3],s[M+4],s[M+5]),x.set(s[M+6],s[M+7],s[M+8]),z.set(r[S+0],r[S+1]),E.set(r[S+2],r[S+3]),C.set(r[S+4],r[S+5]),_.copy(b).add(v).add(x).divideScalar(3);const k=f(_);g(z,S+0,b,k),g(E,S+2,v,k),g(C,S+4,x,k)}}function g(b,v,x,_){_<0&&b.x===1&&(r[v]=b.x-1),x.x===0&&x.z===0&&(r[v]=_/2/Math.PI+.5)}function f(b){return Math.atan2(b.z,-b.x)}function m(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new As(t.vertices,t.indices,t.radius,t.details)}}class So extends As{constructor(t=1,e=0){const o=(1+Math.sqrt(5))/2,n=1/o,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-o,0,-n,o,0,n,-o,0,n,o,-n,-o,0,-n,o,0,n,-o,0,n,o,0,-o,0,-n,o,0,-n,-o,0,n,o,0,n],r=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,r,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new So(t.radius,t.detail)}}const Vr=new R,Hr=new R,Mc=new R,Gr=new ye;class Ts extends Xt{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const n=Math.pow(10,4),s=Math.cos(vi*e),r=t.getIndex(),a=t.getAttribute("position"),l=r?r.count:a.count,c=[0,0,0],p=["a","b","c"],h=new Array(3),u={},d=[];for(let y=0;y<l;y+=3){r?(c[0]=r.getX(y),c[1]=r.getX(y+1),c[2]=r.getX(y+2)):(c[0]=y,c[1]=y+1,c[2]=y+2);const{a:g,b:f,c:m}=Gr;if(g.fromBufferAttribute(a,c[0]),f.fromBufferAttribute(a,c[1]),m.fromBufferAttribute(a,c[2]),Gr.getNormal(Mc),h[0]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[1]=`${Math.round(f.x*n)},${Math.round(f.y*n)},${Math.round(f.z*n)}`,h[2]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let b=0;b<3;b++){const v=(b+1)%3,x=h[b],_=h[v],z=Gr[p[b]],E=Gr[p[v]],C=`${x}_${_}`,M=`${_}_${x}`;M in u&&u[M]?(Mc.dot(u[M].normal)<=s&&(d.push(z.x,z.y,z.z),d.push(E.x,E.y,E.z)),u[M]=null):C in u||(u[C]={index0:c[b],index1:c[v],normal:Mc.clone()})}}for(const y in u)if(u[y]){const{index0:g,index1:f}=u[y];Vr.fromBufferAttribute(a,g),Hr.fromBufferAttribute(a,f),d.push(Vr.x,Vr.y,Vr.z),d.push(Hr.x,Hr.y,Hr.z)}this.setAttribute("position",new Yt(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Zi extends Wi{constructor(t){super(t),this.uuid=xn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let o=0,n=this.holes.length;o<n;o++)e[o]=this.holes[o].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,o=t.holes.length;e<o;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,o=this.holes.length;e<o;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,o=t.holes.length;e<o;e++){const n=t.holes[e];this.holes.push(new Wi().fromJSON(n))}return this}}const O1={triangulate:function(i,t,e=2){const o=t&&t.length,n=o?t[0]*e:i.length;let s=Pu(i,0,n,e,!0);const r=[];if(!s||s.next===s.prev)return r;let a,l,c,p,h,u,d;if(o&&(s=W1(i,t,s,e)),i.length>80*e){a=c=i[0],l=p=i[1];for(let y=e;y<n;y+=e)h=i[y],u=i[y+1],h<a&&(a=h),u<l&&(l=u),h>c&&(c=h),u>p&&(p=u);d=Math.max(c-a,p-l),d=d!==0?32767/d:0}return Cs(s,r,e,a,l,d,0),r}};function Pu(i,t,e,o,n){let s,r;if(n===o2(i,t,e,o)>0)for(s=t;s<e;s+=o)r=Iu(s,i[s],i[s+1],r);else for(s=e-o;s>=t;s-=o)r=Iu(s,i[s],i[s+1],r);return r&&Xr(r,r.next)&&(Bs(r),r=r.next),r}function qn(i,t){if(!i)return i;t||(t=i);let e=i,o;do if(o=!1,!e.steiner&&(Xr(e,e.next)||ze(e.prev,e,e.next)===0)){if(Bs(e),e=t=e.prev,e===e.next)break;o=!0}else e=e.next;while(o||e!==t);return t}function Cs(i,t,e,o,n,s,r){if(!i)return;!r&&s&&j1(i,o,n,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?H1(i,o,n,s):V1(i)){t.push(l.i/e|0),t.push(i.i/e|0),t.push(c.i/e|0),Bs(i),i=c.next,a=c.next;continue}if(i=c,i===a){r?r===1?(i=G1(qn(i),t,e),Cs(i,t,e,o,n,s,2)):r===2&&X1(i,t,e,o,n,s):Cs(qn(i),t,e,o,n,s,1);break}}}function V1(i){const t=i.prev,e=i,o=i.next;if(ze(t,e,o)>=0)return!1;const n=t.x,s=e.x,r=o.x,a=t.y,l=e.y,c=o.y,p=n<s?n<r?n:r:s<r?s:r,h=a<l?a<c?a:c:l<c?l:c,u=n>s?n>r?n:r:s>r?s:r,d=a>l?a>c?a:c:l>c?l:c;let y=o.next;for(;y!==t;){if(y.x>=p&&y.x<=u&&y.y>=h&&y.y<=d&&Yi(n,a,s,l,r,c,y.x,y.y)&&ze(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function H1(i,t,e,o){const n=i.prev,s=i,r=i.next;if(ze(n,s,r)>=0)return!1;const a=n.x,l=s.x,c=r.x,p=n.y,h=s.y,u=r.y,d=a<l?a<c?a:c:l<c?l:c,y=p<h?p<u?p:u:h<u?h:u,g=a>l?a>c?a:c:l>c?l:c,f=p>h?p>u?p:u:h>u?h:u,m=zc(d,y,t,e,o),b=zc(g,f,t,e,o);let v=i.prevZ,x=i.nextZ;for(;v&&v.z>=m&&x&&x.z<=b;){if(v.x>=d&&v.x<=g&&v.y>=y&&v.y<=f&&v!==n&&v!==r&&Yi(a,p,l,h,c,u,v.x,v.y)&&ze(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=d&&x.x<=g&&x.y>=y&&x.y<=f&&x!==n&&x!==r&&Yi(a,p,l,h,c,u,x.x,x.y)&&ze(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=m;){if(v.x>=d&&v.x<=g&&v.y>=y&&v.y<=f&&v!==n&&v!==r&&Yi(a,p,l,h,c,u,v.x,v.y)&&ze(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=b;){if(x.x>=d&&x.x<=g&&x.y>=y&&x.y<=f&&x!==n&&x!==r&&Yi(a,p,l,h,c,u,x.x,x.y)&&ze(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function G1(i,t,e){let o=i;do{const n=o.prev,s=o.next.next;!Xr(n,s)&&Ru(n,o,o.next,s)&&ks(n,s)&&ks(s,n)&&(t.push(n.i/e|0),t.push(o.i/e|0),t.push(s.i/e|0),Bs(o),Bs(o.next),o=i=s),o=o.next}while(o!==i);return qn(o)}function X1(i,t,e,o,n,s){let r=i;do{let a=r.next.next;for(;a!==r.prev;){if(r.i!==a.i&&Q1(r,a)){let l=Du(r,a);r=qn(r,r.next),l=qn(l,l.next),Cs(r,t,e,o,n,s,0),Cs(l,t,e,o,n,s,0);return}a=a.next}r=r.next}while(r!==i)}function W1(i,t,e,o){const n=[];let s,r,a,l,c;for(s=0,r=t.length;s<r;s++)a=t[s]*o,l=s<r-1?t[s+1]*o:i.length,c=Pu(i,a,l,o,!1),c===c.next&&(c.steiner=!0),n.push(J1(c));for(n.sort(Z1),s=0;s<n.length;s++)e=Y1(n[s],e);return e}function Z1(i,t){return i.x-t.x}function Y1(i,t){const e=$1(i,t);if(!e)return t;const o=Du(e,i);return qn(o,o.next),qn(e,e.next)}function $1(i,t){let e=t,o=-1/0,n;const s=i.x,r=i.y;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const u=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=s&&u>o&&(o=u,n=e.x<e.next.x?e:e.next,u===s))return n}e=e.next}while(e!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let p=1/0,h;e=n;do s>=e.x&&e.x>=l&&s!==e.x&&Yi(r<c?s:o,r,l,c,r<c?o:s,r,e.x,e.y)&&(h=Math.abs(r-e.y)/(s-e.x),ks(e,i)&&(h<p||h===p&&(e.x>n.x||e.x===n.x&&q1(n,e)))&&(n=e,p=h)),e=e.next;while(e!==a);return n}function q1(i,t){return ze(i.prev,i,t.prev)<0&&ze(t.next,i,i.next)<0}function j1(i,t,e,o){let n=i;do n.z===0&&(n.z=zc(n.x,n.y,t,e,o)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,K1(n)}function K1(i){let t,e,o,n,s,r,a,l,c=1;do{for(e=i,i=null,s=null,r=0;e;){for(r++,o=e,a=0,t=0;t<c&&(a++,o=o.nextZ,!!o);t++);for(l=c;a>0||l>0&&o;)a!==0&&(l===0||!o||e.z<=o.z)?(n=e,e=e.nextZ,a--):(n=o,o=o.nextZ,l--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=o}s.nextZ=null,c*=2}while(r>1);return i}function zc(i,t,e,o,n){return i=(i-e)*n|0,t=(t-o)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function J1(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Yi(i,t,e,o,n,s,r,a){return(n-r)*(t-a)>=(i-r)*(s-a)&&(i-r)*(o-a)>=(e-r)*(t-a)&&(e-r)*(s-a)>=(n-r)*(o-a)}function Q1(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!t2(i,t)&&(ks(i,t)&&ks(t,i)&&e2(i,t)&&(ze(i.prev,i,t.prev)||ze(i,t.prev,t))||Xr(i,t)&&ze(i.prev,i,i.next)>0&&ze(t.prev,t,t.next)>0)}function ze(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Xr(i,t){return i.x===t.x&&i.y===t.y}function Ru(i,t,e,o){const n=Zr(ze(i,t,e)),s=Zr(ze(i,t,o)),r=Zr(ze(e,o,i)),a=Zr(ze(e,o,t));return!!(n!==s&&r!==a||n===0&&Wr(i,e,t)||s===0&&Wr(i,o,t)||r===0&&Wr(e,i,o)||a===0&&Wr(e,t,o))}function Wr(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Zr(i){return i>0?1:i<0?-1:0}function t2(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Ru(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function ks(i,t){return ze(i.prev,i,i.next)<0?ze(i,t,i.next)>=0&&ze(i,i.prev,t)>=0:ze(i,t,i.prev)<0||ze(i,i.next,t)<0}function e2(i,t){let e=i,o=!1;const n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(o=!o),e=e.next;while(e!==i);return o}function Du(i,t){const e=new Sc(i.i,i.x,i.y),o=new Sc(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,o.next=e,e.prev=o,s.next=o,o.prev=s,o}function Iu(i,t,e,o){const n=new Sc(i,t,e);return o?(n.next=o.next,n.prev=o,o.next.prev=n,o.next=n):(n.prev=n,n.next=n),n}function Bs(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Sc(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function o2(i,t,e,o){let n=0;for(let s=t,r=e-o;s<e;s+=o)n+=(i[r]-i[s])*(i[s+1]+i[r+1]),r=s;return n}class Ps{static area(t){const e=t.length;let o=0;for(let n=e-1,s=0;s<e;n=s++)o+=t[n].x*t[s].y-t[s].x*t[n].y;return o*.5}static isClockWise(t){return Ps.area(t)<0}static triangulateShape(t,e){const o=[],n=[],s=[];Lu(t),Uu(o,t);let r=t.length;e.forEach(Lu);for(let l=0;l<e.length;l++)n.push(r),r+=e[l].length,Uu(o,e[l]);const a=O1.triangulate(o,n);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function Lu(i){const t=i.length;t>2&&i[t-1].equals(i[0])&&i.pop()}function Uu(i,t){for(let e=0;e<t.length;e++)i.push(t[e].x),i.push(t[e].y)}class jn extends Xt{constructor(t=new Zi([new ct(.5,.5),new ct(-.5,.5),new ct(-.5,-.5),new ct(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const o=this,n=[],s=[];for(let a=0,l=t.length;a<l;a++){const c=t[a];r(c)}this.setAttribute("position",new Yt(n,3)),this.setAttribute("uv",new Yt(s,2)),this.computeVertexNormals();function r(a){const l=[],c=e.curveSegments!==void 0?e.curveSegments:12,p=e.steps!==void 0?e.steps:1,h=e.depth!==void 0?e.depth:1;let u=e.bevelEnabled!==void 0?e.bevelEnabled:!0,d=e.bevelThickness!==void 0?e.bevelThickness:.2,y=e.bevelSize!==void 0?e.bevelSize:d-.1,g=e.bevelOffset!==void 0?e.bevelOffset:0,f=e.bevelSegments!==void 0?e.bevelSegments:3;const m=e.extrudePath,b=e.UVGenerator!==void 0?e.UVGenerator:n2;let v,x=!1,_,z,E,C;m&&(v=m.getSpacedPoints(p),x=!0,u=!1,_=m.computeFrenetFrames(p,!1),z=new R,E=new R,C=new R),u||(f=0,d=0,y=0,g=0);const M=a.extractPoints(c);let S=M.shape;const k=M.holes;if(!Ps.isClockWise(S)){S=S.reverse();for(let ht=0,yt=k.length;ht<yt;ht++){const w=k[ht];Ps.isClockWise(w)&&(k[ht]=w.reverse())}}const B=Ps.triangulateShape(S,k),F=S;for(let ht=0,yt=k.length;ht<yt;ht++){const w=k[ht];S=S.concat(w)}function N(ht,yt,w){return yt||console.error("THREE.ExtrudeGeometry: vec does not exist"),ht.clone().addScaledVector(yt,w)}const G=S.length,W=B.length;function et(ht,yt,w){let ot,V,U;const D=ht.x-yt.x,H=ht.y-yt.y,nt=w.x-ht.x,P=w.y-ht.y,T=D*D+H*H,O=D*P-H*nt;if(Math.abs(O)>Number.EPSILON){const j=Math.sqrt(T),$=Math.sqrt(nt*nt+P*P),it=yt.x-H/j,wt=yt.y+D/j,dt=w.x-P/$,St=w.y+nt/$,Qt=((dt-it)*P-(St-wt)*nt)/(D*P-H*nt);ot=it+D*Qt-ht.x,V=wt+H*Qt-ht.y;const mt=ot*ot+V*V;if(mt<=2)return new ct(ot,V);U=Math.sqrt(mt/2)}else{let j=!1;D>Number.EPSILON?nt>Number.EPSILON&&(j=!0):D<-Number.EPSILON?nt<-Number.EPSILON&&(j=!0):Math.sign(H)===Math.sign(P)&&(j=!0),j?(ot=-H,V=D,U=Math.sqrt(T)):(ot=D,V=H,U=Math.sqrt(T/2))}return new ct(ot/U,V/U)}const K=[];for(let ht=0,yt=F.length,w=yt-1,ot=ht+1;ht<yt;ht++,w++,ot++)w===yt&&(w=0),ot===yt&&(ot=0),K[ht]=et(F[ht],F[w],F[ot]);const pt=[];let X,Z=K.concat();for(let ht=0,yt=k.length;ht<yt;ht++){const w=k[ht];X=[];for(let ot=0,V=w.length,U=V-1,D=ot+1;ot<V;ot++,U++,D++)U===V&&(U=0),D===V&&(D=0),X[ot]=et(w[ot],w[U],w[D]);pt.push(X),Z=Z.concat(X)}for(let ht=0;ht<f;ht++){const yt=ht/f,w=d*Math.cos(yt*Math.PI/2),ot=y*Math.sin(yt*Math.PI/2)+g;for(let V=0,U=F.length;V<U;V++){const D=N(F[V],K[V],ot);ft(D.x,D.y,-w)}for(let V=0,U=k.length;V<U;V++){const D=k[V];X=pt[V];for(let H=0,nt=D.length;H<nt;H++){const P=N(D[H],X[H],ot);ft(P.x,P.y,-w)}}}const gt=y+g;for(let ht=0;ht<G;ht++){const yt=u?N(S[ht],Z[ht],gt):S[ht];x?(E.copy(_.normals[0]).multiplyScalar(yt.x),z.copy(_.binormals[0]).multiplyScalar(yt.y),C.copy(v[0]).add(E).add(z),ft(C.x,C.y,C.z)):ft(yt.x,yt.y,0)}for(let ht=1;ht<=p;ht++)for(let yt=0;yt<G;yt++){const w=u?N(S[yt],Z[yt],gt):S[yt];x?(E.copy(_.normals[ht]).multiplyScalar(w.x),z.copy(_.binormals[ht]).multiplyScalar(w.y),C.copy(v[ht]).add(E).add(z),ft(C.x,C.y,C.z)):ft(w.x,w.y,h/p*ht)}for(let ht=f-1;ht>=0;ht--){const yt=ht/f,w=d*Math.cos(yt*Math.PI/2),ot=y*Math.sin(yt*Math.PI/2)+g;for(let V=0,U=F.length;V<U;V++){const D=N(F[V],K[V],ot);ft(D.x,D.y,h+w)}for(let V=0,U=k.length;V<U;V++){const D=k[V];X=pt[V];for(let H=0,nt=D.length;H<nt;H++){const P=N(D[H],X[H],ot);x?ft(P.x,P.y+v[p-1].y,v[p-1].x+w):ft(P.x,P.y,h+w)}}}Y(),tt();function Y(){const ht=n.length/3;if(u){let yt=0,w=G*yt;for(let ot=0;ot<W;ot++){const V=B[ot];xt(V[2]+w,V[1]+w,V[0]+w)}yt=p+f*2,w=G*yt;for(let ot=0;ot<W;ot++){const V=B[ot];xt(V[0]+w,V[1]+w,V[2]+w)}}else{for(let yt=0;yt<W;yt++){const w=B[yt];xt(w[2],w[1],w[0])}for(let yt=0;yt<W;yt++){const w=B[yt];xt(w[0]+G*p,w[1]+G*p,w[2]+G*p)}}o.addGroup(ht,n.length/3-ht,0)}function tt(){const ht=n.length/3;let yt=0;_t(F,yt),yt+=F.length;for(let w=0,ot=k.length;w<ot;w++){const V=k[w];_t(V,yt),yt+=V.length}o.addGroup(ht,n.length/3-ht,1)}function _t(ht,yt){let w=ht.length;for(;--w>=0;){const ot=w;let V=w-1;V<0&&(V=ht.length-1);for(let U=0,D=p+f*2;U<D;U++){const H=G*U,nt=G*(U+1),P=yt+ot+H,T=yt+V+H,O=yt+V+nt,j=yt+ot+nt;Ft(P,T,O,j)}}}function ft(ht,yt,w){l.push(ht),l.push(yt),l.push(w)}function xt(ht,yt,w){Dt(ht),Dt(yt),Dt(w);const ot=n.length/3,V=b.generateTopUV(o,n,ot-3,ot-2,ot-1);Ot(V[0]),Ot(V[1]),Ot(V[2])}function Ft(ht,yt,w,ot){Dt(ht),Dt(yt),Dt(ot),Dt(yt),Dt(w),Dt(ot);const V=n.length/3,U=b.generateSideWallUV(o,n,V-6,V-3,V-2,V-1);Ot(U[0]),Ot(U[1]),Ot(U[3]),Ot(U[1]),Ot(U[2]),Ot(U[3])}function Dt(ht){n.push(l[ht*3+0]),n.push(l[ht*3+1]),n.push(l[ht*3+2])}function Ot(ht){s.push(ht.x),s.push(ht.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,o=this.parameters.options;return i2(e,o,t)}static fromJSON(t,e){const o=[];for(let s=0,r=t.shapes.length;s<r;s++){const a=e[t.shapes[s]];o.push(a)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new Nr[n.type]().fromJSON(n)),new jn(o,t.options)}}const n2={generateTopUV:function(i,t,e,o,n){const s=t[e*3],r=t[e*3+1],a=t[o*3],l=t[o*3+1],c=t[n*3],p=t[n*3+1];return[new ct(s,r),new ct(a,l),new ct(c,p)]},generateSideWallUV:function(i,t,e,o,n,s){const r=t[e*3],a=t[e*3+1],l=t[e*3+2],c=t[o*3],p=t[o*3+1],h=t[o*3+2],u=t[n*3],d=t[n*3+1],y=t[n*3+2],g=t[s*3],f=t[s*3+1],m=t[s*3+2];return Math.abs(a-p)<Math.abs(r-c)?[new ct(r,1-l),new ct(c,1-h),new ct(u,1-y),new ct(g,1-m)]:[new ct(a,1-l),new ct(p,1-h),new ct(d,1-y),new ct(f,1-m)]}};function i2(i,t,e){if(e.shapes=[],Array.isArray(i))for(let o=0,n=i.length;o<n;o++){const s=i[o];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class co extends As{constructor(t=1,e=0){const o=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(o,n,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new co(t.radius,t.detail)}}class xe extends Xt{constructor(t=1,e=32,o=16,n=0,s=Math.PI*2,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:o,phiStart:n,phiLength:s,thetaStart:r,thetaLength:a},e=Math.max(3,Math.floor(e)),o=Math.max(2,Math.floor(o));const l=Math.min(r+a,Math.PI);let c=0;const p=[],h=new R,u=new R,d=[],y=[],g=[],f=[];for(let m=0;m<=o;m++){const b=[],v=m/o;let x=0;m===0&&r===0?x=.5/e:m===o&&l===Math.PI&&(x=-.5/e);for(let _=0;_<=e;_++){const z=_/e;h.x=-t*Math.cos(n+z*s)*Math.sin(r+v*a),h.y=t*Math.cos(r+v*a),h.z=t*Math.sin(n+z*s)*Math.sin(r+v*a),y.push(h.x,h.y,h.z),u.copy(h).normalize(),g.push(u.x,u.y,u.z),f.push(z+x,1-v),b.push(c++)}p.push(b)}for(let m=0;m<o;m++)for(let b=0;b<e;b++){const v=p[m][b+1],x=p[m][b],_=p[m+1][b],z=p[m+1][b+1];(m!==0||r>0)&&d.push(v,x,z),(m!==o-1||l<Math.PI)&&d.push(x,_,z)}this.setIndex(d),this.setAttribute("position",new Yt(y,3)),this.setAttribute("normal",new Yt(g,3)),this.setAttribute("uv",new Yt(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xe(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ec extends As{constructor(t=1,e=0){const o=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(o,n,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ec(t.radius,t.detail)}}class vo extends Xt{constructor(t=1,e=.4,o=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:o,tubularSegments:n,arc:s},o=Math.floor(o),n=Math.floor(n);const r=[],a=[],l=[],c=[],p=new R,h=new R,u=new R;for(let d=0;d<=o;d++)for(let y=0;y<=n;y++){const g=y/n*s,f=d/o*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(g),h.y=(t+e*Math.cos(f))*Math.sin(g),h.z=e*Math.sin(f),a.push(h.x,h.y,h.z),p.x=t*Math.cos(g),p.y=t*Math.sin(g),u.subVectors(h,p).normalize(),l.push(u.x,u.y,u.z),c.push(y/n),c.push(d/o)}for(let d=1;d<=o;d++)for(let y=1;y<=n;y++){const g=(n+1)*d+y-1,f=(n+1)*(d-1)+y-1,m=(n+1)*(d-1)+y,b=(n+1)*d+y;r.push(g,f,b),r.push(f,m,b)}this.setIndex(r),this.setAttribute("position",new Yt(a,3)),this.setAttribute("normal",new Yt(l,3)),this.setAttribute("uv",new Yt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vo(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Rs extends Xt{constructor(t=new ku(new R(-1,-1,0),new R(-1,1,0),new R(1,1,0)),e=64,o=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:o,radialSegments:n,closed:s};const r=t.computeFrenetFrames(e,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new R,l=new R,c=new ct;let p=new R;const h=[],u=[],d=[],y=[];g(),this.setIndex(y),this.setAttribute("position",new Yt(h,3)),this.setAttribute("normal",new Yt(u,3)),this.setAttribute("uv",new Yt(d,2));function g(){for(let v=0;v<e;v++)f(v);f(s===!1?e:0),b(),m()}function f(v){p=t.getPointAt(v/e,p);const x=r.normals[v],_=r.binormals[v];for(let z=0;z<=n;z++){const E=z/n*Math.PI*2,C=Math.sin(E),M=-Math.cos(E);l.x=M*x.x+C*_.x,l.y=M*x.y+C*_.y,l.z=M*x.z+C*_.z,l.normalize(),u.push(l.x,l.y,l.z),a.x=p.x+o*l.x,a.y=p.y+o*l.y,a.z=p.z+o*l.z,h.push(a.x,a.y,a.z)}}function m(){for(let v=1;v<=e;v++)for(let x=1;x<=n;x++){const _=(n+1)*(v-1)+(x-1),z=(n+1)*v+(x-1),E=(n+1)*v+x,C=(n+1)*(v-1)+x;y.push(_,z,C),y.push(z,E,C)}}function b(){for(let v=0;v<=e;v++)for(let x=0;x<=n;x++)c.x=v/e,c.y=x/n,d.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Rs(new Nr[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class s2 extends io{static get type(){return"RawShaderMaterial"}constructor(t){super(t),this.isRawShaderMaterial=!0}}class Ge extends Pi{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new bt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ph,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new oo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function Yr(i,t,e){return!i||!e&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)}function r2(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function a2(i){function t(n,s){return i[n]-i[s]}const e=i.length,o=new Array(e);for(let n=0;n!==e;++n)o[n]=n;return o.sort(t),o}function Nu(i,t,e){const o=i.length,n=new i.constructor(o);for(let s=0,r=0;r!==o;++s){const a=e[s]*t;for(let l=0;l!==t;++l)n[r++]=i[a+l]}return n}function Ou(i,t,e,o){let n=1,s=i[0];for(;s!==void 0&&s[o]===void 0;)s=i[n++];if(s===void 0)return;let r=s[o];if(r!==void 0)if(Array.isArray(r))do r=s[o],r!==void 0&&(t.push(s.time),e.push.apply(e,r)),s=i[n++];while(s!==void 0);else if(r.toArray!==void 0)do r=s[o],r!==void 0&&(t.push(s.time),r.toArray(e,e.length)),s=i[n++];while(s!==void 0);else do r=s[o],r!==void 0&&(t.push(s.time),e.push(r)),s=i[n++];while(s!==void 0)}class $r{constructor(t,e,o,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(o),this.sampleValues=e,this.valueSize=o,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let o=this._cachedIndex,n=e[o],s=e[o-1];t:{e:{let r;o:{n:if(!(t<n)){for(let a=o+2;;){if(n===void 0){if(t<s)break n;return o=e.length,this._cachedIndex=o,this.copySampleValue_(o-1)}if(o===a)break;if(s=n,n=e[++o],t<n)break e}r=e.length;break o}if(!(t>=s)){const a=e[1];t<a&&(o=2,s=a);for(let l=o-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===l)break;if(n=s,s=e[--o-1],t>=s)break e}r=o,o=0;break o}break t}for(;o<r;){const a=o+r>>>1;t<e[a]?r=a:o=a+1}if(n=e[o],s=e[o-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return o=e.length,this._cachedIndex=o,this.copySampleValue_(o-1)}this._cachedIndex=o,this.intervalChanged_(o,s,n)}return this.interpolate_(o,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,o=this.sampleValues,n=this.valueSize,s=t*n;for(let r=0;r!==n;++r)e[r]=o[s+r];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class l2 extends $r{constructor(t,e,o,n){super(t,e,o,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ah,endingEnd:ah}}intervalChanged_(t,e,o){const n=this.parameterPositions;let s=t-2,r=t+1,a=n[s],l=n[r];if(a===void 0)switch(this.getSettings_().endingStart){case lh:s=t,a=2*e-o;break;case ch:s=n.length-2,a=e+n[s]-n[s+1];break;default:s=t,a=o}if(l===void 0)switch(this.getSettings_().endingEnd){case lh:r=t,l=2*o-e;break;case ch:r=1,l=o+n[1]-n[0];break;default:r=t-1,l=e}const c=(o-e)*.5,p=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-o),this._offsetPrev=s*p,this._offsetNext=r*p}interpolate_(t,e,o,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,p=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,y=(o-e)/(n-e),g=y*y,f=g*y,m=-u*f+2*u*g-u*y,b=(1+u)*f+(-1.5-2*u)*g+(-.5+u)*y+1,v=(-1-d)*f+(1.5+d)*g+.5*y,x=d*f-d*g;for(let _=0;_!==a;++_)s[_]=m*r[p+_]+b*r[c+_]+v*r[l+_]+x*r[h+_];return s}}class c2 extends $r{constructor(t,e,o,n){super(t,e,o,n)}interpolate_(t,e,o,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,p=(o-e)/(n-e),h=1-p;for(let u=0;u!==a;++u)s[u]=r[c+u]*h+r[l+u]*p;return s}}class p2 extends $r{constructor(t,e,o,n){super(t,e,o,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Go{constructor(t,e,o,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Yr(e,this.TimeBufferType),this.values=Yr(o,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let o;if(e.toJSON!==this.toJSON)o=e.toJSON(t);else{o={name:t.name,times:Yr(t.times,Array),values:Yr(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(o.interpolation=n)}return o.type=t.ValueTypeName,o}InterpolantFactoryMethodDiscrete(t){return new p2(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new c2(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new l2(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case us:e=this.InterpolantFactoryMethodDiscrete;break;case ar:e=this.InterpolantFactoryMethodLinear;break;case Bl:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const o="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(o);return console.warn("THREE.KeyframeTrack:",o),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return us;case this.InterpolantFactoryMethodLinear:return ar;case this.InterpolantFactoryMethodSmooth:return Bl}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let o=0,n=e.length;o!==n;++o)e[o]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let o=0,n=e.length;o!==n;++o)e[o]*=t}return this}trim(t,e){const o=this.times,n=o.length;let s=0,r=n-1;for(;s!==n&&o[s]<t;)++s;for(;r!==-1&&o[r]>e;)--r;if(++r,s!==0||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const a=this.getValueSize();this.times=o.slice(s,r),this.values=this.values.slice(s*a,r*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const o=this.times,n=this.values,s=o.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let a=0;a!==s;a++){const l=o[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),t=!1;break}if(r!==null&&r>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,r),t=!1;break}r=l}if(n!==void 0&&r2(n))for(let a=0,l=n.length;a!==l;++a){const c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),o=this.getValueSize(),n=this.getInterpolation()===Bl,s=t.length-1;let r=1;for(let a=1;a<s;++a){let l=!1;const c=t[a],p=t[a+1];if(c!==p&&(a!==1||c!==t[0]))if(n)l=!0;else{const h=a*o,u=h-o,d=h+o;for(let y=0;y!==o;++y){const g=e[h+y];if(g!==e[u+y]||g!==e[d+y]){l=!0;break}}}if(l){if(a!==r){t[r]=t[a];const h=a*o,u=r*o;for(let d=0;d!==o;++d)e[u+d]=e[h+d]}++r}}if(s>0){t[r]=t[s];for(let a=s*o,l=r*o,c=0;c!==o;++c)e[l+c]=e[a+c];++r}return r!==t.length?(this.times=t.slice(0,r),this.values=e.slice(0,r*o)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),o=this.constructor,n=new o(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Go.prototype.TimeBufferType=Float32Array,Go.prototype.ValueBufferType=Float32Array,Go.prototype.DefaultInterpolation=ar;class $i extends Go{constructor(t,e,o){super(t,e,o)}}$i.prototype.ValueTypeName="bool",$i.prototype.ValueBufferType=Array,$i.prototype.DefaultInterpolation=us,$i.prototype.InterpolantFactoryMethodLinear=void 0,$i.prototype.InterpolantFactoryMethodSmooth=void 0;class Vu extends Go{}Vu.prototype.ValueTypeName="color";class qr extends Go{}qr.prototype.ValueTypeName="number";class h2 extends $r{constructor(t,e,o,n){super(t,e,o,n)}interpolate_(t,e,o,n){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=(o-e)/(n-e);let c=t*a;for(let p=c+a;c!==p;c+=4)Mo.slerpFlat(s,0,r,c-a,r,c,l);return s}}class Ds extends Go{InterpolantFactoryMethodLinear(t){return new h2(this.times,this.values,this.getValueSize(),t)}}Ds.prototype.ValueTypeName="quaternion",Ds.prototype.InterpolantFactoryMethodSmooth=void 0;class qi extends Go{constructor(t,e,o){super(t,e,o)}}qi.prototype.ValueTypeName="string",qi.prototype.ValueBufferType=Array,qi.prototype.DefaultInterpolation=us,qi.prototype.InterpolantFactoryMethodLinear=void 0,qi.prototype.InterpolantFactoryMethodSmooth=void 0;class Is extends Go{}Is.prototype.ValueTypeName="vector";class u2{constructor(t="",e=-1,o=[],n=bf){this.name=t,this.tracks=o,this.duration=e,this.blendMode=n,this.uuid=xn(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],o=t.tracks,n=1/(t.fps||1);for(let r=0,a=o.length;r!==a;++r)e.push(f2(o[r]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],o=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,r=o.length;s!==r;++s)e.push(Go.toJSON(o[s]));return n}static CreateFromMorphTargetSequence(t,e,o,n){const s=e.length,r=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const p=a2(l);l=Nu(l,1,p),c=Nu(c,1,p),!n&&l[0]===0&&(l.push(s),c.push(c[0])),r.push(new qr(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/o))}return new this(t,-1,r)}static findByName(t,e){let o=t;if(!Array.isArray(t)){const n=t;o=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<o.length;n++)if(o[n].name===e)return o[n];return null}static CreateClipsFromMorphTargetSequences(t,e,o){const n={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=t.length;a<l;a++){const c=t[a],p=c.name.match(s);if(p&&p.length>1){const h=p[1];let u=n[h];u||(n[h]=u=[]),u.push(c)}}const r=[];for(const a in n)r.push(this.CreateFromMorphTargetSequence(a,n[a],e,o));return r}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const o=function(h,u,d,y,g){if(d.length!==0){const f=[],m=[];Ou(d,f,m,y),f.length!==0&&g.push(new h(u,f,m))}},n=[],s=t.name||"default",r=t.fps||30,a=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const u=c[h].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const d={};let y;for(y=0;y<u.length;y++)if(u[y].morphTargets)for(let g=0;g<u[y].morphTargets.length;g++)d[u[y].morphTargets[g]]=-1;for(const g in d){const f=[],m=[];for(let b=0;b!==u[y].morphTargets.length;++b){const v=u[y];f.push(v.time),m.push(v.morphTarget===g?1:0)}n.push(new qr(".morphTargetInfluence["+g+"]",f,m))}l=d.length*r}else{const d=".bones["+e[h].name+"]";o(Is,d+".position",u,"pos",n),o(Ds,d+".quaternion",u,"rot",n),o(Is,d+".scale",u,"scl",n)}}return n.length===0?null:new this(s,l,n,a)}resetDuration(){const t=this.tracks;let e=0;for(let o=0,n=t.length;o!==n;++o){const s=this.tracks[o];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function d2(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return qr;case"vector":case"vector2":case"vector3":case"vector4":return Is;case"color":return Vu;case"quaternion":return Ds;case"bool":case"boolean":return $i;case"string":return qi}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function f2(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=d2(i.type);if(i.times===void 0){const e=[],o=[];Ou(i.keys,e,o,"value"),i.times=e,i.values=o}return t.parse!==void 0?t.parse(i):new t(i.name,i.times,i.values,i.interpolation)}const Hu={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class m2{constructor(t,e,o){const n=this;let s=!1,r=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=o,this.itemStart=function(p){a++,s===!1&&n.onStart!==void 0&&n.onStart(p,r,a),s=!0},this.itemEnd=function(p){r++,n.onProgress!==void 0&&n.onProgress(p,r,a),r===a&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(p){n.onError!==void 0&&n.onError(p)},this.resolveURL=function(p){return l?l(p):p},this.setURLModifier=function(p){return l=p,this},this.addHandler=function(p,h){return c.push(p,h),this},this.removeHandler=function(p){const h=c.indexOf(p);return h!==-1&&c.splice(h,2),this},this.getHandler=function(p){for(let h=0,u=c.length;h<u;h+=2){const d=c[h],y=c[h+1];if(d.global&&(d.lastIndex=0),d.test(p))return y}return null}}}const y2=new m2;class Fc{constructor(t){this.manager=t!==void 0?t:y2,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const o=this;return new Promise(function(n,s){o.load(t,n,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Fc.DEFAULT_MATERIAL_NAME="__DEFAULT";class g2 extends Fc{constructor(t){super(t)}load(t,e,o,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=Hu.get(t);if(r!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(r),s.manager.itemEnd(t)},0),r;const a=ms("img");function l(){p(),Hu.add(t,this),e&&e(this),s.manager.itemEnd(t)}function c(h){p(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function p(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(t),a.src=t,a}}class x2 extends Fc{constructor(t){super(t)}load(t,e,o,n){const s=new Ue,r=new g2(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,function(a){s.image=a,s.needsUpdate=!0,e!==void 0&&e(s)},o,n),s}}class jr extends Oe{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new bt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}class b2 extends jr{constructor(t,e,o){super(t,o),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Oe.DEFAULT_UP),this.updateMatrix(),this.groundColor=new bt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Ac=new $t,Gu=new R,Xu=new R;class Wu{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ct(512,512),this.map=null,this.mapPass=null,this.matrix=new $t,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oc,this._frameExtents=new ct(1,1),this._viewportCount=1,this._viewports=[new se(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,o=this.matrix;Gu.setFromMatrixPosition(t.matrixWorld),e.position.copy(Gu),Xu.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Xu),e.updateMatrixWorld(),Ac.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ac),o.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),o.multiply(Ac)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}const Zu=new $t,Ls=new R,Tc=new R;class v2 extends Wu{constructor(){super(new xo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ct(4,2),this._viewportCount=6,this._viewports=[new se(2,1,1,1),new se(0,1,1,1),new se(3,1,1,1),new se(1,1,1,1),new se(3,0,1,1),new se(1,0,1,1)],this._cubeDirections=[new R(1,0,0),new R(-1,0,0),new R(0,0,1),new R(0,0,-1),new R(0,1,0),new R(0,-1,0)],this._cubeUps=[new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,0,1),new R(0,0,-1)]}updateMatrices(t,e=0){const o=this.camera,n=this.matrix,s=t.distance||o.far;s!==o.far&&(o.far=s,o.updateProjectionMatrix()),Ls.setFromMatrixPosition(t.matrixWorld),o.position.copy(Ls),Tc.copy(o.position),Tc.add(this._cubeDirections[e]),o.up.copy(this._cubeUps[e]),o.lookAt(Tc),o.updateMatrixWorld(),n.makeTranslation(-Ls.x,-Ls.y,-Ls.z),Zu.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zu)}}class _2 extends jr{constructor(t,e,o=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=o,this.decay=n,this.shadow=new v2}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class w2 extends Wu{constructor(){super(new nc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class M2 extends jr{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Oe.DEFAULT_UP),this.updateMatrix(),this.target=new Oe,this.shadow=new w2}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class z2 extends jr{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Yu{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$u(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=$u();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function $u(){return performance.now()}const Cc="\\[\\]\\.:\\/",S2=new RegExp("["+Cc+"]","g"),kc="[^"+Cc+"]",E2="[^"+Cc.replace("\\.","")+"]",F2=/((?:WC+[\/:])*)/.source.replace("WC",kc),A2=/(WCOD+)?/.source.replace("WCOD",E2),T2=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",kc),C2=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",kc),k2=new RegExp("^"+F2+A2+T2+C2+"$"),B2=["material","materials","bones","map"];class P2{constructor(t,e,o){const n=o||le.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const o=this._targetGroup.nCachedObjects_,n=this._bindings[o];n!==void 0&&n.getValue(t,e)}setValue(t,e){const o=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=o.length;n!==s;++n)o[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=t.length;e!==o;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,o=t.length;e!==o;++e)t[e].unbind()}}class le{constructor(t,e,o){this.path=e,this.parsedPath=o||le.parseTrackName(e),this.node=le.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,o){return t&&t.isAnimationObjectGroup?new le.Composite(t,e,o):new le(t,e,o)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(S2,"")}static parseTrackName(t){const e=k2.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const o={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=o.nodeName&&o.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=o.nodeName.substring(n+1);B2.indexOf(s)!==-1&&(o.nodeName=o.nodeName.substring(0,n),o.objectName=s)}if(o.propertyName===null||o.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return o}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const o=t.skeleton.getBoneByName(e);if(o!==void 0)return o}if(t.children){const o=function(s){for(let r=0;r<s.length;r++){const a=s[r];if(a.name===e||a.uuid===e)return a;const l=o(a.children);if(l)return l}return null},n=o(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const o=this.resolvedProperty;for(let n=0,s=o.length;n!==s;++n)t[e++]=o[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const o=this.resolvedProperty;for(let n=0,s=o.length;n!==s;++n)o[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const o=this.resolvedProperty;for(let n=0,s=o.length;n!==s;++n)o[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const o=this.resolvedProperty;for(let n=0,s=o.length;n!==s;++n)o[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,o=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=le.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(o){let c=e.objectIndex;switch(o){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let p=0;p<t.length;p++)if(t[p].name===c){c=p;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[o]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[o]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const r=t[n];if(r===void 0){const c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(l=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}le.Composite=P2,le.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},le.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},le.prototype.GetterByBindingType=[le.prototype._getValue_direct,le.prototype._getValue_array,le.prototype._getValue_arrayElement,le.prototype._getValue_toArray],le.prototype.SetterByBindingTypeAndVersioning=[[le.prototype._setValue_direct,le.prototype._setValue_direct_setNeedsUpdate,le.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[le.prototype._setValue_array,le.prototype._setValue_array_setNeedsUpdate,le.prototype._setValue_array_setMatrixWorldNeedsUpdate],[le.prototype._setValue_arrayElement,le.prototype._setValue_arrayElement_setNeedsUpdate,le.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[le.prototype._setValue_fromArray,le.prototype._setValue_fromArray_setNeedsUpdate,le.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];const qu=new $t;class Bc{constructor(t,e,o=0,n=1/0){this.ray=new On(t,e),this.near=o,this.far=n,this.camera=null,this.layers=new Gl,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return qu.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(qu),this}intersectObject(t,e=!0,o=[]){return Pc(t,this,o,e),o.sort(ju),o}intersectObjects(t,e=!0,o=[]){for(let n=0,s=t.length;n<s;n++)Pc(t[n],this,o,e);return o.sort(ju),o}}function ju(i,t){return i.distance-t.distance}function Pc(i,t,e,o){let n=!0;if(i.layers.test(t.layers)&&i.raycast(t,e)===!1&&(n=!1),n===!0&&o===!0){const s=i.children;for(let r=0,a=s.length;r<a;r++)Pc(s[r],t,e,!0)}}class Ku{constructor(t=1,e=0,o=0){return this.radius=t,this.phi=e,this.theta=o,this}set(t,e,o){return this.radius=t,this.phi=e,this.theta=o,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,o){return this.radius=Math.sqrt(t*t+e*e+o*o),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,o),this.phi=Math.acos(Ce(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const Ju=new R,Kr=new R;class Eo{constructor(t=new R,e=new R){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Ju.subVectors(t,this.start),Kr.subVectors(this.end,this.start);const o=Kr.dot(Kr);let s=Kr.dot(Ju)/o;return e&&(s=Ce(s,0,1)),s}closestPointToPoint(t,e,o){const n=this.closestPointToPointParameter(t,e);return this.delta(o).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class R2 extends Ln{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:lo}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=lo);const Qu={type:"change"},Rc={type:"start"},t0={type:"end"},Jr=new On,e0=new Do,D2=Math.cos(70*Me.DEG2RAD),De=new R,po=2*Math.PI,fe={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Dc=1e-6;class I2 extends R2{constructor(t,e=null){super(t,e),this.state=fe.NONE,this.enabled=!0,this.target=new R,this.cursor=new R,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Je.ROTATE,MIDDLE:Je.DOLLY,RIGHT:Je.PAN},this.touches={ONE:pi.ROTATE,TWO:pi.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new R,this._lastQuaternion=new Mo,this._lastTargetPosition=new R,this._quat=new Mo().setFromUnitVectors(t.up,new R(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ku,this._sphericalDelta=new Ku,this._scale=1,this._panOffset=new R,this._rotateStart=new ct,this._rotateEnd=new ct,this._rotateDelta=new ct,this._panStart=new ct,this._panEnd=new ct,this._panDelta=new ct,this._dollyStart=new ct,this._dollyEnd=new ct,this._dollyDelta=new ct,this._dollyDirection=new R,this._mouse=new ct,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=U2.bind(this),this._onPointerDown=L2.bind(this),this._onPointerUp=N2.bind(this),this._onContextMenu=Z2.bind(this),this._onMouseWheel=H2.bind(this),this._onKeyDown=G2.bind(this),this._onTouchStart=X2.bind(this),this._onTouchMove=W2.bind(this),this._onMouseDown=O2.bind(this),this._onMouseMove=V2.bind(this),this._interceptControlDown=Y2.bind(this),this._interceptControlUp=$2.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Qu),this.update(),this.state=fe.NONE}update(t=null){const e=this.object.position;De.copy(e).sub(this.target),De.applyQuaternion(this._quat),this._spherical.setFromVector3(De),this.autoRotate&&this.state===fe.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(o)&&isFinite(n)&&(o<-Math.PI?o+=po:o>Math.PI&&(o-=po),n<-Math.PI?n+=po:n>Math.PI&&(n-=po),o<=n?this._spherical.theta=Math.max(o,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+n)/2?Math.max(o,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=r!=this._spherical.radius}if(De.setFromSpherical(this._spherical),De.applyQuaternion(this._quatInverse),e.copy(this.target).add(De),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=De.length();r=this._clampDistance(a*this._scale);const l=a-r;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new R(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const c=new R(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),r=De.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(Jr.origin.copy(this.object.position),Jr.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Jr.direction))<D2?this.object.lookAt(this.target):(e0.setFromNormalAndCoplanarPoint(this.object.up,this.target),Jr.intersectPlane(e0,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Dc||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Dc||this._lastTargetPosition.distanceToSquared(this.target)>Dc?(this.dispatchEvent(Qu),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?po/60*this.autoRotateSpeed*t:po/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){De.setFromMatrixColumn(e,0),De.multiplyScalar(-t),this._panOffset.add(De)}_panUp(t,e){this.screenSpacePanning===!0?De.setFromMatrixColumn(e,1):(De.setFromMatrixColumn(e,0),De.crossVectors(this.object.up,De)),De.multiplyScalar(t),this._panOffset.add(De)}_pan(t,e){const o=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;De.copy(n).sub(this.target);let s=De.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*s/o.clientHeight,this.object.matrix),this._panUp(2*e*s/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),n=t-o.left,s=e-o.top,r=o.width,a=o.height;this._mouse.x=n/r*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(po*this._rotateDelta.x/e.clientHeight),this._rotateUp(po*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(po*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(-po*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(po*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(-po*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._rotateStart.set(o,n)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._panStart.set(o,n)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,n=t.pageY-e.y,s=Math.sqrt(o*o+n*n);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),n=.5*(t.pageX+o.x),s=.5*(t.pageY+o.y);this._rotateEnd.set(n,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(po*this._rotateDelta.x/e.clientHeight),this._rotateUp(po*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);this._panEnd.set(o,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,n=t.pageY-e.y,s=Math.sqrt(o*o+n*n);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(t.pageX+e.x)*.5,a=(t.pageY+e.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new ct,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function L2(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function U2(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function N2(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(t0),this.state=fe.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function O2(i){let t;switch(i.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Je.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=fe.DOLLY;break;case Je.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=fe.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=fe.ROTATE}break;case Je.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=fe.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=fe.PAN}break;default:this.state=fe.NONE}this.state!==fe.NONE&&this.dispatchEvent(Rc)}function V2(i){switch(this.state){case fe.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case fe.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case fe.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function H2(i){this.enabled===!1||this.enableZoom===!1||this.state!==fe.NONE||(i.preventDefault(),this.dispatchEvent(Rc),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(t0))}function G2(i){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(i)}function X2(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case pi.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=fe.TOUCH_ROTATE;break;case pi.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=fe.TOUCH_PAN;break;default:this.state=fe.NONE}break;case 2:switch(this.touches.TWO){case pi.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=fe.TOUCH_DOLLY_PAN;break;case pi.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=fe.TOUCH_DOLLY_ROTATE;break;default:this.state=fe.NONE}break;default:this.state=fe.NONE}this.state!==fe.NONE&&this.dispatchEvent(Rc)}function W2(i){switch(this._trackPointer(i),this.state){case fe.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case fe.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case fe.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case fe.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=fe.NONE}}function Z2(i){this.enabled!==!1&&i.preventDefault()}function Y2(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function $2(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class q2{constructor(t){cs(this,"animate",()=>{requestAnimationFrame(this.animate);const t=this.clock.getDelta();this.controls.update(),this.onUpdate&&this.onUpdate(t),this.customRender?this.customRender():this.renderer.render(this.scene,this.camera)});this.canvas=t,this.scene=new Br,this.scene.background=new bt(1710638),this.setupRenderer(),this.setupCamera(),this.setupLights(),this.setupControls(),this.clock=new Yu,this.onUpdate=null,this.customRender=null,window.addEventListener("resize",()=>this.onResize()),this.onResize()}setupRenderer(){this.renderer=new M1({canvas:this.canvas,antialias:!0}),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Op}setupCamera(){this.camera=new xo(60,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(10,10,10),this.camera.lookAt(0,0,0)}setupLights(){const t=new z2(16777215,.4);this.scene.add(t);const e=new M2(16777215,.8);e.position.set(10,20,10),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=50,e.shadow.camera.left=-20,e.shadow.camera.right=20,e.shadow.camera.top=20,e.shadow.camera.bottom=-20,this.scene.add(e);const o=new b2(8900331,3550502,.3);this.scene.add(o)}setupControls(){this.controls=new I2(this.camera,this.canvas),this.controls.enableDamping=!0,this.controls.dampingFactor=.1,this.controls.minDistance=5,this.controls.maxDistance=50,this.controls.maxPolarAngle=Math.PI/2-.05,this.controls.mouseButtons={LEFT:null,MIDDLE:Je.DOLLY,RIGHT:Je.ROTATE},this.controls.enablePan=!0,window.addEventListener("keydown",t=>{t.key==="Shift"&&(this.controls.mouseButtons.RIGHT=Je.PAN)}),window.addEventListener("keyup",t=>{t.key==="Shift"&&(this.controls.mouseButtons.RIGHT=Je.ROTATE)})}onResize(){const t=window.innerWidth,e=window.innerHeight;this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)}start(){this.animate()}}class j2{constructor(t,e={}){this.scene=t,this.cellSize=e.cellSize||1,this.gridSize=e.gridSize||20,this.gridGroup=new Zn,this.gridGroup.name="grid",this.scene.add(this.gridGroup),this.createGridPlane(),this.createMultiLevelGrid()}createGridPlane(){const t=new Ni(this.gridSize*this.cellSize*2,this.gridSize*this.cellSize*2),e=new Ri({visible:!1,side:Ze});this.plane=new ge(t,e),this.plane.rotation.x=-Math.PI/2,this.plane.position.y=0,this.plane.name="gridPlane",this.scene.add(this.plane)}createMultiLevelGrid(){const e=this.gridSize*this.cellSize;this.fineGrid=this.createGridLevel(e,1,3816010,.6),this.fineGrid.position.y=.001,this.gridGroup.add(this.fineGrid),this.mediumGrid=this.createGridLevel(e,5,4868714,.6),this.mediumGrid.position.y=.002,this.gridGroup.add(this.mediumGrid),this.majorGrid=this.createGridLevel(e,10,6974106,.8),this.majorGrid.position.y=.003,this.gridGroup.add(this.majorGrid),this.createOriginAxes(e)}createGridLevel(t,e,o,n){const s=[];for(let l=-t;l<=t;l+=e){const c=e<5&&l%5===0,p=e<10&&l%10===0;c||p||(s.push(new R(-t,0,l)),s.push(new R(t,0,l)),s.push(new R(l,0,-t)),s.push(new R(l,0,t)))}const r=new Xt().setFromPoints(s),a=new $n({color:o,transparent:!0,opacity:n});return new Xi(r,a)}createOriginAxes(t){const e=[new R(-t,0,0),new R(t,0,0)],o=new Xt().setFromPoints(e),n=new $n({color:8930372,transparent:!0,opacity:.7});this.xAxis=new Xi(o,n),this.xAxis.position.y=.004,this.gridGroup.add(this.xAxis);const s=[new R(0,0,-t),new R(0,0,t)],r=new Xt().setFromPoints(s),a=new $n({color:4473992,transparent:!0,opacity:.7});this.zAxis=new Xi(r,a),this.zAxis.position.y=.004,this.gridGroup.add(this.zAxis)}snapToGrid(t){return new R(Math.round(t.x/this.cellSize)*this.cellSize,Math.round(t.y/this.cellSize)*this.cellSize,Math.round(t.z/this.cellSize)*this.cellSize)}worldToGrid(t){return{x:Math.round(t.x/this.cellSize),y:Math.round(t.y/this.cellSize),z:Math.round(t.z/this.cellSize)}}gridToWorld(t){return new R(t.x*this.cellSize,t.y*this.cellSize,t.z*this.cellSize)}getRaycastPlane(){return this.plane}dispose(){this.scene.remove(this.plane),this.scene.remove(this.gridGroup),this.plane.geometry.dispose(),this.plane.material.dispose(),[this.fineGrid,this.mediumGrid,this.majorGrid,this.xAxis,this.zAxis].forEach(t=>{t&&(t.geometry.dispose(),t.material.dispose())})}}const Kn=["east","west","top","bottom","south","north"],K2={east:0,west:1,top:2,bottom:3,south:4,north:5};class J2{constructor(t){this.textureManager=t,this.selectedFace=null}getFaceFromNormal(t){const e=Math.abs(t.x),o=Math.abs(t.y),n=Math.abs(t.z);return e>o&&e>n?t.x>0?"east":"west":o>e&&o>n?t.y>0?"top":"bottom":t.z>0?"south":"north"}applyMaterialToFace(t,e,o){return K2[e]===void 0?!1:(t.faces[e]={direction:e,materialId:o,uvRotation:0,uvFlip:{x:!1,y:!1}},this.updateBlockMaterials(t),!0)}applyMaterialToAllFaces(t,e){Kn.forEach(o=>{t.faces[o]={direction:o,materialId:e,uvRotation:0,uvFlip:{x:!1,y:!1}}}),this.updateBlockMaterials(t)}updateBlockMaterials(t){const e=Kn.map(o=>{const n=t.faces[o];if(n&&n.materialId){const s=this.textureManager.createThreeMaterial(n.materialId);if(s)return s}return new Ge({color:t.color,roughness:.7,metalness:.1})});Array.isArray(t.mesh.material)?t.mesh.material.forEach(o=>o.dispose()):t.mesh.material&&t.mesh.material.dispose(),t.mesh.material=e}rotateFaceUV(t,e,o=90){const n=t.faces[e];n&&(n.uvRotation=(n.uvRotation+o)%360,this.updateBlockMaterials(t))}flipFaceUV(t,e,o="x"){const n=t.faces[e];n&&(n.uvFlip[o]=!n.uvFlip[o],this.updateBlockMaterials(t))}pickMaterialFromFace(t,e){const o=t.faces[e];return o?o.materialId:null}}function vt(i,t=!1){const e=i[0].index!==null,o=new Set(Object.keys(i[0].attributes)),n=new Set(Object.keys(i[0].morphAttributes)),s={},r={},a=i[0].morphTargetsRelative,l=new Xt;let c=0;for(let p=0;p<i.length;++p){const h=i[p];let u=0;if(e!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const d in h.attributes){if(!o.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+'. All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.'),null;s[d]===void 0&&(s[d]=[]),s[d].push(h.attributes[d]),u++}if(u!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const d in h.morphAttributes){if(!n.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+".  .morphAttributes must be consistent throughout all geometries."),null;r[d]===void 0&&(r[d]=[]),r[d].push(h.morphAttributes[d])}if(t){let d;if(e)d=h.index.count;else if(h.attributes.position!==void 0)d=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+p+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,d,p),c+=d}}if(e){let p=0;const h=[];for(let u=0;u<i.length;++u){const d=i[u].index;for(let y=0;y<d.count;++y)h.push(d.getX(y)+p);p+=i[u].attributes.position.count}l.setIndex(h)}for(const p in s){const h=o0(s[p]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" attribute."),null;l.setAttribute(p,h)}for(const p in r){const h=r[p][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[p]=[];for(let u=0;u<h;++u){const d=[];for(let g=0;g<r[p].length;++g)d.push(r[p][g][u]);const y=o0(d);if(!y)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+p+" morphAttribute."),null;l.morphAttributes[p].push(y)}}return l}function o0(i){let t,e,o,n=-1,s=0;for(let c=0;c<i.length;++c){const p=i[c];if(t===void 0&&(t=p.array.constructor),t!==p.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(e===void 0&&(e=p.itemSize),e!==p.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(o===void 0&&(o=p.normalized),o!==p.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(n===-1&&(n=p.gpuType),n!==p.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=p.count*e}const r=new t(s),a=new Gt(r,e,o);let l=0;for(let c=0;c<i.length;++c){const p=i[c];if(p.isInterleavedBufferAttribute){const h=l/e;for(let u=0,d=p.count;u<d;u++)for(let y=0;y<e;y++){const g=p.getComponent(u,y);a.setComponent(u+h,y,g)}}else r.set(p.array,l);l+=p.count*e}return n!==void 0&&(a.gpuType=n),a}const Ic={basic:{label:"Basic",types:["cube","slab","slabTop","quarter","quarterTall","halfX","halfZ","halfCorner","step","platform"]},pillars:{label:"Pillars",types:["pillar","pillar2","pillar4","pillarRound","pillarRound2","post","bollard"]},beams:{label:"Beams",types:["beamX","beam2X","beamZ","beam2Z","beamXLow","beam2XLow","beamZLow","beam2ZLow","beamDiag","crossBeam","truss"]},walls:{label:"Walls",types:["wall","wall4","wall8","panel","wallFront","wallBack","wallCorner","wallCornerInner","wallJunction","parapet","crenellation"]},wedges:{label:"Wedges",types:["wedge","wedgeLow","wedgeFlat","wedgeTop","wedgeLowTop","wedgeFlatTop","wedgeCorner","wedgeInner","wedge4x2","wedge4x2Top","wedge2x2","wedge2x2Top","wedgeHalf","wedgeHalfTop","wedgeCornerLow","wedgeCornerFlat"]},triangles:{label:"Triangles",types:["trianglePrism","triangleRight","triangleEqui","tetrahedron","pentahedron"]},stairs:{label:"Stairs",types:["stairs","stairs4","stairs8","stairsCorner","stairsCornerInner","stairsSingle","landing","spiralStep"]},shapes:{label:"Shapes",types:["cylinder","cylinderHalf","cone","sphere","dome","pyramid","octagon","tube","torus","capsule","hemisphere","egg"]},arches:{label:"Arches",types:["arch","archLow","archWide","archHalf","gothicArch","flatArch","keystone"]},pipes:{label:"Pipes",types:["pipeX","pipeY","pipeZ","pipeElbowXZ","pipeElbowXZ2","pipeElbowXZ3","pipeElbowXZ4","pipeElbowXY","pipeElbowXY2","pipeElbowYZ","pipeElbowYZ2","pipeCross","pipeT","pipeTY","pipeTZ","downspout"]},fences:{label:"Fences & Gates",types:["fence","fenceZ","fenceCorner","fenceCornerInner","fencePost","fenceEnd","fenceT","fenceCross","gate","gateOpen","gateDouble","gateArch","railing","railingZ","railingCorner","railingCornerInner","railingPost","railingEnd","railingSlope","railingSlopeZ","picket","picketZ","lattice","latticeZ"]},decorative:{label:"Decorative",types:["cross","frame","prism","lShape","tShape","cShape","star","heart","diamond"]},details:{label:"Details",types:["ledge","gutter","capital","base","windowFrame","doorFrame","cornerTrim","edgeTrim","edgeCorner","edgeSlope","edgeSlopeZ","moldingX","moldingZ","moldingCorner","bracket","trim","trimZ","trimCorner"]},architectural:{label:"Architectural",types:["cornice","column","baluster","windowSill","shingle","chimney","buttress","finial","pediment","dentil"]},covers:{label:"Covers",types:["awning","canopy","pergola","tarp","umbrella"]},furniture:{label:"Furniture",types:["bench","table","chair","barrel","planter","ladder","stool","shelf","bed","desk"]},storage:{label:"Storage",types:["crate","crateOpen","crateLarge","pallet","shelfUnit","locker","cabinet","cardboardBox","sack","bin","dumpster"]},industrial:{label:"Industrial",types:["tank","valve","vent","iBeam","catwalk","grateFloor","ductX","ductZ","ductCorner","hopper","conveyor"]},electrical:{label:"Electrical",types:["transformer","powerBox","conduitX","conduitY","conduitZ","conduitElbow","conduitElbowY","conduitT","outlet","switchBox","fuseBox","cableX","cableY","cableZ","cableElbow","cableElbowY","cableT","lightFixture","cableHanging","cableDroop","cableLoop","spotlight","bulb"]},natural:{label:"Natural",types:["rock","bush","logX","logZ","stump","boulder","grass","flower","mushroom","mushroomCluster","moss","vine","coral"]},rocks:{label:"Rocks",types:["rock","boulder","rockSmall","rockLarge","rockFlat","rockTall","rockJagged","rockCluster","rockPile","pebbles","slate"]},crystals:{label:"Crystals",types:["crystal","gem","crystalSmall","crystalLarge","crystalCluster","crystalSpike","crystalFlat","crystalShard","crystalFormation"]},cave:{label:"Cave",types:["stalactite","stalagmite","mushroom","mushroomCluster","moss","crystalCluster","crystalFormation"]},modern:{label:"Modern",types:["acUnit","solarPanel","antenna","barrier","trafficCone","sign","monitor","speaker"]},extraShapes:{label:"Extra Shapes",types:["quarterPipe","bowl","hexagon","roundedCube","chamfer","cubeBevel","gem","crystal","pill"]},ramps:{label:"Ramps",types:["rampCurved","rampCurvedLow","rampCurvedCorner","rampStraight","rampWide"]},roofs:{label:"Roofs",types:["roofPeak","roofPeakLow","roofHip","slabSlope","slabSlopeTop","roofCorner","roofValley","gable"]},channels:{label:"Channels",types:["channel","channelCorner","channelEnd","drain","grate"]},medieval:{label:"Medieval",types:["merlon","arrowSlit","torch","chain","shield","banner","portcullis"]},vehicles:{label:"Vehicles",types:["wheel","axle","seat","hull","propeller","wing"]},oil:{label:"Oil & Gas",types:["derrickLeg","derrickCross","derrickPlatform","pumpJack","pumpBase","oilTank","oilTankSmall","wellHead","pipelineX","pipelineZ","oilBarrel"]}};function Q2(){const i=new Set;for(const t of Object.values(Ic))for(const e of t.types)i.add(e);return Array.from(i)}const n0={cube:{icon:"",label:"Cube"},slab:{icon:"",label:"Slab"},slabTop:{icon:"",label:"Slab Top"},quarter:{icon:"",label:"Quarter"},quarterTall:{icon:"",label:"Qtr Tall"},halfX:{icon:"",label:"Half X"},halfZ:{icon:"",label:"Half Z"},halfCorner:{icon:"",label:"Half Crn"},pillar:{icon:"",label:"Pillar"},pillar2:{icon:"",label:"Pillar S"},pillar4:{icon:"",label:"Pillar XS"},pillarRound:{icon:"",label:"Round Pil"},pillarRound2:{icon:"",label:"Round S"},beamX:{icon:"",label:"Beam X"},beam2X:{icon:"",label:"Beam X S"},beam4X:{icon:"",label:"Beam X XS"},beamZ:{icon:"",label:"Beam Z"},beam2Z:{icon:"",label:"Beam Z S"},beam4Z:{icon:"",label:"Beam Z XS"},beamDiag:{icon:"",label:"Beam Diag"},beamXLow:{icon:"",label:"Beam X Lo"},beam2XLow:{icon:"",label:"Beam X LoS"},beamZLow:{icon:"",label:"Beam Z Lo"},beam2ZLow:{icon:"",label:"Beam Z LoS"},wall:{icon:"",label:"Wall"},wall4:{icon:"",label:"Wall Thin"},wall8:{icon:"",label:"Wall XThin"},panel:{icon:"|",label:"Panel"},wallFront:{icon:"",label:"Wall Front"},wallBack:{icon:"",label:"Wall Back"},wallCorner:{icon:"",label:"Corner"},wallCornerInner:{icon:"",label:"Inner Crn"},wallJunction:{icon:"",label:"Junction"},wedge:{icon:"",label:"Wedge"},wedgeLow:{icon:"",label:"Wedge Low"},wedgeFlat:{icon:"",label:"Wedge Flat"},wedgeTop:{icon:"",label:"Wedge Top"},wedgeLowTop:{icon:"",label:"Wdg Low Top"},wedgeFlatTop:{icon:"",label:"Wdg Flat Top"},wedgeCorner:{icon:"",label:"Wdg Corner"},wedgeInner:{icon:"",label:"Wdg Inner"},wedge4x2:{icon:"",label:"Wdg 4x2"},wedge4x2Top:{icon:"",label:"Wdg 4x2 Top"},wedge2x2:{icon:"",label:"Wdg 2x2"},wedge2x2Top:{icon:"",label:"Wdg 2x2 Top"},wedgeHalf:{icon:"",label:"Wdg Half"},wedgeHalfTop:{icon:"",label:"Wdg Half Top"},wedgeCornerLow:{icon:"",label:"Wdg Crn Lo"},wedgeCornerFlat:{icon:"",label:"Wdg Crn Flat"},stairs:{icon:"",label:"Stairs 2"},stairs4:{icon:"",label:"Stairs 4"},stairs8:{icon:"",label:"Stairs 8"},stairsCorner:{icon:"",label:"Stair Crn"},stairsCornerInner:{icon:"",label:"Stair Inn"},cylinder:{icon:"",label:"Cylinder"},cylinderHalf:{icon:"",label:"Half Cyl"},cone:{icon:"",label:"Cone"},sphere:{icon:"",label:"Sphere"},dome:{icon:"",label:"Dome"},pyramid:{icon:"",label:"Pyramid"},octagon:{icon:"",label:"Octagon"},tube:{icon:"",label:"Tube"},arch:{icon:"",label:"Arch"},archLow:{icon:"",label:"Arch Low"},archWide:{icon:"",label:"Arch Wide"},archHalf:{icon:"",label:"Arch Half"},cross:{icon:"",label:"Cross"},frame:{icon:"",label:"Frame"},fence:{icon:"",label:"Fence"},fenceZ:{icon:"",label:"Fence Z"},railing:{icon:"",label:"Railing"},railingZ:{icon:"",label:"Railing Z"},pipeX:{icon:"",label:"Pipe X"},pipeY:{icon:"",label:"Pipe Y"},pipeZ:{icon:"",label:"Pipe Z"},pipeElbow:{icon:"",label:"Elbow 1"},pipeElbow2:{icon:"",label:"Elbow 2"},pipeElbow3:{icon:"",label:"Elbow 3"},pipeElbow4:{icon:"",label:"Elbow 4"},pipeCross:{icon:"",label:"Cross"},pipeT:{icon:"",label:"T Horiz"},pipeTY:{icon:"",label:"T Vert"},prism:{icon:"",label:"Prism"},lShape:{icon:"",label:"L Shape"},tShape:{icon:"",label:"T Shape"},cShape:{icon:"",label:"C Shape"},ledge:{icon:"",label:"Ledge"},gutter:{icon:"",label:"Gutter"},capital:{icon:"",label:"Capital"},base:{icon:"",label:"Base"},windowFrame:{icon:"",label:"Window"},doorFrame:{icon:"",label:"Door"},cornice:{icon:"",label:"Cornice"},column:{icon:"",label:"Column"},baluster:{icon:"",label:"Baluster"},windowSill:{icon:"",label:"Win Sill"},shingle:{icon:"",label:"Shingle"},chimney:{icon:"",label:"Chimney"},buttress:{icon:"",label:"Buttress"},bench:{icon:"",label:"Bench"},table:{icon:"",label:"Table"},chair:{icon:"",label:"Chair"},barrel:{icon:"",label:"Barrel"},planter:{icon:"",label:"Planter"},ladder:{icon:"",label:"Ladder"},crate:{icon:"",label:"Crate"},crateOpen:{icon:"",label:"Crate Open"},crateLarge:{icon:"",label:"Crate Lrg"},pallet:{icon:"",label:"Pallet"},shelfUnit:{icon:"",label:"Shelf"},locker:{icon:"",label:"Locker"},cabinet:{icon:"",label:"Cabinet"},cardboardBox:{icon:"",label:"Cardboard"},sack:{icon:"",label:"Sack"},tank:{icon:"",label:"Tank"},valve:{icon:"",label:"Valve"},vent:{icon:"",label:"Vent"},iBeam:{icon:"",label:"I-Beam"},catwalk:{icon:"",label:"Catwalk"},transformer:{icon:"",label:"Transform"},powerBox:{icon:"",label:"Power Box"},conduit:{icon:"",label:"Conduit"},conduitCorner:{icon:"",label:"Conduit Crn"},outlet:{icon:"",label:"Outlet"},switchBox:{icon:"",label:"Switch"},fuseBox:{icon:"",label:"Fuse Box"},cable:{icon:"",label:"Cable"},lightFixture:{icon:"",label:"Light"},cableHanging:{icon:"",label:"Cable Sag"},cableDroop:{icon:"",label:"Cable Drop"},cableLoop:{icon:"",label:"Cable Coil"},rock:{icon:"",label:"Rock"},bush:{icon:"",label:"Bush"},logX:{icon:"",label:"Log X"},logZ:{icon:"",label:"Log Z"},acUnit:{icon:"",label:"AC Unit"},solarPanel:{icon:"",label:"Solar"},antenna:{icon:"",label:"Antenna"},barrier:{icon:"",label:"Barrier"},quarterPipe:{icon:"",label:"Qtr Pipe"},bowl:{icon:"",label:"Bowl"},hexagon:{icon:"",label:"Hexagon"},roundedCube:{icon:"",label:"Rounded"},chamfer:{icon:"",label:"Chamfer"},merlon:{icon:"",label:"Merlon"},arrowSlit:{icon:"",label:"Arrow Slit"},torch:{icon:"",label:"Torch"},chain:{icon:"",label:"Chain"},rampCurved:{icon:"",label:"Ramp Curved"},rampCurvedLow:{icon:"",label:"Ramp Crv Lo"},rampCurvedCorner:{icon:"",label:"Ramp Crv Crn"},roofPeak:{icon:"",label:"Roof Peak"},roofPeakLow:{icon:"",label:"Roof Pk Lo"},roofHip:{icon:"",label:"Roof Hip"},slabSlope:{icon:"",label:"Slab Slope"},slabSlopeTop:{icon:"",label:"Slab Slp Top"},channel:{icon:"",label:"Channel"},channelCorner:{icon:"",label:"Channel Crn"},channelEnd:{icon:"",label:"Channel End"},cubeBevel:{icon:"",label:"Cube Bevel"},step:{icon:"",label:"Step"},platform:{icon:"",label:"Platform"},post:{icon:"",label:"Post"},bollard:{icon:"",label:"Bollard"},crossBeam:{icon:"",label:"Cross Beam"},truss:{icon:"",label:"Truss"},parapet:{icon:"",label:"Parapet"},crenellation:{icon:"",label:"Crenellation"},trianglePrism:{icon:"",label:"Tri Prism"},triangleRight:{icon:"",label:"Tri Right"},triangleEqui:{icon:"",label:"Tri Equi"},tetrahedron:{icon:"",label:"Tetrahedron"},pentahedron:{icon:"",label:"Pentahedron"},stairsSingle:{icon:"",label:"Single Step"},landing:{icon:"",label:"Landing"},spiralStep:{icon:"",label:"Spiral Step"},torus:{icon:"",label:"Torus"},capsule:{icon:"",label:"Capsule"},hemisphere:{icon:"",label:"Hemisphere"},egg:{icon:"",label:"Egg"},gothicArch:{icon:"",label:"Gothic Arch"},flatArch:{icon:"",label:"Flat Arch"},keystone:{icon:"",label:"Keystone"},downspout:{icon:"",label:"Downspout"},star:{icon:"",label:"Star"},heart:{icon:"",label:"Heart"},diamond:{icon:"",label:"Diamond"},cornerTrim:{icon:"",label:"Corner Trim"},edgeTrim:{icon:"",label:"Edge Trim"},moldingX:{icon:"",label:"Molding X"},moldingZ:{icon:"",label:"Molding Z"},bracket:{icon:"",label:"Bracket"},finial:{icon:"",label:"Finial"},pediment:{icon:"",label:"Pediment"},dentil:{icon:"",label:"Dentil"},awning:{icon:"",label:"Awning"},canopy:{icon:"",label:"Canopy"},pergola:{icon:"",label:"Pergola"},tarp:{icon:"",label:"Tarp"},umbrella:{icon:"",label:"Umbrella"},stool:{icon:"",label:"Stool"},shelf:{icon:"",label:"Shelf"},bed:{icon:"",label:"Bed"},desk:{icon:"",label:"Desk"},bin:{icon:"",label:"Bin"},dumpster:{icon:"",label:"Dumpster"},grateFloor:{icon:"",label:"Grate Floor"},ductX:{icon:"",label:"Duct X"},ductZ:{icon:"",label:"Duct Z"},ductCorner:{icon:"",label:"Duct Corner"},hopper:{icon:"",label:"Hopper"},conveyor:{icon:"",label:"Conveyor"},spotlight:{icon:"",label:"Spotlight"},bulb:{icon:"",label:"Bulb"},stump:{icon:"",label:"Stump"},boulder:{icon:"",label:"Boulder"},grass:{icon:"",label:"Grass"},flower:{icon:"",label:"Flower"},trafficCone:{icon:"",label:"Traffic Cone"},sign:{icon:"",label:"Sign"},monitor:{icon:"",label:"Monitor"},speaker:{icon:"",label:"Speaker"},gem:{icon:"",label:"Gem"},crystal:{icon:"",label:"Crystal"},pill:{icon:"",label:"Pill"},rampStraight:{icon:"",label:"Ramp Straight"},rampWide:{icon:"",label:"Ramp Wide"},roofCorner:{icon:"",label:"Roof Corner"},roofValley:{icon:"",label:"Roof Valley"},gable:{icon:"",label:"Gable"},drain:{icon:"",label:"Drain"},grate:{icon:"",label:"Grate"},shield:{icon:"",label:"Shield"},banner:{icon:"",label:"Banner"},portcullis:{icon:"",label:"Portcullis"},wheel:{icon:"",label:"Wheel"},axle:{icon:"",label:"Axle"},seat:{icon:"",label:"Seat"},hull:{icon:"",label:"Hull"},propeller:{icon:"",label:"Propeller"},wing:{icon:"",label:"Wing"},derrickLeg:{icon:"",label:"Derrick Leg"},derrickCross:{icon:"",label:"Derrick X"},derrickPlatform:{icon:"",label:"Derrick Plat"},pumpJack:{icon:"",label:"Pump Jack"},pumpBase:{icon:"",label:"Pump Base"},oilTank:{icon:"",label:"Oil Tank"},oilTankSmall:{icon:"",label:"Tank Small"},wellHead:{icon:"",label:"Well Head"},pipelineX:{icon:"",label:"Pipeline X"},pipelineZ:{icon:"",label:"Pipeline Z"},oilBarrel:{icon:"",label:"Oil Barrel"},pipeElbowXZ:{icon:"",label:"Elbow XZ 1"},pipeElbowXZ2:{icon:"",label:"Elbow XZ 2"},pipeElbowXZ3:{icon:"",label:"Elbow XZ 3"},pipeElbowXZ4:{icon:"",label:"Elbow XZ 4"},pipeElbowXY:{icon:"",label:"Elbow XY"},pipeElbowXY2:{icon:"",label:"Elbow XY 2"},pipeElbowYZ:{icon:"",label:"Elbow YZ"},pipeElbowYZ2:{icon:"",label:"Elbow YZ 2"},pipeTZ:{icon:"",label:"T Pipe Z"},conduitX:{icon:"",label:"Conduit X"},conduitY:{icon:"",label:"Conduit Y"},conduitZ:{icon:"",label:"Conduit Z"},conduitElbow:{icon:"",label:"Cond Elbow"},conduitElbowY:{icon:"",label:"Cond Elbow Y"},conduitT:{icon:"",label:"Conduit T"},cableX:{icon:"",label:"Cable X"},cableY:{icon:"",label:"Cable Y"},cableZ:{icon:"",label:"Cable Z"},cableElbow:{icon:"",label:"Cable Elbow"},cableElbowY:{icon:"",label:"Cable Elbow Y"},cableT:{icon:"",label:"Cable T"},rockSmall:{icon:"",label:"Rock Small"},rockLarge:{icon:"",label:"Rock Large"},rockFlat:{icon:"",label:"Rock Flat"},rockTall:{icon:"",label:"Rock Tall"},rockJagged:{icon:"",label:"Rock Jagged"},rockCluster:{icon:"",label:"Rock Cluster"},rockPile:{icon:"",label:"Rock Pile"},pebbles:{icon:"",label:"Pebbles"},slate:{icon:"",label:"Slate"},crystalSmall:{icon:"",label:"Crystal Small"},crystalLarge:{icon:"",label:"Crystal Large"},crystalCluster:{icon:"",label:"Crystal Cluster"},crystalSpike:{icon:"",label:"Crystal Spike"},crystalFlat:{icon:"",label:"Crystal Flat"},crystalShard:{icon:"",label:"Crystal Shard"},crystalFormation:{icon:"",label:"Crystal Form"},stalactite:{icon:"",label:"Stalactite"},stalagmite:{icon:"",label:"Stalagmite"},mushroom:{icon:"",label:"Mushroom"},mushroomCluster:{icon:"",label:"Mushroom Clst"},moss:{icon:"",label:"Moss"},vine:{icon:"",label:"Vine"},coral:{icon:"",label:"Coral"}},Jn={cube:1,slab:.5,slabTop:.5,quarter:.5,quarterTall:1,halfX:1,halfZ:1,halfCorner:1,pillar:1,pillar2:1,pillar4:1,pillarRound:1,pillarRound2:1,beamX:.5,beam2X:.25,beam4X:.125,beamZ:.5,beam2Z:.25,beam4Z:.125,beamDiag:.25,beamXLow:.5,beam2XLow:.25,beamZLow:.5,beam2ZLow:.25,wall:1,wall4:1,wall8:1,panel:1,wallFront:1,wallBack:1,wallCorner:1,wallCornerInner:1,wallJunction:1,wedge:1,wedgeLow:.5,wedgeFlat:.25,wedgeTop:1,wedgeLowTop:.5,wedgeFlatTop:.25,wedgeCorner:1,wedgeInner:1,wedge4x2:1,wedge4x2Top:1,wedge2x2:1,wedge2x2Top:1,wedgeHalf:1,wedgeHalfTop:1,wedgeCornerLow:.5,wedgeCornerFlat:.25,rampCurved:1,rampCurvedLow:.5,rampCurvedCorner:1,roofPeak:1,roofPeakLow:.5,roofHip:1,slabSlope:.25,slabSlopeTop:.25,channel:.5,channelCorner:.5,channelEnd:.5,cubeBevel:1,stairs:1,stairs4:1,stairs8:1,stairsCorner:1,stairsCornerInner:1,cylinder:1,cylinderHalf:1,cone:1,sphere:1,dome:.5,pyramid:1,octagon:1,tube:1,arch:1,archLow:.5,archWide:1,archHalf:1,cross:1,frame:1,fence:1,fenceZ:1,fenceCorner:1,fenceCornerInner:1,fencePost:1,fenceEnd:1,fenceT:1,fenceCross:1,gate:1,gateOpen:1,gateDouble:1,gateArch:1,railing:1,railingZ:1,railingCorner:1,railingCornerInner:1,railingPost:1,railingEnd:1,railingSlope:1,railingSlopeZ:1,picket:1,picketZ:1,lattice:1,latticeZ:1,edgeCorner:.25,edgeSlope:.25,edgeSlopeZ:.25,moldingCorner:.125,trim:.125,trimZ:.125,trimCorner:.125,pipeX:1,pipeY:1,pipeZ:1,pipeElbowXZ:1,pipeElbowXZ2:1,pipeElbowXZ3:1,pipeElbowXZ4:1,pipeElbowXY:1,pipeElbowXY2:1,pipeElbowYZ:1,pipeElbowYZ2:1,pipeTZ:1,pipeCross:1,pipeT:1,pipeTY:1,prism:1,lShape:1,tShape:1,cShape:1,ledge:.25,gutter:.25,capital:.25,base:.25,windowFrame:1,doorFrame:1,cornice:.25,column:1,baluster:1,windowSill:.25,shingle:.25,chimney:1,buttress:1,bench:.5,table:.75,chair:1,barrel:1,planter:.5,ladder:1,crate:1,crateOpen:1,crateLarge:1,pallet:.125,shelfUnit:1,locker:1,cabinet:1,cardboardBox:.75,sack:.5,tank:1,valve:.5,vent:.25,iBeam:1,catwalk:.25,transformer:1,powerBox:.5,conduitX:1,conduitY:1,conduitZ:1,conduitElbow:1,conduitElbowY:1,conduitT:1,outlet:.125,switchBox:.25,fuseBox:.5,cableX:1,cableY:1,cableZ:1,cableElbow:1,cableElbowY:1,cableT:1,lightFixture:.25,cableHanging:1,cableDroop:1,cableLoop:1,rock:.75,bush:.75,logX:.5,logZ:.5,stump:.5,boulder:.75,grass:.25,flower:.5,rockSmall:.5,rockLarge:.85,rockFlat:.3,rockTall:1,rockJagged:.85,rockCluster:.6,rockPile:.5,pebbles:.15,slate:.25,crystalSmall:.5,crystalLarge:1,crystalCluster:.75,crystalSpike:1,crystalFlat:.4,crystalShard:.75,crystalFormation:1,stalactite:.8,stalagmite:.7,mushroom:.5,mushroomCluster:.5,moss:.15,vine:.8,coral:.6,acUnit:.75,solarPanel:.25,antenna:1,barrier:.75,quarterPipe:1,bowl:.5,hexagon:1,roundedCube:1,chamfer:1,merlon:.5,arrowSlit:1,torch:.75,chain:1,shield:.125,banner:1,portcullis:1,step:.25,platform:.125,post:1,bollard:.75,crossBeam:.25,truss:1,parapet:.5,crenellation:.5,trianglePrism:1,triangleRight:1,triangleEqui:1,tetrahedron:1,pentahedron:1,stairsSingle:.25,landing:.25,spiralStep:.25,torus:.5,capsule:1,hemisphere:.5,egg:1,gothicArch:1,flatArch:.25,keystone:.5,downspout:1,star:.25,heart:.5,diamond:1,cornerTrim:1,edgeTrim:.25,moldingX:.125,moldingZ:.125,bracket:.5,finial:.75,pediment:.5,dentil:.25,awning:.25,canopy:.125,pergola:.25,tarp:.0625,umbrella:.75,stool:.5,shelf:.125,bed:.5,desk:.75,bin:.75,dumpster:1,grateFloor:.125,ductX:.5,ductZ:.5,ductCorner:.5,hopper:1,conveyor:.25,spotlight:.5,bulb:.25,stump:.5,boulder:.75,grass:.25,flower:.5,trafficCone:.75,sign:1,monitor:.75,speaker:.5,gem:.75,crystal:1,pill:.5,rampStraight:1,rampWide:1,roofCorner:1,roofValley:1,gable:1,drain:.25,grate:.125,wheel:1,axle:.25,seat:.5,hull:.5,propeller:.25,wing:.125,derrickLeg:1,derrickCross:.25,derrickPlatform:.25,pumpJack:1,pumpBase:.25,oilTank:1,oilTankSmall:.5,wellHead:.5,pipelineX:.5,pipelineZ:.5,oilBarrel:1},Qn={slabTop:.5,beamX:.25,beam2X:.375,beam4X:.4375,beamZ:.25,beam2Z:.375,beam4Z:.4375,beamDiag:.375,wedgeTop:0,wedgeLowTop:.5,wedgeFlatTop:.75,wedge4x2Top:0,wedge2x2Top:0,wedgeHalfTop:0,slabSlopeTop:.75,ledge:.75,capital:.75},Qr={cube:i=>new I(i.w,i.h,i.d),slab:i=>new I(i.w,i.h/2,i.d),slabTop:i=>new I(i.w,i.h/2,i.d),pillar:i=>new I(i.w/2,i.h,i.d/2),pillar2:i=>new I(i.w/4,i.h,i.d/4),pillar4:i=>new I(i.w/8,i.h,i.d/8),beamX:i=>new I(i.w,i.h/2,i.d/2),beam2X:i=>new I(i.w,i.h/4,i.d/4),beam4X:i=>new I(i.w,i.h/8,i.d/8),beamZ:i=>new I(i.w/2,i.h/2,i.d),beam2Z:i=>new I(i.w/4,i.h/4,i.d),beam4Z:i=>new I(i.w/8,i.h/8,i.d),wall:i=>new I(i.w,i.h,i.d/2),wall4:i=>new I(i.w,i.h,i.d/4),wall8:i=>new I(i.w,i.h,i.d/8),panel:i=>new I(i.w,i.h,i.d/16),wallFront:i=>{const t=new I(i.w,i.h,i.d/4);return t.translate(0,0,i.d/2-i.d/8),t},wallBack:i=>{const t=new I(i.w,i.h,i.d/4);return t.translate(0,0,-i.d/2+i.d/8),t},wedge:i=>Xo(i.w,i.h,i.d,1),wedgeLow:i=>Xo(i.w,i.h/2,i.d,1),wedgeFlat:i=>Xo(i.w,i.h/4,i.d,1),wedgeTop:i=>ti(i.w,i.h,i.d,1),wedgeLowTop:i=>ti(i.w,i.h/2,i.d,1),wedgeFlatTop:i=>ti(i.w,i.h/4,i.d,1),wedgeCorner:i=>Lc(i.w,i.h,i.d),wedge4x2:i=>Xo(i.w*4,i.h,i.d*2,1),wedge4x2Top:i=>ti(i.w*4,i.h,i.d*2,1),wedge2x2:i=>Xo(i.w*2,i.h,i.d*2,1),wedge2x2Top:i=>ti(i.w*2,i.h,i.d*2,1),wedgeHalf:i=>Xo(i.w/2,i.h,i.d,1),wedgeHalfTop:i=>ti(i.w/2,i.h,i.d,1),wedgeCornerLow:i=>Lc(i.w,i.h/2,i.d),wedgeCornerFlat:i=>Lc(i.w,i.h/4,i.d),stairs:i=>Uc(i.w,i.h,i.d,2),stairs4:i=>Uc(i.w,i.h,i.d,4),stairs8:i=>Uc(i.w,i.h,i.d,8),cylinder:i=>{const t=Math.min(i.w,i.d)/2;return new zt(t,t,i.h,16)},cylinderHalf:i=>{const t=Math.min(i.w,i.d)/2;return new zt(t,t,i.h,16,1,!1,0,Math.PI)},cone:i=>{const t=Math.min(i.w,i.d)/2;return new He(t,i.h,16)},sphere:i=>{const t=Math.min(i.w,i.h,i.d)/2;return new xe(t,16,12)},dome:i=>{const t=Math.min(i.w,i.d)/2;return new xe(t,16,8,0,Math.PI*2,0,Math.PI/2)},quarter:i=>new I(i.w/2,i.h/2,i.d/2),quarterTall:i=>new I(i.w/2,i.h,i.d/2),halfX:i=>new I(i.w/2,i.h,i.d),halfZ:i=>new I(i.w,i.h,i.d/2),halfCorner:i=>new I(i.w/2,i.h,i.d/2),pillarRound:i=>{const t=Math.min(i.w,i.d)/4;return new zt(t,t,i.h,12)},pillarRound2:i=>{const t=Math.min(i.w,i.d)/8;return new zt(t,t,i.h,8)},beamDiag:i=>Vv(i.w,i.h/4,i.d/4),beamXLow:i=>new I(i.w,i.h/2,i.d/2),beam2XLow:i=>new I(i.w,i.h/4,i.d/4),beamZLow:i=>new I(i.w/2,i.h/2,i.d),beam2ZLow:i=>new I(i.w/4,i.h/4,i.d),arch:i=>Nc(i.w,i.h,i.d,1),archLow:i=>Nc(i.w,i.h,i.d,.5),archWide:i=>Nc(i.w,i.h,i.d,.3),archHalf:i=>Zv(i.w,i.h,i.d),wallCorner:i=>s0(i.w,i.h,i.d,!1),wallCornerInner:i=>s0(i.w,i.h,i.d,!0),wallJunction:i=>Hv(i.w,i.h,i.d),wedgeInner:i=>Gv(i.w,i.h,i.d),stairsCorner:i=>r0(i.w,i.h,i.d,!1),stairsCornerInner:i=>r0(i.w,i.h,i.d,!0),pyramid:i=>Xv(i.w,i.h,i.d),octagon:i=>{const t=Math.min(i.w,i.d)/2;return new zt(t,t,i.h,8)},tube:i=>Wv(i.w,i.h,i.d),cross:i=>tb(i.w,i.h,i.d),frame:i=>eb(i.w,i.h,i.d),fence:i=>ob(i.w,i.h,i.d),fenceZ:i=>nb(i.w,i.h,i.d),fenceCorner:i=>rb(i.w,i.h,i.d),fenceCornerInner:i=>ab(i.w,i.h,i.d),fencePost:i=>lb(i.w,i.h,i.d),fenceEnd:i=>cb(i.w,i.h,i.d),fenceT:i=>pb(i.w,i.h,i.d),fenceCross:i=>hb(i.w,i.h,i.d),gate:i=>ub(i.w,i.h,i.d),gateOpen:i=>db(i.w,i.h,i.d),gateDouble:i=>fb(i.w,i.h,i.d),gateArch:i=>mb(i.w,i.h,i.d),railing:i=>ib(i.w,i.h,i.d),railingZ:i=>sb(i.w,i.h,i.d),railingCorner:i=>yb(i.w,i.h,i.d),railingCornerInner:i=>gb(i.w,i.h,i.d),railingPost:i=>xb(i.w,i.h,i.d),railingEnd:i=>bb(i.w,i.h,i.d),railingSlope:i=>vb(i.w,i.h,i.d),railingSlopeZ:i=>_b(i.w,i.h,i.d),picket:i=>wb(i.w,i.h,i.d),picketZ:i=>Mb(i.w,i.h,i.d),lattice:i=>zb(i.w,i.h,i.d),latticeZ:i=>Sb(i.w,i.h,i.d),edgeCorner:i=>Eb(i.w,i.h,i.d),edgeSlope:i=>Fb(i.w,i.h,i.d),edgeSlopeZ:i=>Ab(i.w,i.h,i.d),moldingCorner:i=>Tb(i.w,i.h,i.d),trim:i=>Cb(i.w,i.h,i.d),trimZ:i=>kb(i.w,i.h,i.d),trimCorner:i=>Bb(i.w,i.h,i.d),pipeX:i=>Oc(i.w,i.h,i.d,"X"),pipeY:i=>Oc(i.w,i.h,i.d,"Y"),pipeZ:i=>Oc(i.w,i.h,i.d,"Z"),pipeElbowXZ:i=>Sn(i.w,i.h,i.d,"XZ",0),pipeElbowXZ2:i=>Sn(i.w,i.h,i.d,"XZ",1),pipeElbowXZ3:i=>Sn(i.w,i.h,i.d,"XZ",2),pipeElbowXZ4:i=>Sn(i.w,i.h,i.d,"XZ",3),pipeElbowXY:i=>Sn(i.w,i.h,i.d,"XY",0),pipeElbowXY2:i=>Sn(i.w,i.h,i.d,"XY",1),pipeElbowYZ:i=>Sn(i.w,i.h,i.d,"YZ",0),pipeElbowYZ2:i=>Sn(i.w,i.h,i.d,"YZ",1),pipeCross:i=>Pb(i.w,i.h,i.d),pipeT:i=>Vc(i.w,i.h,i.d),pipeTY:i=>Vc(i.w,i.h,i.d),pipeTZ:i=>Vc(i.w,i.h,i.d),prism:i=>Ov(i.w,i.h,i.d),lShape:i=>Yv(i.w,i.h,i.d),tShape:i=>$v(i.w,i.h,i.d),cShape:i=>qv(i.w,i.h,i.d),ledge:i=>jv(i.w,i.h*.25,i.d),gutter:i=>Kv(i.w,i.h*.25,i.d),capital:i=>Jv(i.w,i.h*.25,i.d),base:i=>Qv(i.w,i.h*.25,i.d),windowFrame:i=>t_(i.w,i.h,i.d),doorFrame:i=>e_(i.w,i.h,i.d),cornice:i=>Rb(i.w,i.h,i.d),column:i=>Db(i.w,i.h,i.d),baluster:i=>Ib(i.w,i.h,i.d),windowSill:i=>Lb(i.w,i.h,i.d),shingle:i=>Ub(i.w,i.h,i.d),chimney:i=>Nb(i.w,i.h,i.d),buttress:i=>Ob(i.w,i.h,i.d),bench:i=>Vb(i.w,i.h,i.d),table:i=>Hb(i.w,i.h,i.d),chair:i=>Gb(i.w,i.h,i.d),barrel:i=>Xb(i.w,i.h,i.d),planter:i=>tv(i.w,i.h,i.d),ladder:i=>ev(i.w,i.h,i.d),crate:i=>Wb(i.w,i.h,i.d),crateOpen:i=>Zb(i.w,i.h,i.d),crateLarge:i=>Yb(i.w,i.h,i.d),pallet:i=>$b(i.w,i.h,i.d),shelfUnit:i=>qb(i.w,i.h,i.d),locker:i=>jb(i.w,i.h,i.d),cabinet:i=>Kb(i.w,i.h,i.d),cardboardBox:i=>Jb(i.w,i.h,i.d),sack:i=>Qb(i.w,i.h,i.d),tank:i=>ov(i.w,i.h,i.d),valve:i=>nv(i.w,i.h,i.d),vent:i=>iv(i.w,i.h,i.d),iBeam:i=>sv(i.w,i.h,i.d),catwalk:i=>rv(i.w,i.h,i.d),transformer:i=>av(i.w,i.h,i.d),powerBox:i=>lv(i.w,i.h,i.d),conduit:i=>cv(i.w,i.h,i.d),conduitCorner:i=>pv(i.w,i.h,i.d),outlet:i=>hv(i.w,i.h,i.d),switchBox:i=>uv(i.w,i.h,i.d),fuseBox:i=>dv(i.w,i.h,i.d),cable:i=>fv(i.w,i.h,i.d),lightFixture:i=>_v(i.w,i.h,i.d),cableHanging:i=>wv(i.w,i.h,i.d),cableDroop:i=>Mv(i.w,i.h,i.d),cableLoop:i=>zv(i.w,i.h,i.d),cableX:i=>mv(i.w,i.h,i.d),cableY:i=>yv(i.w,i.h,i.d),cableZ:i=>gv(i.w,i.h,i.d),cableElbow:i=>xv(i.w,i.h,i.d),cableElbowY:i=>bv(i.w,i.h,i.d),cableT:i=>vv(i.w,i.h,i.d),rock:i=>Sv(i.w,i.h,i.d),bush:i=>Ev(i.w,i.h,i.d),logX:i=>i0(i.w,i.h,i.d,"X"),logZ:i=>i0(i.w,i.h,i.d,"Z"),acUnit:i=>Fv(i.w,i.h,i.d),solarPanel:i=>Av(i.w,i.h,i.d),antenna:i=>Tv(i.w,i.h,i.d),barrier:i=>Cv(i.w,i.h,i.d),quarterPipe:i=>kv(i.w,i.h,i.d),bowl:i=>Bv(i.w,i.h,i.d),hexagon:i=>Pv(i.w,i.h,i.d),roundedCube:i=>Rv(i.w,i.h,i.d),chamfer:i=>Dv(i.w,i.h,i.d),merlon:i=>Iv(i.w,i.h,i.d),arrowSlit:i=>Lv(i.w,i.h,i.d),torch:i=>Uv(i.w,i.h,i.d),chain:i=>Nv(i.w,i.h,i.d),rampCurved:i=>a0(i.w,i.h,i.d),rampCurvedLow:i=>a0(i.w,i.h/2,i.d),rampCurvedCorner:i=>o_(i.w,i.h,i.d),roofPeak:i=>l0(i.w,i.h,i.d),roofPeakLow:i=>l0(i.w,i.h/2,i.d),roofHip:i=>n_(i.w,i.h,i.d),slabSlope:i=>Xo(i.w,i.h/4,i.d,1),slabSlopeTop:i=>ti(i.w,i.h/4,i.d,1),channel:i=>i_(i.w,i.h/2,i.d),channelCorner:i=>s_(i.w,i.h/2,i.d),channelEnd:i=>r_(i.w,i.h/2,i.d),cubeBevel:i=>a_(i.w,i.h,i.d),step:i=>new I(i.w,i.h*.25,i.d),platform:i=>new I(i.w,i.h*.125,i.d),post:i=>new I(i.w*.25,i.h,i.d*.25),bollard:i=>new zt(i.w*.2,i.w*.25,i.h*.75,8),crossBeam:i=>l_(i.w,i.h,i.d),truss:i=>c_(i.w,i.h,i.d),parapet:i=>new I(i.w,i.h*.5,i.d*.25),crenellation:i=>p_(i.w,i.h,i.d),trianglePrism:i=>ta(i.w,i.h,i.d),triangleRight:i=>h_(i.w,i.h,i.d),triangleEqui:i=>u_(i.w,i.h,i.d),tetrahedron:i=>new Ec(Math.min(i.w,i.h,i.d)*.6),pentahedron:i=>d_(i.w,i.h,i.d),stairsSingle:i=>new I(i.w,i.h*.25,i.d*.5),landing:i=>new I(i.w,i.h*.25,i.d),spiralStep:i=>f_(i.w,i.h,i.d),torus:i=>new vo(Math.min(i.w,i.d)*.35,Math.min(i.w,i.d)*.1,8,16),capsule:i=>new Or(Math.min(i.w,i.d)*.3,i.h*.5,4,8),hemisphere:i=>m_(i.w,i.h,i.d),egg:i=>y_(i.w,i.h,i.d),gothicArch:i=>g_(i.w,i.h,i.d),flatArch:i=>x_(i.w,i.h,i.d),keystone:i=>b_(i.w,i.h,i.d),downspout:i=>new zt(i.w*.15,i.w*.15,i.h,8),star:i=>v_(i.w,i.h,i.d),heart:i=>__(i.w,i.h,i.d),diamond:i=>new co(Math.min(i.w,i.h,i.d)*.5),cornerTrim:i=>w_(i.w,i.h,i.d),edgeTrim:i=>new I(i.w,i.h*.25,i.d*.125),moldingX:i=>h0(i.w,i.h*.125,i.d*.125),moldingZ:i=>h0(i.d,i.h*.125,i.w*.125),bracket:i=>M_(i.w,i.h,i.d),finial:i=>z_(i.w,i.h,i.d),pediment:i=>S_(i.w,i.h,i.d),dentil:i=>new I(i.w*.2,i.h*.25,i.d*.5),awning:i=>E_(i.w,i.h,i.d),canopy:i=>new I(i.w,i.h*.125,i.d),pergola:i=>F_(i.w,i.h,i.d),tarp:i=>new Ni(i.w,i.d),umbrella:i=>A_(i.w,i.h,i.d),stool:i=>T_(i.w,i.h,i.d),shelf:i=>new I(i.w,i.h*.125,i.d*.8),bed:i=>C_(i.w,i.h,i.d),desk:i=>k_(i.w,i.h,i.d),bin:i=>B_(i.w,i.h,i.d),dumpster:i=>P_(i.w,i.h,i.d),grateFloor:i=>R_(i.w,i.h,i.d),ductX:i=>new I(i.w,i.h*.5,i.d*.5),ductZ:i=>new I(i.w*.5,i.h*.5,i.d),ductCorner:i=>D_(i.w,i.h,i.d),hopper:i=>I_(i.w,i.h,i.d),conveyor:i=>L_(i.w,i.h,i.d),spotlight:i=>U_(i.w,i.h,i.d),bulb:i=>new xe(Math.min(i.w,i.d)*.3,8,6),stump:i=>new zt(i.w*.35,i.w*.4,i.h*.5,8),boulder:i=>N_(i.w,i.h,i.d),grass:i=>O_(i.w,i.h,i.d),flower:i=>V_(i.w,i.h,i.d),rockSmall:i=>dw(i.w,i.h,i.d),rockLarge:i=>fw(i.w,i.h,i.d),rockFlat:i=>mw(i.w,i.h,i.d),rockTall:i=>yw(i.w,i.h,i.d),rockJagged:i=>gw(i.w,i.h,i.d),rockCluster:i=>xw(i.w,i.h,i.d),rockPile:i=>bw(i.w,i.h,i.d),pebbles:i=>vw(i.w,i.h,i.d),slate:i=>_w(i.w,i.h,i.d),crystalSmall:i=>ww(i.w,i.h,i.d),crystalLarge:i=>Mw(i.w,i.h,i.d),crystalCluster:i=>zw(i.w,i.h,i.d),crystalSpike:i=>Sw(i.w,i.h,i.d),crystalFlat:i=>Ew(i.w,i.h,i.d),crystalShard:i=>Fw(i.w,i.h,i.d),crystalFormation:i=>Aw(i.w,i.h,i.d),stalactite:i=>Tw(i.w,i.h,i.d),stalagmite:i=>Cw(i.w,i.h,i.d),mushroom:i=>kw(i.w,i.h,i.d),mushroomCluster:i=>Bw(i.w,i.h,i.d),moss:i=>Pw(i.w,i.h,i.d),vine:i=>Rw(i.w,i.h,i.d),coral:i=>Dw(i.w,i.h,i.d),trafficCone:i=>new He(i.w*.3,i.h*.75,8),sign:i=>H_(i.w,i.h,i.d),monitor:i=>G_(i.w,i.h,i.d),speaker:i=>X_(i.w,i.h,i.d),gem:i=>W_(i.w,i.h,i.d),crystal:i=>Z_(i.w,i.h,i.d),pill:i=>new Or(Math.min(i.w,i.d)*.25,i.h*.25,4,8),rampStraight:i=>Xo(i.w,i.h,i.d,1),rampWide:i=>Xo(i.w*2,i.h,i.d,1),roofCorner:i=>Y_(i.w,i.h,i.d),roofValley:i=>$_(i.w,i.h,i.d),gable:i=>q_(i.w,i.h,i.d),drain:i=>j_(i.w,i.h,i.d),grate:i=>K_(i.w,i.h,i.d),shield:i=>J_(i.w,i.h,i.d),banner:i=>Q_(i.w,i.h,i.d),portcullis:i=>tw(i.w,i.h,i.d),wheel:i=>new vo(Math.min(i.w,i.d)*.4,Math.min(i.w,i.d)*.1,8,16),axle:i=>new zt(i.w*.05,i.w*.05,i.d,8),seat:i=>ew(i.w,i.h,i.d),hull:i=>ow(i.w,i.h,i.d),propeller:i=>nw(i.w,i.h,i.d),wing:i=>iw(i.w,i.h,i.d),derrickLeg:i=>sw(i.w,i.h,i.d),derrickCross:i=>rw(i.w,i.h,i.d),derrickPlatform:i=>aw(i.w,i.h,i.d),pumpJack:i=>lw(i.w,i.h,i.d),pumpBase:i=>new I(i.w*.8,i.h*.25,i.d*.6),oilTank:i=>cw(i.w,i.h,i.d),oilTankSmall:i=>pw(i.w,i.h,i.d),wellHead:i=>hw(i.w,i.h,i.d),pipelineX:i=>new zt(i.h*.3,i.h*.3,i.w,12).rotateZ(Math.PI/2),pipelineZ:i=>new zt(i.h*.3,i.h*.3,i.d,12).rotateX(Math.PI/2),oilBarrel:i=>uw(i.w,i.h,i.d)};function Xo(i,t,e,o=1){const n=i/2,s=t/2,r=e/2,a=new Float32Array([n,-s,r,n,-s,-r,n,s,-r,-n,-s,-r,-n,-s,r,-n,s,-r,0,s,0,0,s,0,0,s,0,-n,-s,-r,n,-s,-r,n,-s,r,-n,-s,-r,n,-s,r,-n,-s,r,-n,-s,r,n,-s,r,n,s,-r,-n,-s,r,n,s,-r,-n,s,-r,-n,-s,-r,-n,s,-r,n,-s,-r,n,-s,-r,-n,s,-r,n,s,-r]),l=new Xt;return l.setAttribute("position",new Gt(a,3)),l.addGroup(0,3,0),l.addGroup(3,3,1),l.addGroup(6,3,2),l.addGroup(9,6,3),l.addGroup(15,6,4),l.addGroup(21,6,5),l.computeVertexNormals(),l}function ti(i,t,e,o=1){const n=i/2,s=t/2,r=e/2,a=new Float32Array([n,s,r,n,-s,r,n,s,-r,-n,s,-r,-n,s,r,-n,-s,r,-n,s,-r,n,s,r,n,s,-r,-n,s,-r,-n,s,r,n,s,r,0,-s,0,0,-s,0,0,-s,0,-n,-s,r,n,-s,r,n,s,r,-n,-s,r,n,s,r,-n,s,r,-n,s,-r,-n,-s,r,n,-s,r,-n,s,-r,n,-s,r,n,s,-r]),l=new Xt;return l.setAttribute("position",new Gt(a,3)),l.addGroup(0,3,0),l.addGroup(3,3,1),l.addGroup(6,6,2),l.addGroup(12,3,3),l.addGroup(15,6,4),l.addGroup(21,6,5),l.computeVertexNormals(),l}function Lc(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([o,-n,-s,o,n,-s,o,-n,s,0,0,0,0,0,0,0,0,0,0,n,0,0,n,0,0,n,0,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,-s,-o,-n,s,o,n,-s,-o,-n,s,o,-n,s,o,n,-s,-o,-n,-s,o,n,-s,o,-n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.addGroup(0,3,0),a.addGroup(3,3,1),a.addGroup(6,3,2),a.addGroup(9,6,3),a.addGroup(15,6,4),a.addGroup(21,3,5),a.computeVertexNormals(),a}function Uc(i,t,e,o){const n=t/o,s=e/o,r=[];for(let l=0;l<o;l++){const c=n*(l+1),p=new I(i,c,s),h=c/2-t/2,u=e/2-s/2-l*s;p.translate(0,h,u),r.push(p)}const a=vt(r);return r.forEach(l=>l.dispose()),a}function Ht(i){if(!i||i.length===0)return new I(1,1,1);try{const t=i.map(o=>{if(!o)return new I(.1,.1,.1).toNonIndexed();let n=o.index?o.toNonIndexed():o.clone();if(!n.attributes.uv){const s=n.attributes.position.count,r=new Float32Array(s*2);n.setAttribute("uv",new Gt(r,2))}return n}),e=vt(t);return t.forEach(o=>o.dispose()),e||(console.warn("mergeGeometries returned null, using fallback"),new I(1,1,1))}catch(t){return console.warn("safeMergeGeometries error:",t),new I(1,1,1)}}function Nc(i,t,e,o=1){const n=i*.15,s=i/2,r=s*o,a=Math.min(r,t*.8),l=t-a,c=i-n*2,p=c/2,h=Math.max(0,a-n),u=new Zi,d=12;u.moveTo(-i/2,-t/2),u.lineTo(-i/2,-t/2+l);for(let f=0;f<=d;f++){const m=Math.PI-f/d*Math.PI,b=Math.cos(m)*s,v=-t/2+l+Math.sin(m)*a;u.lineTo(b,v)}if(u.lineTo(i/2,-t/2),u.lineTo(-i/2,-t/2),c>0&&h>0){const f=new Wi;f.moveTo(-p,-t/2),f.lineTo(-p,-t/2+l);for(let m=0;m<=d;m++){const b=Math.PI-m/d*Math.PI,v=Math.cos(b)*p,x=-t/2+l+Math.sin(b)*h;f.lineTo(v,x)}f.lineTo(p,-t/2),f.lineTo(-p,-t/2),u.holes.push(f)}const y={steps:1,depth:e,bevelEnabled:!1},g=new jn(u,y);return g.translate(0,0,-e/2),g}function tb(i,t,e){const o=i/3,n=[],s=new I(i,t,o);n.push(s);const r=new I(o,t,e);n.push(r);const a=vt(n);return n.forEach(l=>l.dispose()),a}function eb(i,t,e){const o=Math.min(i,e)/8,n=[],s=new I(i,o,e);s.translate(0,(t-o)/2,0),n.push(s);const r=new I(i,o,e);r.translate(0,-(t-o)/2,0),n.push(r);const a=new I(o,t-o*2,e);a.translate(-(i-o)/2,0,0),n.push(a);const l=new I(o,t-o*2,e);l.translate((i-o)/2,0,0),n.push(l);const c=vt(n);return n.forEach(p=>p.dispose()),c}function ob(i,t,e){const o=i/16,n=i/4,s=[],r=new I(i,t/8,e/4);r.translate(0,t*.375,0),s.push(r);const a=new I(i,t/8,e/4);a.translate(0,-t*.125,0),s.push(a);const l=Math.floor(i/n)+1;for(let p=0;p<l;p++){const h=-i/2+o/2+p*n;if(h>i/2-o/2)break;const u=new I(o,t,e/4);u.translate(h,0,0),s.push(u)}const c=vt(s);return s.forEach(p=>p.dispose()),c}function nb(i,t,e){const o=e/16,n=e/4,s=[],r=new I(i/4,t/8,e);r.translate(0,t*.375,0),s.push(r);const a=new I(i/4,t/8,e);a.translate(0,-t*.125,0),s.push(a);const l=Math.floor(e/n)+1;for(let p=0;p<l;p++){const h=-e/2+o/2+p*n;if(h>e/2-o/2)break;const u=new I(i/4,t,o);u.translate(0,0,h),s.push(u)}const c=vt(s);return s.forEach(p=>p.dispose()),c}function ib(i,t,e){const o=[],n=i/10,s=new I(i,t/6,e/4);s.translate(0,t*.4,0),o.push(s);const r=new I(n,t,n);r.translate(-i/2+n/2,0,0),o.push(r);const a=new I(n,t,n);a.translate(i/2-n/2,0,0),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function sb(i,t,e){const o=[],n=e/10,s=new I(i/4,t/6,e);s.translate(0,t*.4,0),o.push(s);const r=new I(n,t,n);r.translate(0,0,-e/2+n/2),o.push(r);const a=new I(n,t,n);a.translate(0,0,e/2-n/2),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function rb(i,t,e){const o=Math.min(i,e)/16,n=[],s=new I(i/2,t/8,e/4);s.translate(i/4,t*.375,0),n.push(s);const r=new I(i/4,t/8,e/2);r.translate(0,t*.375,e/4),n.push(r);const a=new I(o*2,t,o*2);return n.push(a),Ht(n)}function ab(i,t,e){const o=Math.min(i,e)/16,n=[],s=new I(i/2,t/8,e/4);s.translate(-i/4,t*.375,0),n.push(s);const r=new I(i/4,t/8,e/2);r.translate(0,t*.375,-e/4),n.push(r);const a=new I(o*2,t,o*2);return n.push(a),Ht(n)}function lb(i,t,e){const o=Math.min(i,e)/4;return new I(o,t,o)}function cb(i,t,e){const o=i/16,n=[],s=new I(i/2,t/8,e/4);s.translate(-i/4,t*.375,0),n.push(s);const r=new I(o*2,t,o*2);return n.push(r),Ht(n)}function pb(i,t,e){const o=Math.min(i,e)/16,n=[],s=new I(i,t/8,e/4);s.translate(0,t*.375,0),n.push(s);const r=new I(i/4,t/8,e/2);r.translate(0,t*.375,e/4),n.push(r);const a=new I(o*2,t,o*2);return n.push(a),Ht(n)}function hb(i,t,e){const o=Math.min(i,e)/16,n=[],s=new I(i,t/8,e/4);s.translate(0,t*.375,0),n.push(s);const r=new I(i/4,t/8,e);r.translate(0,t*.375,0),n.push(r);const a=new I(o*2,t,o*2);return n.push(a),Ht(n)}function ub(i,t,e){const o=i/10,n=[];return n.push(new I(o,t,e/4).translate(-i/2+o/2,0,0)),n.push(new I(o,t,e/4).translate(i/2-o/2,0,0)),n.push(new I(i-o*2,o,e/4).translate(0,t/2-o/2,0)),n.push(new I(i-o*2,o,e/4).translate(0,-t/2+o/2,0)),n.push(new I(i-o*2,o/2,e/8).translate(0,0,0)),Ht(n)}function db(i,t,e){const o=i/10,n=[];return n.push(new I(o,t,e/4).translate(-i/2+o/2,0,0)),n.push(new I(i-o,t,e/4).translate(-i/2+o+(i-o)/2,0,-e/2+e/8)),Ht(n)}function fb(i,t,e){const o=i/12,n=[];return n.push(new I(o,t,e/4).translate(-i/2+o/2,0,0)),n.push(new I(o,t,e/4).translate(i/2-o/2,0,0)),n.push(new I(o/2,t,e/4).translate(0,0,0)),n.push(new I(i,o,e/4).translate(0,t/2-o/2,0)),Ht(n)}function mb(i,t,e){const o=i/10,n=[];n.push(new I(o,t*.7,e/4).translate(-i/2+o/2,-t*.15,0)),n.push(new I(o,t*.7,e/4).translate(i/2-o/2,-t*.15,0));const s=new vo((i-o)/2,o/2,4,8,Math.PI);return s.rotateX(Math.PI/2),s.translate(0,t*.2,0),n.push(s),Ht(n)}function yb(i,t,e){const o=Math.min(i,e)/10,n=[];return n.push(new I(i/2,t/6,e/4).translate(i/4,t*.4,0)),n.push(new I(i/4,t/6,e/2).translate(0,t*.4,e/4)),n.push(new I(o,t,o)),Ht(n)}function gb(i,t,e){const o=Math.min(i,e)/10,n=[];return n.push(new I(i/2,t/6,e/4).translate(-i/4,t*.4,0)),n.push(new I(i/4,t/6,e/2).translate(0,t*.4,-e/4)),n.push(new I(o,t,o)),Ht(n)}function xb(i,t,e){const o=Math.min(i,e)/6,n=[];return n.push(new I(o,t,o)),n.push(new I(o*1.5,t/10,o*1.5).translate(0,t/2+t/20,0)),Ht(n)}function bb(i,t,e){const o=i/10,n=[];return n.push(new I(i/2,t/6,e/4).translate(-i/4,t*.4,0)),n.push(new I(o,t,o)),Ht(n)}function vb(i,t,e){const o=i/10,n=[],s=new I(i*1.1,t/6,e/4);return s.rotateZ(Math.atan2(t*.3,i)),n.push(s),n.push(new I(o,t*.7,o).translate(-i/2+o/2,-t*.15,0)),n.push(new I(o,t,o).translate(i/2-o/2,0,0)),Ht(n)}function _b(i,t,e){const o=e/10,n=[],s=new I(i/4,t/6,e*1.1);return s.rotateX(-Math.atan2(t*.3,e)),n.push(s),n.push(new I(o,t*.7,o).translate(0,-t*.15,-e/2+o/2)),n.push(new I(o,t,o).translate(0,0,e/2-o/2)),Ht(n)}function wb(i,t,e){const o=i/8,n=i/4,s=[],r=Math.floor(i/n)+1;for(let a=0;a<r;a++){const l=-i/2+o/2+a*n;if(l>i/2-o/2)break;const c=new I(o,t*.9,e/4);c.translate(l,-t*.05,0),s.push(c);const p=new He(o/2,t*.15,4);p.translate(l,t*.425,0),s.push(p)}return Ht(s)}function Mb(i,t,e){const o=e/8,n=e/4,s=[],r=Math.floor(e/n)+1;for(let a=0;a<r;a++){const l=-e/2+o/2+a*n;if(l>e/2-o/2)break;const c=new I(i/4,t*.9,o);c.translate(0,-t*.05,l),s.push(c);const p=new He(o/2,t*.15,4);p.translate(0,t*.425,l),s.push(p)}return Ht(s)}function zb(i,t,e){const o=i/20,n=i/6,s=[];for(let r=-2;r<=2;r++){const a=new I(o,t*1.4,e/8);a.rotateZ(Math.PI/4),a.translate(r*n*.7,0,0),s.push(a)}for(let r=-2;r<=2;r++){const a=new I(o,t*1.4,e/8);a.rotateZ(-Math.PI/4),a.translate(r*n*.7,0,0),s.push(a)}return s.push(new I(i,o*2,e/8).translate(0,t/2-o,0)),s.push(new I(i,o*2,e/8).translate(0,-t/2+o,0)),Ht(s)}function Sb(i,t,e){const o=e/20,n=e/6,s=[];for(let r=-2;r<=2;r++){const a=new I(i/8,t*1.4,o);a.rotateX(Math.PI/4),a.translate(0,0,r*n*.7),s.push(a)}for(let r=-2;r<=2;r++){const a=new I(i/8,t*1.4,o);a.rotateX(-Math.PI/4),a.translate(0,0,r*n*.7),s.push(a)}return s.push(new I(i/8,o*2,e).translate(0,t/2-o,0)),s.push(new I(i/8,o*2,e).translate(0,-t/2+o,0)),Ht(s)}function Eb(i,t,e){const o=Math.min(i,e)/4,n=[];return n.push(new I(i/2,t*.25,o).translate(i/4,0,-e/2+o/2)),n.push(new I(o,t*.25,e/2).translate(-i/2+o/2,0,e/4)),Ht(n)}function Fb(i,t,e){const o=new Zi;o.moveTo(-i/2,0),o.lineTo(i/2,t*.25),o.lineTo(i/2,0),o.lineTo(-i/2,0);const n={steps:1,depth:e/4,bevelEnabled:!1},s=new jn(o,n);return s.translate(0,-t*.125,-e/8),s}function Ab(i,t,e){const o=new Zi;o.moveTo(-e/2,0),o.lineTo(e/2,t*.25),o.lineTo(e/2,0),o.lineTo(-e/2,0);const n={steps:1,depth:i/4,bevelEnabled:!1},s=new jn(o,n);return s.rotateY(Math.PI/2),s.translate(-i/8,-t*.125,0),s}function Tb(i,t,e){const o=Math.min(i,e)/4,n=[];return n.push(new I(i/2,t*.125,o/2).translate(i/4,0,-e/2+o/4)),n.push(new I(o/2,t*.125,e/2).translate(-i/2+o/4,0,e/4)),Ht(n)}function Cb(i,t,e){return new I(i,t*.125,e/8)}function kb(i,t,e){return new I(i/8,t*.125,e)}function Bb(i,t,e){const o=[];return o.push(new I(i/2,t*.125,e/8).translate(i/4,0,-e/2+e/16)),o.push(new I(i/8,t*.125,e/2).translate(-i/2+i/16,0,e/4)),Ht(o)}function Oc(i,t,e,o){const n=Math.min(i,t,e)/4,s=8;switch(o){case"X":return new zt(n,n,i,s).rotateZ(Math.PI/2);case"Y":return new zt(n,n,t,s);case"Z":return new zt(n,n,e,s).rotateX(Math.PI/2);default:return new zt(n,n,t,s)}}function Sn(i,t,e,o,n){const s=Math.min(i,t,e),r=s/4,a=s/2,l=12,c=8,p=new vo(a,r,c,l,Math.PI/2);if(o==="XZ"){p.rotateX(Math.PI/2);const h=[Math.PI,-Math.PI/2,0,Math.PI/2];p.rotateY(h[n]||0)}else o==="XY"?n===1&&p.rotateY(Math.PI):o==="YZ"&&(p.rotateY(Math.PI/2),n===1&&p.rotateY(Math.PI));return p}function Pb(i,t,e){const o=Math.min(i,t,e)/4,n=8,s=[],r=new zt(o,o,i,n);r.rotateZ(Math.PI/2),s.push(r);const a=new zt(o,o,e,n);a.rotateX(Math.PI/2),s.push(a);const l=vt(s);return s.forEach(c=>c.dispose()),l}function Vc(i,t,e){const o=Math.min(i,t,e)/4,n=8,s=[],r=new zt(o,o,i,n);r.rotateZ(Math.PI/2),s.push(r);const a=new zt(o,o,e/2,n);a.rotateX(Math.PI/2),a.translate(0,0,e/4),s.push(a);const l=vt(s);return s.forEach(c=>c.dispose()),l}function Rb(i,t,e){const o=[],n=new I(i,t*.5,e*.6);n.translate(0,t*.25,e*.2),o.push(n);const s=new I(i,t*.3,e*.3);s.translate(0,t*.1,-e*.35),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function Db(i,t,e){const o=[],n=Math.min(i,e)/3,s=new zt(n*1.2,n*1.3,t*.1,12);s.translate(0,-t*.45,0),o.push(s);const r=new zt(n,n,t*.75,12);o.push(r);const a=new zt(n*1.3,n*1.1,t*.15,12);a.translate(0,t*.425,0),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function Ib(i,t,e){const o=[],n=Math.min(i,e)/4,s=new zt(n*1.5,n*1.5,t*.1,8);s.translate(0,-t*.45,0),o.push(s);const r=new xe(n*1.3,8,6);r.translate(0,-t*.25,0),o.push(r);const a=new zt(n*.6,n*.6,t*.5,8);o.push(a);const l=new xe(n*1.1,8,6);l.translate(0,t*.25,0),o.push(l);const c=new zt(n*1.5,n*1.5,t*.1,8);c.translate(0,t*.45,0),o.push(c);const p=vt(o);return o.forEach(h=>h.dispose()),p}function Lb(i,t,e){const o=new I(i*1.1,t,e*.4);return o.translate(0,0,-e*.3),o}function Ub(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,n,-s,-o,-n,-s,o,n,-s,-o,n,-s,-o,-n,s,o,-n,s,o,-n,-s,-o,-n,s,o,-n,-s,-o,-n,-s,-o,n,-s,o,n,-s,o,-n,s,-o,n,-s,o,-n,s,-o,-n,s,-o,-n,s,-o,-n,-s,-o,n,-s,o,-n,-s,o,-n,s,o,n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function Nb(i,t,e){const o=[],n=new I(i*.7,t*.9,e*.7);n.translate(0,-t*.05,0),o.push(n);const s=new I(i*.9,t*.1,e*.9);s.translate(0,t*.45,0),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function Ob(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,-s,-o,n,-s,o,n,-s,-o,-n,-s,o,n,-s,o,-n,-s,-o,-n,s,o,-n,s,o,n,-s,-o,-n,s,o,n,-s,-o,n,-s,-o,-n,-s,-o,-n,s,-o,n,-s,o,-n,s,o,-n,-s,o,n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function Vb(i,t,e){const o=[],n=new I(i,t*.2,e);n.translate(0,t*.4,0),o.push(n);const s=i*.1,r=t*.8,a=new I(s,r,e*.8);a.translate(-i*.4,-t*.1,0),o.push(a);const l=new I(s,r,e*.8);l.translate(i*.4,-t*.1,0),o.push(l);const c=vt(o);return o.forEach(p=>p.dispose()),c}function Hb(i,t,e){const o=[],n=new I(i,t*.1,e);n.translate(0,t*.45,0),o.push(n);const s=Math.min(i,e)*.1,r=t*.9;[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([c,p])=>{const h=new I(s,r,s);h.translate(c*(i*.4),-t*.05,p*(e*.4)),o.push(h)});const l=vt(o);return o.forEach(c=>c.dispose()),l}function Gb(i,t,e){const o=[],n=new I(i*.9,t*.1,e*.9);n.translate(0,-t*.1,0),o.push(n);const s=new I(i*.9,t*.5,e*.1);s.translate(0,t*.2,-e*.4),o.push(s);const r=i*.08,a=t*.4;[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([p,h])=>{const u=new I(r,a,r);u.translate(p*(i*.35),-t*.35,h*(e*.35)),o.push(u)});const c=vt(o);return o.forEach(p=>p.dispose()),c}function Xb(i,t,e){const o=Math.min(i,e)/2.2;return new zt(o*.85,o*.85,t,12)}function Wb(i,t,e){const o=[],n=new I(i*.95,t*.95,e*.95);o.push(n);const s=new I(i,t*.08,e*.08);s.translate(0,t*.3,e*.45),o.push(s);const r=s.clone();r.translate(0,-t*.3,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function Zb(i,t,e){const o=[],s=new I(i*.9,t*.06,e*.9);s.translate(0,-t*.45,0),o.push(s);const r=new I(i*.9,t*.9,.06*i);r.translate(0,0,e*.4),o.push(r);const a=r.clone();a.translate(0,0,-e*.8),o.push(a);const l=new I(.06*i,t*.9,e*.9);l.translate(-i*.4,0,0),o.push(l);const c=l.clone();c.translate(i*.8,0,0),o.push(c);const p=vt(o);return o.forEach(h=>h.dispose()),p}function Yb(i,t,e){const o=[],n=new I(i,t,e);o.push(n);const s=.15;[[-1,-1,-1],[1,-1,-1],[-1,-1,1],[1,-1,1],[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]].forEach(([l,c,p])=>{const h=new I(i*s,t*s,e*s);h.translate(l*i*.45,c*t*.45,p*e*.45),o.push(h)});const a=vt(o);return o.forEach(l=>l.dispose()),a}function $b(i,t,e){const o=[],n=t*.3,s=i*.15;for(let a=-1;a<=1;a++){const l=new I(i*.28,n,e);l.translate(a*s*2,t*.35,0),o.push(l)}for(let a=-1;a<=1;a++){const l=new I(i*.15,t*.5,e*.15);l.translate(a*i*.35,-t*.1,0),o.push(l)}const r=vt(o);return o.forEach(a=>a.dispose()),r}function qb(i,t,e){const o=[];for(let p=0;p<4;p++){const h=new I(i*.95,t*.05,e*.9);h.translate(0,-t*.4+p*t*.3,0),o.push(h)}const s=new I(i*.05,t,e*.1);s.translate(-i*.45,0,e*.4),o.push(s);const r=s.clone();r.translate(i*.9,0,0),o.push(r);const a=s.clone();a.translate(0,0,-e*.8),o.push(a);const l=a.clone();l.translate(i*.9,0,0),o.push(l);const c=vt(o);return o.forEach(p=>p.dispose()),c}function jb(i,t,e){const o=[],n=new I(i*.95,t,e*.95);o.push(n);const s=new I(i*.02,t*.9,e*.85);s.translate(i*.48,0,0),o.push(s);const r=new I(i*.05,t*.15,e*.05);r.translate(i*.5,t*.1,e*.3),o.push(r);for(let l=-1;l<=1;l++){const c=new I(i*.03,t*.05,e*.4);c.translate(i*.5,t*.35+l*t*.08,0),o.push(c)}const a=vt(o);return o.forEach(l=>l.dispose()),a}function Kb(i,t,e){const o=[],n=new I(i,t,e);o.push(n);const s=i*.48,r=new I(i*.02,t*.95,s);r.translate(i*.5,0,e*.2),o.push(r);const a=r.clone();a.translate(0,0,-e*.4),o.push(a);const l=new I(i*.05,t*.1,e*.03);l.translate(i*.52,0,e*.05),o.push(l);const c=l.clone();c.translate(0,0,-e*.1),o.push(c);const p=vt(o);return o.forEach(h=>h.dispose()),p}function Jb(i,t,e){const o=[],n=new I(i*.95,t*.85,e*.95);n.translate(0,-t*.075,0),o.push(n);const s=new I(i*.9,t*.02,e*.35);s.translate(0,t*.35,e*.25),o.push(s);const r=s.clone();r.translate(0,0,-e*.5),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function Qb(i,t,e){const o=Math.min(i,e)/2,n=new xe(o,8,6,0,Math.PI*2,0,Math.PI*.6);return n.scale(1,t/o*.7,1),n.translate(0,-t*.15,0),n}function tv(i,t,e){return new I(i,t,e)}function ev(i,t,e){const o=[],n=i*.1,s=new I(n,t,e*.1);s.translate(-i*.35,0,0),o.push(s);const r=new I(n,t,e*.1);r.translate(i*.35,0,0),o.push(r);const a=5;for(let c=0;c<a;c++){const p=new I(i*.6,t*.06,e*.08);p.translate(0,-t*.4+c*t*.2,0),o.push(p)}const l=vt(o);return o.forEach(c=>c.dispose()),l}function ov(i,t,e){const o=Math.min(i,e)/2.5;return new zt(o,o,t*.9,16)}function nv(i,t,e){const o=[],n=Math.min(i,e)/3,s=new vo(n,n*.15,8,16);s.rotateX(Math.PI/2),o.push(s);for(let l=0;l<4;l++){const c=new I(n*2,n*.12,n*.12);c.rotateY(l*Math.PI/4),o.push(c)}const r=new zt(n*.2,n*.2,t*.5,8);r.translate(0,-t*.25,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function iv(i,t,e){const o=[],n=new I(i,t,e*.1);o.push(n);const s=5;for(let a=0;a<s;a++){const l=new I(i*.9,t*.08,e*.3);l.rotateX(Math.PI*.15),l.translate(0,-t*.35+a*t*.18,e*.1),o.push(l)}const r=vt(o);return o.forEach(a=>a.dispose()),r}function sv(i,t,e){const o=[],n=t*.15,s=i*.3,r=new I(i,n,e);r.translate(0,t*.425,0),o.push(r);const a=new I(i,n,e);a.translate(0,-t*.425,0),o.push(a);const l=new I(s,t*.7,e);o.push(l);const c=vt(o);return o.forEach(p=>p.dispose()),c}function rv(i,t,e){const o=[],n=new I(i,t*.1,e);n.translate(0,t*.45,0),o.push(n);const s=new I(i,t*.15,e*.1);s.translate(0,t*.35,-e*.35),o.push(s);const r=new I(i,t*.15,e*.1);r.translate(0,t*.35,e*.35),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function av(i,t,e){const o=[],n=new I(i*.8,t*.7,e*.8);n.translate(0,-t*.15,0),o.push(n);for(let r=-1;r<=1;r+=2){const a=new zt(i*.08,i*.1,t*.3,8);a.translate(r*i*.25,t*.3,0),o.push(a)}for(let r=-2;r<=2;r++){const a=new I(i*.05,t*.5,e*.9);a.translate(i*.45,-t*.15,r*e*.15),o.push(a)}const s=vt(o);return o.forEach(r=>r.dispose()),s}function lv(i,t,e){const o=[],n=new I(i*.9,t,e*.5);o.push(n);const s=new I(i*.02,t*.85,e*.4);s.translate(i*.45,0,0),o.push(s);const r=new I(i*.03,t*.3,e*.3);r.translate(i*.47,t*.2,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function cv(i,t,e){const o=Math.min(i,e)*.15,n=new zt(o,o,i,8);return n.rotateZ(Math.PI/2),n}function pv(i,t,e){const o=[],n=Math.min(i,e)*.15,s=new zt(n,n,i*.4,8);s.rotateZ(Math.PI/2),s.translate(-i*.3,0,0),o.push(s);const r=new zt(n,n,t*.4,8);r.translate(0,t*.2,0),o.push(r);const a=new xe(n*1.2,8,8);o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function hv(i,t,e){const o=[],n=new I(i*.6,t,e*.1);o.push(n);for(let r=-1;r<=1;r+=2){const a=new I(i*.08,t*.15,e*.05);a.translate(r*i*.12,t*.15,e*.05),o.push(a);const l=a.clone();l.translate(0,-t*.3,0),o.push(l)}const s=vt(o);return o.forEach(r=>r.dispose()),s}function uv(i,t,e){const o=[],n=new I(i*.7,t,e*.4);o.push(n);const s=new I(i*.15,t*.4,e*.1);s.translate(0,t*.1,e*.25),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function dv(i,t,e){const o=[],n=new I(i*.9,t,e*.5);o.push(n);const s=new I(i*.02,t*.9,e*.45);s.translate(i*.46,0,0),o.push(s);for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++){const c=new I(i*.15,t*.12,e*.08);c.translate(l*i*.2,a*t*.2,e*.22),o.push(c)}const r=vt(o);return o.forEach(a=>a.dispose()),r}function fv(i,t,e){const o=Math.min(i,e)*.08,n=new zt(o,o,i,6);return n.rotateZ(Math.PI/2),n}function mv(i,t,e){const o=Math.min(i,e)*.06,n=new zt(o,o,i,6);return n.rotateZ(Math.PI/2),n}function yv(i,t,e){const o=Math.min(i,e)*.06;return new zt(o,o,t,6)}function gv(i,t,e){const o=Math.min(i,e)*.06,n=new zt(o,o,e,6);return n.rotateX(Math.PI/2),n}function xv(i,t,e){const o=Math.min(i,t,e),n=o*.06,s=o/2,r=new vo(s,n,6,12,Math.PI/2);return r.rotateX(Math.PI/2),r}function bv(i,t,e){const o=Math.min(i,t,e),n=o*.06,s=o/2;return new vo(s,n,6,12,Math.PI/2)}function vv(i,t,e){const o=Math.min(i,e)*.06,n=[],s=new zt(o,o,i,6);s.rotateZ(Math.PI/2),n.push(s);const r=new zt(o,o,e/2,6);r.rotateX(Math.PI/2),r.translate(0,0,e/4),n.push(r);const a=vt(n);return n.forEach(l=>l.dispose()),a}function _v(i,t,e){const o=[],n=new I(i*.3,t*.3,e*.3);n.translate(0,t*.35,0),o.push(n);const s=new zt(i*.35,i*.25,t*.5,8);s.translate(0,0,0),o.push(s);const r=new zt(i*.3,i*.3,t*.1,8);r.translate(0,-t*.3,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function wv(i,t,e){const o=Math.min(i,e)*.05,n=t*.4;class s extends bo{getPoint(c){const p=(c-.5)*e,h=n*(Math.pow(2*c-1,2)-1);return new R(0,h,p)}}const r=new s;return new Rs(r,16,o,6,!1)}function Mv(i,t,e){const o=Math.min(i,e)*.05;class n extends bo{getPoint(l){const c=t*.5-l*t,p=Math.sin(l*Math.PI)*e*.1;return new R(0,c,p)}}const s=new n;return new Rs(s,12,o,6,!1)}function zv(i,t,e){const o=Math.min(i,e)*.04,n=Math.min(i,e)*.15,s=4;class r extends bo{getPoint(p){const h=p*Math.PI*2*s,u=Math.cos(h)*n,d=Math.sin(h)*n,y=t*.4-p*t*.8;return new R(u,y,d)}}const a=new r;return new Rs(a,32,o,6,!1)}function Sv(i,t,e){const o=i*.4,n=t*.35,s=e*.4,r=new Float32Array([0,n,0,-o*.3,n*.7,-s*.4,o*.4,n*.6,-s*.2,0,n,0,o*.4,n*.6,-s*.2,o*.5,n*.5,s*.3,0,n,0,o*.5,n*.5,s*.3,-o*.2,n*.65,s*.5,0,n,0,-o*.2,n*.65,s*.5,-o*.6,n*.4,0,0,n,0,-o*.6,n*.4,0,-o*.3,n*.7,-s*.4,-o*.3,n*.7,-s*.4,-o*.8,-n*.2,-s*.6,o*.4,n*.6,-s*.2,o*.4,n*.6,-s*.2,-o*.8,-n*.2,-s*.6,o*.9,-n*.1,-s*.5,o*.4,n*.6,-s*.2,o*.9,-n*.1,-s*.5,o*.5,n*.5,s*.3,o*.5,n*.5,s*.3,o*.9,-n*.1,-s*.5,o*.85,-n*.15,s*.7,o*.5,n*.5,s*.3,o*.85,-n*.15,s*.7,-o*.2,n*.65,s*.5,-o*.2,n*.65,s*.5,o*.85,-n*.15,s*.7,-o*.5,-n*.1,s*.8,-o*.2,n*.65,s*.5,-o*.5,-n*.1,s*.8,-o*.6,n*.4,0,-o*.6,n*.4,0,-o*.5,-n*.1,s*.8,-o*.95,-n*.2,s*.2,-o*.6,n*.4,0,-o*.95,-n*.2,s*.2,-o*.3,n*.7,-s*.4,-o*.3,n*.7,-s*.4,-o*.95,-n*.2,s*.2,-o*.8,-n*.2,-s*.6,-o*.8,-n*.2,-s*.6,-o*.6,-n,-s*.4,o*.9,-n*.1,-s*.5,o*.9,-n*.1,-s*.5,-o*.6,-n,-s*.4,o*.7,-n,-s*.3,o*.9,-n*.1,-s*.5,o*.7,-n,-s*.3,o*.85,-n*.15,s*.7,o*.85,-n*.15,s*.7,o*.7,-n,-s*.3,o*.6,-n,s*.5,o*.85,-n*.15,s*.7,o*.6,-n,s*.5,-o*.5,-n*.1,s*.8,-o*.5,-n*.1,s*.8,o*.6,-n,s*.5,-o*.4,-n,s*.6,-o*.5,-n*.1,s*.8,-o*.4,-n,s*.6,-o*.95,-n*.2,s*.2,-o*.95,-n*.2,s*.2,-o*.4,-n,s*.6,-o*.7,-n,0,-o*.95,-n*.2,s*.2,-o*.7,-n,0,-o*.8,-n*.2,-s*.6,-o*.8,-n*.2,-s*.6,-o*.7,-n,0,-o*.6,-n,-s*.4,-o*.6,-n,-s*.4,-o*.7,-n,0,0,-n,0,-o*.7,-n,0,-o*.4,-n,s*.6,0,-n,0,-o*.4,-n,s*.6,o*.6,-n,s*.5,0,-n,0,o*.6,-n,s*.5,o*.7,-n,-s*.3,0,-n,0,o*.7,-n,-s*.3,-o*.6,-n,-s*.4,0,-n,0]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function Ev(i,t,e){const o=[],n=Math.min(i,e)/3;[[0,0,0],[-n*.5,-n*.3,0],[n*.5,-n*.3,0],[0,-n*.3,-n*.5],[0,-n*.3,n*.5]].forEach(([a,l,c],p)=>{const h=new xe(n*(.8+p*.05),8,6);h.translate(a,l,c),o.push(h)});const r=vt(o);return o.forEach(a=>a.dispose()),r}function i0(i,t,e,o){const n=Math.min(t,o==="X"?e:i)/3,s=o==="X"?i:e,r=new zt(n,n*.9,s,8);return o==="X"?r.rotateZ(Math.PI/2):r.rotateX(Math.PI/2),r}function Fv(i,t,e){const o=[],n=new I(i*.95,t*.9,e*.95);o.push(n);for(let r=0;r<4;r++){const a=new I(i*.8,t*.05,e*.02);a.translate(0,t*.2-r*t*.15,e*.48),o.push(a)}const s=vt(o);return o.forEach(r=>r.dispose()),s}function Av(i,t,e){const o=[],n=new I(i,t*.1,e);o.push(n);const s=new I(i*.95,t*.05,e*.95);s.translate(0,t*.1,0),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function Tv(i,t,e){const o=[],n=Math.min(i,e)/10,s=new zt(n,n,t*.9,6);o.push(s);const r=new zt(n*.5,n*.5,i*.8,4);r.rotateZ(Math.PI/2),r.translate(0,t*.3,0),o.push(r);const a=new zt(n*.5,n*.5,i*.5,4);a.rotateZ(Math.PI/2),a.translate(0,t*.1,0),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function Cv(i,t,e){const o=[],n=new I(i,t*.6,e*.5);n.translate(0,-t*.1,0),o.push(n);const s=new I(i,t*.15,e*.55);s.translate(0,t*.25,0),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function kv(i,t,e){const n=[],s=[];for(let a=0;a<=12;a++){const l=a/12*Math.PI/2,c=Math.cos(l)*i/2,p=Math.sin(l)*t-t/2;n.push(c,p,e/2),n.push(c,p,-e/2)}for(let a=0;a<12;a++){const l=a*2,c=a*2+1,p=a*2+2,h=a*2+3;s.push(l,p,c,c,p,h)}const r=new Xt;return r.setAttribute("position",new Yt(n,3)),r.setIndex(s),r.computeVertexNormals(),r}function Bv(i,t,e){const o=new xe(Math.min(i,e)/2.2,16,8,0,Math.PI*2,0,Math.PI/2);return o.rotateX(Math.PI),o.translate(0,t*.25,0),o}function Pv(i,t,e){const o=Math.min(i,e)/2;return new zt(o,o,t,6)}function Rv(i,t,e){return new I(i*.9,t*.9,e*.9,2,2,2)}function Dv(i,t,e){const o=i/2,n=t/2,s=e/2,r=Math.min(i,e)*.3,a=new Float32Array([-o,-n,-s,o,-n,-s,o,n,-s,-o,-n,-s,o,n,-s,-o,n,-s,-o,-n,-s,o,-n,-s,o,-n,s-r,-o,-n,-s,o,-n,s-r,-o,-n,s-r,-o,-n,s-r,o,-n,s-r,o-r,-n,s,-o,-n,s-r,o-r,-n,s,-o,-n,s,-o,n,-s,o,n,-s,o,n,s-r,-o,n,-s,o,n,s-r,-o,n,s-r,-o,n,s-r,o,n,s-r,o-r,n,s,-o,n,s-r,o-r,n,s,-o,n,s,o,-n,s-r,o,n,s-r,o-r,n,s,o,-n,s-r,o-r,n,s,o-r,-n,s,-o,-n,s,o-r,-n,s,o-r,n,s,-o,-n,s,o-r,n,s,-o,n,s,o,-n,-s,o,n,-s,o,n,s-r,o,-n,-s,o,n,s-r,o,-n,s-r,-o,-n,s,-o,n,s,-o,n,-s,-o,-n,s,-o,n,-s,-o,-n,-s]),l=new Xt;return l.setAttribute("position",new Gt(a,3)),l.computeVertexNormals(),l}function Iv(i,t,e){return new I(i*.8,t,e*.8)}function Lv(i,t,e){const o=[],n=new I(i*.4,t,e);n.translate(-i*.3,0,0),o.push(n);const s=new I(i*.4,t,e);s.translate(i*.3,0,0),o.push(s);const r=new I(i*.2,t*.3,e);r.translate(0,t*.35,0),o.push(r);const a=new I(i*.2,t*.3,e);a.translate(0,-t*.35,0),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function Uv(i,t,e){const o=[],n=Math.min(i,e)/6,s=new I(i*.3,t*.1,e*.5);s.translate(0,-t*.1,-e*.25),o.push(s);const r=new zt(n,n*.8,t*.5,6);o.push(r);const a=new zt(n*1.5,n,t*.15,6);a.translate(0,t*.3,0),o.push(a);const l=vt(o);return o.forEach(c=>c.dispose()),l}function Nv(i,t,e){const o=[],n=Math.min(i,e)/4,s=4;for(let a=0;a<s;a++){const l=new vo(n,n*.3,6,8);l.rotateX(a%2===0?0:Math.PI/2),l.translate(0,t*.4-a*(t/s),0),o.push(l)}const r=vt(o);return o.forEach(a=>a.dispose()),r}function Ov(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,0,-n,s,-o,-n,-s,0,-n,s,0,n,0,-o,-n,-s,0,n,0,-o,n,-s,o,-n,-s,0,n,0,0,-n,s,o,-n,-s,o,n,-s,0,n,0,-o,-n,-s,-o,n,-s,o,n,-s,-o,-n,-s,o,n,-s,o,-n,-s,-o,n,-s,0,n,0,o,n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function Vv(i,t,e){const o=new I(i*Math.SQRT2,t,e);return o.rotateY(Math.PI/4),o}function s0(i,t,e,o=!1){const n=e/4,s=[];if(o){const a=new I(i,t,n);a.translate(0,0,-e/2+n/2),s.push(a);const l=new I(n,t,e-n);l.translate(-i/2+n/2,0,n/2),s.push(l)}else{const a=new I(i,t,n);a.translate(0,0,e/2-n/2),s.push(a);const l=new I(n,t,e-n);l.translate(i/2-n/2,0,-n/2),s.push(l)}const r=vt(s);return s.forEach(a=>a.dispose()),r}function Hv(i,t,e){const o=t/2,n=Math.min(i,e)/4,s=new Float32Array([n,-o,-n,n,o,-n,-n,o,n,n,-o,-n,-n,o,n,-n,-o,n,-n,-o,-n,-n,-o,n,-n,o,n,-n,-o,-n,-n,o,n,-n,o,-n,-n,o,-n,-n,o,n,n,o,-n,-n,-o,-n,n,-o,-n,-n,-o,n,0,0,n,0,0,n,0,0,n,-n,-o,-n,-n,o,-n,n,o,-n,-n,-o,-n,n,o,-n,n,-o,-n]),r=new Xt;return r.setAttribute("position",new Gt(s,3)),r.addGroup(0,6,0),r.addGroup(6,6,1),r.addGroup(12,3,2),r.addGroup(15,3,3),r.addGroup(18,3,4),r.addGroup(21,6,5),r.computeVertexNormals(),r}function Gv(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([o,-n,-s,o,n,-s,o,-n,s,-o,-n,-s,-o,-n,s,-o,n,-s,0,n,0,0,n,0,0,n,0,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,n,-s,-o,-n,s,o,-n,s,-o,n,-s,o,-n,s,o,n,-s,-o,-n,-s,-o,n,-s,o,n,-s,-o,-n,-s,o,n,-s,o,-n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.addGroup(0,3,0),a.addGroup(3,3,1),a.addGroup(6,3,2),a.addGroup(9,6,3),a.addGroup(15,6,4),a.addGroup(21,6,5),a.computeVertexNormals(),a}function r0(i,t,e,o=!1){const s=t/4,r=[];for(let l=0;l<4;l++){const c=s*(l+1),p=(4-l)/4;if(o){const h=new I(i*p,c,e*p);h.translate(i*(1-p)/2,c/2-t/2,e*(1-p)/2),r.push(h)}else{const h=new I(i*p,c,e*p);h.translate(-i*(1-p)/2,c/2-t/2,-e*(1-p)/2),r.push(h)}}const a=vt(r);return r.forEach(l=>l.dispose()),a}function Xv(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,o,-n,s,0,n,0,o,-n,-s,-o,-n,-s,0,n,0,-o,-n,-s,-o,-n,s,0,n,0,o,-n,s,o,-n,-s,0,n,0]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function Wv(i,t,e){const o=Math.min(i,e)/2,n=o*.7,s=new Zi;s.absarc(0,0,o,0,Math.PI*2,!1);const r=new Wi;r.absarc(0,0,n,0,Math.PI*2,!0),s.holes.push(r);const a={steps:1,depth:t,bevelEnabled:!1},l=new jn(s,a);return l.rotateX(-Math.PI/2),l.translate(0,-t/2,0),l}function Zv(i,t,e){const o=i*.2,n=10,s=new Zi;s.moveTo(-i/2,-t/2),s.lineTo(-i/2,t/2),s.lineTo(i/2,t/2),s.lineTo(i/2,-t/2),s.lineTo(-i/2,-t/2);const r=new Wi,a=-i/2+o,l=t/2-o,c=i/2-o,p=-t/2,h=Math.min(i-o*2,t-o)*.8;r.moveTo(a,p),r.lineTo(a,l-h);for(let d=0;d<=n;d++){const y=Math.PI-d/n*(Math.PI/2),g=a+h+Math.cos(y)*h,f=l-h+Math.sin(y)*h;r.lineTo(g,f)}r.lineTo(c,l),r.lineTo(c,p),r.lineTo(a,p),s.holes.push(r);const u=new jn(s,{steps:1,depth:e,bevelEnabled:!1});return u.translate(0,0,-e/2),u}function Yv(i,t,e){const o=i/3,n=[],s=new I(i,t,o);s.translate(0,0,e/2-o/2),n.push(s);const r=new I(o,t,e-o);r.translate(-i/2+o/2,0,-o/2),n.push(r);const a=vt(n);return n.forEach(l=>l.dispose()),a}function $v(i,t,e){const o=i/3,n=[],s=new I(i,t,o);s.translate(0,0,e/2-o/2),n.push(s);const r=new I(o,t,e-o);r.translate(0,0,-o/2),n.push(r);const a=vt(n);return n.forEach(l=>l.dispose()),a}function qv(i,t,e){const o=i/4,n=[],s=new I(i,t,o);s.translate(0,0,-e/2+o/2),n.push(s);const r=new I(o,t,e-o);r.translate(-i/2+o/2,0,o/2),n.push(r);const a=new I(o,t,e-o);a.translate(i/2-o/2,0,o/2),n.push(a);const l=vt(n);return n.forEach(c=>c.dispose()),l}function jv(i,t,e){const o=[],n=new I(i,t/2,e*.3);n.translate(0,t/4,e*.35),o.push(n);const s=new I(i,t,e*.4);s.translate(0,0,-e*.3),o.push(s);const r=vt(o);return o.forEach(a=>a.dispose()),r}function Kv(i,t,e){const o=e/6,n=[],s=new I(i,t/2,e);s.translate(0,-t/4,0),n.push(s);const r=new I(i,t,o);r.translate(0,0,e/2-o/2),n.push(r);const a=new I(i,t,o);a.translate(0,0,-e/2+o/2),n.push(a);const l=vt(n);return n.forEach(c=>c.dispose()),l}function Jv(i,t,e){const o=[],n=new I(i,t/3,e);n.translate(0,t/3,0),o.push(n);const s=new I(i*.85,t/3,e*.85);s.translate(0,0,0),o.push(s);const r=new I(i*.7,t/3,e*.7);r.translate(0,-t/3,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function Qv(i,t,e){const o=[],n=new I(i,t/3,e);n.translate(0,-t/3,0),o.push(n);const s=new I(i*.85,t/3,e*.85);s.translate(0,0,0),o.push(s);const r=new I(i*.7,t/3,e*.7);r.translate(0,t/3,0),o.push(r);const a=vt(o);return o.forEach(l=>l.dispose()),a}function t_(i,t,e){const o=i/8,n=[],s=new I(i,o,e);s.translate(0,t/2-o/2,0),n.push(s);const r=new I(i,o*1.5,e);r.translate(0,-t/2+o*.75,0),n.push(r);const a=new I(o,t-o*2.5,e);a.translate(-i/2+o/2,o*.25,0),n.push(a);const l=new I(o,t-o*2.5,e);l.translate(i/2-o/2,o*.25,0),n.push(l);const c=vt(n);return n.forEach(p=>p.dispose()),c}function e_(i,t,e){const o=i/8,n=[],s=new I(i,o,e);s.translate(0,t/2-o/2,0),n.push(s);const r=new I(o,t-o,e);r.translate(-i/2+o/2,-o/2,0),n.push(r);const a=new I(o,t-o,e);a.translate(i/2-o/2,-o/2,0),n.push(a);const l=vt(n);return n.forEach(c=>c.dispose()),l}function a0(i,t,e){const n=[];for(let r=0;r<8;r++){const a=r/8*Math.PI/2,l=(r+1)/8*Math.PI/2,c=-t/2+t*Math.sin(a),p=e/2-e*(1-Math.cos(a)),h=-t/2+t*Math.sin(l),u=e/2-e*(1-Math.cos(l));n.push(-i/2,c,p,-i/2,h,u,i/2,h,u,-i/2,c,p,i/2,h,u,i/2,c,p)}n.push(-i/2,-t/2,-e/2,i/2,-t/2,-e/2,i/2,-t/2,e/2,-i/2,-t/2,-e/2,i/2,-t/2,e/2,-i/2,-t/2,e/2),n.push(-i/2,-t/2,-e/2,-i/2,t/2,-e/2,i/2,t/2,-e/2,-i/2,-t/2,-e/2,i/2,t/2,-e/2,i/2,-t/2,-e/2);for(let r=0;r<8;r++){const a=r/8*Math.PI/2,l=(r+1)/8*Math.PI/2,c=-t/2+t*Math.sin(a),p=e/2-e*(1-Math.cos(a)),h=-t/2+t*Math.sin(l),u=e/2-e*(1-Math.cos(l));n.push(-i/2,-t/2,-e/2,-i/2,c,p,-i/2,h,u)}n.push(-i/2,-t/2,-e/2,-i/2,t/2,-e/2,-i/2,-t/2+t*Math.sin(Math.PI/2*7/8),e/2-e*(1-Math.cos(Math.PI/2*7/8)));for(let r=0;r<8;r++){const a=r/8*Math.PI/2,l=(r+1)/8*Math.PI/2,c=-t/2+t*Math.sin(a),p=e/2-e*(1-Math.cos(a)),h=-t/2+t*Math.sin(l),u=e/2-e*(1-Math.cos(l));n.push(i/2,h,u,i/2,c,p,i/2,-t/2,-e/2)}n.push(i/2,-t/2+t*Math.sin(Math.PI/2*7/8),e/2-e*(1-Math.cos(Math.PI/2*7/8)),i/2,t/2,-e/2,i/2,-t/2,-e/2);const s=new Xt;return s.setAttribute("position",new Gt(new Float32Array(n),3)),s.computeVertexNormals(),s}function o_(i,t,e){const n=[];for(let r=0;r<8;r++){const a=r/8*Math.PI/2,l=(r+1)/8*Math.PI/2,c=-t/2+t*Math.sin(a),p=1-Math.cos(a),h=-t/2+t*Math.sin(l),u=1-Math.cos(l);for(let d=0;d<8;d++){const y=d/8*Math.PI/2,g=(d+1)/8*Math.PI/2,f=i/2-i*p*Math.cos(y),m=e/2-e*p*Math.sin(y),b=i/2-i*p*Math.cos(g),v=e/2-e*p*Math.sin(g),x=i/2-i*u*Math.cos(y),_=e/2-e*u*Math.sin(y),z=i/2-i*u*Math.cos(g),E=e/2-e*u*Math.sin(g);n.push(f,c,m,x,h,_,z,h,E,f,c,m,z,h,E,b,c,v)}}n.push(-i/2,-t/2,-e/2,i/2,-t/2,-e/2,i/2,-t/2,e/2,-i/2,-t/2,-e/2,i/2,-t/2,e/2,-i/2,-t/2,e/2);const s=new Xt;return s.setAttribute("position",new Gt(new Float32Array(n),3)),s.computeVertexNormals(),s}function l0(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,-s,0,n,-s,0,n,s,-o,-n,-s,0,n,s,-o,-n,s,o,-n,s,0,n,s,0,n,-s,o,-n,s,0,n,-s,o,-n,-s,-o,-n,s,0,n,s,o,-n,s,o,-n,-s,0,n,-s,-o,-n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function n_(i,t,e){const o=i/2,n=t/2,s=e/2,r=Math.min(i,e)/4,a=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,-o+r,n,s-r,o-r,n,s-r,-o,-n,s,o-r,n,s-r,o,-n,s,o,-n,-s,o-r,n,-s+r,-o+r,n,-s+r,o,-n,-s,-o+r,n,-s+r,-o,-n,-s,-o,-n,-s,-o+r,n,-s+r,-o+r,n,s-r,-o,-n,-s,-o+r,n,s-r,-o,-n,s,o,-n,s,o-r,n,s-r,o-r,n,-s+r,o,-n,s,o-r,n,-s+r,o,-n,-s,-o+r,n,-s+r,o-r,n,-s+r,o-r,n,s-r,-o+r,n,-s+r,o-r,n,s-r,-o+r,n,s-r]),l=new Xt;return l.setAttribute("position",new Gt(a,3)),l.computeVertexNormals(),l}function i_(i,t,e){const o=i/8,n=[],s=new I(i,o,e);s.translate(0,-t/2+o/2,0),n.push(s);const r=new I(o,t,e);r.translate(-i/2+o/2,0,0),n.push(r);const a=new I(o,t,e);a.translate(i/2-o/2,0,0),n.push(a);const l=vt(n);return n.forEach(c=>c.dispose()),l}function s_(i,t,e){const o=Math.min(i,e)/8,n=[],s=new I(i,o,o*2);s.translate(0,-t/2+o/2,e/2-o),n.push(s);const r=new I(o*2,o,e-o*2);r.translate(-i/2+o,-t/2+o/2,-o),n.push(r);const a=new I(i,t,o);a.translate(0,0,e/2-o/2),n.push(a);const l=new I(o,t,e-o);l.translate(-i/2+o/2,0,-o/2),n.push(l);const c=new I(o,t,o);c.translate(i/2-o/2,0,-e/2+o/2),n.push(c);const p=vt(n);return n.forEach(h=>h.dispose()),p}function r_(i,t,e){const o=i/8,n=[],s=new I(i,o,e);s.translate(0,-t/2+o/2,0),n.push(s);const r=new I(o,t,e);r.translate(-i/2+o/2,0,0),n.push(r);const a=new I(o,t,e);a.translate(i/2-o/2,0,0),n.push(a);const l=new I(i-o*2,t,o);l.translate(0,0,-e/2+o/2),n.push(l);const c=vt(n);return n.forEach(p=>p.dispose()),c}function a_(i,t,e){const o=Math.min(i,t,e)/8,n=i/2,s=t/2,r=e/2,a=[];a.push(-n+o,s,-r+o,n-o,s,-r+o,n-o,s,r-o,-n+o,s,-r+o,n-o,s,r-o,-n+o,s,r-o),a.push(-n+o,-s,r-o,n-o,-s,r-o,n-o,-s,-r+o,-n+o,-s,r-o,n-o,-s,-r+o,-n+o,-s,-r+o),a.push(-n+o,-s+o,r,n-o,-s+o,r,n-o,s-o,r,-n+o,-s+o,r,n-o,s-o,r,-n+o,s-o,r),a.push(n-o,-s+o,-r,-n+o,-s+o,-r,-n+o,s-o,-r,n-o,-s+o,-r,-n+o,s-o,-r,n-o,s-o,-r),a.push(-n,-s+o,-r+o,-n,-s+o,r-o,-n,s-o,r-o,-n,-s+o,-r+o,-n,s-o,r-o,-n,s-o,-r+o),a.push(n,-s+o,r-o,n,-s+o,-r+o,n,s-o,-r+o,n,-s+o,r-o,n,s-o,-r+o,n,s-o,r-o),a.push(-n+o,s,r-o,n-o,s,r-o,n-o,s-o,r,-n+o,s,r-o,n-o,s-o,r,-n+o,s-o,r),a.push(n-o,s,-r+o,-n+o,s,-r+o,-n+o,s-o,-r,n-o,s,-r+o,-n+o,s-o,-r,n-o,s-o,-r),a.push(-n+o,s,-r+o,-n+o,s,r-o,-n,s-o,r-o,-n+o,s,-r+o,-n,s-o,r-o,-n,s-o,-r+o),a.push(n-o,s,r-o,n-o,s,-r+o,n,s-o,-r+o,n-o,s,r-o,n,s-o,-r+o,n,s-o,r-o),a.push(-n+o,-s+o,r,n-o,-s+o,r,n-o,-s,r-o,-n+o,-s+o,r,n-o,-s,r-o,-n+o,-s,r-o),a.push(n-o,-s+o,-r,-n+o,-s+o,-r,-n+o,-s,-r+o,n-o,-s+o,-r,-n+o,-s,-r+o,n-o,-s,-r+o),a.push(-n,-s+o,r-o,-n,-s+o,-r+o,-n+o,-s,-r+o,-n,-s+o,r-o,-n+o,-s,-r+o,-n+o,-s,r-o),a.push(n,-s+o,-r+o,n,-s+o,r-o,n-o,-s,r-o,n,-s+o,-r+o,n-o,-s,r-o,n-o,-s,-r+o),a.push(-n+o,-s+o,r,-n,-s+o,r-o,-n,s-o,r-o,-n+o,-s+o,r,-n,s-o,r-o,-n+o,s-o,r),a.push(n,-s+o,r-o,n-o,-s+o,r,n-o,s-o,r,n,-s+o,r-o,n-o,s-o,r,n,s-o,r-o),a.push(-n,-s+o,-r+o,-n+o,-s+o,-r,-n+o,s-o,-r,-n,-s+o,-r+o,-n+o,s-o,-r,-n,s-o,-r+o),a.push(n-o,-s+o,-r,n,-s+o,-r+o,n,s-o,-r+o,n-o,-s+o,-r,n,s-o,-r+o,n-o,s-o,-r);const l=new Xt;return l.setAttribute("position",new Gt(new Float32Array(a),3)),l.computeVertexNormals(),l}function c0(i,t={w:1,h:1,d:1}){const e=t.w,o=t.h,n=t.d,s=Jn[i]||1,r=Qn[i]||0,a=o*s;let l={min:{x:0,y:r,z:0},max:{x:e,y:r+a,z:n}};switch(i){case"pillar":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"pillar2":l.min.x=e*.375,l.max.x=e*.625,l.min.z=n*.375,l.max.z=n*.625;break;case"pillar4":l.min.x=e*.4375,l.max.x=e*.5625,l.min.z=n*.4375,l.max.z=n*.5625;break;case"beamX":l.min.z=n*.25,l.max.z=n*.75;break;case"beam2X":l.min.z=n*.375,l.max.z=n*.625;break;case"beam4X":l.min.z=n*.4375,l.max.z=n*.5625;break;case"beamZ":l.min.x=e*.25,l.max.x=e*.75;break;case"beam2Z":l.min.x=e*.375,l.max.x=e*.625;break;case"beam4Z":l.min.x=e*.4375,l.max.x=e*.5625;break;case"beamXLow":l.min.z=n*.25,l.max.z=n*.75;break;case"beam2XLow":l.min.z=n*.375,l.max.z=n*.625;break;case"beamZLow":l.min.x=e*.25,l.max.x=e*.75;break;case"beam2ZLow":l.min.x=e*.375,l.max.x=e*.625;break;case"wall":l.min.z=n*.25,l.max.z=n*.75;break;case"wall4":l.min.z=n*.375,l.max.z=n*.625;break;case"wall8":l.min.z=n*.4375,l.max.z=n*.5625;break;case"panel":l.min.z=n*.46875,l.max.z=n*.53125;break;case"wallFront":l.min.z=n*.75,l.max.z=n;break;case"wallBack":l.min.z=0,l.max.z=n*.25;break;case"cylinder":case"cylinderHalf":const c=(1-Math.SQRT1_2)/2;l.min.x=e*c,l.max.x=e*(1-c),l.min.z=n*c,l.max.z=n*(1-c);break;case"quarter":case"quarterTall":l.max.x=e*.5,l.max.z=n*.5;break;case"cone":case"sphere":case"dome":const p=(1-Math.SQRT1_2)/2;l.min.x=e*p,l.max.x=e*(1-p),l.min.z=n*p,l.max.z=n*(1-p);break;case"arch":case"archLow":case"archWide":break;case"cross":break;case"frame":break;case"fence":l.min.z=n*.375,l.max.z=n*.625;break;case"fenceZ":l.min.x=e*.375,l.max.x=e*.625;break;case"railing":l.min.z=n*.375,l.max.z=n*.625;break;case"railingZ":l.min.x=e*.375,l.max.x=e*.625;break;case"pipeX":l.min.y=o*.25,l.max.y=o*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"pipeY":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"pipeZ":l.min.x=e*.25,l.max.x=e*.75,l.min.y=o*.25,l.max.y=o*.75;break;case"pipeElbow":case"pipeElbow2":case"pipeElbow3":case"pipeElbow4":case"pipeCross":case"pipeT":case"pipeTY":l.min.y=o*.25,l.max.y=o*.75;break;case"prism":break;case"halfX":l.max.x=e*.5;break;case"halfZ":l.max.z=n*.5;break;case"halfCorner":l.max.x=e*.5,l.max.z=n*.5;break;case"pillarRound":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"pillarRound2":l.min.x=e*.375,l.max.x=e*.625,l.min.z=n*.375,l.max.z=n*.625;break;case"beamDiag":break;case"wallCorner":case"wallCornerInner":break;case"wedgeInner":break;case"stairsCorner":case"stairsCornerInner":break;case"pyramid":break;case"octagon":const h=(1-Math.SQRT1_2)/2;l.min.x=e*h,l.max.x=e*(1-h),l.min.z=n*h,l.max.z=n*(1-h);break;case"tube":const u=(1-Math.SQRT1_2)/2;l.min.x=e*u,l.max.x=e*(1-u),l.min.z=n*u,l.max.z=n*(1-u);break;case"archHalf":break;case"lShape":case"tShape":case"cShape":break;case"ledge":case"gutter":case"capital":case"base":break;case"windowFrame":case"doorFrame":break;case"cornice":l.max.y=o*.25,l.max.z=n*.5;break;case"column":l.min.x=e*.15,l.max.x=e*.85,l.min.z=n*.15,l.max.z=n*.85;break;case"baluster":l.min.x=e*.35,l.max.x=e*.65,l.min.z=n*.35,l.max.z=n*.65;break;case"windowSill":l.max.y=o*.25;break;case"shingle":l.max.y=o*.25;break;case"chimney":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"buttress":break;case"bench":l.max.y=o*.5;break;case"table":break;case"chair":l.max.z=n*.6;break;case"barrel":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"crate":break;case"planter":break;case"ladder":l.min.z=n*.35,l.max.z=n*.65;break;case"tank":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"valve":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"vent":l.max.y=o*.25;break;case"iBeam":l.min.z=n*.35,l.max.z=n*.65;break;case"catwalk":l.max.y=o*.125;break;case"rock":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9,l.max.y=o*.7;break;case"bush":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"logX":l.min.y=0,l.max.y=o*.5,l.min.z=n*.15,l.max.z=n*.85;break;case"logZ":l.min.y=0,l.max.y=o*.5,l.min.x=e*.15,l.max.x=e*.85;break;case"acUnit":break;case"solarPanel":l.max.y=o*.15;break;case"antenna":l.min.x=e*.4,l.max.x=e*.6,l.min.z=n*.4,l.max.z=n*.6;break;case"barrier":l.max.y=o*.5;break;case"quarterPipe":break;case"bowl":break;case"hexagon":l.min.x=e*.07,l.max.x=e*.93,l.min.z=n*.07,l.max.z=n*.93;break;case"roundedCube":break;case"chamfer":break;case"merlon":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"arrowSlit":l.max.z=n*.25;break;case"torch":l.min.x=e*.35,l.max.x=e*.65,l.min.z=n*.35,l.max.z=n*.65;break;case"chain":l.min.x=e*.4,l.max.x=e*.6,l.min.z=n*.4,l.max.z=n*.6;break;case"post":l.min.x=e*.375,l.max.x=e*.625,l.min.z=n*.375,l.max.z=n*.625;break;case"bollard":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75,l.max.y=o*.75;break;case"conduit":l.min.y=o*.35,l.max.y=o*.65,l.min.z=n*.35,l.max.z=n*.65;break;case"conduitCorner":l.min.x=e*.3,l.max.x=e*.7,l.min.z=n*.3,l.max.z=n*.7;break;case"cable":case"cableX":l.min.y=o*.44,l.max.y=o*.56,l.min.z=n*.44,l.max.z=n*.56;break;case"cableY":l.min.x=e*.44,l.max.x=e*.56,l.min.z=n*.44,l.max.z=n*.56;break;case"cableZ":l.min.x=e*.44,l.max.x=e*.56,l.min.y=o*.44,l.max.y=o*.56;break;case"cableElbow":case"cableElbowY":case"cableT":l.min.x=e*.3,l.max.x=e*.7,l.min.y=o*.4,l.max.y=o*.6,l.min.z=n*.3,l.max.z=n*.7;break;case"cableHanging":case"cableDroop":case"cableLoop":l.min.x=e*.35,l.max.x=e*.65,l.min.z=n*.35,l.max.z=n*.65;break;case"crossBeam":l.min.y=o*.375,l.max.y=o*.625;break;case"truss":l.min.z=n*.4,l.max.z=n*.6;break;case"parapet":l.max.y=o*.5,l.min.z=n*.375,l.max.z=n*.625;break;case"crenellation":l.min.z=n*.25,l.max.z=n*.75;break;case"trianglePrism":case"triangleRight":case"triangleEqui":case"pentahedron":break;case"tetrahedron":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"stairsSingle":l.max.y=o*.25,l.min.z=n*.25,l.max.z=n*.75;break;case"landing":l.max.y=o*.25;break;case"spiralStep":l.max.y=o*.25;break;case"step":l.max.y=o*.25;break;case"platform":l.max.y=o*.125;break;case"torus":l.min.x=e*.15,l.max.x=e*.85,l.min.y=o*.4,l.max.y=o*.6,l.min.z=n*.15,l.max.z=n*.85;break;case"capsule":case"pill":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"hemisphere":const d=(1-Math.SQRT1_2)/2;l.min.x=e*d,l.max.x=e*(1-d),l.min.z=n*d,l.max.z=n*(1-d),l.max.y=o*.5;break;case"egg":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"gothicArch":case"flatArch":break;case"keystone":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"downspout":l.min.x=e*.35,l.max.x=e*.65,l.min.z=n*.35,l.max.z=n*.65;break;case"star":case"heart":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"diamond":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"gem":case"crystal":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"cornerTrim":l.max.x=e*.5,l.max.z=n*.5;break;case"edgeTrim":l.max.y=o*.25,l.min.z=n*.4375,l.max.z=n*.5625;break;case"moldingX":l.min.y=o*.4375,l.max.y=o*.5625,l.min.z=n*.4375,l.max.z=n*.5625;break;case"moldingZ":l.min.x=e*.4375,l.max.x=e*.5625,l.min.y=o*.4375,l.max.y=o*.5625;break;case"bracket":l.max.x=e*.5,l.max.z=n*.5;break;case"finial":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"pediment":l.max.y=o*.5;break;case"dentil":l.min.x=e*.4,l.max.x=e*.6,l.max.y=o*.25,l.min.z=n*.25,l.max.z=n*.75;break;case"awning":l.max.y=o*.25;break;case"canopy":l.max.y=o*.125;break;case"pergola":break;case"tarp":l.max.y=o*.05;break;case"umbrella":l.min.x=e*.4,l.max.x=e*.6,l.min.z=n*.4,l.max.z=n*.6;break;case"stool":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"shelf":l.max.y=o*.125,l.min.z=n*.1,l.max.z=n*.9;break;case"bed":case"desk":break;case"crateOpen":case"crateLarge":break;case"pallet":l.max.y=o*.15;break;case"shelfUnit":case"locker":case"cabinet":break;case"cardboardBox":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"sack":l.min.x=e*.15,l.max.x=e*.85,l.min.z=n*.15,l.max.z=n*.85,l.max.y=o*.7;break;case"bin":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"dumpster":break;case"grateFloor":l.max.y=o*.1;break;case"ductX":l.min.y=o*.25,l.max.y=o*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"ductZ":l.min.x=e*.25,l.max.x=e*.75,l.min.y=o*.25,l.max.y=o*.75;break;case"ductCorner":l.min.y=o*.25,l.max.y=o*.75;break;case"hopper":case"conveyor":break;case"spotlight":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"bulb":l.min.x=e*.2,l.max.x=e*.8,l.min.y=o*.2,l.max.y=o*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"lightFixture":l.max.y=o*.3;break;case"stump":l.min.x=e*.15,l.max.x=e*.85,l.min.z=n*.15,l.max.z=n*.85,l.max.y=o*.5;break;case"boulder":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"grass":case"flower":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"trafficCone":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8,l.max.y=o*.75;break;case"sign":l.min.z=n*.4,l.max.z=n*.6;break;case"monitor":l.min.z=n*.3,l.max.z=n*.7;break;case"speaker":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"transformer":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"powerBox":case"fuseBox":l.min.z=n*.3,l.max.z=n;break;case"outlet":case"switchBox":l.min.x=e*.3,l.max.x=e*.7,l.min.z=n*.4,l.max.z=n,l.min.y=o*.3,l.max.y=o*.7;break;case"rampStraight":case"rampWide":break;case"roofCorner":case"roofValley":case"gable":break;case"drain":case"grate":l.max.y=o*.15;break;case"shield":l.min.z=n*.3,l.max.z=n*.7;break;case"banner":l.min.x=e*.4,l.max.x=e*.6,l.min.z=n*.4,l.max.z=n*.6;break;case"portcullis":l.min.z=n*.4,l.max.z=n*.6;break;case"wheel":l.min.x=e*.1,l.max.x=e*.9,l.min.y=o*.1,l.max.y=o*.9,l.min.z=n*.4,l.max.z=n*.6;break;case"axle":l.min.x=e*.45,l.max.x=e*.55,l.min.y=o*.45,l.max.y=o*.55;break;case"seat":l.max.y=o*.6;break;case"hull":case"wing":break;case"propeller":l.min.x=e*.2,l.max.x=e*.8,l.min.z=n*.4,l.max.z=n*.6;break;case"derrickLeg":l.min.x=e*.3,l.max.x=e*.7,l.min.z=n*.3,l.max.z=n*.7;break;case"derrickCross":l.min.y=o*.4,l.max.y=o*.6;break;case"derrickPlatform":l.max.y=o*.2;break;case"pumpJack":break;case"pumpBase":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.2,l.max.z=n*.8,l.max.y=o*.25;break;case"oilTank":case"oilTankSmall":l.min.x=e*.1,l.max.x=e*.9,l.min.z=n*.1,l.max.z=n*.9;break;case"wellHead":l.min.x=e*.25,l.max.x=e*.75,l.min.z=n*.25,l.max.z=n*.75;break;case"pipelineX":l.min.y=o*.2,l.max.y=o*.8,l.min.z=n*.2,l.max.z=n*.8;break;case"pipelineZ":l.min.x=e*.2,l.max.x=e*.8,l.min.y=o*.2,l.max.y=o*.8;break;case"oilBarrel":l.min.x=e*.15,l.max.x=e*.85,l.min.z=n*.15,l.max.z=n*.85;break}return l}function p0(i,t){return i.min.x<t.max.x-.01&&i.max.x>t.min.x+.01&&i.min.y<t.max.y-.01&&i.max.y>t.min.y+.01&&i.min.z<t.max.z-.01&&i.max.z>t.min.z+.01}function Hc(i){const t=c0(i.type,i.dimensions),e=i.gridPosition,o=i.scale||1;return{min:{x:e.x+t.min.x*o,y:e.y+t.min.y*o,z:e.z+t.min.z*o},max:{x:e.x+t.max.x*o,y:e.y+t.max.y*o,z:e.z+t.max.z*o}}}function l_(i,t,e){const o=[],n=new I(i,t*.25,e*.25);o.push(n);const s=new I(i*.25,t*.25,e);return o.push(s),Ht(o)}function c_(i,t,e){const o=[],n=Math.min(i,e)*.1,s=new I(i,n,n);s.translate(0,t*.4,0),o.push(s);const r=new I(i,n,n);r.translate(0,-t*.4,0),o.push(r);const a=3;for(let l=0;l<a;l++){const c=-i*.35+l*(i*.35),p=new I(n,t*.9,n);p.rotateZ(l%2===0?.5:-.5),p.translate(c,0,0),o.push(p)}return Ht(o)}function p_(i,t,e){const o=[],n=i*.3,s=new I(i,t*.3,e*.25);return s.translate(0,-t*.1,0),o.push(s),[-i*.35,0,i*.35].forEach(a=>{const l=new I(n,t*.5,e*.25);l.translate(a,t*.15,0),o.push(l)}),Ht(o)}function ta(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,s,o,-n,s,0,n,s,o,-n,-s,-o,-n,-s,0,n,-s,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,0,n,s,0,n,-s,-o,-n,s,0,n,-s,-o,-n,-s,o,-n,s,o,-n,-s,0,n,-s,o,-n,s,0,n,-s,0,n,s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function h_(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,s,o,-n,s,-o,n,s,o,-n,-s,-o,-n,-s,-o,n,-s,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,-o,n,s,-o,n,-s,-o,-n,s,-o,n,-s,-o,-n,-s,o,-n,s,o,-n,-s,-o,n,-s,o,-n,s,-o,n,-s,-o,n,s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function u_(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,s,o,-n,s,0,n,0,-o,-n,s,0,n,0,-o,-n,-s,o,-n,s,o,-n,-s,0,n,0,-o,-n,-s,0,n,0,o,-n,-s,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function d_(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,o,-n,s,0,n,0,o,-n,s,o,-n,-s,0,n,0,o,-n,-s,-o,-n,-s,0,n,0,-o,-n,-s,-o,-n,s,0,n,0]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function f_(i,t,e){return new zt(i*.5,i*.5,t*.25,8,1,!1,0,Math.PI/2)}function m_(i,t,e){const o=Math.min(i,e)/2;return new xe(o,16,8,0,Math.PI*2,0,Math.PI/2)}function y_(i,t,e){const o=new xe(Math.min(i,e)*.4,12,8),n=o.attributes.position;for(let s=0;s<n.count;s++){const r=n.getY(s);r>0&&n.setY(s,r*1.3)}return o.computeVertexNormals(),o}function g_(i,t,e){const o=[],n=e*.25,s=new I(i*.2,t*.6,n);s.translate(-i*.4,-t*.2,0),o.push(s);const r=new I(i*.2,t*.6,n);r.translate(i*.4,-t*.2,0),o.push(r);const a=ta(i*.6,t*.4,n);return a.translate(0,t*.3,0),o.push(a),Ht(o)}function x_(i,t,e){return new I(i,t*.25,e*.25)}function b_(i,t,e){const o=i*.3,n=t*.5,s=e*.3,r=new Float32Array([-o,-n,s,o,-n,s,o*.7,n,s,-o,-n,s,o*.7,n,s,-o*.7,n,s,o,-n,-s,-o,-n,-s,-o*.7,n,-s,o,-n,-s,-o*.7,n,-s,o*.7,n,-s,-o*.7,n,s,o*.7,n,s,o*.7,n,-s,-o*.7,n,s,o*.7,n,-s,-o*.7,n,-s,-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,-o*.7,n,s,-o*.7,n,-s,-o,-n,s,-o*.7,n,-s,-o,-n,-s,o,-n,s,o,-n,-s,o*.7,n,-s,o,-n,s,o*.7,n,-s,o*.7,n,s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function v_(i,t,e){return new zt(i*.4,i*.4,t*.25,5,1)}function __(i,t,e){const o=[],n=new xe(i*.25,8,6);n.translate(-i*.15,t*.1,0),o.push(n);const s=new xe(i*.25,8,6);s.translate(i*.15,t*.1,0),o.push(s);const r=new He(i*.35,t*.4,8);return r.rotateZ(Math.PI),r.translate(0,-t*.15,0),o.push(r),Ht(o)}function w_(i,t,e){const o=[],n=new I(i*.15,t,e*.15);return n.translate(-i*.425,0,-e*.425),o.push(n),Ht(o)}function h0(i,t,e){return new I(i,t,e)}function M_(i,t,e){const o=[],n=new I(i*.2,t*.5,e*.2);n.translate(0,t*.25,-e*.15),o.push(n);const s=new I(i*.2,t*.2,e*.5);s.translate(0,0,e*0),o.push(s);const r=new I(i*.15,t*.5,e*.1);return r.rotateX(-Math.PI/4),r.translate(0,t*.1,-e*.05),o.push(r),Ht(o)}function z_(i,t,e){const o=[],n=new zt(i*.25,i*.3,t*.2,8);n.translate(0,-t*.3,0),o.push(n);const s=new xe(i*.2,8,6);s.translate(0,t*.1,0),o.push(s);const r=new He(i*.1,t*.3,8);return r.translate(0,t*.35,0),o.push(r),Ht(o)}function S_(i,t,e){return ta(i,t*.5,e*.3)}function E_(i,t,e){return Xo(i,t*.25,e,1)}function F_(i,t,e){const o=[],n=i*.1;for(let s=-1;s<=1;s++){const r=new I(i,t*.1,n);r.translate(0,0,s*e*.35),o.push(r)}return Ht(o)}function A_(i,t,e){const o=[],n=new zt(i*.03,i*.03,t*.7,8);n.translate(0,-t*.1,0),o.push(n);const s=new He(i*.45,t*.3,8);return s.rotateZ(Math.PI),s.translate(0,t*.25,0),o.push(s),Ht(o)}function T_(i,t,e){const o=[],n=new zt(i*.35,i*.3,t*.1,8);n.translate(0,t*.2,0),o.push(n);for(let s=0;s<4;s++){const r=s*Math.PI/2+Math.PI/4,a=new zt(i*.05,i*.05,t*.4,6);a.translate(Math.cos(r)*i*.2,-t*.05,Math.sin(r)*e*.2),o.push(a)}return Ht(o)}function C_(i,t,e){const o=[],n=new I(i*.9,t*.25,e*.9);n.translate(0,t*.05,0),o.push(n);const s=new I(i*.9,t*.4,e*.1);s.translate(0,t*.1,-e*.45),o.push(s);const r=new I(i,t*.15,e);return r.translate(0,-t*.15,0),o.push(r),Ht(o)}function k_(i,t,e){const o=[],n=new I(i,t*.1,e);n.translate(0,t*.35,0),o.push(n);const s=i*.08,r=t*.7;[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([c,p])=>{const h=new I(s,r,s);h.translate(c*(i*.42),-t*.05,p*(e*.42)),o.push(h)});const l=new I(i*.4,t*.2,e*.8);return l.translate(i*.25,t*.1,0),o.push(l),Ht(o)}function B_(i,t,e){const o=[],s=new I(i*.85,t*.05,e*.85);s.translate(0,-t*.35,0),o.push(s);const r=new I(i*.9,t*.7,.05*i);r.translate(0,0,e*.4),o.push(r);const a=r.clone();a.translate(0,0,-e*.8),o.push(a);const l=new I(.05*i,t*.7,e*.85);l.translate(-i*.42,0,0),o.push(l);const c=l.clone();return c.translate(i*.84,0,0),o.push(c),Ht(o)}function P_(i,t,e){const o=[],n=new I(i*.95,t*.8,e*.95);n.translate(0,-t*.1,0),o.push(n);const s=new I(i,t*.1,e*.5);return s.translate(0,t*.35,-e*.25),o.push(s),Ht(o)}function R_(i,t,e){const o=[],n=i*.05,s=i*.15,r=Math.floor(i/s);for(let a=0;a<=r;a++){const l=new I(n,t*.125,e);l.translate(-i*.4+a*s,0,0),o.push(l)}return Ht(o)}function D_(i,t,e){const o=[],n=t*.5,s=new I(i*.5,n,e*.5);s.translate(i*.25,0,0),o.push(s);const r=new I(i*.5,n,e*.5);return r.translate(0,0,e*.25),o.push(r),Ht(o)}function I_(i,t,e){return new zt(i*.2,i*.4,t,8)}function L_(i,t,e){const o=[],n=new I(i,t*.1,e*.8);n.translate(0,t*.05,0),o.push(n);const s=new zt(t*.1,t*.1,e*.9,8);s.rotateX(Math.PI/2),s.translate(-i*.4,-t*.05,0),o.push(s);const r=s.clone();return r.translate(i*.8,0,0),o.push(r),Ht(o)}function U_(i,t,e){const o=[],n=new zt(i*.2,i*.15,t*.3,8);n.translate(0,t*.1,0),o.push(n);const s=new I(i*.1,t*.2,e*.1);return s.translate(0,-t*.15,0),o.push(s),Ht(o)}function N_(i,t,e){return new So(Math.min(i,t,e)*.4,0)}function O_(i,t,e){const o=[];for(let n=0;n<5;n++){const s=new He(i*.05,t*.25,4),r=(Math.random()-.5)*i*.6,a=(Math.random()-.5)*e*.6;s.translate(r,0,a),o.push(s)}return Ht(o)}function V_(i,t,e){const o=[],n=new zt(i*.02,i*.02,t*.4,6);n.translate(0,-t*.05,0),o.push(n);const s=new xe(i*.15,8,6);return s.translate(0,t*.2,0),o.push(s),Ht(o)}function H_(i,t,e){const o=[],n=new I(i*.1,t*.7,e*.1);n.translate(0,-t*.15,0),o.push(n);const s=new I(i*.8,t*.5,e*.05);return s.translate(0,t*.25,0),o.push(s),Ht(o)}function G_(i,t,e){const o=[],n=new I(i*.9,t*.6,e*.1);n.translate(0,t*.1,0),o.push(n);const s=new I(i*.2,t*.3,e*.3);return s.translate(0,-t*.25,0),o.push(s),Ht(o)}function X_(i,t,e){const o=[],n=new I(i*.8,t*.5,e*.6);o.push(n);const s=new zt(i*.25,i*.15,e*.2,12);return s.rotateX(Math.PI/2),s.translate(0,0,e*.35),o.push(s),Ht(o)}function W_(i,t,e){const o=new co(Math.min(i,t,e)*.4,0);return o.scale(1,1.3,1),o}function Z_(i,t,e){const o=[],n=new He(i*.25,t*.8,6);n.translate(0,t*.1,0),o.push(n);const s=new He(i*.12,t*.4,6);s.translate(i*.2,-t*.1,e*.1),o.push(s);const r=new He(i*.1,t*.3,6);return r.translate(-i*.15,-t*.15,-e*.15),o.push(r),Ht(o)}function Y_(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,-n,-s,o,-n,-s,o,-n,s,-o,-n,-s,o,-n,s,-o,-n,s,-o,-n,s,o,-n,s,o,n,-s,o,-n,s,o,-n,-s,o,n,-s,-o,-n,-s,o,n,-s,o,-n,-s,-o,-n,-s,-o,-n,s,o,n,-s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function $_(i,t,e){const o=i/2,n=t/2,s=e/2,r=new Float32Array([-o,n,-s,0,-n,0,-o,n,s,o,n,-s,o,n,s,0,-n,0,-o,n,s,0,-n,0,o,n,s,o,n,-s,0,-n,0,-o,n,-s,-o,n,-s,-o,n,s,0,-n,0,o,n,s,o,n,-s,0,-n,0]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function q_(i,t,e){return ta(i,t,e*.25)}function j_(i,t,e){const o=[],n=new zt(i*.3,i*.35,t*.25,8);o.push(n);const s=new zt(i*.32,i*.32,t*.05,8);return s.translate(0,t*.1,0),o.push(s),Ht(o)}function K_(i,t,e){const o=[],n=i*.08,s=4;for(let r=0;r<s;r++){const a=new I(i*.9,t*.125,n);a.translate(0,0,-e*.3+r*e*.2),o.push(a)}return Ht(o)}function J_(i,t,e){return new I(i*.7,t*.125,e*.5)}function Q_(i,t,e){const o=[],n=new zt(i*.03,i*.03,t,6);n.translate(-i*.4,0,0),o.push(n);const s=new I(i*.7,t*.8,e*.02);return s.translate(0,-t*.05,0),o.push(s),Ht(o)}function tw(i,t,e){const o=[],n=i*.05;for(let s=0;s<5;s++){const r=new I(n,t,n);r.translate(-i*.4+s*i*.2,0,0),o.push(r)}for(let s=0;s<4;s++){const r=new I(i,n,n);r.translate(0,-t*.35+s*t*.25,0),o.push(r)}return Ht(o)}function ew(i,t,e){const o=[],n=new I(i*.8,t*.15,e*.7);n.translate(0,0,0),o.push(n);const s=new I(i*.8,t*.4,e*.1);return s.translate(0,t*.2,-e*.3),o.push(s),Ht(o)}function ow(i,t,e){const o=new zt(i*.3,i*.4,e,8,1,!1,0,Math.PI);return o.rotateZ(Math.PI/2),o.rotateY(Math.PI/2),o}function nw(i,t,e){const o=[],n=new zt(i*.1,i*.1,t*.25,8);o.push(n);for(let s=0;s<3;s++){const r=new I(i*.4,t*.05,e*.1);r.rotateY(s*Math.PI*2/3),r.translate(i*.2,0,0),r.rotateY(s*Math.PI*2/3),o.push(r)}return Ht(o)}function iw(i,t,e){const o=i/2,n=t*.125/2,s=e/2,r=new Float32Array([-o,n,-s,o*.3,n,-s,o,n,s,-o,n,-s,o,n,s,-o,n,s,-o,-n,s,o,-n,s,o*.3,-n,-s,-o,-n,s,o*.3,-n,-s,-o,-n,-s,-o,n,s,o,n,s,o,-n,s,-o,n,s,o,-n,s,-o,-n,s,o*.3,n,-s,-o,n,-s,-o,-n,-s,o*.3,n,-s,-o,-n,-s,o*.3,-n,-s,o,n,s,o*.3,n,-s,o*.3,-n,-s,o,n,s,o*.3,-n,-s,o,-n,s]),a=new Xt;return a.setAttribute("position",new Gt(r,3)),a.computeVertexNormals(),a}function sw(i,t,e){const o=Math.min(i,e)*.1,n=[],s=new I(o,t,o);n.push(s);const r=i*.35;for(let p=0;p<3;p++){const h=-t*.35+p*t*.35,u=new I(r,o*.6,o*.6);u.translate(r*.5,h,0),n.push(u)}const a=Math.sqrt(t*t*.25+r*r*.25)*.8,l=Math.atan2(t*.35,r*.5),c=new I(o*.5,a,o*.5);return c.rotateZ(-l),c.translate(r*.25,0,0),n.push(c),vt(n,!1)||n[0]}function rw(i,t,e){const o=Math.min(i,e)*.08,n=[],s=new I(o,Math.sqrt(i*i+t*t)*.5,o);s.rotateZ(Math.PI*.25),n.push(s);const r=new I(o,Math.sqrt(i*i+t*t)*.5,o);return r.rotateZ(-Math.PI*.25),n.push(r),vt(n,!1)||n[0]}function aw(i,t,e){const o=[],n=new I(i*.9,t*.25,e*.9);o.push(n);const s=new I(i*.95,t*.1,e*.05);s.translate(0,-t*.08,e*.45),o.push(s);const r=new I(i*.95,t*.1,e*.05);return r.translate(0,-t*.08,-e*.45),o.push(r),vt(o,!1)||o[0]}function lw(i,t,e){const o=[],n=new I(i*.7,t*.08,e*.5);n.translate(0,-t*.46,0),o.push(n);const s=new I(i*.25,t*.2,e*.3);s.translate(-i*.15,-t*.32,0),o.push(s);const r=new I(i*.08,t*.55,e*.08);r.translate(-i*.05,-t*.125,e*.12),o.push(r);const a=new I(i*.08,t*.55,e*.08);a.translate(-i*.05,-t*.125,-e*.12),o.push(a);const l=new I(i*.1,t*.08,e*.35);l.translate(-i*.05,t*.15,0),o.push(l);const c=new I(i*.85,t*.08,e*.1);c.translate(i*.1,t*.22,0),o.push(c);const p=new I(i*.1,t*.15,e*.08);p.translate(i*.48,t*.15,0),o.push(p);const h=new I(i*.04,t*.12,e*.04);h.translate(i*.48,t*.02,0),o.push(h);const u=new I(i*.05,t*.25,e*.05);u.rotateZ(Math.PI*.15),u.translate(-i*.25,t*0,0),o.push(u);const d=new zt(e*.12,e*.12,i*.08,12);d.rotateZ(Math.PI/2),d.translate(-i*.28,-t*.15,0),o.push(d);const y=new I(i*.06,t*.18,e*.08);y.translate(-i*.28,-t*.06,e*.1),o.push(y);const g=new I(i*.06,t*.18,e*.08);return g.translate(-i*.28,-t*.06,-e*.1),o.push(g),vt(o,!1)||o[0]}function cw(i,t,e){const o=[],n=Math.min(t,e)*.4,s=new zt(n,n,i*.8,16,1,!1);s.rotateZ(Math.PI/2),o.push(s);const r=new xe(n,12,8,0,Math.PI*2,0,Math.PI/2);r.rotateZ(Math.PI/2),r.translate(i*.4,0,0),o.push(r);const a=new xe(n,12,8,0,Math.PI*2,0,Math.PI/2);a.rotateZ(-Math.PI/2),a.translate(-i*.4,0,0),o.push(a);const l=new I(i*.1,t*.15,e*.5);l.translate(-i*.25,-n-t*.075,0),o.push(l);const c=new I(i*.1,t*.15,e*.5);c.translate(i*.25,-n-t*.075,0),o.push(c);const p=new I(i*.08,t*.2,e*.08);p.translate(-i*.25,-n-t*.25,e*.2),o.push(p);const h=new I(i*.08,t*.2,e*.08);h.translate(-i*.25,-n-t*.25,-e*.2),o.push(h);const u=new I(i*.08,t*.2,e*.08);u.translate(i*.25,-n-t*.25,e*.2),o.push(u);const d=new I(i*.08,t*.2,e*.08);return d.translate(i*.25,-n-t*.25,-e*.2),o.push(d),vt(o,!1)||o[0]}function pw(i,t,e){const o=[],n=new zt(Math.min(i,e)*.35,Math.min(i,e)*.35,t*.45,12);o.push(n);const s=new xe(Math.min(i,e)*.35,12,8,0,Math.PI*2,0,Math.PI/2);s.translate(0,t*.225,0),o.push(s);const r=new zt(i*.05,i*.05,t*.15,8);return r.translate(0,t*.35,0),o.push(r),vt(o,!1)||o[0]}function hw(i,t,e){const o=[],n=new zt(i*.35,i*.4,t*.15,8);n.translate(0,-t*.175,0),o.push(n);const s=new I(i*.3,t*.25,e*.3);s.translate(0,t*.025,0),o.push(s);const r=new zt(i*.12,i*.12,t*.15,8);r.translate(0,t*.175,0),o.push(r);const a=new zt(i*.08,i*.08,e*.25,8);return a.rotateX(Math.PI/2),a.translate(0,0,e*.25),o.push(a),vt(o,!1)||o[0]}function uw(i,t,e){const o=Math.min(i,e)*.4,n=[],s=new zt(o*.95,o*.95,t*.9,12);n.push(s);const r=new vo(o*.85,o*.08,6,12);r.rotateX(Math.PI/2),r.translate(0,t*.45,0),n.push(r);const a=new vo(o*.85,o*.08,6,12);a.rotateX(Math.PI/2),a.translate(0,-t*.45,0),n.push(a);const l=new vo(o*.95,o*.05,6,12);return l.rotateX(Math.PI/2),n.push(l),vt(n,!1)||n[0]}function dw(i,t,e){const o=new So(Math.min(i,t,e)*.25,0);return o.translate(0,-t*.15,0),o}function fw(i,t,e){const o=[],n=new So(Math.min(i,e)*.45,1);n.scale(1,.7,1),o.push(n);const s=new So(Math.min(i,e)*.25,0);return s.translate(i*.2,t*.1,e*.15),o.push(s),vt(o,!1)||o[0]}function mw(i,t,e){const o=new So(Math.min(i,e)*.4,1);return o.scale(1,.3,1),o.translate(0,-t*.2,0),o}function yw(i,t,e){const o=new So(Math.min(i,e)*.3,1);return o.scale(.7,1.5,.7),o}function gw(i,t,e){const o=[],n=new So(Math.min(i,e)*.35,0);n.scale(1,.6,1),n.translate(0,-t*.15,0),o.push(n);const s=new He(i*.15,t*.4,4);s.translate(-i*.1,t*.1,-e*.05),s.rotateZ(.2),o.push(s);const r=new He(i*.12,t*.35,4);return r.translate(i*.1,t*.05,e*.1),r.rotateZ(-.15),o.push(r),vt(o,!1)||o[0]}function xw(i,t,e){const o=[],n=4+Math.floor(Math.random()*3);for(let s=0;s<n;s++){const r=Math.min(i,e)*(.15+Math.random()*.2),a=new So(r,0),l=(Math.random()-.5)*i*.6,c=(Math.random()-.5)*e*.6,p=-t*.25+r;a.translate(l,p,c),o.push(a)}return vt(o,!1)||o[0]}function bw(i,t,e){const o=[];for(let n=0;n<3;n++){const s=Math.min(i,e)*(.2+Math.random()*.15),r=new So(s,0),a=n/3*Math.PI*2;r.translate(Math.cos(a)*i*.2,-t*.2,Math.sin(a)*e*.2),o.push(r)}for(let n=0;n<2;n++){const s=Math.min(i,e)*(.12+Math.random()*.1),r=new So(s,0);r.translate((Math.random()-.5)*i*.3,t*.05,(Math.random()-.5)*e*.3),o.push(r)}return vt(o,!1)||o[0]}function vw(i,t,e){const o=[],n=8+Math.floor(Math.random()*5);for(let s=0;s<n;s++){const r=Math.min(i,e)*(.05+Math.random()*.08),a=new xe(r,5,4);a.scale(1,.6,1);const l=(Math.random()-.5)*i*.7,c=(Math.random()-.5)*e*.7;a.translate(l,-t*.35,c),o.push(a)}return vt(o,!1)||o[0]}function _w(i,t,e){const o=[];for(let n=0;n<3;n++){const s=new I(i*(.6+Math.random()*.3),t*.08,e*(.5+Math.random()*.3));s.translate((Math.random()-.5)*i*.15,-t*.25+n*t*.1,(Math.random()-.5)*e*.15),s.rotateY(Math.random()*.3),o.push(s)}return vt(o,!1)||o[0]}function ww(i,t,e){const o=new co(Math.min(i,e)*.2,0);return o.scale(.6,1,.6),o.translate(0,-t*.15,0),o}function Mw(i,t,e){const o=[],n=new co(Math.min(i,e)*.35,0);n.scale(.7,1.3,.7),o.push(n);const s=new co(Math.min(i,e)*.2,0);return s.scale(.6,1,.6),s.translate(i*.25,-t*.1,e*.15),s.rotateZ(.3),o.push(s),vt(o,!1)||o[0]}function zw(i,t,e){const o=[],n=5+Math.floor(Math.random()*3);for(let s=0;s<n;s++){const r=Math.min(i,e)*(.1+Math.random()*.15),a=new co(r,0);a.scale(.5,1+Math.random()*.5,.5);const l=(Math.random()-.5)*i*.5,c=(Math.random()-.5)*e*.5,p=-t*.2+r*.5;a.translate(l,p,c),a.rotateZ((Math.random()-.5)*.4),a.rotateX((Math.random()-.5)*.4),o.push(a)}return vt(o,!1)||o[0]}function Sw(i,t,e){const o=new co(Math.min(i,e)*.25,0);return o.scale(.4,2,.4),o}function Ew(i,t,e){const o=[],n=new zt(Math.min(i,e)*.35,Math.min(i,e)*.4,t*.15,6);n.translate(0,-t*.3,0),o.push(n);for(let s=0;s<3;s++){const r=new co(Math.min(i,e)*.1,0);r.scale(.5,1,.5);const a=s/3*Math.PI*2;r.translate(Math.cos(a)*i*.15,-t*.1,Math.sin(a)*e*.15),o.push(r)}return vt(o,!1)||o[0]}function Fw(i,t,e){const o=[],n=new co(Math.min(i,e)*.2,0);n.scale(.3,1.8,.5),n.rotateZ(.2),o.push(n);const s=new co(Math.min(i,e)*.1,0);return s.scale(.4,.8,.3),s.translate(i*.15,-t*.2,e*.1),s.rotateZ(-.5),o.push(s),vt(o,!1)||o[0]}function Aw(i,t,e){const o=[],n=new co(Math.min(i,e)*.25,0);n.scale(.6,1.5,.6),o.push(n);const s=[0,Math.PI*.5,Math.PI,Math.PI*1.5];for(let r=0;r<s.length;r++){const a=new co(Math.min(i,e)*.15,0);a.scale(.5,1+Math.random()*.3,.5);const l=Math.min(i,e)*.25;a.translate(Math.cos(s[r])*l,-t*.1,Math.sin(s[r])*l),a.rotateZ((Math.random()-.5)*.5),o.push(a)}return vt(o,!1)||o[0]}function Tw(i,t,e){const o=new He(Math.min(i,e)*.25,t*.8,6);return o.rotateX(Math.PI),o.translate(0,t*.1,0),o}function Cw(i,t,e){const o=[],n=new He(Math.min(i,e)*.2,t*.7,6);n.translate(0,-t*.15,0),o.push(n);const s=new He(Math.min(i,e)*.3,t*.2,6);return s.translate(0,-t*.4,0),o.push(s),vt(o,!1)||o[0]}function kw(i,t,e){const o=[],n=new zt(i*.08,i*.1,t*.4,8);n.translate(0,-t*.1,0),o.push(n);const s=new xe(Math.min(i,e)*.25,8,6,0,Math.PI*2,0,Math.PI*.6);return s.translate(0,t*.15,0),o.push(s),vt(o,!1)||o[0]}function Bw(i,t,e){const o=[],n=[{x:0,z:0,scale:1},{x:i*.2,z:e*.15,scale:.7},{x:-i*.15,z:e*.2,scale:.6},{x:i*.1,z:-e*.2,scale:.5}];for(const s of n){const r=new zt(i*.05*s.scale,i*.06*s.scale,t*.3*s.scale,6);r.translate(s.x,-t*.2+t*.15*s.scale,s.z),o.push(r);const a=new xe(Math.min(i,e)*.15*s.scale,6,5,0,Math.PI*2,0,Math.PI*.6);a.translate(s.x,-t*.05+t*.15*s.scale,s.z),o.push(a)}return vt(o,!1)||o[0]}function Pw(i,t,e){const o=[],n=6+Math.floor(Math.random()*4);for(let s=0;s<n;s++){const r=Math.min(i,e)*(.1+Math.random()*.15),a=new xe(r,5,4);a.scale(1,.4,1);const l=(Math.random()-.5)*i*.7,c=(Math.random()-.5)*e*.7;a.translate(l,-t*.35,c),o.push(a)}return vt(o,!1)||o[0]}function Rw(i,t,e){const o=[];for(let n=0;n<4;n++){const s=(Math.random()-.5)*i*.6,r=(Math.random()-.5)*e*.6,a=t*(.5+Math.random()*.4),l=new zt(i*.02,i*.015,a,4);if(l.translate(s,-a*.3,r),o.push(l),Math.random()>.5){const c=new xe(i*.06,4,3);c.scale(1,.3,.6),c.translate(s+i*.05,-a*.2+t*.1,r),o.push(c)}}return vt(o,!1)||o[0]}function Dw(i,t,e){const o=[],n=4+Math.floor(Math.random()*3);for(let s=0;s<n;s++){const r=s/n*Math.PI*2+Math.random()*.5,a=t*(.3+Math.random()*.3),l=new zt(i*.04,i*.06,a,5);l.translate(0,a*.3,0),l.rotateZ((Math.random()-.5)*.8),l.rotateY(r),l.translate(0,-t*.2,0),o.push(l);const c=new xe(i*.06,5,4);c.translate(Math.sin(r)*a*.3,a*.4-t*.2,Math.cos(r)*a*.3),o.push(c)}return vt(o,!1)||o[0]}let Iw=0;class Gc{constructor(t={}){this.id=t.id||`block_${++Iw}`,this.type=t.type||"cube",this.gridPosition=t.position||{x:0,y:0,z:0},this.dimensions=t.dimensions||{w:1,h:1,d:1},this.rotation=t.rotation||{x:0,y:0,z:0},this.color=t.color||"#5588cc",this.layerId=t.layerId||"default",this.scale=t.scale||1,this.emissive=t.emissive||{enabled:!1,color:"#ffaa00",intensity:1,radius:3},this.faces={},t.faces?Kn.forEach(e=>{t.faces[e]?this.faces[e]={...t.faces[e]}:this.faces[e]={direction:e,materialId:null,color:null,uvRotation:0,uvFlip:{x:!1,y:!1}}}):Kn.forEach(e=>{this.faces[e]={direction:e,materialId:null,color:null,uvRotation:0,uvFlip:{x:!1,y:!1}}}),this.mesh=null,this.light=null,this.createMesh()}createMesh(){const e=(Qr[this.type]||Qr.cube)(this.dimensions);this.scale>1&&e.scale(this.scale,this.scale,this.scale);const o=e.groups&&e.groups.length===6;let n;o?n=Kn.map(s=>{const r=this.faces[s],a=r&&r.color?r.color:this.color,l=new Ge({color:a,roughness:.7,metalness:.1,side:Ze});return this.emissive.enabled&&(l.emissive=new bt(this.emissive.color),l.emissiveIntensity=this.emissive.intensity),l}):(n=new Ge({color:this.color,roughness:.7,metalness:.1,side:Ze}),this.emissive.enabled&&(n.emissive=new bt(this.emissive.color),n.emissiveIntensity=this.emissive.intensity)),this.mesh=new ge(e,n),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.userData.blockId=this.id,this.mesh.userData.block=this,this.createEdges(e),this.emissive.enabled&&this.createLight(),this.updateTransform()}createEdges(t){const e=new Ts(t,30),o=new $n({color:0,transparent:!0,opacity:.3});this.edges=new Xi(e,o),this.mesh.add(this.edges)}setEdgesVisible(t){this.edges&&(this.edges.visible=t)}setEdgesOpacity(t){this.edges&&(this.edges.material.opacity=t)}createLight(){this.light&&(this.mesh.remove(this.light),this.light.dispose()),this.light=new _2(new bt(this.emissive.color),this.emissive.intensity*2,this.emissive.radius*2,1),this.light.castShadow=!1,this.mesh.add(this.light)}removeLight(){this.light&&(this.mesh.remove(this.light),this.light.dispose(),this.light=null)}updateTransform(){const t=Jn[this.type]||1,e=Qn[this.type]||0,o=this.dimensions.h*t*this.scale,n=e*this.scale+o/2;this.mesh.position.set(this.gridPosition.x+this.dimensions.w*this.scale/2,this.gridPosition.y+n,this.gridPosition.z+this.dimensions.d*this.scale/2),this.mesh.rotation.set(Me.degToRad(this.rotation.x),Me.degToRad(this.rotation.y),Me.degToRad(this.rotation.z))}setPosition(t){this.gridPosition={...t},this.updateTransform()}setRotation(t){this.rotation={...t},this.updateTransform()}rotateY(t){this.rotation.y=(this.rotation.y+t)%360,this.updateTransform()}setColor(t){this.color=t,Array.isArray(this.mesh.material)?this.mesh.material.forEach((e,o)=>{const n=Kn[o];(!this.faces[n]||!this.faces[n].color)&&e.color.set(t)}):this.mesh.material.color.set(t)}setFaceColor(t,e){if(!Array.isArray(this.mesh.material)){this.color=e,this.mesh.material.color.set(e);return}const o=Kn.indexOf(t);o!==-1&&(this.faces[t]||(this.faces[t]={direction:t,materialId:null,color:null,uvRotation:0,uvFlip:{x:!1,y:!1}}),this.faces[t].color=e,this.mesh.material[o].color.set(e))}getFaceColor(t){if(!Array.isArray(this.mesh.material))return this.color;const e=this.faces[t];return e&&e.color?e.color:this.color}supportsPerFacePainting(){return Array.isArray(this.mesh.material)&&this.mesh.material.length===6}setEmissive(t,e=null,o=null,n=null){this.emissive.enabled=t,e!==null&&(this.emissive.color=e),o!==null&&(this.emissive.intensity=o),n!==null&&(this.emissive.radius=n);const s=r=>{t?(r.emissive=new bt(this.emissive.color),r.emissiveIntensity=this.emissive.intensity):(r.emissive=new bt(0),r.emissiveIntensity=0)};Array.isArray(this.mesh.material)?this.mesh.material.forEach(s):s(this.mesh.material),t?this.createLight():this.removeLight()}updateLight(){this.light&&(this.light.color.set(this.emissive.color),this.light.intensity=this.emissive.intensity*2,this.light.distance=this.emissive.radius*2)}setSelected(t){if(this.emissive.enabled){const o=n=>{n.emissiveIntensity=t?this.emissive.intensity*1.5:this.emissive.intensity};Array.isArray(this.mesh.material)?this.mesh.material.forEach(o):o(this.mesh.material);return}const e=(o,n)=>{o.emissive&&o.emissive.set(n)};Array.isArray(this.mesh.material)?this.mesh.material.forEach(o=>e(o,t?3355443:0)):e(this.mesh.material,t?3355443:0)}clone(){return new Gc({type:this.type,position:{...this.gridPosition},dimensions:{...this.dimensions},rotation:{...this.rotation},color:this.color,emissive:{...this.emissive},faces:JSON.parse(JSON.stringify(this.faces)),layerId:this.layerId,scale:this.scale})}toJSON(){return{id:this.id,type:this.type,position:this.gridPosition,dimensions:this.dimensions,rotation:this.rotation,color:this.color,emissive:this.emissive,faces:this.faces,layerId:this.layerId,scale:this.scale}}dispose(){this.removeLight(),this.edges&&(this.edges.geometry.dispose(),this.edges.material.dispose()),this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(t=>t.dispose()):this.mesh.material.dispose()}}Q2();const u0=new Set;for(const i of Object.values(Ic))for(const t of i.types)u0.add(t);function Lw(i){return typeof i=="string"&&u0.has(i)}function Uw(i){return!i||typeof i!="object"?!1:typeof i.x=="number"&&isFinite(i.x)&&typeof i.y=="number"&&isFinite(i.y)&&typeof i.z=="number"&&isFinite(i.z)}function Nw(i){return!i||typeof i!="object"?!1:typeof i.w=="number"&&i.w>0&&isFinite(i.w)&&typeof i.h=="number"&&i.h>0&&isFinite(i.h)&&typeof i.d=="number"&&i.d>0&&isFinite(i.d)}function Ow(i){return!i||typeof i!="object"?!1:typeof i.x=="number"&&isFinite(i.x)&&typeof i.y=="number"&&isFinite(i.y)&&typeof i.z=="number"&&isFinite(i.z)}function d0(i){return typeof i!="string"?!1:/^#[0-9A-Fa-f]{6}$/.test(i)}function Vw(i){return!(!i||typeof i!="object"||typeof i.enabled!="boolean"||i.enabled&&(!d0(i.color)||typeof i.intensity!="number"||i.intensity<0||typeof i.radius!="number"||i.radius<0))}function f0(i){const t=[];return!i||typeof i!="object"?{valid:!1,errors:["Block data must be an object"]}:(i.type?Lw(i.type)||t.push(`Invalid block type: ${i.type}`):t.push("Block type is required"),i.position?Uw(i.position)||t.push("Invalid block position"):t.push("Block position is required"),i.dimensions&&!Nw(i.dimensions)&&t.push("Invalid block dimensions"),i.rotation&&!Ow(i.rotation)&&t.push("Invalid block rotation"),i.color&&!d0(i.color)&&t.push("Invalid block color"),i.emissive&&!Vw(i.emissive)&&t.push("Invalid emissive settings"),{valid:t.length===0,errors:t})}function Hw(i){const t=[],e=[];return!i||typeof i!="object"?{valid:!1,errors:["Project data must be an object"],warnings:[]}:(i.version&&i.version!=="1.0"&&e.push(`Project version ${i.version} may not be fully compatible`),i.blocks&&(Array.isArray(i.blocks)?i.blocks.forEach((o,n)=>{const s=f0(o);s.valid||t.push(`Block ${n}: ${s.errors.join(", ")}`)}):t.push("Project blocks must be an array")),i.animations&&(Array.isArray(i.animations)||t.push("Project animations must be an array")),{valid:t.length===0,errors:t,warnings:e})}function Gw(i){const t={...i};return t.dimensions=t.dimensions||{w:1,h:1,d:1},t.rotation=t.rotation||{x:0,y:0,z:0},t.color=t.color||"#5588cc",t.emissive=t.emissive||{enabled:!1,color:"#ffaa00",intensity:1,radius:3},t.position&&(t.position.x=Math.max(-1e3,Math.min(1e3,t.position.x)),t.position.y=Math.max(-1e3,Math.min(1e3,t.position.y)),t.position.z=Math.max(-1e3,Math.min(1e3,t.position.z))),t}function Xw(i){if(!Array.isArray(i))return{blocks:[],invalidCount:0};const t=[];let e=0;for(const o of i){const n=f0(o);n.valid?t.push(Gw(o)):(e++,console.warn("Skipping invalid block:",n.errors.join(", ")))}return{blocks:t,invalidCount:e}}const m0={pillar:"Y",pillar2:"Y",pillar4:"Y",pillarRound:"Y",pillarRound2:"Y",post:"Y",bollard:"Y",downspout:"Y",antenna:"Y",torch:"Y",chain:"Y",finial:"Y",banner:"Y",derrickLeg:"Y",wellHead:"Y",beamX:"X",beam2X:"X",beam4X:"X",beamXLow:"X",beam2XLow:"X",pipeX:"X",conduit:"X",cableX:"X",pipelineX:"X",ductX:"X",moldingX:"X",beamZ:"Z",beam2Z:"Z",beam4Z:"Z",beamZLow:"Z",beam2ZLow:"Z",pipeZ:"Z",cableZ:"Z",pipelineZ:"Z",ductZ:"Z",moldingZ:"Z",pipeY:"Y",cableY:"Y",cableDroop:"Y",cableLoop:"Y",beamDiag:"XZ"},y0=["slab","quarter","wedgeLow","wedgeFlat","wedgeCornerLow","wedgeCornerFlat","slabSlope","ledge","gutter","capital","base","channel","channelCorner","channelEnd","rampCurvedLow","roofPeakLow","step","platform","landing","stairsSingle","spiralStep","drain","grate","grateFloor","pallet","derrickPlatform","pumpBase","awning","canopy","tarp","lightFixture","shelf"],g0=["beamX","beam2X","beam4X","beamZ","beam2Z","beam4Z","beamDiag","slabTop","wedgeLowTop","wedgeFlatTop","slabSlopeTop","crossBeam","derrickCross"],x0=["pillar","pillar2","pillar4","pillarRound","pillarRound2","fence","fenceZ","railing","railingZ","wall","wall4","wall8","panel","post","bollard","downspout","antenna","torch","chain","finial","banner","conduit","conduitCorner","cable","cableX","cableY","cableZ","cableElbow","cableElbowY","cableT","cableHanging","cableDroop","cableLoop","pipeX","pipeY","pipeZ","pipeElbowXZ","pipeElbowXZ2","pipeElbowXZ3","pipeElbowXZ4","pipeElbowXY","pipeElbowXY2","pipeElbowYZ","pipeElbowYZ2","pipeCross","pipeT","pipeTY","pipeTZ","derrickLeg","wellHead","pipelineX","pipelineZ"],b0=["pipeX","pipeY","pipeZ","pipeElbowXZ","pipeElbowXZ2","pipeElbowXZ3","pipeElbowXZ4","pipeElbowXY","pipeElbowXY2","pipeElbowYZ","pipeElbowYZ2","pipeCross","pipeT","pipeTY","pipeTZ","conduit","conduitCorner","conduitElbow","conduitElbowY","conduitT","cableX","cableY","cableZ","cableElbow","cableElbowY","cableT"];function v0(i,t){const e=m0[i],o=m0[t],n=y0.includes(i),s=y0.includes(t),r=g0.includes(i),a=g0.includes(t),l=x0.includes(i),c=x0.includes(t),p=b0.includes(i),h=b0.includes(t);return p&&h||n&&a||s&&r||n&&c||s&&l||p&&s||h&&n?!0:!(r&&a||n&&s||!e||!o||e===o||e==="XZ"||o==="XZ")}class Ww{constructor(t){this.scene=t,this.blocks=new Map,this.mergedMeshes=new Map,this.blockGroup=new Zn,this.blockGroup.name="blocks",this.scene.add(this.blockGroup),this.selectedBlocks=new Set,this.onBlockCountChange=null,this.onSelectionChange=null}get selectedBlock(){return this.selectedBlocks.size===0?null:this.selectedBlocks.values().next().value}set selectedBlock(t){this.deselectAll(),t&&(this.selectedBlocks.add(t),t.setSelected(!0))}addBlock(t){const e=new Gc(t);return this.wouldOverlap(e)?(e.dispose(),null):(this.blocks.set(e.id,e),this.blockGroup.add(e.mesh),this.notifyBlockCountChange(),e)}wouldOverlap(t,e=null){const o=Hc(t);for(const n of this.blocks.values()){if(e&&n.id===e)continue;const s=Hc(n);if(p0(o,s)){if(v0(t.type,n.type))continue;return!0}}return!1}wouldOverlapAt(t,e,o={w:1,h:1,d:1},n=null,s=1){const r=c0(t,o),a={min:{x:e.x+r.min.x*s,y:e.y+r.min.y*s,z:e.z+r.min.z*s},max:{x:e.x+r.max.x*s,y:e.y+r.max.y*s,z:e.z+r.max.z*s}},l=n instanceof Set?n:n?new Set([n]):new Set;for(const c of this.blocks.values()){if(l.has(c.id))continue;const p=Hc(c);if(p0(a,p)){if(v0(t,c.type))continue;return!0}}return!1}removeBlock(t){const e=this.blocks.get(t);return e?(this.blockGroup.remove(e.mesh),e.dispose(),this.blocks.delete(t),this.selectedBlocks.has(e)&&(this.selectedBlocks.delete(e),this.notifySelectionChange()),this.notifyBlockCountChange(),!0):!1}removeBlockAtPosition(t){const e=this.getBlockAtPosition(t);return e?this.removeBlock(e.id):!1}getBlockAtPosition(t){for(const e of this.blocks.values()){const o=e.gridPosition;if(o.x===t.x&&o.y===t.y&&o.z===t.z)return e}return null}getBlockByMesh(t){return t.userData.block?t.userData.block:null}selectBlock(t,e=!1){e||this.deselectAll(),t&&(this.selectedBlocks.add(t),t.setSelected(!0)),this.notifySelectionChange()}addToSelection(t){t&&!this.selectedBlocks.has(t)&&(this.selectedBlocks.add(t),t.setSelected(!0),this.notifySelectionChange())}removeFromSelection(t){t&&this.selectedBlocks.has(t)&&(this.selectedBlocks.delete(t),t.setSelected(!1),this.notifySelectionChange())}toggleSelection(t){this.selectedBlocks.has(t)?this.removeFromSelection(t):this.addToSelection(t)}isSelected(t){return this.selectedBlocks.has(t)}getSelectedBlocks(){return Array.from(this.selectedBlocks)}getSelectionCount(){return this.selectedBlocks.size}selectBlocksInBox(t,e){for(const o of this.blocks.values()){const n=o.gridPosition;n.x>=t.x&&n.x<=e.x&&n.y>=t.y&&n.y<=e.y&&n.z>=t.z&&n.z<=e.z&&(this.selectedBlocks.add(o),o.setSelected(!0))}this.notifySelectionChange()}deselectAll(){for(const t of this.selectedBlocks)t.setSelected(!1);this.selectedBlocks.clear(),this.notifySelectionChange()}notifySelectionChange(){this.onSelectionChange&&this.onSelectionChange(this.getSelectedBlocks())}getBlockMeshes(){return this.blockGroup.children}getAllBlocks(){return Array.from(this.blocks.values())}getBlockById(t){return this.blocks.get(t)||null}positionKey(t){return`${t.x},${t.y},${t.z}`}getBlockCount(){return this.blocks.size}notifyBlockCountChange(){this.onBlockCountChange&&this.onBlockCountChange(this.blocks.size)}clear(){for(const t of this.blocks.values())this.blockGroup.remove(t.mesh),t.dispose();this.blocks.clear();for(const t of this.mergedMeshes.values())this.blockGroup.remove(t.mesh),t.dispose();this.mergedMeshes.clear(),this.selectedBlocks.clear(),this.notifyBlockCountChange(),this.notifySelectionChange()}addMergedMesh(t){return this.mergedMeshes.set(t.id,t),this.blockGroup.add(t.mesh),this.notifyBlockCountChange(),t}removeMergedMesh(t){const e=this.mergedMeshes.get(t);return e?(this.blockGroup.remove(e.mesh),e.dispose(),this.mergedMeshes.delete(t),this.notifyBlockCountChange(),!0):!1}getMergedMeshes(){return Array.from(this.mergedMeshes.values())}getMergedMeshByMesh(t){return t.userData.merged?t.userData.merged:null}toJSON(){return Array.from(this.blocks.values()).map(t=>t.toJSON())}fromJSON(t){this.clear();const{blocks:e,invalidCount:o}=Xw(t);o>0&&console.warn(`Skipped ${o} invalid block(s) during load`);for(const n of e)this.addBlock({type:n.type,position:n.position,dimensions:n.dimensions,rotation:n.rotation,color:n.color,emissive:n.emissive,faces:n.faces,layerId:n.layerId||"default",scale:n.scale||1});return{loadedCount:e.length,invalidCount:o}}}class Zw{constructor(t,e){cs(this,"handleMouseMove",t=>{this.updateMouse(t);const e=this.raycast();if(this.isDragging&&this.currentTool==="shape"&&this.onShapeDrag){if(e&&this.dragStartPos){const o=e.placementPosition;this.onShapeDrag(this.dragStartPos,o)}return}if(this.isPainting&&this.currentTool==="paint"&&this.onPaint&&e&&e.block){const n=`${e.block.id}_${e.normal.x}_${e.normal.y}_${e.normal.z}`;n!==this.lastPaintedBlock&&(this.onPaint(e,!1),this.lastPaintedBlock=n)}this.onMouseMove&&this.onMouseMove(e)});cs(this,"handleMouseDown",t=>{if(t.button!==0&&t.button!==1)return;this.updateMouse(t);const e=this.raycast();if(e){if(t.button===1){this.onDelete&&e.block&&this.onDelete(e.block);return}if(t.ctrlKey&&e.block){this.onReplace&&this.onReplace(e.block);return}if(t.altKey&&e.block){this.onPickBlock&&this.onPickBlock(e.block);return}switch(this.currentTool){case"place":this.onPlace&&this.onPlace(e,t.shiftKey);break;case"delete":this.onDelete&&e.block&&this.onDelete(e.block);break;case"select":this.onSelect&&this.onSelect(e.block||null,t.shiftKey);break;case"paint":if(this.onPaint&&e.block){this.isPainting=!0;const n=`${e.block.id}_${e.normal.x}_${e.normal.y}_${e.normal.z}`;this.lastPaintedBlock=n,this.onPaint(e,t.shiftKey)}break;case"pick":this.onPick&&e.block&&this.onPick(e);break;case"shape":this.isDragging=!0,this.dragStartPos=e.placementPosition,this.dragStartResult=e,this.onShapeDrag&&this.onShapeDrag(this.dragStartPos,this.dragStartPos);break;case"scatter":this.onScatterPlace&&this.onScatterPlace(e);break}}});cs(this,"handleMouseUp",t=>{if(t.button===0){if(this.isDragging&&this.currentTool==="shape"){this.updateMouse(t);const e=this.raycast();if(e&&this.dragStartPos&&this.onShapePlace){const o=e.placementPosition;this.onShapePlace(this.dragStartPos,o)}this.isDragging=!1,this.dragStartPos=null,this.dragStartResult=null}this.isPainting&&(this.isPainting=!1,this.lastPaintedBlock=null)}});cs(this,"handleKeyDown",t=>{});this.canvas=t,this.camera=e,this.raycaster=new Bc,this.mouse=new ct,this.currentTool="place",this.onPlace=null,this.onDelete=null,this.onSelect=null,this.onPaint=null,this.onPick=null,this.onMouseMove=null,this.onReplace=null,this.onPickBlock=null,this.onShapeDrag=null,this.onShapePlace=null,this.onScatterPlace=null,this.isDragging=!1,this.dragStartPos=null,this.dragStartResult=null,this.isPainting=!1,this.lastPaintedBlock=null,this.raycastTargets=[],this.gridPlane=null,this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),window.addEventListener("keydown",this.handleKeyDown)}setGridPlane(t){this.gridPlane=t}setRaycastTargets(t){this.raycastTargets=t}setTool(t){this.currentTool=t}updateMouse(t){const e=this.canvas.getBoundingClientRect();this.mouse.x=(t.clientX-e.left)/e.width*2-1,this.mouse.y=-((t.clientY-e.top)/e.height)*2+1}raycast(){this.raycaster.setFromCamera(this.mouse,this.camera);const t=this.raycaster.intersectObjects(this.raycastTargets,!1);if(t.length>0){const e=t[0],o=e.object.userData.block,n=e.object.userData.merged,s=e.face.normal.clone();if(s.transformDirection(e.object.matrixWorld),s.x=Math.abs(s.x)>.5?Math.sign(s.x):0,s.y=Math.abs(s.y)>.5?Math.sign(s.y):0,s.z=Math.abs(s.z)>.5?Math.sign(s.z):0,n&&!o){const r=e.point;let a={x:Math.floor(r.x+s.x*.5),y:Math.floor(r.y+s.y*.5),z:Math.floor(r.z+s.z*.5)};return s.y>0&&(a.y=Math.floor(r.y),a.surfaceY=r.y),{type:"merged",point:e.point,normal:s,block:null,merged:n,placementPosition:a,faceIndex:e.faceIndex}}if(o){const r=o,a=r.gridPosition,l=r.dimensions,c=r.scale||1,p=Jn[r.type]||1,h=(Qn[r.type]||0)*c,u=l.h*p*c;let d={x:a.x,y:a.y,z:a.z};if(s.y>0){const y=a.y+h+u;d.y=Math.floor(y),d.surfaceY=y}else s.y<0?d.y=a.y-1:s.x!==0?d.x=a.x+s.x*l.w*c:s.z!==0&&(d.z=a.z+s.z*l.d*c);return{type:"block",point:e.point,normal:s,block:o,placementPosition:d,faceIndex:e.faceIndex}}}if(this.gridPlane){const e=this.raycaster.intersectObject(this.gridPlane,!1);if(e.length>0){const o=e[0],n={x:Math.floor(o.point.x),y:0,z:Math.floor(o.point.z)};return{type:"grid",point:o.point,normal:new R(0,1,0),block:null,placementPosition:n}}}return null}dispose(){this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),window.removeEventListener("keydown",this.handleKeyDown)}}class Yw{constructor(t){this.scene=t,this.visible=!1,this.currentType="cube",this.currentScale=1,this.group=new Zn,this.scene.add(this.group),this.mesh=null,this.wireframe=null,this.createMesh("cube")}createMesh(t){this.mesh&&(this.group.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.wireframe&&(this.wireframe.geometry.dispose(),this.wireframe.material.dispose()));const e=this.createGeometry(t),o=new Ri({color:5605580,transparent:!0,opacity:.4,depthWrite:!1});this.mesh=new ge(e,o),this.mesh.visible=this.visible;const n=new Ts(e),s=new $n({color:16777215,transparent:!0,opacity:.6});this.wireframe=new Xi(n,s),this.mesh.add(this.wireframe),this.group.add(this.mesh),this.currentType=t}createGeometry(t){const o=(Qr[t]||Qr.cube)({w:1,h:1,d:1});return this.currentScale>1&&o.scale(this.currentScale,this.currentScale,this.currentScale),o}show(){this.mesh.visible=!0,this.visible=!0}hide(){this.mesh.visible=!1,this.visible=!1}setPosition(t){const e=Jn[this.currentType]||1,o=Qn[this.currentType]||0,n=e*this.currentScale,s=o*this.currentScale+n/2,r=this.currentScale/2;this.group.position.set(t.x+r,t.y+s,t.z+r)}setBlockType(t){t!==this.currentType&&(this.createMesh(t),this.mesh.visible=this.visible)}setScale(t){t!==this.currentScale&&(this.currentScale=t,this.createMesh(this.currentType),this.mesh.visible=this.visible)}setRotation(t){this.group.rotation.y=Me.degToRad(t)}setColor(t){this.mesh.material.color.set(t)}setValid(t){t?(this.mesh.material.color.set(5605580),this.mesh.material.opacity=.4):(this.mesh.material.color.set(16729156),this.mesh.material.opacity=.6)}dispose(){this.scene.remove(this.group),this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material.dispose()),this.wireframe&&(this.wireframe.geometry.dispose(),this.wireframe.material.dispose())}}class $w{constructor(){this.atlases=new Map,this.materials=new Map,this.loader=new x2,this.createDefaultMaterials()}createDefaultMaterials(){[{id:"white",name:"White",color:"#ffffff"},{id:"gray",name:"Gray",color:"#888888"},{id:"black",name:"Black",color:"#222222"},{id:"red",name:"Red",color:"#e74c3c"},{id:"orange",name:"Orange",color:"#e67e22"},{id:"yellow",name:"Yellow",color:"#f1c40f"},{id:"green",name:"Green",color:"#2ecc71"},{id:"cyan",name:"Cyan",color:"#1abc9c"},{id:"blue",name:"Blue",color:"#3498db"},{id:"purple",name:"Purple",color:"#9b59b6"},{id:"pink",name:"Pink",color:"#e91e63"},{id:"brown",name:"Brown",color:"#795548"}].forEach(e=>{this.materials.set(e.id,{id:e.id,name:e.name,baseColor:e.color,albedoTile:null,roughness:.7,metallic:0,emission:null,emissionStrength:0})})}async loadAtlas(t,e,o,n,s){return new Promise((r,a)=>{this.loader.load(e,l=>{l.magFilter=Se,l.minFilter=Se,l.colorSpace=to;const c={id:t,texture:l,tileSize:o,columns:n,rows:s,totalTiles:n*s};this.atlases.set(t,c),this.createAtlasMaterials(c),r(c)},void 0,a)})}createAtlasMaterials(t){for(let e=0;e<t.totalTiles;e++){const o=e%t.columns,n=Math.floor(e/t.columns),s=`${t.id}_tile_${e}`;this.materials.set(s,{id:s,name:`Tile ${e}`,baseColor:"#ffffff",albedoTile:{atlasId:t.id,index:e,col:o,row:n},roughness:.8,metallic:0,emission:null,emissionStrength:0})}}getMaterial(t){return this.materials.get(t)}getAllMaterials(){return Array.from(this.materials.values())}getColorMaterials(){return Array.from(this.materials.values()).filter(t=>!t.albedoTile)}getAtlasMaterials(t){return Array.from(this.materials.values()).filter(e=>e.albedoTile&&e.albedoTile.atlasId===t)}createThreeMaterial(t){const e=this.materials.get(t);if(!e)return null;const o={color:e.baseColor,roughness:e.roughness,metalness:e.metallic};if(e.albedoTile){const n=this.atlases.get(e.albedoTile.atlasId);if(n){const s=n.texture.clone();s.needsUpdate=!0,s.repeat.set(1/n.columns,1/n.rows),s.offset.set(e.albedoTile.col/n.columns,1-(e.albedoTile.row+1)/n.rows),o.map=s}}return e.emission&&(o.emissive=new bt(e.emission),o.emissiveIntensity=e.emissionStrength),new Ge(o)}createFaceMaterial(t,e=0,o={x:!1,y:!1}){const n=this.createThreeMaterial(t);return n?(n.userData={uvRotation:e,uvFlip:o},n):null}}class qw{constructor(t=50){this.undoStack=[],this.redoStack=[],this.maxSize=t,this.onChange=null}push(t){this.undoStack.push(t),this.redoStack=[],this.undoStack.length>this.maxSize&&this.undoStack.shift(),this.notify()}undo(){if(this.undoStack.length===0)return!1;const t=this.undoStack.pop();return t.undo(),this.redoStack.push(t),this.notify(),!0}redo(){if(this.redoStack.length===0)return!1;const t=this.redoStack.pop();return t.redo(),this.undoStack.push(t),this.notify(),!0}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}clear(){this.undoStack=[],this.redoStack=[],this.notify()}notify(){this.onChange&&this.onChange({canUndo:this.canUndo(),canRedo:this.canRedo()})}}function Us(i,t,e){return{type:"addBlock",data:t,undo:()=>{i.removeBlock(e.id)},redo:()=>{i.addBlock(t)}}}function Xc(i,t){const e=t.toJSON();return{type:"removeBlock",data:e,undo:()=>{i.addBlock(e)},redo:()=>{i.removeBlockAtPosition(e.position)}}}function jw(i,t,e,o){return{type:"paintFaceColor",data:{blockId:i.id,faceDirection:t,oldColor:e,newColor:o},undo:()=>{if(e===null){if(i.faces[t].color=null,Array.isArray(i.mesh.material)){const s=["east","west","top","bottom","south","north"].indexOf(t);s!==-1&&i.mesh.material[s].color.set(i.color)}}else i.setFaceColor(t,e)},redo:()=>{i.setFaceColor(t,o)}}}function Kw(i,t,e,o){return{type:"paintBlockColor",data:{blockId:i.id,oldColor:t,newColor:e},undo:()=>{i.setColor(t),o&&Object.entries(o).forEach(([s,r])=>{r&&r.color&&i.setFaceColor(s,r.color)})},redo:()=>{i.setColor(e)}}}function _0(i){return{type:"batchPaint",data:{count:i.length},undo:()=>{for(let t=i.length-1;t>=0;t--)i[t].undo()},redo:()=>{i.forEach(t=>t.redo())}}}function Jw(i,t,e){return{type:"flatten",data:{blockCount:t.length,mergedCount:e.length},undo:()=>{for(const o of e)i.removeMergedMesh(o);for(const o of t)i.addBlock(o)},redo:()=>{const o=i.getAllBlocks().filter(n=>t.some(s=>s.position.x===n.gridPosition.x&&s.position.y===n.gridPosition.y&&s.position.z===n.gridPosition.z));for(const n of o)i.removeBlock(n.id)}}}class ea{constructor(t={}){this.id=t.id||`anim_${Date.now()}`,this.name=t.name||"Animation",this.duration=t.duration||1e3,this.loop=t.loop||!1,this.curve=t.curve||"easeInOut",this.keyframes=t.keyframes||[]}addKeyframe(t,e,o){this.keyframes=this.keyframes.filter(n=>!(n.time===t&&n.blockId===e)),this.keyframes.push({time:t,blockId:e,properties:o}),this.keyframes.sort((n,s)=>n.time-s.time)}removeKeyframe(t,e){this.keyframes=this.keyframes.filter(o=>!(o.time===t&&o.blockId===e))}getKeyframesForBlock(t){return this.keyframes.filter(e=>e.blockId===t)}getKeyframesAtTime(t){return this.keyframes.filter(e=>e.time===t)}toJSON(){return{id:this.id,name:this.name,duration:this.duration,loop:this.loop,curve:this.curve,keyframes:this.keyframes}}static fromJSON(t){return new ea(t)}}class Qw{constructor(t){this.blockManager=t,this.animations=new Map,this.currentAnimation=null,this.isPlaying=!1,this.currentTime=0,this.playbackSpeed=1,this.originalStates=new Map,this.onTimeUpdate=null,this.onPlayStateChange=null}createAnimation(t="New Animation",e=2e3){const o=new ea({name:t,duration:e});return this.animations.set(o.id,o),o}deleteAnimation(t){var e;this.animations.delete(t),((e=this.currentAnimation)==null?void 0:e.id)===t&&(this.currentAnimation=null,this.stop())}setCurrentAnimation(t){this.stop(),this.currentAnimation=this.animations.get(t)||null,this.currentTime=0}captureInitialState(){if(this.currentAnimation){this.originalStates.clear();for(const t of this.blockManager.blocks.values())this.originalStates.set(t.id,{position:{...t.gridPosition},rotation:{...t.rotation},scale:{...t.dimensions},color:t.color,emissive:t.emissive?{...t.emissive}:null})}}addKeyframe(t){return!this.currentAnimation||!t?0:(this.currentAnimation.addKeyframe(this.currentTime,t.id,{position:{...t.gridPosition},rotation:{...t.rotation},scale:{...t.dimensions},color:t.color,emissive:t.emissive?{...t.emissive}:null}),1)}addKeyframesForSelection(t){if(!this.currentAnimation||!t||t.length===0)return 0;let e=0;for(const o of t)this.currentAnimation.addKeyframe(this.currentTime,o.id,{position:{...o.gridPosition},rotation:{...o.rotation},scale:{...o.dimensions},color:o.color,emissive:o.emissive?{...o.emissive}:null}),e++;return e}removeKeyframe(t){if(!this.currentAnimation)return 0;const e=this.currentAnimation.keyframes.length;return this.currentAnimation.removeKeyframe(this.currentTime,t),e-this.currentAnimation.keyframes.length}removeKeyframesForSelection(t){if(!this.currentAnimation||!t||t.length===0)return 0;let e=0;for(const o of t){const n=this.currentAnimation.keyframes.length;this.currentAnimation.removeKeyframe(this.currentTime,o),this.currentAnimation.keyframes.length<n&&e++}return e}hasKeyframesAtCurrentTime(t){return this.currentAnimation?this.currentAnimation.getKeyframesAtTime(this.currentTime).some(o=>t.includes(o.blockId)):!1}play(){this.currentAnimation&&(this.captureInitialState(),this.isPlaying=!0,this.lastTime=performance.now(),this.onPlayStateChange&&this.onPlayStateChange(!0))}pause(){this.isPlaying=!1,this.onPlayStateChange&&this.onPlayStateChange(!1)}stop(){this.isPlaying=!1,this.currentTime=0,this.restoreOriginalStates(),this.onPlayStateChange&&this.onPlayStateChange(!1),this.onTimeUpdate&&this.onTimeUpdate(0)}restoreOriginalStates(){for(const[t,e]of this.originalStates){const o=this.blockManager.blocks.get(t);o&&(o.setPosition(e.position),o.setRotation(e.rotation),o.setColor(e.color),e.emissive&&o.setEmissive&&o.setEmissive(e.emissive))}}setTime(t){var e;this.currentTime=Math.max(0,Math.min(t,((e=this.currentAnimation)==null?void 0:e.duration)||0)),this.updateBlocks(),this.onTimeUpdate&&this.onTimeUpdate(this.currentTime)}update(t){!this.isPlaying||!this.currentAnimation||(this.currentTime+=t*1e3*this.playbackSpeed,this.currentTime>=this.currentAnimation.duration&&(this.currentAnimation.loop?this.currentTime=this.currentTime%this.currentAnimation.duration:(this.currentTime=this.currentAnimation.duration,this.pause())),this.updateBlocks(),this.onTimeUpdate&&this.onTimeUpdate(this.currentTime))}updateBlocks(){if(!this.currentAnimation)return;const t=new Map;for(const e of this.currentAnimation.keyframes)t.has(e.blockId)||t.set(e.blockId,[]),t.get(e.blockId).push(e);for(const[e,o]of t){const n=this.blockManager.blocks.get(e);if(!n||o.length===0)continue;let s=null,r=null;for(const a of o)a.time<=this.currentTime?s=a:r||(r=a);if(s&&r){const a=(this.currentTime-s.time)/(r.time-s.time);this.interpolateBlock(n,s.properties,r.properties,a)}else if(s)this.applyProperties(n,s.properties);else if(r){const a=this.originalStates.get(e);a&&(n.setPosition(a.position),n.setRotation(a.rotation))}}}interpolateBlock(t,e,o,n){const s=this.applyCurve(n);if(e.position&&o.position&&t.setPosition({x:Math.round(this.lerp(e.position.x,o.position.x,s)),y:Math.round(this.lerp(e.position.y,o.position.y,s)),z:Math.round(this.lerp(e.position.z,o.position.z,s))}),e.rotation&&o.rotation&&t.setRotation({x:this.lerp(e.rotation.x,o.rotation.x,s),y:this.lerp(e.rotation.y,o.rotation.y,s),z:this.lerp(e.rotation.z,o.rotation.z,s)}),e.color&&o.color){const r=new bt(e.color),a=new bt(o.color);r.lerp(a,s),t.setColor("#"+r.getHexString())}if(e.emissive&&o.emissive&&t.setEmissive){const r=new bt(e.emissive.color||"#000000"),a=new bt(o.emissive.color||"#000000");r.lerp(a,s),t.setEmissive({enabled:o.emissive.enabled,color:"#"+r.getHexString(),intensity:this.lerp(e.emissive.intensity||0,o.emissive.intensity||0,s),radius:this.lerp(e.emissive.radius||0,o.emissive.radius||0,s)})}else if(o.emissive&&t.setEmissive)t.setEmissive(o.emissive);else if(e.emissive&&!o.emissive&&t.setEmissive){const r=new bt(e.emissive.color||"#000000");t.setEmissive({enabled:s<.5?e.emissive.enabled:!1,color:"#"+r.getHexString(),intensity:this.lerp(e.emissive.intensity||0,0,s),radius:e.emissive.radius||0})}}applyProperties(t,e){e.position&&t.setPosition(e.position),e.rotation&&t.setRotation(e.rotation),e.color&&t.setColor(e.color),e.emissive&&t.setEmissive&&t.setEmissive(e.emissive)}lerp(t,e,o){return t+(e-t)*o}applyCurve(t){if(!this.currentAnimation)return t;switch(this.currentAnimation.curve||"easeInOut"){case"linear":return t;case"easeIn":return t*t;case"easeOut":return 1-Math.pow(1-t,2);case"easeInOut":return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;case"smoothstep":return t*t*(3-2*t);default:return t}}getAllAnimations(){return Array.from(this.animations.values())}toJSON(){var t;return{animations:Array.from(this.animations.values()).map(e=>e.toJSON()),currentAnimationId:((t=this.currentAnimation)==null?void 0:t.id)||null}}fromJSON(t){this.animations.clear();for(const e of t.animations||[]){const o=ea.fromJSON(e);this.animations.set(o.id,o)}t.currentAnimationId&&this.setCurrentAnimation(t.currentAnimationId)}clear(){this.stop(),this.animations.clear(),this.currentAnimation=null,this.originalStates.clear()}}class tM{constructor(t,e,o,n=null){this.blockManager=t,this.animator=e,this.textureManager=o,this.layerManager=n,this.currentProjectName="Untitled",this.onError=null}setLayerManager(t){this.layerManager=t}notifyError(t,e=null){console.error(t,e),this.onError&&this.onError(t,e)}save(){try{const t=this.currentProjectName||"Untitled",e=prompt("Save project as:",t);if(e===null)return!1;const o=e.trim()||"Untitled";this.currentProjectName=o;const n={version:"1.0",name:o,createdAt:new Date().toISOString(),blocks:this.blockManager.toJSON(),animations:this.animator.toJSON(),layers:this.layerManager?this.layerManager.toJSON():null},s=JSON.stringify(n,null,2),r=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(r),l=document.createElement("a");return l.href=a,l.download=`${o.replace(/\s+/g,"_")}.blocks`,l.click(),URL.revokeObjectURL(a),!0}catch(t){return this.notifyError("Failed to save project",t),!1}}async load(t){return new Promise((e,o)=>{if(!t){const s=new Error("No file provided");this.notifyError("No file provided for loading",s),o(s);return}const n=new FileReader;n.onload=s=>{try{const r=s.target.result;if(!r||r.trim()==="")throw new Error("File is empty");const a=JSON.parse(r);if(!a||typeof a!="object")throw new Error("Invalid project format");const l=Hw(a);if(!l.valid)throw new Error(`Invalid project: ${l.errors.join(", ")}`);for(const c of l.warnings)console.warn("Project warning:",c);if(this.currentProjectName=a.name||"Loaded Project",a.blocks&&Array.isArray(a.blocks)){const c=this.blockManager.fromJSON(a.blocks);c.invalidCount>0&&console.warn(`Loaded ${c.loadedCount} blocks, skipped ${c.invalidCount} invalid blocks`)}else console.warn("No blocks found in project file");a.animations&&this.animator.fromJSON(a.animations),a.layers&&this.layerManager&&this.layerManager.fromJSON(a.layers),e(a)}catch(r){this.notifyError(`Failed to parse project file: ${r.message}`,r),o(r)}},n.onerror=s=>{const r=new Error("Failed to read file");this.notifyError("Failed to read project file",r),o(r)},n.readAsText(t)})}newProject(){try{return this.currentProjectName="Untitled",this.blockManager.clear(),this.animator.animations.clear(),this.animator.currentAnimation=null,this.layerManager&&this.layerManager.clear(),!0}catch(t){return this.notifyError("Failed to create new project",t),!1}}setProjectName(t){this.currentProjectName=t}}const w0={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};let oa=class{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(t){return new pM(t)}),this.register(function(t){return new hM(t)}),this.register(function(t){return new mM(t)}),this.register(function(t){return new yM(t)}),this.register(function(t){return new gM(t)}),this.register(function(t){return new xM(t)}),this.register(function(t){return new uM(t)}),this.register(function(t){return new dM(t)}),this.register(function(t){return new fM(t)}),this.register(function(t){return new bM(t)}),this.register(function(t){return new vM(t)}),this.register(function(t){return new _M(t)}),this.register(function(t){return new wM(t)}),this.register(function(t){return new MM(t)})}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}setTextureUtils(t){return this.textureUtils=t,this}parse(t,e,o,n){const s=new cM,r=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)r.push(this.pluginCallbacks[a](s));s.setPlugins(r),s.setTextureUtils(this.textureUtils),s.writeAsync(t,e,n).catch(o)}parseAsync(t,e){const o=this;return new Promise(function(n,s){o.parse(t,n,s,e)})}};const ie={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Wc="KHR_mesh_quantization",_o={};_o[Se]=ie.NEAREST,_o[Kp]=ie.NEAREST_MIPMAP_NEAREST,_o[ps]=ie.NEAREST_MIPMAP_LINEAR,_o[uo]=ie.LINEAR,_o[er]=ie.LINEAR_MIPMAP_NEAREST,_o[gn]=ie.LINEAR_MIPMAP_LINEAR,_o[yn]=ie.CLAMP_TO_EDGE,_o[Qs]=ie.REPEAT,_o[tr]=ie.MIRRORED_REPEAT;const M0={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},eM=new bt,z0=12,oM=1179937895,nM=2,S0=8,iM=1313821514,sM=5130562;function Ns(i,t){return i.length===t.length&&i.every(function(e,o){return e===t[o]})}function rM(i){return new TextEncoder().encode(i).buffer}function aM(i){return Ns(i.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function lM(i,t,e){const o={min:new Array(i.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(i.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+e;n++)for(let s=0;s<i.itemSize;s++){let r;i.itemSize>4?r=i.array[n*i.itemSize+s]:(s===0?r=i.getX(n):s===1?r=i.getY(n):s===2?r=i.getZ(n):s===3&&(r=i.getW(n)),i.normalized===!0&&(r=Me.normalize(r,i.array))),o.min[s]=Math.min(o.min[s],r),o.max[s]=Math.max(o.max[s],r)}return o}function E0(i){return Math.ceil(i/4)*4}function Zc(i,t=0){const e=E0(i.byteLength);if(e!==i.byteLength){const o=new Uint8Array(e);if(o.set(new Uint8Array(i)),t!==0)for(let n=i.byteLength;n<e;n++)o[n]=t;return o.buffer}return i}function F0(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function A0(i,t){if(i.toBlob!==void 0)return new Promise(o=>i.toBlob(o,t));let e;return t==="image/jpeg"?e=.92:t==="image/webp"&&(e=.8),i.convertToBlob({type:t,quality:e})}class cM{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+lo}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(t){this.plugins=t}setTextureUtils(t){this.textureUtils=t}async writeAsync(t,e,o={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},o),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(t),await Promise.all(this.pending);const n=this,s=n.buffers,r=n.json;o=n.options;const a=n.extensionsUsed,l=n.extensionsRequired,c=new Blob(s,{type:"application/octet-stream"}),p=Object.keys(a),h=Object.keys(l);if(p.length>0&&(r.extensionsUsed=p),h.length>0&&(r.extensionsRequired=h),r.buffers&&r.buffers.length>0&&(r.buffers[0].byteLength=c.size),o.binary===!0){const u=new FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){const d=Zc(u.result),y=new DataView(new ArrayBuffer(S0));y.setUint32(0,d.byteLength,!0),y.setUint32(4,sM,!0);const g=Zc(rM(JSON.stringify(r)),32),f=new DataView(new ArrayBuffer(S0));f.setUint32(0,g.byteLength,!0),f.setUint32(4,iM,!0);const m=new ArrayBuffer(z0),b=new DataView(m);b.setUint32(0,oM,!0),b.setUint32(4,nM,!0);const v=z0+f.byteLength+g.byteLength+y.byteLength+d.byteLength;b.setUint32(8,v,!0);const x=new Blob([m,f,g,y,d],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(x),_.onloadend=function(){e(_.result)}}}else if(r.buffers&&r.buffers.length>0){const u=new FileReader;u.readAsDataURL(c),u.onloadend=function(){const d=u.result;r.buffers[0].uri=d,e(r)}}else e(r)}serializeUserData(t,e){if(Object.keys(t.userData).length===0)return;const o=this.options,n=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(t.userData));if(o.includeCustomExtensions&&s.gltfExtensions){e.extensions===void 0&&(e.extensions={});for(const r in s.gltfExtensions)e.extensions[r]=s.gltfExtensions[r],n[r]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(e.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(t,e=!1){if(this.uids.has(t)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(t,n)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const o=new R;for(let n=0,s=t.count;n<s;n++)if(Math.abs(o.fromBufferAttribute(t,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);const o=t.clone(),n=new R;for(let s=0,r=o.count;s<r;s++)n.fromBufferAttribute(o,s),n.x===0&&n.y===0&&n.z===0?n.setX(1):n.normalize(),o.setXYZ(s,n.x,n.y,n.z);return e.attributesNormalized.set(t,o),o}applyTextureTransform(t,e){let o=!1;const n={};(e.offset.x!==0||e.offset.y!==0)&&(n.offset=e.offset.toArray(),o=!0),e.rotation!==0&&(n.rotation=e.rotation,o=!0),(e.repeat.x!==1||e.repeat.y!==1)&&(n.scale=e.repeat.toArray(),o=!0),o&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=n,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(t,e){if(t===e)return t;function o(d){return d.colorSpace===to?function(g){return g<.04045?g*.0773993808:Math.pow(g*.9478672986+.0521327014,2.4)}:function(g){return g}}t instanceof mc&&(t=await this.decompressTextureAsync(t)),e instanceof mc&&(e=await this.decompressTextureAsync(e));const n=t?t.image:null,s=e?e.image:null,r=Math.max(n?n.width:0,s?s.width:0),a=Math.max(n?n.height:0,s?s.height:0),l=F0();l.width=r,l.height=a;const c=l.getContext("2d",{willReadFrequently:!0});c.fillStyle="#00ffff",c.fillRect(0,0,r,a);const p=c.getImageData(0,0,r,a);if(n){c.drawImage(n,0,0,r,a);const d=o(t),y=c.getImageData(0,0,r,a).data;for(let g=2;g<y.length;g+=4)p.data[g]=d(y[g]/256)*256}if(s){c.drawImage(s,0,0,r,a);const d=o(e),y=c.getImageData(0,0,r,a).data;for(let g=1;g<y.length;g+=4)p.data[g]=d(y[g]/256)*256}c.putImageData(p,0,0);const u=(t||e).clone();return u.source=new Dl(l),u.colorSpace=Ko,u.channel=(t||e).channel,t&&e&&t.channel!==e.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),u}async decompressTextureAsync(t,e=1/0){if(this.textureUtils===null)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(t,e)}processBuffer(t){const e=this.json,o=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),o.push(t),0}processBufferView(t,e,o,n,s){const r=this.json;r.bufferViews||(r.bufferViews=[]);let a;switch(e){case ie.BYTE:case ie.UNSIGNED_BYTE:a=1;break;case ie.SHORT:case ie.UNSIGNED_SHORT:a=2;break;default:a=4}let l=t.itemSize*a;s===ie.ARRAY_BUFFER&&(l=Math.ceil(l/4)*4);const c=E0(n*l),p=new DataView(new ArrayBuffer(c));let h=0;for(let y=o;y<o+n;y++){for(let g=0;g<t.itemSize;g++){let f;t.itemSize>4?f=t.array[y*t.itemSize+g]:(g===0?f=t.getX(y):g===1?f=t.getY(y):g===2?f=t.getZ(y):g===3&&(f=t.getW(y)),t.normalized===!0&&(f=Me.normalize(f,t.array))),e===ie.FLOAT?p.setFloat32(h,f,!0):e===ie.INT?p.setInt32(h,f,!0):e===ie.UNSIGNED_INT?p.setUint32(h,f,!0):e===ie.SHORT?p.setInt16(h,f,!0):e===ie.UNSIGNED_SHORT?p.setUint16(h,f,!0):e===ie.BYTE?p.setInt8(h,f):e===ie.UNSIGNED_BYTE&&p.setUint8(h,f),h+=a}h%l!==0&&(h+=l-h%l)}const u={buffer:this.processBuffer(p.buffer),byteOffset:this.byteOffset,byteLength:c};return s!==void 0&&(u.target=s),s===ie.ARRAY_BUFFER&&(u.byteStride=l),this.byteOffset+=c,r.bufferViews.push(u),{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,o=e.json;return o.bufferViews||(o.bufferViews=[]),new Promise(function(n){const s=new FileReader;s.readAsArrayBuffer(t),s.onloadend=function(){const r=Zc(s.result),a={buffer:e.processBuffer(r),byteOffset:e.byteOffset,byteLength:r.byteLength};e.byteOffset+=r.byteLength,n(o.bufferViews.push(a)-1)}})}processAccessor(t,e,o,n){const s=this.json,r={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(t.array.constructor===Float32Array)a=ie.FLOAT;else if(t.array.constructor===Int32Array)a=ie.INT;else if(t.array.constructor===Uint32Array)a=ie.UNSIGNED_INT;else if(t.array.constructor===Int16Array)a=ie.SHORT;else if(t.array.constructor===Uint16Array)a=ie.UNSIGNED_SHORT;else if(t.array.constructor===Int8Array)a=ie.BYTE;else if(t.array.constructor===Uint8Array)a=ie.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+t.array.constructor.name);if(o===void 0&&(o=0),(n===void 0||n===1/0)&&(n=t.count),n===0)return null;const l=lM(t,o,n);let c;e!==void 0&&(c=t===e.index?ie.ELEMENT_ARRAY_BUFFER:ie.ARRAY_BUFFER);const p=this.processBufferView(t,a,o,n,c),h={bufferView:p.id,byteOffset:p.byteOffset,componentType:a,count:n,max:l.max,min:l.min,type:r[t.itemSize]};return t.normalized===!0&&(h.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(h)-1}processImage(t,e,o,n="image/png"){if(t!==null){const s=this,r=s.cache,a=s.json,l=s.options,c=s.pending;r.images.has(t)||r.images.set(t,{});const p=r.images.get(t),h=n+":flipY/"+o.toString();if(p[h]!==void 0)return p[h];a.images||(a.images=[]);const u={mimeType:n},d=F0();d.width=Math.min(t.width,l.maxTextureSize),d.height=Math.min(t.height,l.maxTextureSize);const y=d.getContext("2d",{willReadFrequently:!0});if(o===!0&&(y.translate(0,d.height),y.scale(1,-1)),t.data!==void 0){e!==fo&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(t.width>l.maxTextureSize||t.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const f=new Uint8ClampedArray(t.height*t.width*4);for(let m=0;m<f.length;m+=4)f[m+0]=t.data[m+0],f[m+1]=t.data[m+1],f[m+2]=t.data[m+2],f[m+3]=t.data[m+3];y.putImageData(new ImageData(f,t.width,t.height),0,0)}else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)y.drawImage(t,0,0,d.width,d.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(A0(d,n).then(f=>s.processBufferViewImage(f)).then(f=>{u.bufferView=f})):d.toDataURL!==void 0?u.uri=d.toDataURL(n):c.push(A0(d,n).then(f=>new FileReader().readAsDataURL(f)).then(f=>{u.uri=f}));const g=a.images.push(u)-1;return p[h]=g,g}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const o={magFilter:_o[t.magFilter],minFilter:_o[t.minFilter],wrapS:_o[t.wrapS],wrapT:_o[t.wrapT]};return e.samplers.push(o)-1}async processTextureAsync(t){const o=this.options,n=this.cache,s=this.json;if(n.textures.has(t))return n.textures.get(t);s.textures||(s.textures=[]),t instanceof mc&&(t=await this.decompressTextureAsync(t,o.maxTextureSize));let r=t.userData.mimeType;r==="image/webp"&&(r="image/png");const a={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,r)};t.name&&(a.name=t.name),await this._invokeAllAsync(async function(c){c.writeTexture&&await c.writeTexture(t,a)});const l=s.textures.push(a)-1;return n.textures.set(t,l),l}async processMaterialAsync(t){const e=this.cache,o=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;o.materials||(o.materials=[]);const n={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=t.color.toArray().concat([t.opacity]);if(Ns(s,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=s),t.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=t.metalness,n.pbrMetallicRoughness.roughnessFactor=t.roughness):(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=1),t.metalnessMap||t.roughnessMap){const a=await this.buildMetalRoughTextureAsync(t.metalnessMap,t.roughnessMap),l={index:await this.processTextureAsync(a),texCoord:a.channel};this.applyTextureTransform(l,a),n.pbrMetallicRoughness.metallicRoughnessTexture=l}if(t.map){const a={index:await this.processTextureAsync(t.map),texCoord:t.map.channel};this.applyTextureTransform(a,t.map),n.pbrMetallicRoughness.baseColorTexture=a}if(t.emissive){const a=t.emissive;if(Math.max(a.r,a.g,a.b)>0&&(n.emissiveFactor=t.emissive.toArray()),t.emissiveMap){const c={index:await this.processTextureAsync(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(c,t.emissiveMap),n.emissiveTexture=c}}if(t.normalMap){const a={index:await this.processTextureAsync(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(a.scale=t.normalScale.x),this.applyTextureTransform(a,t.normalMap),n.normalTexture=a}if(t.aoMap){const a={index:await this.processTextureAsync(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(a.strength=t.aoMapIntensity),this.applyTextureTransform(a,t.aoMap),n.occlusionTexture=a}t.transparent?n.alphaMode="BLEND":t.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=t.alphaTest),t.side===Ze&&(n.doubleSided=!0),t.name!==""&&(n.name=t.name),this.serializeUserData(t,n),await this._invokeAllAsync(async function(a){a.writeMaterialAsync&&await a.writeMaterialAsync(t,n)});const r=o.materials.push(n)-1;return e.materials.set(t,r),r}async processMeshAsync(t){const e=this.cache,o=this.json,n=[t.geometry.uuid];if(Array.isArray(t.material))for(let x=0,_=t.material.length;x<_;x++)n.push(t.material[x].uuid);else n.push(t.material.uuid);const s=n.join(":");if(e.meshes.has(s))return e.meshes.get(s);const r=t.geometry;let a;t.isLineSegments?a=ie.LINES:t.isLineLoop?a=ie.LINE_LOOP:t.isLine?a=ie.LINE_STRIP:t.isPoints?a=ie.POINTS:a=t.material.wireframe?ie.LINES:ie.TRIANGLES;const l={},c={},p=[],h=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=r.getAttribute("normal");d!==void 0&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let y=null;for(let x in r.attributes){if(x.slice(0,5)==="morph")continue;const _=r.attributes[x];if(x=u[x]||x.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(x)||(x="_"+x),e.attributes.has(this.getUID(_))){c[x]=e.attributes.get(this.getUID(_));continue}y=null;const E=_.array;x==="JOINTS_0"&&!(E instanceof Uint16Array)&&!(E instanceof Uint8Array)?(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),y=new Gt(new Uint16Array(E),_.itemSize,_.normalized)):(E instanceof Uint32Array||E instanceof Int32Array)&&!x.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${x}" converted to type FLOAT.`),y=oa.Utils.toFloat32BufferAttribute(_));const C=this.processAccessor(y||_,r);C!==null&&(x.startsWith("_")||this.detectMeshQuantization(x,_),c[x]=C,e.attributes.set(this.getUID(_),C))}if(d!==void 0&&r.setAttribute("normal",d),Object.keys(c).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const x=[],_=[],z={};if(t.morphTargetDictionary!==void 0)for(const E in t.morphTargetDictionary)z[t.morphTargetDictionary[E]]=E;for(let E=0;E<t.morphTargetInfluences.length;++E){const C={};let M=!1;for(const S in r.morphAttributes){if(S!=="position"&&S!=="normal"){M||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),M=!0);continue}const k=r.morphAttributes[S][E],A=S.toUpperCase(),B=r.attributes[S];if(e.attributes.has(this.getUID(k,!0))){C[A]=e.attributes.get(this.getUID(k,!0));continue}const F=k.clone();if(!r.morphTargetsRelative)for(let N=0,G=k.count;N<G;N++)for(let W=0;W<k.itemSize;W++)W===0&&F.setX(N,k.getX(N)-B.getX(N)),W===1&&F.setY(N,k.getY(N)-B.getY(N)),W===2&&F.setZ(N,k.getZ(N)-B.getZ(N)),W===3&&F.setW(N,k.getW(N)-B.getW(N));C[A]=this.processAccessor(F,r),e.attributes.set(this.getUID(B,!0),C[A])}h.push(C),x.push(t.morphTargetInfluences[E]),t.morphTargetDictionary!==void 0&&_.push(z[E])}l.weights=x,_.length>0&&(l.extras={},l.extras.targetNames=_)}const g=Array.isArray(t.material);if(g&&r.groups.length===0)return null;let f=!1;if(g&&r.index===null){const x=[];for(let _=0,z=r.attributes.position.count;_<z;_++)x[_]=_;r.setIndex(x),f=!0}const m=g?t.material:[t.material],b=g?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let x=0,_=b.length;x<_;x++){const z={mode:a,attributes:c};if(this.serializeUserData(r,z),h.length>0&&(z.targets=h),r.index!==null){let C=this.getUID(r.index);(b[x].start!==void 0||b[x].count!==void 0)&&(C+=":"+b[x].start+":"+b[x].count),e.attributes.has(C)?z.indices=e.attributes.get(C):(z.indices=this.processAccessor(r.index,r,b[x].start,b[x].count),e.attributes.set(C,z.indices)),z.indices===null&&delete z.indices}const E=await this.processMaterialAsync(m[b[x].materialIndex]);E!==null&&(z.material=E),p.push(z)}f===!0&&r.setIndex(null),l.primitives=p,o.meshes||(o.meshes=[]),await this._invokeAllAsync(function(x){x.writeMesh&&x.writeMesh(t,l)});const v=o.meshes.push(l)-1;return e.meshes.set(s,v),v}detectMeshQuantization(t,e){if(this.extensionsUsed[Wc])return;let o;switch(e.array.constructor){case Int8Array:o="byte";break;case Uint8Array:o="unsigned byte";break;case Int16Array:o="short";break;case Uint16Array:o="unsigned short";break;default:return}e.normalized&&(o+=" normalized");const n=t.split("_",1)[0];w0[n]&&w0[n].includes(o)&&(this.extensionsUsed[Wc]=!0,this.extensionsRequired[Wc]=!0)}processCamera(t){const e=this.json;e.cameras||(e.cameras=[]);const o=t.isOrthographicCamera,n={type:o?"orthographic":"perspective"};return o?n.orthographic={xmag:t.right*2,ymag:t.top*2,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:n.perspective={aspectRatio:t.aspect,yfov:Me.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(n.name=t.type),e.cameras.push(n)-1}processAnimation(t,e){const o=this.json,n=this.nodeMap;o.animations||(o.animations=[]),t=oa.Utils.mergeMorphTargetTracks(t.clone(),e);const s=t.tracks,r=[],a=[];for(let l=0;l<s.length;++l){const c=s[l],p=le.parseTrackName(c.name);let h=le.findNode(e,p.nodeName);const u=M0[p.propertyName];if(p.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(p.objectIndex):h=void 0),!h||!u){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name);continue}const d=1;let y=c.values.length/c.times.length;u===M0.morphTargetInfluences&&(y/=h.morphTargetInfluences.length);let g;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(g="CUBICSPLINE",y/=3):c.getInterpolation()===us?g="STEP":g="LINEAR",a.push({input:this.processAccessor(new Gt(c.times,d)),output:this.processAccessor(new Gt(c.values,y)),interpolation:g}),r.push({sampler:a.length-1,target:{node:n.get(h),path:u}})}return o.animations.push({name:t.name||"clip_"+o.animations.length,samplers:a,channels:r}),o.animations.length-1}processSkin(t){const e=this.json,o=this.nodeMap,n=e.nodes[o.get(t)],s=t.skeleton;if(s===void 0)return null;const r=t.skeleton.bones[0];if(r===void 0)return null;const a=[],l=new Float32Array(s.bones.length*16),c=new $t;for(let h=0;h<s.bones.length;++h)a.push(o.get(s.bones[h])),c.copy(s.boneInverses[h]),c.multiply(t.bindMatrix).toArray(l,h*16);return e.skins===void 0&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new Gt(l,16)),joints:a,skeleton:o.get(r)}),n.skin=e.skins.length-1}async processNodeAsync(t){const e=this.json,o=this.options,n=this.nodeMap;e.nodes||(e.nodes=[]);const s={};if(o.trs){const a=t.quaternion.toArray(),l=t.position.toArray(),c=t.scale.toArray();Ns(a,[0,0,0,1])||(s.rotation=a),Ns(l,[0,0,0])||(s.translation=l),Ns(c,[1,1,1])||(s.scale=c)}else t.matrixAutoUpdate&&t.updateMatrix(),aM(t.matrix)===!1&&(s.matrix=t.matrix.elements);if(t.name!==""&&(s.name=String(t.name)),this.serializeUserData(t,s),t.isMesh||t.isLine||t.isPoints){const a=await this.processMeshAsync(t);a!==null&&(s.mesh=a)}else t.isCamera&&(s.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const a=[];for(let l=0,c=t.children.length;l<c;l++){const p=t.children[l];if(p.visible||o.onlyVisible===!1){const h=await this.processNodeAsync(p);h!==null&&a.push(h)}}a.length>0&&(s.children=a)}await this._invokeAllAsync(function(a){a.writeNode&&a.writeNode(t,s)});const r=e.nodes.push(s)-1;return n.set(t,r),r}async processSceneAsync(t){const e=this.json,o=this.options;e.scenes||(e.scenes=[],e.scene=0);const n={};t.name!==""&&(n.name=t.name),e.scenes.push(n);const s=[];for(let r=0,a=t.children.length;r<a;r++){const l=t.children[r];if(l.visible||o.onlyVisible===!1){const c=await this.processNodeAsync(l);c!==null&&s.push(c)}}s.length>0&&(n.nodes=s),this.serializeUserData(t,n)}async processObjectsAsync(t){const e=new Br;e.name="AuxScene";for(let o=0;o<t.length;o++)e.children.push(t[o]);await this.processSceneAsync(e)}async processInputAsync(t){const e=this.options;t=t instanceof Array?t:[t],await this._invokeAllAsync(function(n){n.beforeParse&&n.beforeParse(t)});const o=[];for(let n=0;n<t.length;n++)t[n]instanceof Br?await this.processSceneAsync(t[n]):o.push(t[n]);o.length>0&&await this.processObjectsAsync(o);for(let n=0;n<this.skins.length;++n)this.processSkin(this.skins[n]);for(let n=0;n<e.animations.length;++n)this.processAnimation(e.animations[n],t[0]);await this._invokeAllAsync(function(n){n.afterParse&&n.afterParse(t)})}async _invokeAllAsync(t){for(let e=0,o=this.plugins.length;e<o;e++)await t(this.plugins[e])}}class pM{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);return}const o=this.writer,n=o.json,s=o.extensionsUsed,r={};t.name&&(r.name=t.name),r.color=t.color.toArray(),r.intensity=t.intensity,t.isDirectionalLight?r.type="directional":t.isPointLight?(r.type="point",t.distance>0&&(r.range=t.distance)):t.isSpotLight&&(r.type="spot",t.distance>0&&(r.range=t.distance),r.spot={},r.spot.innerConeAngle=(1-t.penumbra)*t.angle,r.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),t.target&&(t.target.parent!==t||t.target.position.x!==0||t.target.position.y!==0||t.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(n.extensions=n.extensions||{},n.extensions[this.name]={lights:[]},s[this.name]=!0);const a=n.extensions[this.name].lights;a.push(r),e.extensions=e.extensions||{},e.extensions[this.name]={light:a.length-1}}}class hM{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}async writeMaterialAsync(t,e){if(!t.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},n[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}class uM{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const o=this.writer,n=o.extensionsUsed,s={};if(s.clearcoatFactor=t.clearcoat,t.clearcoatMap){const r={index:await o.processTextureAsync(t.clearcoatMap),texCoord:t.clearcoatMap.channel};o.applyTextureTransform(r,t.clearcoatMap),s.clearcoatTexture=r}if(s.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const r={index:await o.processTextureAsync(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};o.applyTextureTransform(r,t.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=r}if(t.clearcoatNormalMap){const r={index:await o.processTextureAsync(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};t.clearcoatNormalScale.x!==1&&(r.scale=t.clearcoatNormalScale.x),o.applyTextureTransform(r,t.clearcoatNormalMap),s.clearcoatNormalTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class dM{constructor(t){this.writer=t,this.name="KHR_materials_dispersion"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.dispersion===0)return;const n=this.writer.extensionsUsed,s={};s.dispersion=t.dispersion,e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class fM{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const o=this.writer,n=o.extensionsUsed,s={};if(s.iridescenceFactor=t.iridescence,t.iridescenceMap){const r={index:await o.processTextureAsync(t.iridescenceMap),texCoord:t.iridescenceMap.channel};o.applyTextureTransform(r,t.iridescenceMap),s.iridescenceTexture=r}if(s.iridescenceIor=t.iridescenceIOR,s.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const r={index:await o.processTextureAsync(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};o.applyTextureTransform(r,t.iridescenceThicknessMap),s.iridescenceThicknessTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class mM{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const o=this.writer,n=o.extensionsUsed,s={};if(s.transmissionFactor=t.transmission,t.transmissionMap){const r={index:await o.processTextureAsync(t.transmissionMap),texCoord:t.transmissionMap.channel};o.applyTextureTransform(r,t.transmissionMap),s.transmissionTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class yM{constructor(t){this.writer=t,this.name="KHR_materials_volume"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const o=this.writer,n=o.extensionsUsed,s={};if(s.thicknessFactor=t.thickness,t.thicknessMap){const r={index:await o.processTextureAsync(t.thicknessMap),texCoord:t.thicknessMap.channel};o.applyTextureTransform(r,t.thicknessMap),s.thicknessTexture=r}t.attenuationDistance!==1/0&&(s.attenuationDistance=t.attenuationDistance),s.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class gM{constructor(t){this.writer=t,this.name="KHR_materials_ior"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const n=this.writer.extensionsUsed,s={};s.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class xM{constructor(t){this.writer=t,this.name="KHR_materials_specular"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(eM)&&!t.specularIntensityMap&&!t.specularColorMap)return;const o=this.writer,n=o.extensionsUsed,s={};if(t.specularIntensityMap){const r={index:await o.processTextureAsync(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};o.applyTextureTransform(r,t.specularIntensityMap),s.specularTexture=r}if(t.specularColorMap){const r={index:await o.processTextureAsync(t.specularColorMap),texCoord:t.specularColorMap.channel};o.applyTextureTransform(r,t.specularColorMap),s.specularColorTexture=r}s.specularFactor=t.specularIntensity,s.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class bM{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const o=this.writer,n=o.extensionsUsed,s={};if(t.sheenRoughnessMap){const r={index:await o.processTextureAsync(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};o.applyTextureTransform(r,t.sheenRoughnessMap),s.sheenRoughnessTexture=r}if(t.sheenColorMap){const r={index:await o.processTextureAsync(t.sheenColorMap),texCoord:t.sheenColorMap.channel};o.applyTextureTransform(r,t.sheenColorMap),s.sheenColorTexture=r}s.sheenRoughnessFactor=t.sheenRoughness,s.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class vM{constructor(t){this.writer=t,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(t,e){if(!t.isMeshPhysicalMaterial||t.anisotropy==0)return;const o=this.writer,n=o.extensionsUsed,s={};if(t.anisotropyMap){const r={index:await o.processTextureAsync(t.anisotropyMap)};o.applyTextureTransform(r,t.anisotropyMap),s.anisotropyTexture=r}s.anisotropyStrength=t.anisotropy,s.anisotropyRotation=t.anisotropyRotation,e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class _M{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(t,e){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const n=this.writer.extensionsUsed,s={};s.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class wM{constructor(t){this.writer=t,this.name="EXT_materials_bump"}async writeMaterialAsync(t,e){if(!t.isMeshStandardMaterial||t.bumpScale===1&&!t.bumpMap)return;const o=this.writer,n=o.extensionsUsed,s={};if(t.bumpMap){const r={index:await o.processTextureAsync(t.bumpMap),texCoord:t.bumpMap.channel};o.applyTextureTransform(r,t.bumpMap),s.bumpTexture=r}s.bumpFactor=t.bumpScale,e.extensions=e.extensions||{},e.extensions[this.name]=s,n[this.name]=!0}}class MM{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,e){if(!t.isInstancedMesh)return;const o=this.writer,n=t,s=new Float32Array(n.count*3),r=new Float32Array(n.count*4),a=new Float32Array(n.count*3),l=new $t,c=new R,p=new Mo,h=new R;for(let d=0;d<n.count;d++)n.getMatrixAt(d,l),l.decompose(c,p,h),c.toArray(s,d*3),p.toArray(r,d*4),h.toArray(a,d*3);const u={TRANSLATION:o.processAccessor(new Gt(s,3)),ROTATION:o.processAccessor(new Gt(r,4)),SCALE:o.processAccessor(new Gt(a,3))};n.instanceColor&&(u._COLOR_0=o.processAccessor(n.instanceColor)),e.extensions=e.extensions||{},e.extensions[this.name]={attributes:u},o.extensionsUsed[this.name]=!0,o.extensionsRequired[this.name]=!0}}oa.Utils={insertKeyframe:function(i,t){const o=i.getValueSize(),n=new i.TimeBufferType(i.times.length+1),s=new i.ValueBufferType(i.values.length+o),r=i.createInterpolant(new i.ValueBufferType(o));let a;if(i.times.length===0){n[0]=t;for(let l=0;l<o;l++)s[l]=0;a=0}else if(t<i.times[0]){if(Math.abs(i.times[0]-t)<.001)return 0;n[0]=t,n.set(i.times,1),s.set(r.evaluate(t),0),s.set(i.values,o),a=0}else if(t>i.times[i.times.length-1]){if(Math.abs(i.times[i.times.length-1]-t)<.001)return i.times.length-1;n[n.length-1]=t,n.set(i.times,0),s.set(i.values,0),s.set(r.evaluate(t),i.values.length),a=n.length-1}else for(let l=0;l<i.times.length;l++){if(Math.abs(i.times[l]-t)<.001)return l;if(i.times[l]<t&&i.times[l+1]>t){n.set(i.times.slice(0,l+1),0),n[l+1]=t,n.set(i.times.slice(l+1),l+2),s.set(i.values.slice(0,(l+1)*o),0),s.set(r.evaluate(t),(l+1)*o),s.set(i.values.slice((l+1)*o),(l+2)*o),a=l+1;break}}return i.times=n,i.values=s,a},mergeMorphTargetTracks:function(i,t){const e=[],o={},n=i.tracks;for(let s=0;s<n.length;++s){let r=n[s];const a=le.parseTrackName(r.name),l=le.findNode(t,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){e.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(ar)}const c=l.morphTargetInfluences.length,p=l.morphTargetDictionary[a.propertyIndex];if(p===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(o[l.uuid]===void 0){h=r.clone();const d=new h.ValueBufferType(c*h.times.length);for(let y=0;y<h.times.length;y++)d[y*c+p]=h.values[y];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=d,o[l.uuid]=h,e.push(h);continue}const u=r.createInterpolant(new r.ValueBufferType(1));h=o[l.uuid];for(let d=0;d<h.times.length;d++)h.values[d*c+p]=u.evaluate(h.times[d]);for(let d=0;d<r.times.length;d++){const y=this.insertKeyframe(h,r.times[d]);h.values[y*c+p]=r.values[d]}}return i.tracks=e,i},toFloat32BufferAttribute:function(i){const t=new Gt(new Float32Array(i.count*i.itemSize),i.itemSize,!1);if(!i.normalized&&!i.isInterleavedBufferAttribute)return t.array.set(i.array),t;for(let e=0,o=i.count;e<o;e++)for(let n=0;n<i.itemSize;n++)t.setComponent(e,n,i.getComponent(e,n));return t}};const ji={east:{axis:"x",sign:1,opposite:"west"},west:{axis:"x",sign:-1,opposite:"east"},top:{axis:"y",sign:1,opposite:"bottom"},bottom:{axis:"y",sign:-1,opposite:"top"},south:{axis:"z",sign:1,opposite:"north"},north:{axis:"z",sign:-1,opposite:"south"}};class zM{constructor(){this.stats={originalFaces:0,optimizedFaces:0,culledFaces:0,mergedQuads:0}}optimize(t,e={}){const{cullFaces:o=!0,mergeCubes:n=!0,batchMaterials:s=!0,mergeAll:r=!1,deduplicateVertices:a=!0}=e;this.resetStats();const l=this.buildBlockMap(t),c=[],p=[];for(const u of t)u.type==="cube"?c.push(u):p.push(u);let h=[];if(c.length>0)if(n){const u=this.greedyMeshCubes(c,l,o,s);h.push(...u)}else if(o){const u=this.cullCubeFaces(c,l,s);h.push(...u)}else{const u=this.createSimpleMeshes(c,s);h.push(...u)}if(p.length>0){const u=this.processNonCubeBlocks(p,l,o,s);h.push(...u)}return r&&h.length>1&&(h=this.mergeAllMeshes(h)),a&&(h=h.map(u=>{const d=this.deduplicateGeometryVertices(u.geometry);return u.geometry.dispose(),u.geometry=d,u})),this.stats.finalMeshCount=h.length,this.stats.finalVertexCount=h.reduce((u,d)=>{var y;return u+(((y=d.geometry.getAttribute("position"))==null?void 0:y.count)||0)},0),this.stats.finalTriangleCount=h.reduce((u,d)=>{var g;const y=d.geometry.getIndex();return y?u+y.count/3:u+(((g=d.geometry.getAttribute("position"))==null?void 0:g.count)||0)/3},0),{meshes:h,stats:{...this.stats}}}resetStats(){this.stats={originalFaces:0,optimizedFaces:0,culledFaces:0,mergedQuads:0}}buildBlockMap(t){const e=new Map;for(const o of t){const n=o.gridPosition,s=`${n.x},${n.y},${n.z}`;e.set(s,o)}return e}hasNeighbor(t,e,o,n){return t.has(`${e},${o},${n}`)}getNeighbor(t,e,o,n){return t.get(`${e},${o},${n}`)}shouldCullFace(t,e,o){const n=t.gridPosition,s=ji[e],r={x:n.x+(s.axis==="x"?s.sign:0),y:n.y+(s.axis==="y"?s.sign:0),z:n.z+(s.axis==="z"?s.sign:0)},a=this.getNeighbor(o,r.x,r.y,r.z);return a?a.type==="cube":!1}greedyMeshCubes(t,e,o,n){const s=new Map;for(const a of t){const l=a.color.toLowerCase();s.has(l)||s.set(l,[]),s.get(l).push(a)}const r=[];for(const[a,l]of s){const c=new Set;for(const h of l){const u=h.gridPosition;c.add(`${u.x},${u.y},${u.z}`)}const p=[];for(const[h,u]of Object.entries(ji)){const d=this.greedyMeshFace(l,h,u,c,e,o);p.push(...d)}if(this.stats.originalFaces+=l.length*6,p.length>0){const h=this.createGeometryFromQuads(p),u=new ge(h,new Ge({color:new bt(a),roughness:.7,metalness:.1}));u.name=`merged_cubes_${a}`,r.push(u),this.stats.optimizedFaces+=p.length,this.stats.mergedQuads+=p.length}}return r}greedyMeshFace(t,e,o,n,s,r){const a=[],l=["x","y","z"].filter(u=>u!==o.axis),[c,p]=l,h=new Map;for(const u of t){const d=u.gridPosition,y=d[o.axis];h.has(y)||h.set(y,new Map);let g=!0;if(r){const f={x:d.x+(o.axis==="x"?o.sign:0),y:d.y+(o.axis==="y"?o.sign:0),z:d.z+(o.axis==="z"?o.sign:0)},m=`${f.x},${f.y},${f.z}`;n.has(m)?(g=!1,this.stats.culledFaces++):s.has(m)&&(g=!1,this.stats.culledFaces++)}if(g){const f=d[c],m=d[p];h.get(y).set(`${f},${m}`,{pos:d,cube:u})}}for(const[u,d]of h){const y=new Set,g=Array.from(d.keys()).map(f=>{const[m,b]=f.split(",").map(Number);return{u:m,v:b,key:f}}).sort((f,m)=>f.v-m.v||f.u-m.u);for(const{u:f,v:m,key:b}of g){if(y.has(b))continue;let v=1,x=1;for(;d.has(`${f+v},${m}`)&&!y.has(`${f+v},${m}`);)v++;t:for(;;){for(let z=0;z<v;z++){const E=`${f+z},${m+x}`;if(!d.has(E)||y.has(E))break t}x++}for(let z=0;z<v;z++)for(let E=0;E<x;E++)y.add(`${f+z},${m+E}`);const _=this.createQuad(e,o,u,f,m,v,x,c,p);a.push(_)}}return a}createQuad(t,e,o,n,s,r,a,l,c){const p=[],h=e.sign>0?1:0,u=[[0,0],[r,0],[r,a],[0,a]];e.sign<0&&u.reverse();for(const[d,y]of u){const g={x:0,y:0,z:0};g[e.axis]=o+h,g[l]=n+d,g[c]=s+y,p.push(g)}return{vertices:p,normal:{x:e.axis==="x"?e.sign:0,y:e.axis==="y"?e.sign:0,z:e.axis==="z"?e.sign:0}}}createGeometryFromQuads(t){const e=[],o=[],n=[];let s=0;for(const a of t){for(const l of a.vertices)e.push(l.x,l.y,l.z),o.push(a.normal.x,a.normal.y,a.normal.z);n.push(s,s+1,s+2,s,s+2,s+3),s+=4}const r=new Xt;return r.setAttribute("position",new Yt(e,3)),r.setAttribute("normal",new Yt(o,3)),r.setIndex(n),r}cullCubeFaces(t,e,o){const n=o?new Map:null,s=[];for(const r of t){const a=r.gridPosition,l=[];this.stats.originalFaces+=6;for(const[h,u]of Object.entries(ji))this.shouldCullFace(r,h,e)?this.stats.culledFaces++:(l.push(h),this.stats.optimizedFaces++);if(l.length===0)continue;const c=this.createCubeWithFaces(a,l),p=r.color.toLowerCase();if(o)n.has(p)||n.set(p,[]),n.get(p).push(c);else{const h=new ge(c,new Ge({color:new bt(p),roughness:.7,metalness:.1}));s.push(h)}}if(o&&n)for(const[r,a]of n){const l=this.mergeGeometries(a),c=new ge(l,new Ge({color:new bt(r),roughness:.7,metalness:.1}));c.name=`culled_cubes_${r}`,s.push(c)}return s}createCubeWithFaces(t,e){const o=[];for(const n of e){const s=ji[n],r=["x","y","z"].filter(a=>a!==s.axis);o.push(this.createQuad(n,s,t[s.axis],t[r[0]],t[r[1]],1,1,r[0],r[1]))}return this.createGeometryFromQuads(o)}mergeGeometries(t){const e=[],o=[],n=[];let s=0;for(const a of t){const l=a.getAttribute("position"),c=a.getAttribute("normal"),p=a.getIndex();for(let h=0;h<l.count;h++)e.push(l.getX(h),l.getY(h),l.getZ(h)),o.push(c.getX(h),c.getY(h),c.getZ(h));for(let h=0;h<p.count;h++)n.push(p.getX(h)+s);s+=l.count,a.dispose()}const r=new Xt;return r.setAttribute("position",new Yt(e,3)),r.setAttribute("normal",new Yt(o,3)),r.setIndex(n),r}processNonCubeBlocks(t,e,o,n){const s=[],r=n?new Map:null;for(const a of t){const l=a.mesh.geometry.clone(),c=new $t;c.compose(a.mesh.position,a.mesh.quaternion,a.mesh.scale),l.applyMatrix4(c);const p=a.color.toLowerCase(),h=l.index?l.index.count:l.attributes.position.count;if(this.stats.originalFaces+=Math.floor(h/6),this.stats.optimizedFaces+=Math.floor(h/6),n)r.has(p)||r.set(p,[]),r.get(p).push(l);else{const u=new ge(l,new Ge({color:new bt(p),roughness:.7,metalness:.1}));s.push(u)}}if(n&&r)for(const[a,l]of r){const c=this.mergeNonIndexedGeometries(l),p=new ge(c,new Ge({color:new bt(a),roughness:.7,metalness:.1}));p.name=`other_blocks_${a}`,s.push(p)}return s}mergeNonIndexedGeometries(t){const e=[],o=[],n=[];let s=!1;for(const a of t){const l=a.getAttribute("position"),c=a.getAttribute("normal"),p=a.getAttribute("uv");if(p&&(s=!0),a.index){const h=a.index;for(let u=0;u<h.count;u++){const d=h.getX(u);e.push(l.getX(d),l.getY(d),l.getZ(d)),c&&o.push(c.getX(d),c.getY(d),c.getZ(d)),p&&n.push(p.getX(d),p.getY(d))}}else for(let h=0;h<l.count;h++)e.push(l.getX(h),l.getY(h),l.getZ(h)),c&&o.push(c.getX(h),c.getY(h),c.getZ(h)),p&&n.push(p.getX(h),p.getY(h));a.dispose()}const r=new Xt;return r.setAttribute("position",new Yt(e,3)),o.length>0?r.setAttribute("normal",new Yt(o,3)):r.computeVertexNormals(),s&&n.length>0&&r.setAttribute("uv",new Yt(n,2)),r}createSimpleMeshes(t,e){const o=e?new Map:null,n=[];for(const s of t){const r=new I(1,1,1);r.translate(s.gridPosition.x+.5,s.gridPosition.y+.5,s.gridPosition.z+.5),this.stats.originalFaces+=6,this.stats.optimizedFaces+=6;const a=s.color.toLowerCase();if(e)o.has(a)||o.set(a,[]),o.get(a).push(r);else{const l=new ge(r,new Ge({color:new bt(a),roughness:.7,metalness:.1}));n.push(l)}}if(e&&o)for(const[s,r]of o){const a=this.mergeGeometries(r),l=new ge(a,new Ge({color:new bt(s),roughness:.7,metalness:.1}));l.name=`simple_cubes_${s}`,n.push(l)}return n}estimateFaceCount(t){let e=0;for(const o of t)if(o.type==="cube")e+=6;else{const n=o.mesh.geometry,s=n.index?n.index.count:n.attributes.position.count;e+=Math.floor(s/6)}return e}createInstancedExport(t){const e=new Map;for(const c of t)e.has(c.type)||e.set(c.type,[]),e.get(c.type).push(c);const o=[],n=new $t,s=new R,r=new Mo,a=new R(1,1,1),l=new oo;for(const[c,p]of e){if(p.length===0)continue;const u=p[0].mesh.geometry.clone(),d=new E1(u,new Ge({vertexColors:!0,roughness:.7,metalness:.1}),p.length),y=new Float32Array(p.length*3);p.forEach((g,f)=>{s.copy(g.mesh.position),l.set(Me.degToRad(g.rotation.x),Me.degToRad(g.rotation.y),Me.degToRad(g.rotation.z)),r.setFromEuler(l),n.compose(s,r,a),d.setMatrixAt(f,n);const m=new bt(g.color);y[f*3]=m.r,y[f*3+1]=m.g,y[f*3+2]=m.b}),d.instanceColor=new dc(y,3),d.instanceMatrix.needsUpdate=!0,d.name=`instanced_${c}`,d.castShadow=!0,d.receiveShadow=!0,o.push(d)}return{meshes:o,stats:{totalBlocks:t.length,uniqueTypes:e.size,drawCalls:o.length}}}estimateOptimizedCount(t,e={}){const{cullFaces:o=!0,mergeCubes:n=!0}=e;if(!o&&!n)return this.estimateFaceCount(t);const s=this.buildBlockMap(t);let r=0;for(const a of t)if(a.type==="cube")for(const l of Object.keys(ji))(!o||!this.shouldCullFace(a,l,s))&&r++;else{const l=a.mesh.geometry,c=l.index?l.index.count:l.attributes.position.count;r+=Math.floor(c/6)}if(n){const a=t.filter(p=>p.type==="cube").length,l=r-(a>0?t.filter(p=>p.type==="cube").reduce((p,h)=>{let u=0;for(const d of Object.keys(ji))(!o||!this.shouldCullFace(h,d,s))&&u++;return p+u},0):0),c=r-l;r=Math.floor(c*.4)+l}return r}mergeAllMeshes(t){if(t.length===0)return[];if(t.length===1)return t;const e=[];for(const r of t){const a=r.geometry.clone(),l=r.material.color||new bt(8421504),c=a.getAttribute("position").count,p=new Float32Array(c*3);for(let h=0;h<c;h++)p[h*3]=l.r,p[h*3+1]=l.g,p[h*3+2]=l.b;a.setAttribute("color",new Gt(p,3)),e.push(a),r.geometry.dispose(),r.material.dispose()}const o=vt(e,!1);e.forEach(r=>r.dispose());const n=new Ge({vertexColors:!0,roughness:.7,metalness:.1}),s=new ge(o,n);return s.name="merged_all",[s]}deduplicateGeometryVertices(t){const e=t.getAttribute("position"),o=t.getAttribute("normal"),n=t.getAttribute("color"),s=t.getAttribute("uv"),r=t.getIndex();if(!e)return t;const a=new Map,l=[],c=[],p=[],h=[],u=[],d=1e3,y=v=>{const x=Math.round(e.getX(v)*d),_=Math.round(e.getY(v)*d),z=Math.round(e.getZ(v)*d);let E=`${x},${_},${z}`;if(o){const C=Math.round(o.getX(v)*100),M=Math.round(o.getY(v)*100),S=Math.round(o.getZ(v)*100);E+=`|${C},${M},${S}`}if(n){const C=Math.round(n.getX(v)*255),M=Math.round(n.getY(v)*255),S=Math.round(n.getZ(v)*255);E+=`|${C},${M},${S}`}return E},g=v=>{const x=y(v);if(a.has(x))return a.get(x);const _=l.length/3;return a.set(x,_),l.push(e.getX(v),e.getY(v),e.getZ(v)),o&&c.push(o.getX(v),o.getY(v),o.getZ(v)),n&&p.push(n.getX(v),n.getY(v),n.getZ(v)),s&&h.push(s.getX(v),s.getY(v)),_};if(r)for(let v=0;v<r.count;v++){const x=r.getX(v),_=g(x);u.push(_)}else for(let v=0;v<e.count;v++){const x=g(v);u.push(x)}const f=new Xt;f.setAttribute("position",new Yt(l,3)),c.length>0&&f.setAttribute("normal",new Yt(c,3)),p.length>0&&f.setAttribute("color",new Yt(p,3)),h.length>0&&f.setAttribute("uv",new Yt(h,2)),f.setIndex(u);const m=e.count,b=l.length/3;return this.stats.verticesRemoved=(this.stats.verticesRemoved||0)+(m-b),f}}class SM{constructor(){this.exporter=new oa,this.optimizer=new zM}async exportScene(t,e={}){var b;const{binary:o=!0,includeAnimations:n=!1,animator:s=null,bakedTexture:r=null,uvData:a=null,cullFaces:l=!1,mergeCubes:c=!1,batchMaterials:p=!1,useInstancing:h=!1,mergeAll:u=!1,deduplicateVertices:d=!0}=e;if(t.blocks.size===0)throw new Error("No blocks to export");const y=new Br,g=t.getAllBlocks(),f=l||c||p||u;if(h&&!r){const v=this.optimizer.createInstancedExport(g);for(const x of v.meshes)y.add(x);console.log("Instancing stats:",v.stats)}else if(f&&!r){const v=this.optimizer.optimize(g,{cullFaces:l,mergeCubes:c,batchMaterials:p,mergeAll:u,deduplicateVertices:d});for(const x of v.meshes)y.add(x);console.log("Optimization stats:",v.stats)}else{let v=null;r&&(v=new yc(r),v.magFilter=Se,v.minFilter=Se,v.generateMipmaps=!1,v.flipY=!1,v.colorSpace=to);const x=["east","west","top","bottom","south","north"];for(const _ of g){const z=_.mesh.clone();z.name=_.id,z.geometry=_.mesh.geometry.clone();const E=Array.isArray(_.mesh.material)?_.mesh.material[0]:_.mesh.material;let C;if(v&&a&&a.has(_.id)){const M=a.get(_.id),S=z.geometry.getAttribute("uv");if(S&&M.faceUVs){for(let A=0;A<6;A++){const B=x[A],F=M.faceUVs[B];if(F)for(let N=0;N<4;N++){const G=A*4+N;S.setXY(G,F.u,F.v)}}S.needsUpdate=!0}C=new Ge({map:v,roughness:E.roughness||.7,metalness:E.metalness||.1})}else C=new Ge({color:new bt(_.color),roughness:E.roughness||.7,metalness:E.metalness||.1});(b=_.emissive)!=null&&b.enabled&&(C.emissive=new bt(_.emissive.color),C.emissiveIntensity=_.emissive.intensity),z.material=C,y.add(z)}}const m=[];if(n&&s&&s.getAllAnimations().length>0)for(const v of s.getAllAnimations()){const x=this.buildAnimationClip(v,t);x&&m.push(x)}try{const v=await this.exporter.parseAsync(y,{binary:o,animations:m});return this.disposeScene(y),v}catch(v){throw this.disposeScene(y),v}}disposeScene(t){t.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(o=>{o.map&&o.map.dispose(),o.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.dispose()))})}buildAnimationClip(t,e){const o=[],n=new Map;for(const s of t.keyframes)n.has(s.blockId)||n.set(s.blockId,[]),n.get(s.blockId).push(s);for(const[s,r]of n){const a=e.blocks.get(s);if(!a)continue;const l=a.id,c=[],p=[],h=[],u=[];for(const d of r){const y=d.time/1e3;if(d.properties.position){c.push(y);const g=d.properties.position;p.push(g.x+.5,g.y+.5,g.z+.5)}if(d.properties.rotation){h.push(y);const g=new oo(Me.degToRad(d.properties.rotation.x),Me.degToRad(d.properties.rotation.y),Me.degToRad(d.properties.rotation.z)),f=new Mo().setFromEuler(g);u.push(f.x,f.y,f.z,f.w)}}c.length>0&&o.push(new Is(`${l}.position`,c,p)),h.length>0&&o.push(new Ds(`${l}.quaternion`,h,u))}return o.length===0?null:new u2(t.name,t.duration/1e3,o)}downloadFile(t,e,o=!0){const n=o?new Blob([t],{type:"application/octet-stream"}):new Blob([JSON.stringify(t)],{type:"application/json"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=e,r.click(),URL.revokeObjectURL(s)}getOptimizationStats(t,e={}){const o=t.getAllBlocks(),n=this.optimizer.estimateFaceCount(o),s=this.optimizer.estimateOptimizedCount(o,e);return{blockCount:o.length,originalFaces:n,optimizedFaces:s,reduction:n>0?Math.round((1-s/n)*100):0}}}class EM{constructor(){this.raycaster=new Bc,this.ambientLight=new bt(.15,.15,.15)}bake(t){const e=t.getAllBlocks(),o=e.filter(r=>{var a;return(a=r.emissive)==null?void 0:a.enabled}),n=e.map(r=>r.mesh);console.log(`Baking lighting: ${o.length} emissive blocks, ${e.length} total blocks`);const s=new Map;for(const r of e){const a=this.bakeBlockVertices(r,o,n);s.set(r.id,a)}return s}apply(t,e){for(const[o,n]of e){const s=t.getBlockById(o);if(!s)continue;s.mesh.geometry.setAttribute("color",new Gt(n,3));const a=l=>{l.vertexColors=!0,l.needsUpdate=!0};Array.isArray(s.mesh.material)?s.mesh.material.forEach(a):a(s.mesh.material)}}bakeBlockVertices(t,e,o){const n=t.mesh.geometry,s=n.getAttribute("position"),r=n.getAttribute("normal"),a=s.count,l=new Float32Array(a*3),c=new R,p=new R,h=new Kt().getNormalMatrix(t.mesh.matrixWorld);t.mesh.updateMatrixWorld();for(let u=0;u<a;u++){c.fromBufferAttribute(s,u),c.applyMatrix4(t.mesh.matrixWorld),r?(p.fromBufferAttribute(r,u),p.applyMatrix3(h).normalize()):p.set(0,1,0);const d=this.calculateLightAtPoint(c,p,e,o,t.mesh),y=new bt(t.color);l[u*3]=Math.min(1,y.r*d.r),l[u*3+1]=Math.min(1,y.g*d.g),l[u*3+2]=Math.min(1,y.b*d.b)}return l}calculateLightAtPoint(t,e,o,n,s){const r=this.ambientLight.clone();for(const a of o){const l=this.getBlockCenter(a),c=new R().subVectors(l,t),p=c.length();if(p>a.emissive.radius)continue;c.normalize();const h=Math.max(0,e.dot(c));if(h<=0||this.isOccluded(t,l,n,s,a.mesh))continue;const d=p/a.emissive.radius,y=Math.pow(1-d,2),g=new bt(a.emissive.color),f=a.emissive.intensity*h*y;r.r+=g.r*f,r.g+=g.g*f,r.b+=g.b*f}return r}getBlockCenter(t){const e=t.gridPosition,o=t.dimensions,n=Jn[t.type]||1,s=Qn[t.type]||0,r=o.h*n;return new R(e.x+o.w/2,e.y+s+r/2,e.z+o.d/2)}isOccluded(t,e,o,n,s){const r=new R().subVectors(e,t),a=r.length();r.normalize();const l=t.clone().addScaledVector(r,.01);this.raycaster.set(l,r),this.raycaster.far=a-.02;const c=o.filter(h=>h!==n&&h!==s);return this.raycaster.intersectObjects(c,!1).length>0}clear(t){for(const e of t.getAllBlocks()){const o=e.mesh.geometry;o.hasAttribute("color")&&o.deleteAttribute("color");const n=s=>{s.vertexColors=!1,s.needsUpdate=!0};Array.isArray(e.mesh.material)?e.mesh.material.forEach(n):n(e.mesh.material)}}generateDebugTexture(t,e={}){const{cellSize:o=32,columns:n=8,showLighting:s=!0,showBaseColors:r=!0}=e,a=t.getAllBlocks(),l=Math.ceil(a.length/n),c=n*o,p=Math.max(l*o*(s&&r?2:1),o),h=document.createElement("canvas");h.width=c,h.height=p;const u=h.getContext("2d");return u.fillStyle="#000000",u.fillRect(0,0,c,p),a.forEach((d,y)=>{var b;const g=y%n,f=Math.floor(y/n),m=g*o;if(r){const v=f*o;u.fillStyle=d.color,u.fillRect(m+1,v+1,o-2,o-2),u.fillStyle="#ffffff",u.font="8px monospace",u.fillText(d.type.slice(0,4),m+2,v+10)}if(s){const v=(r?l+f:f)*o,x=d.mesh.geometry;if(x.hasAttribute("color")){const _=x.getAttribute("color");let z=0,E=0,C=0;for(let A=0;A<_.count;A++)z+=_.getX(A),E+=_.getY(A),C+=_.getZ(A);z/=_.count,E/=_.count,C/=_.count;const M=Math.round(z*255),S=Math.round(E*255),k=Math.round(C*255);u.fillStyle=`rgb(${M},${S},${k})`}else u.fillStyle=d.color;u.fillRect(m+1,v+1,o-2,o-2),(b=d.emissive)!=null&&b.enabled&&(u.strokeStyle=d.emissive.color,u.lineWidth=2,u.strokeRect(m+2,v+2,o-4,o-4))}}),u.fillStyle="#ffffff",u.font="10px monospace",r&&s&&(u.fillText("Base Colors",4,l*o-4),u.fillText("Baked",4,p-4)),h}generateLightmapTexture(t,e={}){const{cellSize:o=32,columns:n=8}=e,s=t.getAllBlocks(),r=Math.ceil(s.length/n),a=n*o,l=Math.max(r*o,o),c=document.createElement("canvas");c.width=a,c.height=l;const p=c.getContext("2d");return p.fillStyle="#808080",p.fillRect(0,0,a,l),s.forEach((h,u)=>{const d=u%n,y=Math.floor(u/n),g=d*o,f=y*o,m=h.mesh.geometry;if(m.hasAttribute("color")){const b=m.getAttribute("color"),v=new bt(h.color);let x=new bt(0,0,0),_=0;for(let M=0;M<b.count;M++){const S=b.getX(M),k=b.getY(M),A=b.getZ(M),B=v.r>.01?S/v.r:S,F=v.g>.01?k/v.g:k,N=v.b>.01?A/v.b:A;x.r+=B,x.g+=F,x.b+=N,_++}_>0&&(x.r/=_,x.g/=_,x.b/=_);const z=Math.round(Math.min(1,x.r)*255),E=Math.round(Math.min(1,x.g)*255),C=Math.round(Math.min(1,x.b)*255);p.fillStyle=`rgb(${z},${E},${C})`}else p.fillStyle="#262626";p.fillRect(g,f,o,o),p.strokeStyle="#333333",p.strokeRect(g,f,o,o)}),c}downloadCanvasAsPNG(t,e){const o=document.createElement("a");o.download=e,o.href=t.toDataURL("image/png"),o.click()}}class FM{constructor(){this.raycaster=new Bc,this.ambientLight=new bt(.15,.15,.15),this.faceOrder=["east","west","top","bottom","south","north"],this.faceNormals={east:new R(1,0,0),west:new R(-1,0,0),top:new R(0,1,0),bottom:new R(0,-1,0),south:new R(0,0,1),north:new R(0,0,-1)}}bake(t){const e=t.getAllBlocks(),o=e.filter(d=>{var y;return(y=d.emissive)==null?void 0:y.enabled}),n=e.map(d=>d.mesh);o.length===0&&console.warn("No emissive blocks found for texture baking"),console.log(`Texture baking: ${o.length} emissive blocks, ${e.length} total blocks`);const r=e.length*6,a=Math.ceil(Math.sqrt(r)),l=Math.ceil(r/a);console.log(`Atlas size: ${a}x${l} (${r} pixels for ${e.length} blocks)`);const c=document.createElement("canvas");c.width=a,c.height=l;const p=c.getContext("2d");p.fillStyle="#000000",p.fillRect(0,0,a,l);const h=new Map;let u=0;for(const d of e){const y={};for(const g of this.faceOrder){const f=u%a,m=Math.floor(u/a),b=this.calculateFaceLighting(d,g,o,n),v=Math.round(Math.min(1,b.r)*255),x=Math.round(Math.min(1,b.g)*255),_=Math.round(Math.min(1,b.b)*255);p.fillStyle=`rgb(${v},${x},${_})`,p.fillRect(f,m,1,1),y[g]={u:(f+.5)/a,v:1-(m+.5)/l},u++}h.set(d.id,{faceUVs:y})}return{texture:c,uvData:h,atlasWidth:a,atlasHeight:l}}calculateFaceLighting(t,e,o,n){var p,h,u;const s=new bt(t.color),r=this.faceNormals[e].clone(),a=new oo(Me.degToRad(((p=t.rotation)==null?void 0:p.x)||0),Me.degToRad(((h=t.rotation)==null?void 0:h.y)||0),Me.degToRad(((u=t.rotation)==null?void 0:u.z)||0));r.applyEuler(a);const l=this.getFaceCenter(t,e),c=this.calculateLightAtPoint(l,r,o,n,t.mesh);return new bt(Math.min(1,s.r*c.r),Math.min(1,s.g*c.g),Math.min(1,s.b*c.b))}getFaceCenter(t,e){var h,u,d;const o=t.gridPosition,n=t.dimensions,s=Jn[t.type]||1,r=Qn[t.type]||0,a=n.h*s,l=new R(o.x+n.w/2,o.y+r+a/2,o.z+n.d/2),c=new R;switch(e){case"east":c.set(n.w/2,0,0);break;case"west":c.set(-n.w/2,0,0);break;case"top":c.set(0,a/2,0);break;case"bottom":c.set(0,-a/2,0);break;case"south":c.set(0,0,n.d/2);break;case"north":c.set(0,0,-n.d/2);break}const p=new oo(Me.degToRad(((h=t.rotation)==null?void 0:h.x)||0),Me.degToRad(((u=t.rotation)==null?void 0:u.y)||0),Me.degToRad(((d=t.rotation)==null?void 0:d.z)||0));return c.applyEuler(p),l.add(c)}calculateLightAtPoint(t,e,o,n,s){const r=this.ambientLight.clone();for(const a of o){const l=this.getBlockCenter(a),c=new R().subVectors(l,t),p=c.length();if(p>a.emissive.radius)continue;c.normalize();const h=Math.max(0,e.dot(c));if(h<=0||this.isOccluded(t,l,n,s,a.mesh))continue;const d=p/a.emissive.radius,y=Math.pow(1-d,2),g=new bt(a.emissive.color),f=a.emissive.intensity*h*y;r.r+=g.r*f,r.g+=g.g*f,r.b+=g.b*f}return r}getBlockCenter(t){const e=t.gridPosition,o=t.dimensions,n=Jn[t.type]||1,s=Qn[t.type]||0,r=o.h*n;return new R(e.x+o.w/2,e.y+s+r/2,e.z+o.d/2)}isOccluded(t,e,o,n,s){const r=new R().subVectors(e,t),a=r.length();r.normalize();const l=t.clone().addScaledVector(r,.01);this.raycaster.set(l,r),this.raycaster.far=a-.02;const c=o.filter(h=>h!==n&&h!==s);return this.raycaster.intersectObjects(c,!1).length>0}applyUVs(t,e){for(const[o,n]of e){const s=t.getBlockById(o);if(!s)continue;const a=s.mesh.geometry.getAttribute("uv");if(!a){console.warn(`Block ${o} has no UV attribute`);continue}const l=4;for(let c=0;c<6;c++){const p=this.faceOrder[c],h=n.faceUVs[p];for(let u=0;u<l;u++){const d=c*l+u;a.setXY(d,h.u,h.v)}}a.needsUpdate=!0}}createTexture(t){const e=new yc(t);return e.magFilter=Se,e.minFilter=Se,e.generateMipmaps=!1,e.flipY=!1,e}}const AM={city:{label:"City",templates:["cityBlock","skyscraper","apartmentBuilding","shoppingMall","trainStation"]},buildings:{label:"Buildings",templates:["cottage","townhouse","officeBuilding","warehouse"]},medieval:{label:"Medieval",templates:["castleWall","guardTower","dungeon","tavern"]},nature:{label:"Nature",templates:["oakTree","rockGarden","pond","campsite"]},industrial:{label:"Industrial",templates:["factory","pipeNetwork","storageYard","refinery","industrialComplex","powerPlant","warehouseDistrict"]},energy:{label:"Energy",templates:["solarArrayLarge","windTurbine","substationYard","coolingTowers"]},modern:{label:"Modern",templates:["rooftopTerrace","parkingLot","busStop","solarFarm","gasStation","helipad"]},furniture:{label:"Furniture",templates:["diningRoom","livingRoom","workshop","cellar"]},infrastructure:{label:"Infrastructure",templates:["stoneBridge","streetCorner","plaza","stairway","highway","harbor"]},oil:{label:"Oil & Gas",templates:["oilDerrick","pumpJackStation","oilStorageFacility","oilFieldSite","offshorePlatform","oilRefinery","tankerLoadingStation"]}},Yc={cottage:{name:"Cozy Cottage",category:"buildings",description:"A charming rustic cottage with detailed architecture",blocks:[...st(-1,0,-1,6,6,"#5D4037"),{type:"slab",position:{x:-1,y:0,z:-1},color:"#696969"},{type:"slab",position:{x:-1,y:0,z:4},color:"#696969"},{type:"slab",position:{x:4,y:0,z:-1},color:"#696969"},{type:"slab",position:{x:4,y:0,z:4},color:"#696969"},{type:"cube",position:{x:0,y:1,z:0},color:"#DEB887"},{type:"cube",position:{x:1,y:1,z:0},color:"#F5DEB3"},{type:"cube",position:{x:2,y:1,z:0},color:"#F5DEB3"},{type:"cube",position:{x:3,y:1,z:0},color:"#DEB887"},{type:"cube",position:{x:0,y:2,z:0},color:"#DEB887"},{type:"cube",position:{x:3,y:2,z:0},color:"#DEB887"},{type:"cube",position:{x:0,y:1,z:3},color:"#DEB887"},{type:"cube",position:{x:3,y:1,z:3},color:"#DEB887"},{type:"cube",position:{x:0,y:2,z:3},color:"#DEB887"},{type:"cube",position:{x:1,y:2,z:3},color:"#F5DEB3"},{type:"cube",position:{x:2,y:2,z:3},color:"#F5DEB3"},{type:"cube",position:{x:3,y:2,z:3},color:"#DEB887"},{type:"cube",position:{x:0,y:1,z:1},color:"#DEB887"},{type:"cube",position:{x:0,y:1,z:2},color:"#DEB887"},{type:"cube",position:{x:0,y:2,z:1},color:"#F5DEB3"},{type:"cube",position:{x:0,y:2,z:2},color:"#F5DEB3"},{type:"cube",position:{x:3,y:1,z:1},color:"#DEB887"},{type:"cube",position:{x:3,y:1,z:2},color:"#DEB887"},{type:"cube",position:{x:3,y:2,z:1},color:"#F5DEB3"},{type:"cube",position:{x:3,y:2,z:2},color:"#F5DEB3"},{type:"beam2X",position:{x:0,y:1,z:0},color:"#5D4037"},{type:"beam2X",position:{x:2,y:1,z:0},color:"#5D4037"},{type:"beam2Z",position:{x:0,y:1,z:0},color:"#5D4037"},{type:"beam2Z",position:{x:0,y:1,z:2},color:"#5D4037"},{type:"beam2Z",position:{x:3,y:1,z:0},color:"#5D4037"},{type:"beam2Z",position:{x:3,y:1,z:2},color:"#5D4037"},{type:"windowFrame",position:{x:1,y:2,z:0},color:"#8B4513"},{type:"windowFrame",position:{x:2,y:2,z:0},color:"#8B4513"},{type:"windowSill",position:{x:1,y:1,z:-1},color:"#5D4037"},{type:"windowSill",position:{x:2,y:1,z:-1},color:"#5D4037"},{type:"windowFrame",position:{x:0,y:2,z:2},color:"#8B4513",rotation:{x:0,y:90,z:0}},{type:"doorFrame",position:{x:1,y:1,z:3},color:"#654321"},{type:"doorFrame",position:{x:2,y:1,z:3},color:"#654321"},{type:"step",position:{x:1,y:0,z:4},color:"#808080"},{type:"step",position:{x:2,y:0,z:4},color:"#808080"},{type:"wedge",position:{x:0,y:3,z:0},color:"#8B0000"},{type:"wedge",position:{x:1,y:3,z:0},color:"#8B0000"},{type:"wedge",position:{x:2,y:3,z:0},color:"#8B0000"},{type:"wedge",position:{x:3,y:3,z:0},color:"#8B0000"},{type:"wedge",position:{x:0,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:1,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:2,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:3,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},...Et(0,3,1,4,"X","slab","#8B0000"),...Et(0,3,2,4,"X","slab","#8B0000"),{type:"wedgeFlat",position:{x:-1,y:3,z:0},color:"#8B0000"},{type:"wedgeFlat",position:{x:4,y:3,z:0},color:"#8B0000"},{type:"wedgeFlat",position:{x:-1,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},{type:"wedgeFlat",position:{x:4,y:3,z:3},color:"#8B0000",rotation:{x:0,y:180,z:0}},{type:"chimney",position:{x:3,y:3,z:1},color:"#8B4513"},{type:"chimney",position:{x:3,y:4,z:1},color:"#704214"},{type:"chimney",position:{x:3,y:5,z:1},color:"#5D3A1A"},{type:"slab",position:{x:1,y:0,z:-1},color:"#5D4037"},{type:"slab",position:{x:2,y:0,z:-1},color:"#5D4037"},{type:"pillar2",position:{x:1,y:0,z:-1},color:"#5D4037"},{type:"pillar2",position:{x:2,y:0,z:-1},color:"#5D4037"},{type:"beam2X",position:{x:1,y:1,z:-1},color:"#5D4037"},{type:"planter",position:{x:-1,y:0,z:1},color:"#8B4513"},{type:"flower",position:{x:-1,y:1,z:1},color:"#FF69B4"},{type:"planter",position:{x:-1,y:0,z:2},color:"#8B4513"},{type:"bush",position:{x:-1,y:1,z:2},color:"#228B22"},{type:"barrel",position:{x:4,y:0,z:2},color:"#8B4513"},{type:"rock",position:{x:4,y:0,z:0},color:"#696969"},{type:"fence",position:{x:-1,y:0,z:-1},color:"#DEB887"},{type:"fence",position:{x:0,y:0,z:-1},color:"#DEB887"},{type:"fence",position:{x:3,y:0,z:-1},color:"#DEB887"},{type:"fence",position:{x:4,y:0,z:-1},color:"#DEB887"}]},townhouse:{name:"Town House",category:"buildings",description:"A tall narrow townhouse with baluster railings",blocks:[...st(0,0,0,3,3,"#696969"),...ae(0,1,0,3,3,"#F5F5DC"),...ae(0,2,0,3,3,"#F5F5DC"),...ae(0,3,0,3,3,"#F5F5DC"),{type:"slab",position:{x:0,y:2,z:-1},color:"#808080"},{type:"slab",position:{x:1,y:2,z:-1},color:"#808080"},{type:"slab",position:{x:2,y:2,z:-1},color:"#808080"},{type:"baluster",position:{x:0,y:2,z:-1},color:"#F5F5DC"},{type:"baluster",position:{x:2,y:2,z:-1},color:"#F5F5DC"},{type:"railing",position:{x:0,y:3,z:-1},color:"#F5F5DC"},{type:"railing",position:{x:1,y:3,z:-1},color:"#F5F5DC"},{type:"railing",position:{x:2,y:3,z:-1},color:"#F5F5DC"},{type:"cornice",position:{x:0,y:4,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:1,y:4,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:2,y:4,z:0},color:"#D3D3D3"},...st(0,4,0,3,3,"#2F4F4F"),{type:"slab",position:{x:0,y:0,z:-1},color:"#696969"},{type:"slab",position:{x:1,y:0,z:-1},color:"#696969"},{type:"slab",position:{x:2,y:0,z:-1},color:"#696969"},{type:"base",position:{x:0,y:0,z:-1},color:"#F5F5DC"},{type:"base",position:{x:2,y:0,z:-1},color:"#F5F5DC"},{type:"column",position:{x:0,y:1,z:-1},color:"#F5F5DC"},{type:"column",position:{x:2,y:1,z:-1},color:"#F5F5DC"},{type:"capital",position:{x:0,y:2,z:-1},color:"#F5F5DC"},{type:"capital",position:{x:2,y:2,z:-1},color:"#F5F5DC"}]},officeBuilding:{name:"Office Building",category:"buildings",description:"Modern office with AC units and antenna",blocks:[...st(0,0,0,5,5,"#333333"),...Ae(0,1,0,5,5,"#E0E0E0","#4169E1"),...Ae(0,2,0,5,5,"#E0E0E0","#4169E1"),...Ae(0,3,0,5,5,"#E0E0E0","#4169E1"),...Ae(0,4,0,5,5,"#E0E0E0","#4169E1"),...st(0,5,0,5,5,"#404040"),{type:"acUnit",position:{x:1,y:5,z:1},color:"#C0C0C0"},{type:"acUnit",position:{x:3,y:5,z:1},color:"#C0C0C0"},{type:"acUnit",position:{x:1,y:5,z:3},color:"#C0C0C0"},{type:"acUnit",position:{x:3,y:5,z:3},color:"#C0C0C0"},{type:"antenna",position:{x:2,y:5,z:2},color:"#808080"},{type:"antenna",position:{x:2,y:6,z:2},color:"#808080"},{type:"vent",position:{x:0,y:5,z:2},color:"#696969"}]},warehouse:{name:"Warehouse",category:"buildings",description:"Industrial warehouse with crates and barrels",blocks:[...st(0,0,0,6,4,"#808080"),...ne(0,1,0,6,2,"#A9A9A9"),...ne(0,1,3,6,2,"#A9A9A9"),...Wt(0,1,1,2,2,"#A9A9A9"),...Wt(5,1,1,2,2,"#A9A9A9"),{type:"iBeam",position:{x:2,y:1,z:1},color:"#696969"},{type:"iBeam",position:{x:2,y:2,z:1},color:"#696969"},{type:"iBeam",position:{x:2,y:1,z:2},color:"#696969"},{type:"iBeam",position:{x:2,y:2,z:2},color:"#696969"},...st(0,3,0,6,4,"#708090"),{type:"catwalk",position:{x:1,y:3,z:1},color:"#4A4A4A"},{type:"catwalk",position:{x:1,y:3,z:2},color:"#4A4A4A"},{type:"crate",position:{x:4,y:1,z:1},color:"#8B4513"},{type:"crate",position:{x:4,y:1,z:2},color:"#8B4513"},{type:"crate",position:{x:4,y:2,z:1},color:"#A0522D"},{type:"barrel",position:{x:3,y:1,z:1},color:"#654321"},{type:"barrel",position:{x:3,y:1,z:2},color:"#654321"}]},castleWall:{name:"Castle Wall",category:"medieval",description:"Fortified wall with merlons and arrow slits",blocks:[...ne(0,0,0,8,3,"#808080"),{type:"merlon",position:{x:0,y:3,z:0},color:"#696969"},{type:"merlon",position:{x:2,y:3,z:0},color:"#696969"},{type:"merlon",position:{x:4,y:3,z:0},color:"#696969"},{type:"merlon",position:{x:6,y:3,z:0},color:"#696969"},{type:"arrowSlit",position:{x:1,y:1,z:0},color:"#505050"},{type:"arrowSlit",position:{x:3,y:1,z:0},color:"#505050"},{type:"arrowSlit",position:{x:5,y:1,z:0},color:"#505050"},{type:"arrowSlit",position:{x:7,y:1,z:0},color:"#505050"},...Et(0,2,1,8,"X","slab","#707070"),{type:"torch",position:{x:1,y:2,z:1},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:1.5,radius:4}},{type:"torch",position:{x:5,y:2,z:1},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:1.5,radius:4}},{type:"buttress",position:{x:0,y:0,z:1},color:"#606060"},{type:"buttress",position:{x:4,y:0,z:1},color:"#606060"},{type:"buttress",position:{x:7,y:0,z:1},color:"#606060"}]},guardTower:{name:"Guard Tower",category:"medieval",description:"Imposing medieval watchtower with battlements, arrow slits, and defensive features",blocks:[...st(0,0,0,5,5,"#505050"),{type:"cylinder",position:{x:2,y:1,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:2,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:3,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:4,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:5,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:6,z:2},color:"#505050"},{type:"arrowSlit",position:{x:2,y:2,z:0},color:"#3A3A3A"},{type:"arrowSlit",position:{x:0,y:3,z:2},color:"#3A3A3A",rotation:{x:0,y:90,z:0}},{type:"arrowSlit",position:{x:4,y:3,z:2},color:"#3A3A3A",rotation:{x:0,y:90,z:0}},{type:"arrowSlit",position:{x:2,y:4,z:4},color:"#3A3A3A",rotation:{x:0,y:180,z:0}},{type:"merlon",position:{x:1,y:6,z:1},color:"#505050"},{type:"merlon",position:{x:3,y:6,z:1},color:"#505050"},{type:"merlon",position:{x:1,y:6,z:3},color:"#505050"},{type:"merlon",position:{x:3,y:6,z:3},color:"#505050"},{type:"crenellation",position:{x:0,y:6,z:2},color:"#505050"},{type:"crenellation",position:{x:4,y:6,z:2},color:"#505050"},{type:"crenellation",position:{x:2,y:6,z:0},color:"#505050"},{type:"crenellation",position:{x:2,y:6,z:4},color:"#505050"},{type:"cone",position:{x:2,y:7,z:2},color:"#2F4F4F"},{type:"finial",position:{x:2,y:8,z:2},color:"#8B4513"},{type:"doorFrame",position:{x:2,y:1,z:0},color:"#5D4037"},{type:"archLow",position:{x:2,y:2,z:0},color:"#606060"},{type:"torch",position:{x:1,y:2,z:0},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"torch",position:{x:3,y:2,z:0},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"torch",position:{x:2,y:6,z:2},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:3,radius:8}},{type:"chain",position:{x:0,y:5,z:1},color:"#4A4A4A"},{type:"chain",position:{x:4,y:5,z:1},color:"#4A4A4A"},{type:"chain",position:{x:0,y:4,z:1},color:"#4A4A4A"},{type:"chain",position:{x:4,y:4,z:1},color:"#4A4A4A"},{type:"banner",position:{x:2,y:5,z:0},color:"#8B0000"},{type:"shield",position:{x:1,y:4,z:0},color:"#DAA520"},{type:"shield",position:{x:3,y:4,z:0},color:"#DAA520"},{type:"buttress",position:{x:0,y:0,z:1},color:"#606060"},{type:"buttress",position:{x:0,y:0,z:3},color:"#606060"},{type:"buttress",position:{x:4,y:0,z:1},color:"#606060"},{type:"buttress",position:{x:4,y:0,z:3},color:"#606060"},{type:"ladder",position:{x:1,y:1,z:1},color:"#8B4513"},{type:"ladder",position:{x:1,y:2,z:1},color:"#8B4513"},{type:"ladder",position:{x:1,y:3,z:1},color:"#8B4513"},{type:"ladder",position:{x:1,y:4,z:1},color:"#8B4513"},{type:"ladder",position:{x:1,y:5,z:1},color:"#8B4513"},{type:"rock",position:{x:0,y:0,z:0},color:"#696969"},{type:"rock",position:{x:4,y:0,z:4},color:"#707070"},{type:"boulder",position:{x:-1,y:0,z:3},color:"#5A5A5A"}]},dungeon:{name:"Dungeon Complex",category:"medieval",description:"Medieval dungeon with cells, torture chamber, guard post, and treasure room",blocks:[...st(0,0,4,12,3,"#3A3A3A"),...ne(0,1,4,12,3,"#4A4A4A"),...ne(0,1,6,12,3,"#4A4A4A"),...st(0,4,4,12,3,"#3A3A3A"),{type:"torch",position:{x:2,y:3,z:4},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},{type:"torch",position:{x:6,y:3,z:4},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},{type:"torch",position:{x:10,y:3,z:4},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},...st(0,0,0,4,4,"#3A3A3A"),...ne(0,1,0,4,3,"#4A4A4A"),...Wt(0,1,1,3,3,"#4A4A4A"),...Wt(3,1,1,3,3,"#4A4A4A"),...st(0,4,0,4,4,"#3A3A3A"),{type:"fence",position:{x:0,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:1,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:2,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:3,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:0,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:1,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:2,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:3,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:0,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:1,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:2,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:3,y:3,z:3},color:"#2F2F2F"},{type:"chain",position:{x:1,y:2,z:0},color:"#4A4A4A"},{type:"chain",position:{x:2,y:2,z:0},color:"#4A4A4A"},{type:"chain",position:{x:1,y:1,z:0},color:"#4A4A4A"},{type:"chain",position:{x:2,y:1,z:0},color:"#4A4A4A"},{type:"slab",position:{x:0,y:1,z:1},color:"#8B7355"},...st(4,0,0,4,4,"#3A3A3A"),...ne(4,1,0,4,3,"#4A4A4A"),...Wt(4,1,1,3,3,"#4A4A4A"),...Wt(7,1,1,3,3,"#4A4A4A"),...st(4,4,0,4,4,"#3A3A3A"),{type:"fence",position:{x:4,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:5,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:6,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:7,y:1,z:3},color:"#2F2F2F"},{type:"fence",position:{x:4,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:5,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:6,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:7,y:2,z:3},color:"#2F2F2F"},{type:"fence",position:{x:4,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:5,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:6,y:3,z:3},color:"#2F2F2F"},{type:"fence",position:{x:7,y:3,z:3},color:"#2F2F2F"},{type:"barrel",position:{x:4,y:1,z:1},color:"#3D2914"},{type:"chain",position:{x:6,y:2,z:0},color:"#4A4A4A"},...st(8,0,0,4,4,"#2F2F2F"),...ne(8,1,0,4,3,"#4A4A4A"),...Wt(8,1,1,3,3,"#4A4A4A"),...Wt(11,1,1,3,3,"#4A4A4A"),...st(8,4,0,4,4,"#3A3A3A"),{type:"arch",position:{x:9,y:1,z:3},color:"#4A4A4A"},{type:"arch",position:{x:10,y:1,z:3},color:"#4A4A4A"},{type:"cross",position:{x:9,y:1,z:0},color:"#3D2914"},{type:"chain",position:{x:9,y:2,z:0},color:"#4A4A4A"},{type:"chain",position:{x:9,y:3,z:0},color:"#4A4A4A"},{type:"barrel",position:{x:11,y:1,z:1},color:"#2F2F2F"},{type:"cube",position:{x:11,y:2,z:1},color:"#FF4500",emissive:{enabled:!0,color:"#FF2200",intensity:1.5,radius:3}},{type:"shelf",position:{x:8,y:2,z:1},color:"#3D2914"},{type:"torch",position:{x:10,y:3,z:0},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},...st(0,0,7,5,5,"#4A4A3A"),...ne(0,1,11,5,3,"#5A5A4A"),...Wt(0,1,7,4,3,"#5A5A4A"),...Wt(4,1,8,3,3,"#5A5A4A"),...st(0,4,7,5,5,"#3A3A3A"),{type:"doorFrame",position:{x:1,y:1,z:7},color:"#3D2914"},{type:"doorFrame",position:{x:1,y:2,z:7},color:"#3D2914"},{type:"table",position:{x:1,y:1,z:9},color:"#5C4033"},{type:"stool",position:{x:0,y:1,z:9},color:"#5C4033"},{type:"stool",position:{x:2,y:1,z:9},color:"#5C4033"},{type:"shelf",position:{x:0,y:2,z:11},color:"#3D2914"},{type:"shelf",position:{x:1,y:2,z:11},color:"#3D2914"},{type:"shield",position:{x:3,y:2,z:11},color:"#8B0000"},{type:"torch",position:{x:2,y:3,z:11},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},{type:"barrel",position:{x:4,y:1,z:10},color:"#5C4033"},{type:"chain",position:{x:4,y:2,z:8},color:"#B8860B"},...st(8,0,7,4,5,"#3A3A3A"),...ne(8,1,11,4,3,"#4A4A4A"),...Wt(8,1,7,4,3,"#4A4A4A"),...Wt(11,1,7,4,3,"#4A4A4A"),...st(8,4,7,4,5,"#3A3A3A"),{type:"portcullis",position:{x:9,y:1,z:7},color:"#2F2F2F"},{type:"portcullis",position:{x:10,y:1,z:7},color:"#2F2F2F"},{type:"portcullis",position:{x:9,y:2,z:7},color:"#2F2F2F"},{type:"portcullis",position:{x:10,y:2,z:7},color:"#2F2F2F"},{type:"crate",position:{x:9,y:1,z:10},color:"#8B4513"},{type:"crate",position:{x:10,y:1,z:10},color:"#8B4513"},{type:"slab",position:{x:9,y:1,z:9},color:"#FFD700"},{type:"slab",position:{x:10,y:1,z:9},color:"#FFD700"},{type:"quarter",position:{x:9,y:2,z:9},color:"#FFD700"},{type:"sack",position:{x:8,y:1,z:9},color:"#8B7355"},{type:"sack",position:{x:11,y:1,z:9},color:"#8B7355"},{type:"torch",position:{x:9,y:3,z:11},color:"#5C4033",emissive:{enabled:!0,color:"#FF4500",intensity:1.2,radius:4}},{type:"arrowSlit",position:{x:4,y:2,z:6},color:"#4A4A4A"},{type:"arrowSlit",position:{x:8,y:2,z:6},color:"#4A4A4A"},{type:"grate",position:{x:3,y:0,z:5},color:"#2F2F2F"},{type:"grate",position:{x:7,y:0,z:5},color:"#2F2F2F"}]},tavern:{name:"Tavern Interior",category:"medieval",description:"Cozy medieval tavern with bar, fireplace, sleeping quarters, and rustic charm",blocks:[...st(0,0,0,7,6,"#8B4513"),{type:"slab",position:{x:6,y:0,z:0},color:"#505050"},{type:"slab",position:{x:6,y:0,z:1},color:"#505050"},{type:"slab",position:{x:6,y:0,z:2},color:"#505050"},...ne(0,1,-1,7,3,"#606060"),...Wt(-1,1,0,6,3,"#8B4513"),...Wt(7,1,0,6,3,"#8B4513"),{type:"slab",position:{x:0,y:1,z:0},color:"#5D4037"},{type:"slab",position:{x:1,y:1,z:0},color:"#5D4037"},{type:"slab",position:{x:2,y:1,z:0},color:"#5D4037"},{type:"slab",position:{x:3,y:1,z:0},color:"#5D4037"},{type:"ledge",position:{x:0,y:1,z:1},color:"#654321"},{type:"ledge",position:{x:1,y:1,z:1},color:"#654321"},{type:"ledge",position:{x:2,y:1,z:1},color:"#654321"},{type:"ledge",position:{x:3,y:1,z:1},color:"#654321"},{type:"shelf",position:{x:0,y:2,z:-1},color:"#5D4037"},{type:"shelf",position:{x:1,y:2,z:-1},color:"#5D4037"},{type:"shelf",position:{x:2,y:2,z:-1},color:"#5D4037"},{type:"shelf",position:{x:3,y:2,z:-1},color:"#5D4037"},{type:"barrel",position:{x:0,y:1,z:-1},color:"#5C4033"},{type:"barrel",position:{x:1,y:1,z:-1},color:"#4A3728"},{type:"barrel",position:{x:2,y:1,z:-1},color:"#5C4033"},{type:"barrel",position:{x:3,y:1,z:-1},color:"#4A3728"},{type:"barrel",position:{x:0,y:2,z:-1},color:"#4A3728"},{type:"barrel",position:{x:2,y:2,z:-1},color:"#5C4033"},{type:"barrel",position:{x:0,y:0,z:5},color:"#5C4033"},{type:"barrel",position:{x:0,y:1,z:5},color:"#4A3728"},{type:"cube",position:{x:6,y:1,z:0},color:"#505050"},{type:"cube",position:{x:6,y:1,z:2},color:"#505050"},{type:"cube",position:{x:6,y:2,z:0},color:"#404040"},{type:"cube",position:{x:6,y:2,z:2},color:"#404040"},{type:"arch",position:{x:6,y:2,z:1},color:"#505050",rotation:{x:0,y:90,z:0}},{type:"pillar4",position:{x:6,y:1,z:1},color:"#FF4500",emissive:{enabled:!0,color:"#FF6600",intensity:4,radius:5}},{type:"chimney",position:{x:6,y:3,z:1},color:"#505050"},{type:"chimney",position:{x:6,y:4,z:1},color:"#404040"},{type:"slab",position:{x:6,y:3,z:0},color:"#5D4037"},{type:"slab",position:{x:6,y:3,z:2},color:"#5D4037"},{type:"table",position:{x:2,y:1,z:3},color:"#8B4513"},{type:"chair",position:{x:1,y:1,z:3},color:"#654321",rotation:{x:0,y:90,z:0}},{type:"chair",position:{x:3,y:1,z:3},color:"#654321",rotation:{x:0,y:270,z:0}},{type:"stool",position:{x:2,y:1,z:2},color:"#654321"},{type:"stool",position:{x:2,y:1,z:4},color:"#654321"},{type:"bench",position:{x:4,y:1,z:4},color:"#654321"},{type:"bench",position:{x:5,y:1,z:5},color:"#654321",rotation:{x:0,y:90,z:0}},{type:"table",position:{x:5,y:1,z:4},color:"#8B4513"},{type:"stool",position:{x:1,y:1,z:1},color:"#5D4037"},{type:"stool",position:{x:2,y:1,z:1},color:"#5D4037"},{type:"stool",position:{x:3,y:1,z:1},color:"#5D4037"},{type:"beamX",position:{x:0,y:3,z:2},color:"#5D4037"},{type:"beamX",position:{x:2,y:3,z:2},color:"#5D4037"},{type:"beamX",position:{x:4,y:3,z:2},color:"#5D4037"},{type:"beamX",position:{x:0,y:3,z:4},color:"#5D4037"},{type:"beamX",position:{x:2,y:3,z:4},color:"#5D4037"},{type:"beamX",position:{x:4,y:3,z:4},color:"#5D4037"},{type:"torch",position:{x:-1,y:2,z:1},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"torch",position:{x:-1,y:2,z:4},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"torch",position:{x:4,y:2,z:-1},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"chain",position:{x:3,y:3,z:3},color:"#2F2F2F"},{type:"sphere",position:{x:3,y:2,z:3},color:"#FFD700",emissive:{enabled:!0,color:"#FFAA00",intensity:2,radius:3}},{type:"shield",position:{x:2,y:3,z:-1},color:"#8B0000"},{type:"beamDiag",position:{x:5,y:3,z:-1},color:"#C0C0C0"},{type:"banner",position:{x:0,y:3,z:-1},color:"#006400"},{type:"crate",position:{x:0,y:0,z:4},color:"#8B4513"},{type:"doorFrame",position:{x:3,y:1,z:5},color:"#5D4037"}]},oakTree:{name:"Oak Tree",category:"nature",description:"Majestic oak tree with detailed bark, branches, and forest floor",blocks:[{type:"slab",position:{x:0,y:0,z:0},color:"#4A3728"},{type:"slab",position:{x:1,y:0,z:0},color:"#3D2914"},{type:"slab",position:{x:2,y:0,z:0},color:"#4A3728"},{type:"slab",position:{x:3,y:0,z:0},color:"#3D2914"},{type:"slab",position:{x:0,y:0,z:1},color:"#3D2914"},{type:"slab",position:{x:3,y:0,z:1},color:"#4A3728"},{type:"slab",position:{x:0,y:0,z:2},color:"#4A3728"},{type:"slab",position:{x:3,y:0,z:2},color:"#3D2914"},{type:"slab",position:{x:0,y:0,z:3},color:"#3D2914"},{type:"slab",position:{x:1,y:0,z:3},color:"#4A3728"},{type:"slab",position:{x:2,y:0,z:3},color:"#3D2914"},{type:"slab",position:{x:3,y:0,z:3},color:"#4A3728"},{type:"rock",position:{x:1,y:0,z:1},color:"#5D4037"},{type:"rock",position:{x:2,y:0,z:1},color:"#5D4037"},{type:"rock",position:{x:1,y:0,z:2},color:"#5D4037"},{type:"rock",position:{x:2,y:0,z:2},color:"#5D4037"},{type:"pillar",position:{x:1,y:1,z:1},color:"#5D4037"},{type:"pillar",position:{x:2,y:1,z:1},color:"#4A3728"},{type:"pillar",position:{x:1,y:1,z:2},color:"#4A3728"},{type:"pillar",position:{x:2,y:1,z:2},color:"#5D4037"},{type:"pillar",position:{x:1,y:2,z:1},color:"#5D4037"},{type:"pillar",position:{x:2,y:2,z:2},color:"#5D4037"},{type:"pillar",position:{x:1,y:3,z:2},color:"#5D4037"},{type:"pillar",position:{x:2,y:3,z:1},color:"#5D4037"},{type:"logX",position:{x:0,y:3,z:1},color:"#5D4037"},{type:"logX",position:{x:3,y:3,z:2},color:"#5D4037"},{type:"logZ",position:{x:1,y:4,z:0},color:"#5D4037"},{type:"logZ",position:{x:2,y:4,z:3},color:"#5D4037"},{type:"sphere",position:{x:0,y:4,z:1},color:"#228B22"},{type:"sphere",position:{x:3,y:4,z:1},color:"#2E8B2E"},{type:"sphere",position:{x:0,y:4,z:2},color:"#2E8B2E"},{type:"sphere",position:{x:3,y:4,z:2},color:"#228B22"},{type:"sphere",position:{x:1,y:4,z:0},color:"#228B22"},{type:"sphere",position:{x:2,y:4,z:0},color:"#2E8B2E"},{type:"sphere",position:{x:1,y:4,z:3},color:"#2E8B2E"},{type:"sphere",position:{x:2,y:4,z:3},color:"#228B22"},{type:"sphere",position:{x:1,y:5,z:1},color:"#32CD32"},{type:"sphere",position:{x:2,y:5,z:1},color:"#228B22"},{type:"sphere",position:{x:1,y:5,z:2},color:"#228B22"},{type:"sphere",position:{x:2,y:5,z:2},color:"#32CD32"},{type:"sphere",position:{x:0,y:5,z:1},color:"#2E8B2E"},{type:"sphere",position:{x:3,y:5,z:2},color:"#2E8B2E"},{type:"sphere",position:{x:1,y:6,z:1},color:"#32CD32"},{type:"sphere",position:{x:2,y:6,z:2},color:"#32CD32"},{type:"sphere",position:{x:1,y:6,z:2},color:"#228B22"},{type:"sphere",position:{x:2,y:6,z:1},color:"#228B22"},{type:"sphere",position:{x:1,y:7,z:1},color:"#90EE90"},{type:"sphere",position:{x:2,y:7,z:2},color:"#90EE90"},{type:"bush",position:{x:0,y:0,z:0},color:"#228B22"},{type:"bush",position:{x:3,y:0,z:3},color:"#2E8B2E"},{type:"bush",position:{x:3,y:0,z:0},color:"#006400"},{type:"grass",position:{x:0,y:0,z:3},color:"#7CFC00"},{type:"grass",position:{x:3,y:0,z:1},color:"#90EE90"},{type:"flower",position:{x:0,y:0,z:2},color:"#FFD700"},{type:"flower",position:{x:2,y:0,z:3},color:"#FF69B4"},{type:"logX",position:{x:-1,y:0,z:0},color:"#5D4037"},{type:"stump",position:{x:-1,y:0,z:3},color:"#5D4037"},{type:"rock",position:{x:4,y:0,z:1},color:"#696969"},{type:"rock",position:{x:-1,y:0,z:1},color:"#707070"}]},rockGarden:{name:"Rock Garden",category:"nature",description:"Zen garden with rocks and plants",blocks:[...st(0,0,0,4,4,"#C2B280"),{type:"rock",position:{x:0,y:0,z:0},color:"#696969"},{type:"rock",position:{x:3,y:0,z:1},color:"#808080",rotation:{x:0,y:45,z:0}},{type:"rock",position:{x:1,y:0,z:3},color:"#707070",rotation:{x:0,y:90,z:0}},{type:"rock",position:{x:2,y:0,z:2},color:"#606060"},{type:"bush",position:{x:0,y:0,z:2},color:"#228B22"},{type:"bush",position:{x:3,y:0,z:3},color:"#2E8B2E"},{type:"planter",position:{x:2,y:0,z:0},color:"#8B4513"}]},pond:{name:"Pond",category:"nature",description:"Small pond with rocks and plants",blocks:[{type:"slab",position:{x:1,y:0,z:1},color:"#1E90FF"},{type:"slab",position:{x:2,y:0,z:1},color:"#1E90FF"},{type:"slab",position:{x:1,y:0,z:2},color:"#1E90FF"},{type:"slab",position:{x:2,y:0,z:2},color:"#1E90FF"},{type:"rock",position:{x:0,y:0,z:1},color:"#696969"},{type:"rock",position:{x:0,y:0,z:2},color:"#606060"},{type:"rock",position:{x:3,y:0,z:1},color:"#707070"},{type:"rock",position:{x:3,y:0,z:2},color:"#808080"},{type:"rock",position:{x:1,y:0,z:0},color:"#656565"},{type:"rock",position:{x:2,y:0,z:0},color:"#757575"},{type:"rock",position:{x:1,y:0,z:3},color:"#858585"},{type:"rock",position:{x:2,y:0,z:3},color:"#959595"},{type:"bush",position:{x:0,y:0,z:0},color:"#228B22"},{type:"bush",position:{x:3,y:0,z:3},color:"#2E8B2E"},{type:"logX",position:{x:1,y:1,z:1},color:"#5D4037"},{type:"logX",position:{x:2,y:1,z:1},color:"#5D4037"}]},campsite:{name:"Campsite",category:"nature",description:"Cozy wilderness campsite with tent, campfire, and outdoor gear",blocks:[...st(0,0,0,6,6,"#654321"),{type:"slab",position:{x:2,y:0,z:2},color:"#4A3728"},{type:"slab",position:{x:3,y:0,z:2},color:"#4A3728"},{type:"slab",position:{x:2,y:0,z:3},color:"#4A3728"},{type:"slab",position:{x:3,y:0,z:3},color:"#4A3728"},{type:"slab",position:{x:0,y:0,z:4},color:"#2F4F4F"},{type:"slab",position:{x:1,y:0,z:4},color:"#2F4F4F"},{type:"slab",position:{x:0,y:0,z:5},color:"#2F4F4F"},{type:"slab",position:{x:1,y:0,z:5},color:"#2F4F4F"},{type:"wedge",position:{x:0,y:1,z:4},color:"#3CB371"},{type:"wedge",position:{x:1,y:1,z:4},color:"#3CB371"},{type:"wedge",position:{x:0,y:1,z:5},color:"#2E8B57",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:1,y:1,z:5},color:"#2E8B57",rotation:{x:0,y:180,z:0}},{type:"pillar4",position:{x:0,y:1,z:4},color:"#8B4513"},{type:"pillar4",position:{x:1,y:1,z:5},color:"#8B4513"},{type:"rock",position:{x:2,y:0,z:2},color:"#404040"},{type:"rock",position:{x:3,y:0,z:2},color:"#505050"},{type:"rock",position:{x:2,y:0,z:3},color:"#505050"},{type:"rock",position:{x:3,y:0,z:3},color:"#404040"},{type:"pillar4",position:{x:2,y:0,z:2},color:"#FF4500",emissive:{enabled:!0,color:"#FF6600",intensity:4,radius:6}},{type:"pillar4",position:{x:3,y:0,z:3},color:"#FF8C00",emissive:{enabled:!0,color:"#FF4500",intensity:3,radius:4}},{type:"sphere",position:{x:2,y:1,z:2},color:"#3A3A3A"},{type:"logX",position:{x:1,y:0,z:1},color:"#5D4037"},{type:"logZ",position:{x:4,y:0,z:2},color:"#5D4037"},{type:"logZ",position:{x:4,y:0,z:3},color:"#5D4037"},{type:"logX",position:{x:1,y:0,z:4},color:"#5D4037"},{type:"pillar4",position:{x:3,y:1,z:2},color:"#2F2F2F"},{type:"barrel",position:{x:3,y:0,z:2},color:"#1A1A1A"},{type:"crate",position:{x:5,y:0,z:0},color:"#8B4513"},{type:"crate",position:{x:5,y:0,z:1},color:"#A0522D"},{type:"crate",position:{x:5,y:1,z:0},color:"#CD853F"},{type:"barrel",position:{x:5,y:0,z:2},color:"#4169E1"},{type:"sphere",position:{x:5,y:1,z:1},color:"#FFD700",emissive:{enabled:!0,color:"#FFAA00",intensity:2,radius:3}},{type:"pillar4",position:{x:0,y:0,z:0},color:"#8B4513"},{type:"pillar4",position:{x:0,y:1,z:0},color:"#8B4513"},{type:"barrel",position:{x:1,y:0,z:0},color:"#696969"},{type:"boulder",position:{x:0,y:0,z:2},color:"#696969"},{type:"rock",position:{x:4,y:0,z:5},color:"#707070"},{type:"bush",position:{x:5,y:0,z:4},color:"#228B22"},{type:"bush",position:{x:5,y:0,z:5},color:"#2E8B2E"},{type:"pillar",position:{x:-1,y:0,z:3},color:"#5D4037"},{type:"pillar",position:{x:-1,y:1,z:3},color:"#5D4037"},{type:"sphere",position:{x:-1,y:2,z:3},color:"#228B22"},{type:"grass",position:{x:0,y:0,z:1},color:"#7CFC00"},{type:"grass",position:{x:4,y:0,z:0},color:"#90EE90"},{type:"flower",position:{x:3,y:0,z:5},color:"#FFFF00"}]},factory:{name:"Factory Building",category:"industrial",description:"Detailed industrial facility with machinery, pipes, and electrical systems",blocks:[...st(0,0,0,8,6,"#505050"),{type:"grate",position:{x:3,y:0,z:3},color:"#404040"},{type:"grate",position:{x:4,y:0,z:3},color:"#404040"},...ne(0,1,0,8,3,"#606060"),...ne(0,1,5,8,3,"#606060"),...Wt(0,1,1,4,3,"#606060"),...Wt(7,1,1,4,3,"#606060"),...st(0,4,0,8,6,"#505050"),{type:"iBeam",position:{x:2,y:1,z:2},color:"#8B0000"},{type:"iBeam",position:{x:2,y:2,z:2},color:"#8B0000"},{type:"iBeam",position:{x:2,y:3,z:2},color:"#8B0000"},{type:"iBeam",position:{x:5,y:1,z:2},color:"#8B0000"},{type:"iBeam",position:{x:5,y:2,z:2},color:"#8B0000"},{type:"iBeam",position:{x:5,y:3,z:2},color:"#8B0000"},{type:"iBeam",position:{x:2,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:3,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:3,z:4},color:"#8B0000"},{type:"doorFrame",position:{x:3,y:1,z:0},color:"#FFD700"},{type:"doorFrame",position:{x:4,y:1,z:0},color:"#FFD700"},{type:"doorFrame",position:{x:3,y:2,z:0},color:"#FFD700"},{type:"doorFrame",position:{x:4,y:2,z:0},color:"#FFD700"},{type:"windowFrame",position:{x:1,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:6,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:1,y:2,z:5},color:"#4682B4"},{type:"windowFrame",position:{x:6,y:2,z:5},color:"#4682B4"},{type:"tank",position:{x:1,y:4,z:1},color:"#C0C0C0"},{type:"tank",position:{x:1,y:5,z:1},color:"#B0B0B0"},{type:"tank",position:{x:6,y:4,z:1},color:"#808080"},{type:"tank",position:{x:6,y:5,z:1},color:"#707070"},{type:"vent",position:{x:3,y:4,z:3},color:"#4A4A4A"},{type:"vent",position:{x:4,y:4,z:3},color:"#4A4A4A"},{type:"acUnit",position:{x:1,y:4,z:4},color:"#909090"},{type:"acUnit",position:{x:6,y:4,z:4},color:"#909090"},{type:"chimney",position:{x:0,y:4,z:2},color:"#8B4513"},{type:"chimney",position:{x:0,y:5,z:2},color:"#704214"},{type:"chimney",position:{x:0,y:6,z:2},color:"#5D3A1A"},{type:"pipeX",position:{x:2,y:5,z:1},color:"#696969"},{type:"pipeX",position:{x:3,y:5,z:1},color:"#696969"},{type:"pipeX",position:{x:4,y:5,z:1},color:"#696969"},{type:"pipeX",position:{x:5,y:5,z:1},color:"#696969"},{type:"valve",position:{x:3,y:5,z:1},color:"#B22222"},{type:"pipeY",position:{x:4,y:4,z:1},color:"#696969"},{type:"fuseBox",position:{x:0,y:1,z:3},color:"#404040"},{type:"powerBox",position:{x:7,y:1,z:3},color:"#2F4F4F"},{type:"cableY",position:{x:0,y:2,z:3},color:"#696969"},{type:"cableY",position:{x:0,y:3,z:3},color:"#696969"},{type:"beamX",position:{x:1,y:3,z:3},color:"#404040"},{type:"beamX",position:{x:2,y:3,z:3},color:"#404040"},{type:"beamX",position:{x:3,y:3,z:3},color:"#404040"},{type:"beamX",position:{x:4,y:3,z:3},color:"#404040"},{type:"cableX",position:{x:1,y:3,z:3},color:"#1A1A1A"},{type:"cableX",position:{x:2,y:3,z:3},color:"#1A1A1A"},{type:"lightFixture",position:{x:3,y:3,z:3},color:"#FFFF00"},{type:"lightFixture",position:{x:4,y:3,z:3},color:"#FFFF00"},{type:"pillar2",position:{x:3,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:4,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:4,y:1,z:2},color:"#4A4A4A"},{type:"catwalk",position:{x:3,y:2,z:2},color:"#3A3A3A"},{type:"catwalk",position:{x:4,y:2,z:2},color:"#3A3A3A"},{type:"railing",position:{x:3,y:3,z:2},color:"#505050"},{type:"railing",position:{x:4,y:3,z:2},color:"#505050"},{type:"ladder",position:{x:2,y:1,z:3},color:"#FFD700"},{type:"ladder",position:{x:2,y:2,z:3},color:"#FFD700"},{type:"crate",position:{x:6,y:0,z:2},color:"#8B4513"},{type:"crate",position:{x:6,y:0,z:3},color:"#A0522D"},{type:"crate",position:{x:6,y:1,z:2},color:"#CD853F"},{type:"barrel",position:{x:1,y:0,z:3},color:"#006400"},{type:"barrel",position:{x:1,y:0,z:4},color:"#2F4F4F"},{type:"barrier",position:{x:3,y:0,z:-1},color:"#FFD700"},{type:"barrier",position:{x:4,y:0,z:-1},color:"#FFD700"},{type:"trafficCone",position:{x:2,y:0,z:-1},color:"#FF4500"}]},pipeNetwork:{name:"Pipe Network",category:"industrial",description:"Industrial pipe and cable network showcase with all junction types",blocks:[...st(0,0,0,8,8,"#505050"),{type:"pipeX",position:{x:0,y:2,z:2},color:"#4682B4"},{type:"pipeX",position:{x:1,y:2,z:2},color:"#4682B4"},{type:"pipeX",position:{x:2,y:2,z:2},color:"#4682B4"},{type:"valve",position:{x:1,y:2,z:2},color:"#B22222"},{type:"pipeElbowXZ4",position:{x:3,y:2,z:2},color:"#4682B4"},{type:"pipeZ",position:{x:3,y:2,z:3},color:"#4682B4"},{type:"pipeZ",position:{x:3,y:2,z:4},color:"#4682B4"},{type:"pipeT",position:{x:3,y:2,z:5},color:"#4682B4"},{type:"pipeX",position:{x:2,y:2,z:5},color:"#4682B4"},{type:"pipeX",position:{x:4,y:2,z:5},color:"#4682B4"},{type:"valve",position:{x:4,y:2,z:5},color:"#B22222"},{type:"pipeY",position:{x:6,y:0,z:2},color:"#708090"},{type:"pipeY",position:{x:6,y:1,z:2},color:"#708090"},{type:"pipeY",position:{x:6,y:2,z:2},color:"#708090"},{type:"pipeElbowXY",position:{x:6,y:3,z:2},color:"#708090"},{type:"pipeX",position:{x:7,y:3,z:2},color:"#708090"},{type:"pipeTY",position:{x:5,y:2,z:2},color:"#708090"},{type:"pipeX",position:{x:4,y:2,z:2},color:"#708090"},{type:"pipeY",position:{x:5,y:3,z:2},color:"#708090"},{type:"vent",position:{x:5,y:4,z:2},color:"#606060"},{type:"pipeCross",position:{x:5,y:2,z:5},color:"#FF8C00"},{type:"pipeX",position:{x:6,y:2,z:5},color:"#FF8C00"},{type:"pipeZ",position:{x:5,y:2,z:6},color:"#FF8C00"},{type:"valve",position:{x:5,y:2,z:6},color:"#B22222"},{type:"cableX",position:{x:0,y:1,z:1},color:"#1A1A1A"},{type:"cableX",position:{x:1,y:1,z:1},color:"#1A1A1A"},{type:"cableX",position:{x:2,y:1,z:1},color:"#1A1A1A"},{type:"cableElbow",position:{x:3,y:1,z:1},color:"#1A1A1A"},{type:"cableZ",position:{x:3,y:1,z:2},color:"#1A1A1A"},{type:"cableZ",position:{x:3,y:1,z:3},color:"#1A1A1A"},{type:"cableT",position:{x:3,y:1,z:4},color:"#1A1A1A"},{type:"cableZ",position:{x:3,y:1,z:5},color:"#1A1A1A"},{type:"cableY",position:{x:1,y:0,z:6},color:"#8B0000"},{type:"cableY",position:{x:1,y:1,z:6},color:"#8B0000"},{type:"cableY",position:{x:1,y:2,z:6},color:"#8B0000"},{type:"cableElbowY",position:{x:1,y:3,z:6},color:"#8B0000"},{type:"cableX",position:{x:2,y:3,z:6},color:"#8B0000"},{type:"cableX",position:{x:3,y:3,z:6},color:"#8B0000"},{type:"conduitX",position:{x:5,y:0,z:0},color:"#696969"},{type:"conduitX",position:{x:6,y:0,z:0},color:"#696969"},{type:"conduitElbow",position:{x:7,y:0,z:0},color:"#696969"},{type:"conduitZ",position:{x:7,y:0,z:1},color:"#696969"},{type:"conduitT",position:{x:7,y:0,z:2},color:"#696969"},{type:"conduitZ",position:{x:7,y:0,z:3},color:"#696969"},{type:"pillar2",position:{x:0,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:0,y:1,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:0,z:5},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:5},color:"#4A4A4A"},{type:"pillar2",position:{x:5,y:0,z:5},color:"#4A4A4A"},{type:"pillar2",position:{x:5,y:1,z:5},color:"#4A4A4A"},{type:"fuseBox",position:{x:0,y:0,z:1},color:"#404040"},{type:"switchBox",position:{x:1,y:0,z:0},color:"#505050"},{type:"powerBox",position:{x:0,y:0,z:6},color:"#2F4F4F"},{type:"tank",position:{x:0,y:0,z:4},color:"#4682B4"},{type:"tank",position:{x:0,y:1,z:4},color:"#4682B4"},{type:"tank",position:{x:7,y:0,z:5},color:"#FF8C00"},{type:"tank",position:{x:7,y:1,z:5},color:"#FF8C00"},{type:"sign",position:{x:0,y:2,z:4},color:"#FFFF00"},{type:"sign",position:{x:7,y:2,z:5},color:"#FF4500"}]},storageYard:{name:"Storage Yard",category:"industrial",description:"Outdoor storage with crates and barrels",blocks:[...st(0,0,0,5,4,"#808080"),{type:"crate",position:{x:0,y:0,z:0},color:"#8B4513"},{type:"crate",position:{x:1,y:0,z:0},color:"#A0522D"},{type:"crate",position:{x:0,y:0,z:1},color:"#8B4513"},{type:"crate",position:{x:1,y:0,z:1},color:"#A0522D"},{type:"crate",position:{x:0,y:1,z:0},color:"#CD853F"},{type:"crate",position:{x:1,y:1,z:0},color:"#8B4513"},{type:"barrel",position:{x:3,y:0,z:0},color:"#2F4F4F"},{type:"barrel",position:{x:4,y:0,z:0},color:"#2F4F4F"},{type:"barrel",position:{x:3,y:0,z:1},color:"#006400"},{type:"barrel",position:{x:4,y:0,z:1},color:"#006400"},{type:"barrel",position:{x:3,y:1,z:0},color:"#2F4F4F"},{type:"barrier",position:{x:0,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:1,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:2,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:3,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:4,y:0,z:3},color:"#FFD700"}]},refinery:{name:"Refinery",category:"industrial",description:"Oil refinery with tanks and pipes",blocks:[...st(0,0,0,5,5,"#404040"),{type:"tank",position:{x:0,y:0,z:0},color:"#C0C0C0"},{type:"tank",position:{x:0,y:1,z:0},color:"#C0C0C0"},{type:"tank",position:{x:0,y:2,z:0},color:"#C0C0C0"},{type:"tank",position:{x:4,y:0,z:0},color:"#808080"},{type:"tank",position:{x:4,y:1,z:0},color:"#808080"},{type:"tank",position:{x:4,y:2,z:0},color:"#808080"},{type:"pipeX",position:{x:1,y:2,z:0},color:"#696969"},{type:"pipeX",position:{x:2,y:2,z:0},color:"#696969"},{type:"pipeX",position:{x:3,y:2,z:0},color:"#696969"},{type:"valve",position:{x:2,y:2,z:0},color:"#B22222"},{type:"cube",position:{x:2,y:0,z:2},color:"#505050"},{type:"cube",position:{x:2,y:1,z:2},color:"#505050"},{type:"vent",position:{x:2,y:2,z:2},color:"#404040"},{type:"pillar2",position:{x:1,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:1,y:1,z:2},color:"#4A4A4A"},{type:"catwalk",position:{x:1,y:2,z:2},color:"#3A3A3A"},{type:"pillar2",position:{x:3,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:2},color:"#4A4A4A"},{type:"catwalk",position:{x:3,y:2,z:2},color:"#3A3A3A"},{type:"ladder",position:{x:0,y:0,z:1},color:"#FFD700"},{type:"ladder",position:{x:0,y:1,z:1},color:"#FFD700"},{type:"ladder",position:{x:0,y:2,z:1},color:"#FFD700"}]},industrialComplex:{name:"Industrial Complex",category:"industrial",description:"Large industrial facility with buildings, tanks, and pipe network",blocks:[...st(0,0,0,12,10,"#505050"),...ne(0,1,0,5,3,"#606060"),...ne(0,1,4,5,3,"#606060"),...Wt(0,1,1,3,3,"#606060"),...Wt(4,1,1,3,3,"#606060"),...st(0,4,0,5,5,"#404040"),{type:"doorFrame",position:{x:1,y:1,z:4},color:"#333333"},{type:"doorFrame",position:{x:2,y:1,z:4},color:"#333333"},{type:"doorFrame",position:{x:1,y:2,z:4},color:"#333333"},{type:"doorFrame",position:{x:2,y:2,z:4},color:"#333333"},{type:"windowFrame",position:{x:1,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:2,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:2,z:0},color:"#4682B4"},{type:"iBeam",position:{x:1,y:1,z:2},color:"#8B0000"},{type:"iBeam",position:{x:1,y:2,z:2},color:"#8B0000"},{type:"iBeam",position:{x:1,y:3,z:2},color:"#8B0000"},{type:"iBeam",position:{x:3,y:1,z:2},color:"#8B0000"},{type:"iBeam",position:{x:3,y:2,z:2},color:"#8B0000"},{type:"iBeam",position:{x:3,y:3,z:2},color:"#8B0000"},{type:"vent",position:{x:1,y:4,z:1},color:"#3A3A3A"},{type:"vent",position:{x:3,y:4,z:1},color:"#3A3A3A"},{type:"vent",position:{x:2,y:4,z:3},color:"#3A3A3A"},{type:"chimney",position:{x:0,y:4,z:0},color:"#8B4513"},{type:"chimney",position:{x:0,y:5,z:0},color:"#8B4513"},{type:"chimney",position:{x:0,y:6,z:0},color:"#8B4513"},{type:"chimney",position:{x:0,y:7,z:0},color:"#704214"},{type:"tank",position:{x:8,y:0,z:1},color:"#C0C0C0"},{type:"tank",position:{x:8,y:1,z:1},color:"#C0C0C0"},{type:"tank",position:{x:8,y:2,z:1},color:"#C0C0C0"},{type:"tank",position:{x:8,y:3,z:1},color:"#B0B0B0"},{type:"tank",position:{x:10,y:0,z:1},color:"#A0A0A0"},{type:"tank",position:{x:10,y:1,z:1},color:"#A0A0A0"},{type:"tank",position:{x:10,y:2,z:1},color:"#A0A0A0"},{type:"tank",position:{x:10,y:3,z:1},color:"#909090"},{type:"tank",position:{x:8,y:0,z:4},color:"#708090"},{type:"tank",position:{x:8,y:1,z:4},color:"#708090"},{type:"tank",position:{x:10,y:0,z:4},color:"#708090"},{type:"tank",position:{x:10,y:1,z:4},color:"#708090"},{type:"ladder",position:{x:8,y:0,z:0},color:"#FFD700"},{type:"ladder",position:{x:8,y:1,z:0},color:"#FFD700"},{type:"ladder",position:{x:8,y:2,z:0},color:"#FFD700"},{type:"ladder",position:{x:8,y:3,z:0},color:"#FFD700"},{type:"pipeX",position:{x:5,y:2,z:2},color:"#696969"},{type:"pipeX",position:{x:6,y:2,z:2},color:"#696969"},{type:"pipeX",position:{x:7,y:2,z:2},color:"#696969"},{type:"pipeElbowXZ4",position:{x:8,y:2,z:2},color:"#696969"},{type:"pipeZ",position:{x:8,y:2,z:1},color:"#696969"},{type:"pipeT",position:{x:7,y:2,z:2},color:"#696969"},{type:"pipeZ",position:{x:7,y:2,z:3},color:"#696969"},{type:"pipeZ",position:{x:7,y:2,z:4},color:"#696969"},{type:"pipeCross",position:{x:9,y:1,z:4},color:"#696969"},{type:"pipeX",position:{x:8,y:1,z:4},color:"#696969"},{type:"pipeX",position:{x:10,y:1,z:4},color:"#696969"},{type:"pipeY",position:{x:9,y:0,z:4},color:"#696969"},{type:"pipeTY",position:{x:9,y:2,z:4},color:"#696969"},{type:"valve",position:{x:6,y:2,z:2},color:"#B22222"},{type:"valve",position:{x:9,y:1,z:4},color:"#B22222"},{type:"pillar2",position:{x:5,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:5,y:1,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:7,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:7,y:1,z:2},color:"#4A4A4A"},{type:"catwalk",position:{x:9,y:3,z:1},color:"#3A3A3A"},{type:"railing",position:{x:9,y:4,z:1},color:"#505050"},{type:"pillar",position:{x:9,y:0,z:1},color:"#4A4A4A"},{type:"pillar",position:{x:9,y:1,z:1},color:"#4A4A4A"},{type:"pillar",position:{x:9,y:2,z:1},color:"#4A4A4A"},{type:"crate",position:{x:0,y:0,z:6},color:"#8B4513"},{type:"crate",position:{x:1,y:0,z:6},color:"#A0522D"},{type:"crate",position:{x:0,y:0,z:7},color:"#8B4513"},{type:"crate",position:{x:1,y:0,z:7},color:"#CD853F"},{type:"crate",position:{x:0,y:1,z:6},color:"#A0522D"},{type:"barrel",position:{x:3,y:0,z:6},color:"#2F4F4F"},{type:"barrel",position:{x:4,y:0,z:6},color:"#006400"},{type:"barrel",position:{x:3,y:0,z:7},color:"#8B0000"},{type:"barrel",position:{x:4,y:0,z:7},color:"#2F4F4F"},{type:"cube",position:{x:6,y:0,z:7},color:"#D3D3D3"},{type:"cube",position:{x:7,y:0,z:7},color:"#D3D3D3"},{type:"cube",position:{x:6,y:0,z:8},color:"#D3D3D3"},{type:"cube",position:{x:7,y:0,z:8},color:"#D3D3D3"},{type:"cube",position:{x:6,y:1,z:7},color:"#C0C0C0"},{type:"cube",position:{x:7,y:1,z:7},color:"#C0C0C0"},{type:"cube",position:{x:6,y:1,z:8},color:"#C0C0C0"},{type:"cube",position:{x:7,y:1,z:8},color:"#C0C0C0"},{type:"slab",position:{x:6,y:2,z:7},color:"#808080"},{type:"slab",position:{x:7,y:2,z:7},color:"#808080"},{type:"slab",position:{x:6,y:2,z:8},color:"#808080"},{type:"slab",position:{x:7,y:2,z:8},color:"#808080"},{type:"acUnit",position:{x:7,y:2,z:8},color:"#909090"},{type:"antenna",position:{x:6,y:2,z:7},color:"#606060"},{type:"doorFrame",position:{x:6,y:0,z:6},color:"#333333"},{type:"slab",position:{x:10,y:0,z:7},color:"#707070"},{type:"slab",position:{x:11,y:0,z:7},color:"#707070"},{type:"slab",position:{x:10,y:0,z:8},color:"#707070"},{type:"slab",position:{x:11,y:0,z:8},color:"#707070"},{type:"barrier",position:{x:10,y:0,z:6},color:"#FFD700"},{type:"barrier",position:{x:11,y:0,z:6},color:"#FFD700"},{type:"fence",position:{x:0,y:0,z:9},color:"#696969"},{type:"fence",position:{x:1,y:0,z:9},color:"#696969"},{type:"fence",position:{x:2,y:0,z:9},color:"#696969"},{type:"fence",position:{x:3,y:0,z:9},color:"#696969"},{type:"fence",position:{x:4,y:0,z:9},color:"#696969"},{type:"fence",position:{x:5,y:0,z:9},color:"#696969"},{type:"fence",position:{x:8,y:0,z:9},color:"#696969"},{type:"fence",position:{x:9,y:0,z:9},color:"#696969"},{type:"fence",position:{x:10,y:0,z:9},color:"#696969"},{type:"fence",position:{x:11,y:0,z:9},color:"#696969"}]},rooftopTerrace:{name:"Rooftop Terrace",category:"modern",description:"Modern rooftop with furniture and plants",blocks:[...st(0,0,0,5,4,"#D2B48C"),{type:"planter",position:{x:0,y:0,z:0},color:"#696969"},{type:"bush",position:{x:0,y:1,z:0},color:"#228B22"},{type:"planter",position:{x:4,y:0,z:0},color:"#696969"},{type:"bush",position:{x:4,y:1,z:0},color:"#2E8B2E"},{type:"planter",position:{x:0,y:0,z:3},color:"#696969"},{type:"bush",position:{x:0,y:1,z:3},color:"#32CD32"},{type:"planter",position:{x:4,y:0,z:3},color:"#696969"},{type:"bush",position:{x:4,y:1,z:3},color:"#228B22"},{type:"bench",position:{x:1,y:0,z:1},color:"#8B4513"},{type:"table",position:{x:2,y:0,z:1},color:"#A0522D"},{type:"chair",position:{x:3,y:0,z:1},color:"#8B4513"},{type:"acUnit",position:{x:2,y:0,z:3},color:"#C0C0C0"},{type:"solarPanel",position:{x:1,y:0,z:3},color:"#1a1a2e"},{type:"solarPanel",position:{x:3,y:0,z:3},color:"#1a1a2e"}]},parkingLot:{name:"Parking Lot",category:"modern",description:"Parking area with barriers and lights",blocks:[...st(0,0,0,6,4,"#2F2F2F"),{type:"slab",position:{x:1,y:0,z:0},color:"#FFFFFF"},{type:"slab",position:{x:3,y:0,z:0},color:"#FFFFFF"},{type:"slab",position:{x:5,y:0,z:0},color:"#FFFFFF"},{type:"barrier",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:1},color:"#FF0000"},{type:"barrier",position:{x:0,y:0,z:2},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:3},color:"#FF0000"},{type:"pillar2",position:{x:2,y:0,z:3},color:"#808080"},{type:"pillar2",position:{x:2,y:1,z:3},color:"#808080"},{type:"pillar2",position:{x:2,y:2,z:3},color:"#808080"},{type:"solarPanel",position:{x:2,y:3,z:3},color:"#404040"},{type:"quarter",position:{x:2,y:2,z:3},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFAA",intensity:2,radius:6}},{type:"pillar2",position:{x:5,y:0,z:3},color:"#808080"},{type:"pillar2",position:{x:5,y:1,z:3},color:"#808080"},{type:"pillar2",position:{x:5,y:2,z:3},color:"#808080"},{type:"quarter",position:{x:5,y:2,z:3},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFAA",intensity:2,radius:6}}]},busStop:{name:"Bus Stop",category:"modern",description:"Modern bus shelter with bench",blocks:[{type:"slab",position:{x:0,y:0,z:0},color:"#808080"},{type:"slab",position:{x:1,y:0,z:0},color:"#808080"},{type:"slab",position:{x:2,y:0,z:0},color:"#808080"},{type:"slab",position:{x:0,y:0,z:1},color:"#808080"},{type:"slab",position:{x:1,y:0,z:1},color:"#808080"},{type:"slab",position:{x:2,y:0,z:1},color:"#808080"},{type:"pillar2",position:{x:0,y:0,z:0},color:"#4169E1"},{type:"pillar2",position:{x:0,y:1,z:0},color:"#4169E1"},{type:"pillar2",position:{x:2,y:0,z:0},color:"#4169E1"},{type:"pillar2",position:{x:2,y:1,z:0},color:"#4169E1"},{type:"slab",position:{x:0,y:2,z:0},color:"#4169E1"},{type:"slab",position:{x:1,y:2,z:0},color:"#4169E1"},{type:"slab",position:{x:2,y:2,z:0},color:"#4169E1"},{type:"slab",position:{x:0,y:2,z:1},color:"#4169E1"},{type:"slab",position:{x:1,y:2,z:1},color:"#4169E1"},{type:"slab",position:{x:2,y:2,z:1},color:"#4169E1"},{type:"bench",position:{x:1,y:0,z:0},color:"#8B4513"},{type:"quarter",position:{x:1,y:2,z:0},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:4}}]},solarFarm:{name:"Solar Farm",category:"modern",description:"Array of solar panels",blocks:[...st(0,0,0,5,4,"#90EE90"),{type:"solarPanel",position:{x:0,y:0,z:0},color:"#1a1a2e"},{type:"solarPanel",position:{x:1,y:0,z:0},color:"#1a1a2e"},{type:"solarPanel",position:{x:2,y:0,z:0},color:"#1a1a2e"},{type:"solarPanel",position:{x:3,y:0,z:0},color:"#1a1a2e"},{type:"solarPanel",position:{x:4,y:0,z:0},color:"#1a1a2e"},{type:"solarPanel",position:{x:0,y:0,z:2},color:"#1a1a2e"},{type:"solarPanel",position:{x:1,y:0,z:2},color:"#1a1a2e"},{type:"solarPanel",position:{x:2,y:0,z:2},color:"#1a1a2e"},{type:"solarPanel",position:{x:3,y:0,z:2},color:"#1a1a2e"},{type:"solarPanel",position:{x:4,y:0,z:2},color:"#1a1a2e"},{type:"cube",position:{x:2,y:0,z:3},color:"#808080"},{type:"vent",position:{x:2,y:1,z:3},color:"#696969"},{type:"fence",position:{x:0,y:0,z:3},color:"#C0C0C0"},{type:"fence",position:{x:1,y:0,z:3},color:"#C0C0C0"},{type:"fence",position:{x:3,y:0,z:3},color:"#C0C0C0"},{type:"fence",position:{x:4,y:0,z:3},color:"#C0C0C0"}]},diningRoom:{name:"Dining Room",category:"furniture",description:"Dining set with table and chairs",blocks:[...st(0,0,0,4,4,"#DEB887"),{type:"table",position:{x:1,y:0,z:1},color:"#8B4513"},{type:"table",position:{x:2,y:0,z:1},color:"#8B4513"},{type:"table",position:{x:1,y:0,z:2},color:"#8B4513"},{type:"table",position:{x:2,y:0,z:2},color:"#8B4513"},{type:"chair",position:{x:0,y:0,z:1},color:"#654321",rotation:{x:0,y:90,z:0}},{type:"chair",position:{x:0,y:0,z:2},color:"#654321",rotation:{x:0,y:90,z:0}},{type:"chair",position:{x:3,y:0,z:1},color:"#654321",rotation:{x:0,y:270,z:0}},{type:"chair",position:{x:3,y:0,z:2},color:"#654321",rotation:{x:0,y:270,z:0}},{type:"chair",position:{x:1,y:0,z:0},color:"#654321",rotation:{x:0,y:180,z:0}},{type:"chair",position:{x:2,y:0,z:0},color:"#654321",rotation:{x:0,y:180,z:0}},{type:"chair",position:{x:1,y:0,z:3},color:"#654321"},{type:"chair",position:{x:2,y:0,z:3},color:"#654321"}]},livingRoom:{name:"Living Room",category:"furniture",description:"Cozy living room with sofa, fireplace, entertainment center, and decorations",blocks:[...st(0,0,0,8,7,"#DEB887"),{type:"slab",position:{x:2,y:0,z:2},color:"#8B0000"},{type:"slab",position:{x:3,y:0,z:2},color:"#8B0000"},{type:"slab",position:{x:4,y:0,z:2},color:"#8B0000"},{type:"slab",position:{x:2,y:0,z:3},color:"#A52A2A"},{type:"slab",position:{x:3,y:0,z:3},color:"#A52A2A"},{type:"slab",position:{x:4,y:0,z:3},color:"#A52A2A"},{type:"slab",position:{x:2,y:0,z:4},color:"#8B0000"},{type:"slab",position:{x:3,y:0,z:4},color:"#8B0000"},{type:"slab",position:{x:4,y:0,z:4},color:"#8B0000"},...Wt(0,1,0,7,3,"#F5F5DC"),...ne(0,1,0,8,3,"#F5F5DC"),{type:"cube",position:{x:3,y:1,z:0},color:"#696969"},{type:"cube",position:{x:4,y:1,z:0},color:"#696969"},{type:"cube",position:{x:2,y:1,z:0},color:"#808080"},{type:"cube",position:{x:5,y:1,z:0},color:"#808080"},{type:"cube",position:{x:2,y:2,z:0},color:"#808080"},{type:"cube",position:{x:5,y:2,z:0},color:"#808080"},{type:"slab",position:{x:2,y:3,z:0},color:"#654321"},{type:"slab",position:{x:3,y:3,z:0},color:"#654321"},{type:"slab",position:{x:4,y:3,z:0},color:"#654321"},{type:"slab",position:{x:5,y:3,z:0},color:"#654321"},{type:"doorFrame",position:{x:3,y:1,z:0},color:"#1A1A1A"},{type:"doorFrame",position:{x:4,y:1,z:0},color:"#1A1A1A"},{type:"cube",position:{x:3,y:1,z:0},color:"#FF4500",emissive:{enabled:!0,color:"#FF6600",intensity:2,radius:4}},{type:"chimney",position:{x:3,y:3,z:0},color:"#696969"},{type:"chimney",position:{x:4,y:3,z:0},color:"#696969"},{type:"pillar2",position:{x:2,y:3,z:0},color:"#FFD700"},{type:"pillar2",position:{x:5,y:3,z:0},color:"#FFD700"},{type:"bench",position:{x:2,y:0,z:5},color:"#4169E1"},{type:"bench",position:{x:3,y:0,z:5},color:"#4169E1"},{type:"bench",position:{x:4,y:0,z:5},color:"#4169E1"},{type:"halfZ",position:{x:2,y:1,z:6},color:"#3A5FCD"},{type:"halfZ",position:{x:3,y:1,z:6},color:"#3A5FCD"},{type:"halfZ",position:{x:4,y:1,z:6},color:"#3A5FCD"},{type:"halfX",position:{x:1,y:0,z:5},color:"#3A5FCD"},{type:"halfX",position:{x:5,y:0,z:5},color:"#3A5FCD",rotation:{x:0,y:180,z:0}},{type:"slab",position:{x:2,y:0,z:5},color:"#FFD700"},{type:"slab",position:{x:4,y:0,z:5},color:"#DC143C"},{type:"table",position:{x:3,y:0,z:3},color:"#8B4513"},{type:"slab",position:{x:3,y:1,z:3},color:"#228B22"},{type:"shelf",position:{x:0,y:0,z:2},color:"#2F2F2F"},{type:"shelf",position:{x:0,y:0,z:3},color:"#2F2F2F"},{type:"shelf",position:{x:0,y:0,z:4},color:"#2F2F2F"},{type:"monitor",position:{x:0,y:1,z:3},color:"#1A1A1A"},{type:"speaker",position:{x:0,y:1,z:2},color:"#2F2F2F"},{type:"speaker",position:{x:0,y:1,z:4},color:"#2F2F2F"},{type:"shelfUnit",position:{x:7,y:0,z:0},color:"#654321"},{type:"shelfUnit",position:{x:7,y:1,z:0},color:"#654321"},{type:"shelfUnit",position:{x:7,y:2,z:0},color:"#654321"},{type:"chair",position:{x:6,y:0,z:3},color:"#8B4513",rotation:{x:0,y:90,z:0}},{type:"table",position:{x:6,y:0,z:5},color:"#A0522D"},{type:"pillar2",position:{x:6,y:1,z:5},color:"#B87333"},{type:"dome",position:{x:6,y:2,z:5},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:1.5,radius:4}},{type:"planter",position:{x:7,y:0,z:5},color:"#8B4513"},{type:"bush",position:{x:7,y:1,z:5},color:"#228B22"},{type:"bush",position:{x:7,y:2,z:5},color:"#2E8B57"},{type:"windowFrame",position:{x:0,y:2,z:5},color:"#F5F5DC"},{type:"windowFrame",position:{x:0,y:2,z:6},color:"#F5F5DC"},{type:"windowSill",position:{x:0,y:1,z:5},color:"#F5F5DC"},{type:"windowSill",position:{x:0,y:1,z:6},color:"#F5F5DC"},{type:"lightFixture",position:{x:3,y:3,z:3},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1,radius:5}}]},workshop:{name:"Workshop",category:"furniture",description:"Crafting workshop with tools",blocks:[...st(0,0,0,4,4,"#696969"),{type:"table",position:{x:0,y:0,z:0},color:"#8B4513"},{type:"table",position:{x:1,y:0,z:0},color:"#8B4513"},{type:"table",position:{x:2,y:0,z:0},color:"#8B4513"},{type:"valve",position:{x:0,y:1,z:0},color:"#B22222"},{type:"valve",position:{x:2,y:1,z:0},color:"#4169E1"},{type:"chair",position:{x:1,y:0,z:1},color:"#654321"},{type:"crate",position:{x:3,y:0,z:0},color:"#8B4513"},{type:"crate",position:{x:3,y:0,z:1},color:"#A0522D"},{type:"crate",position:{x:3,y:1,z:0},color:"#CD853F"},{type:"barrel",position:{x:0,y:0,z:3},color:"#2F4F4F"},{type:"barrel",position:{x:1,y:0,z:3},color:"#006400"},{type:"ladder",position:{x:3,y:0,z:3},color:"#8B4513"},{type:"ladder",position:{x:3,y:1,z:3},color:"#8B4513"}]},cellar:{name:"Wine Cellar",category:"furniture",description:"Underground cellar with barrels",blocks:[...st(0,0,0,4,3,"#505050"),{type:"barrel",position:{x:0,y:0,z:0},color:"#5C4033",rotation:{x:90,y:0,z:0}},{type:"barrel",position:{x:1,y:0,z:0},color:"#5C4033",rotation:{x:90,y:0,z:0}},{type:"barrel",position:{x:2,y:0,z:0},color:"#5C4033",rotation:{x:90,y:0,z:0}},{type:"barrel",position:{x:0,y:1,z:0},color:"#4A3728",rotation:{x:90,y:0,z:0}},{type:"barrel",position:{x:1,y:1,z:0},color:"#4A3728",rotation:{x:90,y:0,z:0}},{type:"barrel",position:{x:2,y:1,z:0},color:"#4A3728",rotation:{x:90,y:0,z:0}},{type:"crate",position:{x:3,y:0,z:0},color:"#654321"},{type:"crate",position:{x:3,y:1,z:0},color:"#654321"},{type:"crate",position:{x:3,y:0,z:1},color:"#654321"},{type:"crate",position:{x:3,y:1,z:1},color:"#654321"},{type:"table",position:{x:1,y:0,z:2},color:"#8B4513"},{type:"torch",position:{x:0,y:1,z:2},color:"#8B4513",emissive:{enabled:!0,color:"#FF6600",intensity:1.5,radius:4}}]},stoneBridge:{name:"Stone Bridge",category:"infrastructure",description:"Grand arched stone bridge with decorative pillars, lanterns, and water below",blocks:[{type:"slab",position:{x:1,y:-1,z:0},color:"#4169E1"},{type:"slab",position:{x:2,y:-1,z:0},color:"#4682B4"},{type:"slab",position:{x:3,y:-1,z:0},color:"#4169E1"},{type:"slab",position:{x:4,y:-1,z:0},color:"#4682B4"},{type:"slab",position:{x:5,y:-1,z:0},color:"#4169E1"},{type:"slab",position:{x:1,y:-1,z:1},color:"#4682B4"},{type:"slab",position:{x:2,y:-1,z:1},color:"#4169E1"},{type:"slab",position:{x:3,y:-1,z:1},color:"#4682B4"},{type:"slab",position:{x:4,y:-1,z:1},color:"#4169E1"},{type:"slab",position:{x:5,y:-1,z:1},color:"#4682B4"},{type:"slab",position:{x:1,y:-1,z:-1},color:"#4682B4"},{type:"slab",position:{x:2,y:-1,z:-1},color:"#4169E1"},{type:"slab",position:{x:3,y:-1,z:-1},color:"#4682B4"},{type:"slab",position:{x:4,y:-1,z:-1},color:"#4169E1"},{type:"slab",position:{x:5,y:-1,z:-1},color:"#4682B4"},{type:"column",position:{x:0,y:-1,z:0},color:"#505050"},{type:"column",position:{x:0,y:0,z:0},color:"#606060"},{type:"column",position:{x:0,y:1,z:0},color:"#696969"},{type:"base",position:{x:0,y:-1,z:0},color:"#404040"},{type:"column",position:{x:8,y:-1,z:0},color:"#505050"},{type:"column",position:{x:8,y:0,z:0},color:"#606060"},{type:"column",position:{x:8,y:1,z:0},color:"#696969"},{type:"base",position:{x:8,y:-1,z:0},color:"#404040"},{type:"column",position:{x:4,y:-1,z:0},color:"#505050"},{type:"buttress",position:{x:4,y:0,z:0},color:"#606060"},{type:"arch",position:{x:2,y:0,z:0},color:"#707070",rotation:{x:0,y:90,z:0}},{type:"arch",position:{x:6,y:0,z:0},color:"#707070",rotation:{x:0,y:90,z:0}},...Et(0,2,0,9,"X","slab","#808080"),...Et(0,2,-1,9,"X","slab","#909090"),...Et(0,2,1,9,"X","slab","#909090"),{type:"slab",position:{x:1,y:2,z:0},color:"#707070"},{type:"slab",position:{x:3,y:2,z:0},color:"#707070"},{type:"slab",position:{x:5,y:2,z:0},color:"#707070"},{type:"slab",position:{x:7,y:2,z:0},color:"#707070"},{type:"baluster",position:{x:0,y:2,z:-2},color:"#909090"},{type:"baluster",position:{x:2,y:2,z:-2},color:"#909090"},{type:"baluster",position:{x:4,y:2,z:-2},color:"#909090"},{type:"baluster",position:{x:6,y:2,z:-2},color:"#909090"},{type:"baluster",position:{x:8,y:2,z:-2},color:"#909090"},{type:"baluster",position:{x:0,y:2,z:2},color:"#909090"},{type:"baluster",position:{x:2,y:2,z:2},color:"#909090"},{type:"baluster",position:{x:4,y:2,z:2},color:"#909090"},{type:"baluster",position:{x:6,y:2,z:2},color:"#909090"},{type:"baluster",position:{x:8,y:2,z:2},color:"#909090"},...Et(0,3,-2,9,"X","railing","#808080"),...Et(0,3,2,9,"X","railing","#808080"),{type:"cube",position:{x:0,y:2,z:-2},color:"#707070"},{type:"cube",position:{x:0,y:2,z:2},color:"#707070"},{type:"cube",position:{x:8,y:2,z:-2},color:"#707070"},{type:"cube",position:{x:8,y:2,z:2},color:"#707070"},{type:"finial",position:{x:0,y:3,z:-2},color:"#606060"},{type:"finial",position:{x:0,y:3,z:2},color:"#606060"},{type:"finial",position:{x:8,y:3,z:-2},color:"#606060"},{type:"finial",position:{x:8,y:3,z:2},color:"#606060"},{type:"pillar4",position:{x:0,y:3,z:0},color:"#2F2F2F"},{type:"sphere",position:{x:0,y:4,z:0},color:"#FFFACD",emissive:{enabled:!0,color:"#FFD700",intensity:2,radius:4}},{type:"pillar4",position:{x:8,y:3,z:0},color:"#2F2F2F"},{type:"sphere",position:{x:8,y:4,z:0},color:"#FFFACD",emissive:{enabled:!0,color:"#FFD700",intensity:2,radius:4}},{type:"pillar4",position:{x:4,y:3,z:0},color:"#2F2F2F"},{type:"sphere",position:{x:4,y:4,z:0},color:"#FFFACD",emissive:{enabled:!0,color:"#FFD700",intensity:2,radius:4}},{type:"wedge",position:{x:-1,y:1,z:0},color:"#505050",rotation:{x:0,y:90,z:0}},{type:"wedge",position:{x:-1,y:1,z:-1},color:"#606060",rotation:{x:0,y:90,z:0}},{type:"wedge",position:{x:-1,y:1,z:1},color:"#606060",rotation:{x:0,y:90,z:0}},{type:"wedge",position:{x:9,y:1,z:0},color:"#505050",rotation:{x:0,y:-90,z:0}},{type:"wedge",position:{x:9,y:1,z:-1},color:"#606060",rotation:{x:0,y:-90,z:0}},{type:"wedge",position:{x:9,y:1,z:1},color:"#606060",rotation:{x:0,y:-90,z:0}},{type:"bush",position:{x:-1,y:0,z:-2},color:"#228B22"},{type:"bush",position:{x:9,y:0,z:2},color:"#2E8B2E"}]},streetCorner:{name:"Street Corner",category:"infrastructure",description:"Urban street corner with lamp",blocks:[...st(0,0,0,4,4,"#D3D3D3"),{type:"slab",position:{x:0,y:0,z:-1},color:"#2F2F2F"},{type:"slab",position:{x:1,y:0,z:-1},color:"#2F2F2F"},{type:"slab",position:{x:2,y:0,z:-1},color:"#2F2F2F"},{type:"slab",position:{x:3,y:0,z:-1},color:"#2F2F2F"},{type:"slab",position:{x:-1,y:0,z:0},color:"#2F2F2F"},{type:"slab",position:{x:-1,y:0,z:1},color:"#2F2F2F"},{type:"slab",position:{x:-1,y:0,z:2},color:"#2F2F2F"},{type:"slab",position:{x:-1,y:0,z:3},color:"#2F2F2F"},{type:"pillar2",position:{x:0,y:0,z:0},color:"#2F2F2F"},{type:"pillar2",position:{x:0,y:1,z:0},color:"#2F2F2F"},{type:"pillar2",position:{x:0,y:2,z:0},color:"#2F2F2F"},{type:"dome",position:{x:0,y:3,z:0},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:2,radius:6}},{type:"bench",position:{x:2,y:0,z:0},color:"#228B22"},{type:"planter",position:{x:3,y:0,z:0},color:"#8B4513"},{type:"bush",position:{x:3,y:1,z:0},color:"#228B22"},{type:"barrier",position:{x:0,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:1,y:0,z:3},color:"#FFD700"}]},plaza:{name:"Plaza",category:"infrastructure",description:"Grand public plaza with tiered fountain, outdoor seating, landscaping, and decorative lighting",blocks:[...st(0,0,0,12,12,"#B8B8B8"),...Et(0,0,0,12,"X","slab","#808080"),...Et(0,0,11,12,"X","slab","#808080"),{type:"slab",position:{x:0,y:0,z:1},color:"#808080"},{type:"slab",position:{x:0,y:0,z:2},color:"#808080"},{type:"slab",position:{x:0,y:0,z:3},color:"#808080"},{type:"slab",position:{x:0,y:0,z:4},color:"#808080"},{type:"slab",position:{x:0,y:0,z:5},color:"#808080"},{type:"slab",position:{x:0,y:0,z:6},color:"#808080"},{type:"slab",position:{x:0,y:0,z:7},color:"#808080"},{type:"slab",position:{x:0,y:0,z:8},color:"#808080"},{type:"slab",position:{x:0,y:0,z:9},color:"#808080"},{type:"slab",position:{x:0,y:0,z:10},color:"#808080"},{type:"slab",position:{x:11,y:0,z:1},color:"#808080"},{type:"slab",position:{x:11,y:0,z:2},color:"#808080"},{type:"slab",position:{x:11,y:0,z:3},color:"#808080"},{type:"slab",position:{x:11,y:0,z:4},color:"#808080"},{type:"slab",position:{x:11,y:0,z:5},color:"#808080"},{type:"slab",position:{x:11,y:0,z:6},color:"#808080"},{type:"slab",position:{x:11,y:0,z:7},color:"#808080"},{type:"slab",position:{x:11,y:0,z:8},color:"#808080"},{type:"slab",position:{x:11,y:0,z:9},color:"#808080"},{type:"slab",position:{x:11,y:0,z:10},color:"#808080"},{type:"slab",position:{x:4,y:0,z:4},color:"#606060"},{type:"slab",position:{x:5,y:0,z:4},color:"#606060"},{type:"slab",position:{x:6,y:0,z:4},color:"#606060"},{type:"slab",position:{x:7,y:0,z:4},color:"#606060"},{type:"slab",position:{x:4,y:0,z:7},color:"#606060"},{type:"slab",position:{x:5,y:0,z:7},color:"#606060"},{type:"slab",position:{x:6,y:0,z:7},color:"#606060"},{type:"slab",position:{x:7,y:0,z:7},color:"#606060"},{type:"slab",position:{x:4,y:0,z:5},color:"#606060"},{type:"slab",position:{x:4,y:0,z:6},color:"#606060"},{type:"slab",position:{x:7,y:0,z:5},color:"#606060"},{type:"slab",position:{x:7,y:0,z:6},color:"#606060"},{type:"quarter",position:{x:5,y:0,z:5},color:"#4169E1"},{type:"quarter",position:{x:6,y:0,z:5},color:"#4682B4"},{type:"quarter",position:{x:5,y:0,z:6},color:"#4682B4"},{type:"quarter",position:{x:6,y:0,z:6},color:"#4169E1"},{type:"cylinder",position:{x:5,y:0,z:5},color:"#A0A0A0"},{type:"cylinder",position:{x:5,y:1,z:5},color:"#909090"},{type:"bowl",position:{x:5,y:2,z:5},color:"#B0B0B0"},{type:"pillar2",position:{x:5,y:2,z:5},color:"#C0C0C0"},{type:"finial",position:{x:5,y:3,z:5},color:"#D4AF37"},{type:"base",position:{x:3,y:0,z:3},color:"#808080"},{type:"column",position:{x:3,y:1,z:3},color:"#D3D3D3"},{type:"capital",position:{x:3,y:2,z:3},color:"#D3D3D3"},{type:"base",position:{x:8,y:0,z:3},color:"#808080"},{type:"column",position:{x:8,y:1,z:3},color:"#D3D3D3"},{type:"capital",position:{x:8,y:2,z:3},color:"#D3D3D3"},{type:"base",position:{x:3,y:0,z:8},color:"#808080"},{type:"column",position:{x:3,y:1,z:8},color:"#D3D3D3"},{type:"capital",position:{x:3,y:2,z:8},color:"#D3D3D3"},{type:"base",position:{x:8,y:0,z:8},color:"#808080"},{type:"column",position:{x:8,y:1,z:8},color:"#D3D3D3"},{type:"capital",position:{x:8,y:2,z:8},color:"#D3D3D3"},{type:"bench",position:{x:3,y:0,z:1},color:"#8B4513",rotation:{x:0,y:180,z:0}},{type:"bench",position:{x:5,y:0,z:1},color:"#8B4513",rotation:{x:0,y:180,z:0}},{type:"bench",position:{x:7,y:0,z:1},color:"#8B4513",rotation:{x:0,y:180,z:0}},{type:"bench",position:{x:3,y:0,z:10},color:"#8B4513"},{type:"bench",position:{x:5,y:0,z:10},color:"#8B4513"},{type:"bench",position:{x:7,y:0,z:10},color:"#8B4513"},{type:"bench",position:{x:10,y:0,z:4},color:"#8B4513",rotation:{x:0,y:270,z:0}},{type:"bench",position:{x:10,y:0,z:6},color:"#8B4513",rotation:{x:0,y:270,z:0}},{type:"bench",position:{x:1,y:0,z:4},color:"#8B4513",rotation:{x:0,y:90,z:0}},{type:"bench",position:{x:1,y:0,z:6},color:"#8B4513",rotation:{x:0,y:90,z:0}},{type:"table",position:{x:9,y:0,z:9},color:"#8B4513"},{type:"chair",position:{x:9,y:0,z:8},color:"#8B4513",rotation:{x:0,y:180,z:0}},{type:"chair",position:{x:9,y:0,z:10},color:"#8B4513"},{type:"chair",position:{x:8,y:0,z:9},color:"#8B4513",rotation:{x:0,y:90,z:0}},{type:"chair",position:{x:10,y:0,z:9},color:"#8B4513",rotation:{x:0,y:270,z:0}},{type:"umbrella",position:{x:9,y:1,z:9},color:"#DC143C"},{type:"planter",position:{x:1,y:0,z:1},color:"#696969"},{type:"planter",position:{x:2,y:0,z:1},color:"#696969"},{type:"planter",position:{x:1,y:0,z:2},color:"#696969"},{type:"logZ",position:{x:1,y:1,z:1},color:"#654321"},{type:"logZ",position:{x:1,y:2,z:1},color:"#654321"},{type:"bush",position:{x:1,y:3,z:1},color:"#228B22"},{type:"bush",position:{x:0,y:3,z:1},color:"#2E8B57"},{type:"bush",position:{x:1,y:3,z:0},color:"#2E8B57"},{type:"bush",position:{x:1,y:4,z:1},color:"#228B22"},{type:"planter",position:{x:9,y:0,z:1},color:"#696969"},{type:"planter",position:{x:10,y:0,z:1},color:"#696969"},{type:"planter",position:{x:10,y:0,z:2},color:"#696969"},{type:"logZ",position:{x:10,y:1,z:1},color:"#654321"},{type:"logZ",position:{x:10,y:2,z:1},color:"#654321"},{type:"bush",position:{x:10,y:3,z:1},color:"#228B22"},{type:"bush",position:{x:10,y:3,z:0},color:"#32CD32"},{type:"bush",position:{x:10,y:4,z:1},color:"#228B22"},{type:"planter",position:{x:2,y:0,z:5},color:"#696969"},{type:"flower",position:{x:2,y:1,z:5},color:"#FF6B6B"},{type:"planter",position:{x:2,y:0,z:6},color:"#696969"},{type:"flower",position:{x:2,y:1,z:6},color:"#FFD700"},{type:"planter",position:{x:9,y:0,z:5},color:"#696969"},{type:"flower",position:{x:9,y:1,z:5},color:"#DA70D6"},{type:"planter",position:{x:9,y:0,z:6},color:"#696969"},{type:"flower",position:{x:9,y:1,z:6},color:"#FF69B4"},{type:"pillar",position:{x:2,y:0,z:2},color:"#2F4F4F"},{type:"pillar",position:{x:2,y:1,z:2},color:"#2F4F4F"},{type:"pillar",position:{x:2,y:2,z:2},color:"#2F4F4F"},{type:"lightFixture",position:{x:2,y:3,z:2},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1.2,radius:4}},{type:"pillar",position:{x:9,y:0,z:2},color:"#2F4F4F"},{type:"pillar",position:{x:9,y:1,z:2},color:"#2F4F4F"},{type:"pillar",position:{x:9,y:2,z:2},color:"#2F4F4F"},{type:"lightFixture",position:{x:9,y:3,z:2},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1.2,radius:4}},{type:"pillar",position:{x:2,y:0,z:9},color:"#2F4F4F"},{type:"pillar",position:{x:2,y:1,z:9},color:"#2F4F4F"},{type:"pillar",position:{x:2,y:2,z:9},color:"#2F4F4F"},{type:"lightFixture",position:{x:2,y:3,z:9},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1.2,radius:4}},{type:"bin",position:{x:4,y:0,z:2},color:"#2F4F4F"},{type:"bin",position:{x:7,y:0,z:9},color:"#2F4F4F"},{type:"pediment",position:{x:1,y:0,z:9},color:"#808080"},{type:"pillar2",position:{x:1,y:1,z:9},color:"#A0A0A0"},{type:"sphere",position:{x:1,y:2,z:9},color:"#B87333"},{type:"grate",position:{x:3,y:0,z:5},color:"#404040"},{type:"grate",position:{x:8,y:0,z:6},color:"#404040"}]},stairway:{name:"Grand Stairway",category:"infrastructure",description:"Elegant staircase with balusters",blocks:[{type:"stairs",position:{x:1,y:0,z:0},color:"#D3D3D3"},{type:"stairs",position:{x:1,y:1,z:1},color:"#D3D3D3"},{type:"stairs",position:{x:1,y:2,z:2},color:"#D3D3D3"},{type:"stairs",position:{x:1,y:3,z:3},color:"#D3D3D3"},{type:"baluster",position:{x:0,y:0,z:0},color:"#F5F5DC"},{type:"baluster",position:{x:0,y:1,z:1},color:"#F5F5DC"},{type:"baluster",position:{x:0,y:2,z:2},color:"#F5F5DC"},{type:"baluster",position:{x:0,y:3,z:3},color:"#F5F5DC"},{type:"baluster",position:{x:2,y:0,z:0},color:"#F5F5DC"},{type:"baluster",position:{x:2,y:1,z:1},color:"#F5F5DC"},{type:"baluster",position:{x:2,y:2,z:2},color:"#F5F5DC"},{type:"baluster",position:{x:2,y:3,z:3},color:"#F5F5DC"},{type:"railing",position:{x:0,y:1,z:0},color:"#DAA520"},{type:"railing",position:{x:0,y:2,z:1},color:"#DAA520"},{type:"railing",position:{x:0,y:3,z:2},color:"#DAA520"},{type:"railing",position:{x:0,y:4,z:3},color:"#DAA520"},{type:"railing",position:{x:2,y:1,z:0},color:"#DAA520"},{type:"railing",position:{x:2,y:2,z:1},color:"#DAA520"},{type:"railing",position:{x:2,y:3,z:2},color:"#DAA520"},{type:"railing",position:{x:2,y:4,z:3},color:"#DAA520"},{type:"capital",position:{x:0,y:1,z:0},color:"#F5F5DC"},{type:"capital",position:{x:2,y:1,z:0},color:"#F5F5DC"},{type:"slab",position:{x:0,y:4,z:4},color:"#D3D3D3"},{type:"slab",position:{x:1,y:4,z:4},color:"#D3D3D3"},{type:"slab",position:{x:2,y:4,z:4},color:"#D3D3D3"}]},cityBlock:{name:"City Block",category:"city",description:"Detailed urban block with shops, apartments, offices, street furniture, and traffic elements",blocks:[...st(-2,0,-2,16,2,"#2F2F2F"),...st(-2,0,12,16,2,"#2F2F2F"),...st(-2,0,0,2,12,"#2F2F2F"),...st(12,0,0,2,12,"#2F2F2F"),{type:"slab",position:{x:3,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:5,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:7,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:9,y:0,z:-1},color:"#FFFFFF"},...st(0,0,0,12,12,"#B0B0B0"),{type:"slab",position:{x:0,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:1,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:-1},color:"#FFFFFF"},{type:"slab",position:{x:11,y:0,z:-1},color:"#FFFFFF"},...st(0,0,0,4,5,"#404040"),...Ae(0,1,0,4,5,"#303030","#4169E1"),...Ae(0,2,0,4,5,"#303030","#4682B4"),...Ae(0,3,0,4,5,"#303030","#4169E1"),...Ae(0,4,0,4,5,"#303030","#4682B4"),...Ae(0,5,0,4,5,"#303030","#4169E1"),...Ae(0,6,0,4,5,"#303030","#4682B4"),...st(0,7,0,4,5,"#353535"),{type:"acUnit",position:{x:1,y:7,z:1},color:"#C0C0C0"},{type:"acUnit",position:{x:2,y:7,z:2},color:"#C0C0C0"},{type:"antenna",position:{x:1,y:7,z:3},color:"#808080"},{type:"doorFrame",position:{x:1,y:1,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:2,y:1,z:0},color:"#4682B4"},{type:"awning",position:{x:1,y:2,z:-1},color:"#2F2F2F"},{type:"awning",position:{x:2,y:2,z:-1},color:"#2F2F2F"},...st(5,0,0,4,4,"#696969"),...ae(5,1,0,4,4,"#DEB887"),...ae(5,2,0,4,4,"#F5DEB3"),...st(5,3,0,4,4,"#8B4513"),{type:"doorFrame",position:{x:6,y:1,z:0},color:"#654321"},{type:"awning",position:{x:5,y:2,z:-1},color:"#DC143C"},{type:"awning",position:{x:6,y:2,z:-1},color:"#DC143C"},{type:"awning",position:{x:7,y:2,z:-1},color:"#DC143C"},{type:"windowFrame",position:{x:5,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:1,z:0},color:"#4682B4"},{type:"sign",position:{x:6,y:2,z:0},color:"#FFD700"},{type:"table",position:{x:5,y:0,z:-1},color:"#8B4513"},{type:"chair",position:{x:5,y:0,z:-2},color:"#8B4513"},...st(9,0,0,3,5,"#505050"),...ae(9,1,0,3,5,"#CD853F"),...ae(9,2,0,3,5,"#CD853F"),...ae(9,3,0,3,5,"#D2B48C"),...ae(9,4,0,3,5,"#D2B48C"),...ae(9,5,0,3,5,"#CD853F"),...st(9,6,0,3,5,"#8B0000"),{type:"windowFrame",position:{x:10,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:10,y:2,z:0},color:"#87CEEB"},{type:"windowFrame",position:{x:10,y:3,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:10,y:4,z:0},color:"#87CEEB"},{type:"windowFrame",position:{x:10,y:5,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:9,y:1,z:0},color:"#654321"},{type:"step",position:{x:9,y:0,z:-1},color:"#808080"},{type:"slab",position:{x:10,y:3,z:-1},color:"#808080"},{type:"railing",position:{x:10,y:4,z:-1},color:"#404040"},{type:"slab",position:{x:10,y:5,z:-1},color:"#808080"},{type:"railing",position:{x:10,y:6,z:-1},color:"#404040"},...st(0,0,7,7,5,"#606060"),...ne(0,1,7,7,3,"#808080"),...ne(0,1,11,7,3,"#808080"),...Wt(0,1,8,3,3,"#808080"),...Wt(6,1,8,3,3,"#808080"),...st(0,4,7,7,5,"#505050"),{type:"doorFrame",position:{x:2,y:1,z:7},color:"#4A4A4A"},{type:"doorFrame",position:{x:3,y:1,z:7},color:"#4A4A4A"},{type:"doorFrame",position:{x:2,y:2,z:7},color:"#4A4A4A"},{type:"doorFrame",position:{x:3,y:2,z:7},color:"#4A4A4A"},{type:"barrel",position:{x:5,y:1,z:9},color:"#2F4F4F"},{type:"barrel",position:{x:5,y:1,z:10},color:"#006400"},...st(8,0,6,4,6,"#3A3A3A"),{type:"slab",position:{x:8,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:8,y:0,z:9},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:9},color:"#FFFFFF"},{type:"barrier",position:{x:8,y:0,z:6},color:"#FFD700"},{type:"barrier",position:{x:11,y:0,z:6},color:"#FFD700"},{type:"pillar",position:{x:-1,y:0,z:3},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:1,z:3},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:2,z:3},color:"#2F2F2F"},{type:"lightFixture",position:{x:-1,y:3,z:3},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:1.5,radius:5}},{type:"pillar",position:{x:-1,y:0,z:8},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:1,z:8},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:2,z:8},color:"#2F2F2F"},{type:"lightFixture",position:{x:-1,y:3,z:8},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:1.5,radius:5}},{type:"pillar",position:{x:12,y:0,z:5},color:"#2F2F2F"},{type:"pillar",position:{x:12,y:1,z:5},color:"#2F2F2F"},{type:"pillar",position:{x:12,y:2,z:5},color:"#2F2F2F"},{type:"lightFixture",position:{x:12,y:3,z:5},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:1.5,radius:5}},{type:"bollard",position:{x:4,y:0,z:-1},color:"#FF0000"},{type:"bin",position:{x:0,y:0,z:-1},color:"#2F4F4F"},{type:"bin",position:{x:8,y:0,z:-1},color:"#2F4F4F"},{type:"bench",position:{x:4,y:0,z:5},color:"#8B4513"},{type:"pillar",position:{x:-1,y:0,z:-1},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:1,z:-1},color:"#2F2F2F"},{type:"pillar",position:{x:-1,y:2,z:-1},color:"#2F2F2F"},{type:"bulb",position:{x:-1,y:3,z:-1},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:1,radius:2}},{type:"pillar",position:{x:12,y:0,z:10},color:"#4169E1"},{type:"pillar",position:{x:12,y:1,z:10},color:"#4169E1"},{type:"sign",position:{x:12,y:2,z:10},color:"#FFD700"},{type:"bench",position:{x:11,y:0,z:10},color:"#808080",rotation:{x:0,y:90,z:0}},{type:"planter",position:{x:4,y:0,z:4},color:"#505050"},{type:"logZ",position:{x:4,y:1,z:4},color:"#654321"},{type:"bush",position:{x:4,y:2,z:4},color:"#228B22"},{type:"bush",position:{x:4,y:3,z:4},color:"#2E8B57"},{type:"planter",position:{x:7,y:0,z:5},color:"#505050"},{type:"logZ",position:{x:7,y:1,z:5},color:"#654321"},{type:"bush",position:{x:7,y:2,z:5},color:"#228B22"},{type:"bush",position:{x:7,y:3,z:5},color:"#32CD32"}]},skyscraper:{name:"Skyscraper",category:"city",description:"Modern glass tower with helipad, observation deck, and detailed infrastructure",blocks:[...st(-1,0,-1,8,8,"#2F2F2F"),{type:"planter",position:{x:-1,y:0,z:2},color:"#505050"},{type:"bush",position:{x:-1,y:1,z:2},color:"#228B22"},{type:"planter",position:{x:-1,y:0,z:4},color:"#505050"},{type:"bush",position:{x:-1,y:1,z:4},color:"#228B22"},{type:"bench",position:{x:6,y:0,z:2},color:"#808080"},...Ae(0,1,0,6,6,"#303030","#4169E1"),...Ae(0,2,0,6,6,"#303030","#4682B4"),...Ae(0,3,0,6,6,"#303030","#4169E1"),...Ae(0,4,0,6,6,"#303030","#4682B4"),...Ae(0,5,0,6,6,"#303030","#4169E1"),...ae(0,6,0,6,6,"#252525"),...Ae(0,7,0,6,6,"#303030","#4682B4"),...Ae(0,8,0,6,6,"#303030","#4169E1"),...Ae(0,9,0,6,6,"#303030","#4682B4"),...Ae(0,10,0,6,6,"#303030","#4169E1"),...Ae(1,11,1,4,4,"#404040","#4169E1"),...Ae(1,12,1,4,4,"#404040","#4682B4"),...st(1,13,1,4,4,"#252525"),{type:"railing",position:{x:1,y:13,z:0},color:"#C0C0C0"},{type:"railing",position:{x:2,y:13,z:0},color:"#C0C0C0"},{type:"railing",position:{x:3,y:13,z:0},color:"#C0C0C0"},{type:"railing",position:{x:4,y:13,z:0},color:"#C0C0C0"},{type:"railing",position:{x:0,y:13,z:1},color:"#C0C0C0"},{type:"railing",position:{x:0,y:13,z:2},color:"#C0C0C0"},{type:"railing",position:{x:0,y:13,z:3},color:"#C0C0C0"},{type:"railing",position:{x:0,y:13,z:4},color:"#C0C0C0"},...st(1,14,1,4,4,"#404040"),{type:"slab",position:{x:2,y:14,z:2},color:"#FFFF00"},{type:"slab",position:{x:3,y:14,z:2},color:"#FFFF00"},{type:"slab",position:{x:2,y:14,z:3},color:"#FFFF00"},{type:"slab",position:{x:3,y:14,z:3},color:"#FFFF00"},{type:"sphere",position:{x:1,y:14,z:1},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:2}},{type:"sphere",position:{x:4,y:14,z:1},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:2}},{type:"sphere",position:{x:1,y:14,z:4},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:2}},{type:"sphere",position:{x:4,y:14,z:4},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:2}},{type:"pillar2",position:{x:2,y:15,z:2},color:"#C0C0C0"},{type:"pillar2",position:{x:2,y:16,z:2},color:"#C0C0C0"},{type:"pillar4",position:{x:2,y:17,z:2},color:"#C0C0C0"},{type:"pillar4",position:{x:2,y:18,z:2},color:"#C0C0C0"},{type:"antenna",position:{x:2,y:19,z:2},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:3,radius:5}},{type:"acUnit",position:{x:5,y:11,z:1},color:"#808080"},{type:"acUnit",position:{x:5,y:11,z:3},color:"#808080"},{type:"acUnit",position:{x:5,y:11,z:5},color:"#808080"},{type:"vent",position:{x:0,y:11,z:2},color:"#606060"},{type:"vent",position:{x:0,y:11,z:4},color:"#606060"},{type:"dome",position:{x:0,y:11,z:0},color:"#E0E0E0"},{type:"doorFrame",position:{x:2,y:1,z:0},color:"#B8860B"},{type:"doorFrame",position:{x:3,y:1,z:0},color:"#B8860B"},{type:"slab",position:{x:1,y:2,z:-1},color:"#303030"},{type:"slab",position:{x:2,y:2,z:-1},color:"#303030"},{type:"slab",position:{x:3,y:2,z:-1},color:"#303030"},{type:"slab",position:{x:4,y:2,z:-1},color:"#303030"},{type:"column",position:{x:1,y:1,z:0},color:"#D4AF37"},{type:"column",position:{x:4,y:1,z:0},color:"#D4AF37"},{type:"capital",position:{x:1,y:2,z:0},color:"#D4AF37"},{type:"capital",position:{x:4,y:2,z:0},color:"#D4AF37"},{type:"spotlight",position:{x:0,y:0,z:-1},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:2,radius:3}},{type:"spotlight",position:{x:5,y:0,z:-1},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:2,radius:3}},{type:"beam4X",position:{x:0,y:10,z:-1},color:"#404040"},{type:"beam4X",position:{x:2,y:10,z:-1},color:"#404040"},{type:"beam4X",position:{x:4,y:10,z:-1},color:"#404040"}]},apartmentBuilding:{name:"Apartment Building",category:"city",description:"Residential apartment with balconies, fire escape, rooftop amenities, and urban details",blocks:[...st(-1,0,-2,10,8,"#707070"),...st(0,0,0,8,5,"#505050"),...ae(0,1,0,8,5,"#8B4513"),...ae(0,2,0,8,5,"#DEB887"),...ae(0,3,0,8,5,"#DEB887"),...ae(0,4,0,8,5,"#DEB887"),...ae(0,5,0,8,5,"#E8D8B8"),...ae(0,6,0,8,5,"#E8D8B8"),...ae(0,7,0,8,5,"#E8D8B8"),...st(0,8,0,8,5,"#404040"),...Et(0,8,0,8,"X","ledge","#505050"),...Et(0,8,4,8,"X","ledge","#505050"),{type:"ledge",position:{x:0,y:8,z:1},color:"#505050",rotation:{x:0,y:90,z:0}},{type:"ledge",position:{x:0,y:8,z:2},color:"#505050",rotation:{x:0,y:90,z:0}},{type:"ledge",position:{x:0,y:8,z:3},color:"#505050",rotation:{x:0,y:90,z:0}},{type:"ledge",position:{x:7,y:8,z:1},color:"#505050",rotation:{x:0,y:270,z:0}},{type:"ledge",position:{x:7,y:8,z:2},color:"#505050",rotation:{x:0,y:270,z:0}},{type:"ledge",position:{x:7,y:8,z:3},color:"#505050",rotation:{x:0,y:270,z:0}},{type:"tank",position:{x:1,y:8,z:2},color:"#2F4F4F"},{type:"tank",position:{x:1,y:9,z:2},color:"#2F4F4F"},{type:"acUnit",position:{x:5,y:8,z:1},color:"#C0C0C0"},{type:"acUnit",position:{x:6,y:8,z:1},color:"#C0C0C0"},{type:"acUnit",position:{x:5,y:8,z:3},color:"#C0C0C0"},{type:"antenna",position:{x:3,y:8,z:2},color:"#808080"},{type:"cube",position:{x:4,y:8,z:2},color:"#606060"},{type:"slab",position:{x:4,y:9,z:2},color:"#505050"},{type:"doorFrame",position:{x:4,y:8,z:1},color:"#404040"},{type:"slab",position:{x:1,y:2,z:-1},color:"#808080"},{type:"slab",position:{x:2,y:2,z:-1},color:"#808080"},{type:"railing",position:{x:1,y:3,z:-1},color:"#303030"},{type:"railing",position:{x:2,y:3,z:-1},color:"#303030"},{type:"planter",position:{x:1,y:2,z:-1},color:"#8B4513"},{type:"flower",position:{x:1,y:3,z:-1},color:"#FF6B6B"},{type:"slab",position:{x:5,y:2,z:-1},color:"#808080"},{type:"slab",position:{x:6,y:2,z:-1},color:"#808080"},{type:"railing",position:{x:5,y:3,z:-1},color:"#303030"},{type:"railing",position:{x:6,y:3,z:-1},color:"#303030"},{type:"chair",position:{x:6,y:2,z:-1},color:"#8B4513"},{type:"slab",position:{x:1,y:4,z:-1},color:"#808080"},{type:"slab",position:{x:2,y:4,z:-1},color:"#808080"},{type:"railing",position:{x:1,y:5,z:-1},color:"#303030"},{type:"railing",position:{x:2,y:5,z:-1},color:"#303030"},{type:"slab",position:{x:5,y:4,z:-1},color:"#808080"},{type:"slab",position:{x:6,y:4,z:-1},color:"#808080"},{type:"railing",position:{x:5,y:5,z:-1},color:"#303030"},{type:"railing",position:{x:6,y:5,z:-1},color:"#303030"},{type:"planter",position:{x:5,y:4,z:-1},color:"#8B4513"},{type:"bush",position:{x:5,y:5,z:-1},color:"#228B22"},{type:"slab",position:{x:1,y:6,z:-1},color:"#808080"},{type:"slab",position:{x:2,y:6,z:-1},color:"#808080"},{type:"railing",position:{x:1,y:7,z:-1},color:"#303030"},{type:"railing",position:{x:2,y:7,z:-1},color:"#303030"},{type:"slab",position:{x:5,y:6,z:-1},color:"#808080"},{type:"slab",position:{x:6,y:6,z:-1},color:"#808080"},{type:"railing",position:{x:5,y:7,z:-1},color:"#303030"},{type:"railing",position:{x:6,y:7,z:-1},color:"#303030"},{type:"planter",position:{x:6,y:6,z:-1},color:"#8B4513"},{type:"flower",position:{x:6,y:7,z:-1},color:"#FFD700"},{type:"grateFloor",position:{x:8,y:2,z:1},color:"#303030"},{type:"grateFloor",position:{x:8,y:2,z:2},color:"#303030"},{type:"railing",position:{x:8,y:3,z:1},color:"#404040"},{type:"stairs",position:{x:8,y:3,z:2},color:"#303030",rotation:{x:0,y:90,z:0}},{type:"grateFloor",position:{x:8,y:4,z:1},color:"#303030"},{type:"grateFloor",position:{x:8,y:4,z:2},color:"#303030"},{type:"railing",position:{x:8,y:5,z:1},color:"#404040"},{type:"stairs",position:{x:8,y:5,z:2},color:"#303030",rotation:{x:0,y:270,z:0}},{type:"grateFloor",position:{x:8,y:6,z:1},color:"#303030"},{type:"grateFloor",position:{x:8,y:6,z:2},color:"#303030"},{type:"railing",position:{x:8,y:7,z:1},color:"#404040"},{type:"ladder",position:{x:8,y:0,z:1},color:"#404040"},{type:"ladder",position:{x:8,y:1,z:1},color:"#404040"},{type:"windowFrame",position:{x:1,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:2,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:5,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:6,y:1,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:1,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:5,y:2,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:1,y:4,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:4,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:5,y:4,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:1,y:6,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:6,z:0},color:"#4682B4"},{type:"windowFrame",position:{x:5,y:6,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:3,y:1,z:0},color:"#654321"},{type:"doorFrame",position:{x:4,y:1,z:0},color:"#654321"},{type:"awning",position:{x:3,y:2,z:-1},color:"#8B0000"},{type:"awning",position:{x:4,y:2,z:-1},color:"#8B0000"},{type:"step",position:{x:3,y:0,z:-1},color:"#606060"},{type:"step",position:{x:4,y:0,z:-1},color:"#606060"},{type:"locker",position:{x:0,y:1,z:-1},color:"#C0C0C0"},{type:"pillar",position:{x:-1,y:0,z:-1},color:"#404040"},{type:"pillar",position:{x:-1,y:1,z:-1},color:"#404040"},{type:"pillar",position:{x:-1,y:2,z:-1},color:"#404040"},{type:"lightFixture",position:{x:-1,y:3,z:-1},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1.2,radius:4}},{type:"bin",position:{x:7,y:0,z:-1},color:"#2F4F4F"},{type:"bollard",position:{x:8,y:0,z:-1},color:"#FF0000"},{type:"railing",position:{x:6,y:0,z:-1},color:"#808080"},{type:"powerBox",position:{x:0,y:1,z:1},color:"#808080"},{type:"cableY",position:{x:7,y:3,z:4},color:"#FFFFFF"},{type:"cableY",position:{x:7,y:4,z:4},color:"#FFFFFF"},{type:"cableY",position:{x:7,y:5,z:4},color:"#FFFFFF"},{type:"cableY",position:{x:7,y:6,z:4},color:"#FFFFFF"},{type:"cableY",position:{x:7,y:7,z:4},color:"#FFFFFF"},{type:"cornice",position:{x:0,y:2,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:1,y:2,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:2,y:2,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:5,y:2,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:6,y:2,z:0},color:"#D3D3D3"},{type:"cornice",position:{x:7,y:2,z:0},color:"#D3D3D3"}]},shoppingMall:{name:"Shopping Mall",category:"city",description:"Two-story shopping center with stores, food court, escalators, and glass atrium",blocks:[...st(0,0,0,18,14,"#D8D8D8"),...st(7,0,0,4,14,"#E8E8E8"),...ne(0,1,0,18,6,"#E0E0E0"),...ne(0,1,13,18,6,"#E0E0E0"),...Wt(0,1,1,12,6,"#E0E0E0"),...Wt(17,1,1,12,6,"#E0E0E0"),{type:"doorFrame",position:{x:7,y:1,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:8,y:1,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:9,y:1,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:10,y:1,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:7,y:2,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:8,y:2,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:9,y:2,z:0},color:"#4682B4"},{type:"doorFrame",position:{x:10,y:2,z:0},color:"#4682B4"},{type:"awning",position:{x:7,y:3,z:-1},color:"#E0E0E0"},{type:"awning",position:{x:8,y:3,z:-1},color:"#E0E0E0"},{type:"awning",position:{x:9,y:3,z:-1},color:"#E0E0E0"},{type:"awning",position:{x:10,y:3,z:-1},color:"#E0E0E0"},...Wt(1,1,1,3,3,"#F5F5DC"),...Wt(5,1,1,3,3,"#F5F5DC"),{type:"windowFrame",position:{x:2,y:1,z:1},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:1,z:1},color:"#4682B4"},{type:"windowFrame",position:{x:4,y:1,z:1},color:"#4682B4"},{type:"sign",position:{x:3,y:3,z:1},color:"#FF69B4"},{type:"shelf",position:{x:2,y:1,z:2},color:"#D2B48C"},{type:"shelf",position:{x:3,y:1,z:2},color:"#D2B48C"},{type:"shelf",position:{x:4,y:1,z:2},color:"#D2B48C"},...Wt(1,1,4,3,3,"#1E1E1E"),...Wt(5,1,4,3,3,"#1E1E1E"),{type:"windowFrame",position:{x:2,y:1,z:4},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:1,z:4},color:"#4682B4"},{type:"windowFrame",position:{x:4,y:1,z:4},color:"#4682B4"},{type:"sign",position:{x:3,y:3,z:4},color:"#00BFFF"},{type:"monitor",position:{x:2,y:1,z:5},color:"#1E1E1E"},{type:"monitor",position:{x:4,y:1,z:5},color:"#1E1E1E"},{type:"table",position:{x:3,y:1,z:6},color:"#2F2F2F"},...Wt(12,1,1,3,3,"#8B4513"),...Wt(16,1,1,3,3,"#8B4513"),{type:"windowFrame",position:{x:13,y:1,z:1},color:"#4682B4"},{type:"windowFrame",position:{x:14,y:1,z:1},color:"#4682B4"},{type:"windowFrame",position:{x:15,y:1,z:1},color:"#4682B4"},{type:"sign",position:{x:14,y:3,z:1},color:"#228B22"},{type:"shelfUnit",position:{x:13,y:1,z:2},color:"#8B4513"},{type:"shelfUnit",position:{x:14,y:1,z:2},color:"#8B4513"},{type:"shelfUnit",position:{x:15,y:1,z:2},color:"#8B4513"},...Wt(12,1,4,3,3,"#FF4500"),...Wt(16,1,4,3,3,"#FF4500"),{type:"windowFrame",position:{x:13,y:1,z:4},color:"#4682B4"},{type:"windowFrame",position:{x:14,y:1,z:4},color:"#4682B4"},{type:"windowFrame",position:{x:15,y:1,z:4},color:"#4682B4"},{type:"sign",position:{x:14,y:3,z:4},color:"#FF4500"},{type:"shelf",position:{x:13,y:1,z:5},color:"#E0E0E0"},{type:"shelf",position:{x:15,y:1,z:5},color:"#E0E0E0"},{type:"cylinder",position:{x:8,y:0,z:3},color:"#708090"},{type:"cylinder",position:{x:9,y:0,z:3},color:"#708090"},{type:"cylinder",position:{x:8,y:0,z:4},color:"#708090"},{type:"cylinder",position:{x:9,y:0,z:4},color:"#708090"},{type:"slab",position:{x:8,y:0,z:3},color:"#87CEEB"},{type:"slab",position:{x:9,y:0,z:3},color:"#87CEEB"},{type:"slab",position:{x:8,y:0,z:4},color:"#87CEEB"},{type:"slab",position:{x:9,y:0,z:4},color:"#87CEEB"},{type:"pillar",position:{x:8,y:1,z:3},color:"#708090"},{type:"dome",position:{x:8,y:2,z:3},color:"#87CEEB"},{type:"stairs",position:{x:7,y:1,z:6},color:"#808080"},{type:"stairs",position:{x:7,y:2,z:7},color:"#808080"},{type:"stairs",position:{x:7,y:3,z:8},color:"#808080"},{type:"railing",position:{x:6,y:1,z:6},color:"#C0C0C0"},{type:"railing",position:{x:6,y:2,z:7},color:"#C0C0C0"},{type:"railing",position:{x:6,y:3,z:8},color:"#C0C0C0"},{type:"stairs",position:{x:10,y:1,z:8},color:"#808080",rotation:{x:0,y:180,z:0}},{type:"stairs",position:{x:10,y:2,z:7},color:"#808080",rotation:{x:0,y:180,z:0}},{type:"stairs",position:{x:10,y:3,z:6},color:"#808080",rotation:{x:0,y:180,z:0}},{type:"railing",position:{x:11,y:1,z:8},color:"#C0C0C0"},{type:"railing",position:{x:11,y:2,z:7},color:"#C0C0C0"},{type:"railing",position:{x:11,y:3,z:6},color:"#C0C0C0"},...st(0,4,0,6,6,"#D8D8D8"),...st(12,4,0,6,6,"#D8D8D8"),...st(0,4,8,18,6,"#D8D8D8"),...Et(6,4,0,6,"Z","railing","#C0C0C0"),...Et(11,4,0,6,"Z","railing","#C0C0C0"),...Et(0,4,8,6,"X","railing","#C0C0C0"),...Et(12,4,8,6,"X","railing","#C0C0C0"),...st(0,0,8,18,5,"#C0A080"),{type:"table",position:{x:2,y:1,z:10},color:"#FFFFFF"},{type:"chair",position:{x:1,y:1,z:10},color:"#FF6347"},{type:"chair",position:{x:3,y:1,z:10},color:"#FF6347"},{type:"table",position:{x:5,y:1,z:10},color:"#FFFFFF"},{type:"chair",position:{x:4,y:1,z:10},color:"#4169E1"},{type:"chair",position:{x:6,y:1,z:10},color:"#4169E1"},{type:"table",position:{x:12,y:1,z:10},color:"#FFFFFF"},{type:"chair",position:{x:11,y:1,z:10},color:"#32CD32"},{type:"chair",position:{x:13,y:1,z:10},color:"#32CD32"},{type:"table",position:{x:15,y:1,z:10},color:"#FFFFFF"},{type:"chair",position:{x:14,y:1,z:10},color:"#FFD700"},{type:"chair",position:{x:16,y:1,z:10},color:"#FFD700"},...Et(1,1,12,6,"X","slab","#808080"),...Et(11,1,12,6,"X","slab","#808080"),{type:"sign",position:{x:2,y:2,z:13},color:"#FF0000"},{type:"sign",position:{x:5,y:2,z:13},color:"#FFD700"},{type:"sign",position:{x:12,y:2,z:13},color:"#228B22"},{type:"sign",position:{x:15,y:2,z:13},color:"#FF69B4"},{type:"pillar",position:{x:8,y:1,z:1},color:"#404040"},{type:"monitor",position:{x:8,y:2,z:1},color:"#1E1E1E",emissive:{enabled:!0,color:"#4169E1",intensity:.5,radius:2}},{type:"column",position:{x:4,y:1,z:3},color:"#C0C0C0"},{type:"column",position:{x:4,y:2,z:3},color:"#C0C0C0"},{type:"column",position:{x:4,y:3,z:3},color:"#C0C0C0"},{type:"column",position:{x:13,y:1,z:3},color:"#C0C0C0"},{type:"column",position:{x:13,y:2,z:3},color:"#C0C0C0"},{type:"column",position:{x:13,y:3,z:3},color:"#C0C0C0"},{type:"column",position:{x:4,y:1,z:10},color:"#C0C0C0"},{type:"column",position:{x:4,y:2,z:10},color:"#C0C0C0"},{type:"column",position:{x:4,y:3,z:10},color:"#C0C0C0"},{type:"column",position:{x:13,y:1,z:10},color:"#C0C0C0"},{type:"column",position:{x:13,y:2,z:10},color:"#C0C0C0"},{type:"column",position:{x:13,y:3,z:10},color:"#C0C0C0"},...st(6,7,1,6,12,"#87CEEB"),...Et(6,7,0,6,"X","iBeam","#404040"),...Et(6,7,13,6,"X","iBeam","#404040"),...Et(6,7,0,14,"Z","iBeam","#404040"),...Et(11,7,0,14,"Z","iBeam","#404040"),...st(0,7,0,6,14,"#A0A0A0"),...st(12,7,0,6,14,"#A0A0A0"),{type:"planter",position:{x:3,y:0,z:3},color:"#8B4513"},{type:"bush",position:{x:3,y:1,z:3},color:"#228B22"},{type:"planter",position:{x:14,y:0,z:3},color:"#8B4513"},{type:"bush",position:{x:14,y:1,z:3},color:"#228B22"},{type:"bench",position:{x:5,y:0,z:5},color:"#A0522D"},{type:"bench",position:{x:12,y:0,z:5},color:"#A0522D"},{type:"bin",position:{x:6,y:0,z:1},color:"#2F2F2F"},{type:"bin",position:{x:11,y:0,z:1},color:"#2F2F2F"},{type:"bin",position:{x:8,y:0,z:9},color:"#2F2F2F"},{type:"pillar4",position:{x:4,y:4,z:3},color:"#C0C0C0"},{type:"pillar4",position:{x:4,y:5,z:3},color:"#C0C0C0"},{type:"lightFixture",position:{x:4,y:6,z:3},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}},{type:"pillar4",position:{x:13,y:4,z:3},color:"#C0C0C0"},{type:"pillar4",position:{x:13,y:5,z:3},color:"#C0C0C0"},{type:"lightFixture",position:{x:13,y:6,z:3},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}},{type:"pillar4",position:{x:4,y:4,z:10},color:"#C0C0C0"},{type:"pillar4",position:{x:4,y:5,z:10},color:"#C0C0C0"},{type:"lightFixture",position:{x:4,y:6,z:10},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}},{type:"pillar4",position:{x:13,y:4,z:10},color:"#C0C0C0"},{type:"pillar4",position:{x:13,y:5,z:10},color:"#C0C0C0"},{type:"lightFixture",position:{x:13,y:6,z:10},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}}]},trainStation:{name:"Train Station",category:"city",description:"Grand railway station with platforms, canopy, clock tower, ticket hall, and period details",blocks:[...st(0,-1,3,18,4,"#4A4A4A"),...Et(0,0,3,18,"X","beamX","#505050"),...Et(0,0,4,18,"X","beamX","#505050"),...Et(0,0,5,18,"X","beamX","#505050"),...Et(0,0,6,18,"X","beamX","#505050"),{type:"beam2Z",position:{x:1,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:3,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:5,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:7,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:9,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:11,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:13,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:15,y:0,z:3},color:"#654321"},{type:"beam2Z",position:{x:1,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:3,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:5,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:7,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:9,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:11,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:13,y:0,z:5},color:"#654321"},{type:"beam2Z",position:{x:15,y:0,z:5},color:"#654321"},...st(0,0,0,18,3,"#A0A0A0"),...Et(0,0,2,18,"X","ledge","#FFD700"),{type:"grate",position:{x:8,y:0,z:1},color:"#606060"},{type:"grate",position:{x:9,y:0,z:1},color:"#606060"},...st(0,0,7,18,3,"#A0A0A0"),...Et(0,0,7,18,"X","ledge","#FFD700"),{type:"column",position:{x:2,y:0,z:1},color:"#2F4F4F"},{type:"column",position:{x:2,y:1,z:1},color:"#2F4F4F"},{type:"column",position:{x:2,y:2,z:1},color:"#2F4F4F"},{type:"capital",position:{x:2,y:3,z:1},color:"#3A5A5A"},{type:"column",position:{x:7,y:0,z:1},color:"#2F4F4F"},{type:"column",position:{x:7,y:1,z:1},color:"#2F4F4F"},{type:"column",position:{x:7,y:2,z:1},color:"#2F4F4F"},{type:"capital",position:{x:7,y:3,z:1},color:"#3A5A5A"},{type:"column",position:{x:12,y:0,z:1},color:"#2F4F4F"},{type:"column",position:{x:12,y:1,z:1},color:"#2F4F4F"},{type:"column",position:{x:12,y:2,z:1},color:"#2F4F4F"},{type:"capital",position:{x:12,y:3,z:1},color:"#3A5A5A"},{type:"column",position:{x:2,y:0,z:8},color:"#2F4F4F"},{type:"column",position:{x:2,y:1,z:8},color:"#2F4F4F"},{type:"column",position:{x:2,y:2,z:8},color:"#2F4F4F"},{type:"capital",position:{x:2,y:3,z:8},color:"#3A5A5A"},{type:"column",position:{x:7,y:0,z:8},color:"#2F4F4F"},{type:"column",position:{x:7,y:1,z:8},color:"#2F4F4F"},{type:"column",position:{x:7,y:2,z:8},color:"#2F4F4F"},{type:"capital",position:{x:7,y:3,z:8},color:"#3A5A5A"},{type:"column",position:{x:12,y:0,z:8},color:"#2F4F4F"},{type:"column",position:{x:12,y:1,z:8},color:"#2F4F4F"},{type:"column",position:{x:12,y:2,z:8},color:"#2F4F4F"},{type:"capital",position:{x:12,y:3,z:8},color:"#3A5A5A"},...st(1,4,0,16,10,"#2F4F4F"),{type:"archWide",position:{x:2,y:4,z:4},color:"#3A5A5A",rotation:{x:0,y:90,z:0}},{type:"archWide",position:{x:7,y:4,z:4},color:"#3A5A5A",rotation:{x:0,y:90,z:0}},{type:"archWide",position:{x:12,y:4,z:4},color:"#3A5A5A",rotation:{x:0,y:90,z:0}},{type:"truss",position:{x:3,y:3,z:4},color:"#2F4F4F"},{type:"truss",position:{x:8,y:3,z:4},color:"#2F4F4F"},{type:"truss",position:{x:13,y:3,z:4},color:"#2F4F4F"},...st(0,0,10,8,5,"#606060"),...ae(0,1,10,8,5,"#DEB887"),...ae(0,2,10,8,5,"#DEB887"),...ae(0,3,10,8,5,"#C9B896"),...st(0,4,10,8,5,"#8B4513"),{type:"wedge",position:{x:2,y:4,z:11},color:"#704214"},{type:"wedge",position:{x:3,y:4,z:11},color:"#704214"},{type:"wedge",position:{x:4,y:4,z:11},color:"#704214"},{type:"wedge",position:{x:5,y:4,z:11},color:"#704214"},{type:"wedge",position:{x:2,y:4,z:13},color:"#704214",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:3,y:4,z:13},color:"#704214",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:4,y:4,z:13},color:"#704214",rotation:{x:0,y:180,z:0}},{type:"wedge",position:{x:5,y:4,z:13},color:"#704214",rotation:{x:0,y:180,z:0}},{type:"doorFrame",position:{x:3,y:1,z:10},color:"#654321"},{type:"doorFrame",position:{x:4,y:1,z:10},color:"#654321"},{type:"arch",position:{x:3,y:2,z:10},color:"#DEB887"},{type:"arch",position:{x:4,y:2,z:10},color:"#DEB887"},{type:"windowFrame",position:{x:1,y:2,z:10},color:"#4682B4"},{type:"windowFrame",position:{x:6,y:2,z:10},color:"#4682B4"},{type:"windowFrame",position:{x:1,y:3,z:10},color:"#4682B4"},{type:"windowFrame",position:{x:6,y:3,z:10},color:"#4682B4"},{type:"cube",position:{x:3,y:4,z:12},color:"#8B4513"},{type:"cube",position:{x:4,y:4,z:12},color:"#8B4513"},{type:"cube",position:{x:3,y:5,z:12},color:"#704214"},{type:"cube",position:{x:4,y:5,z:12},color:"#704214"},{type:"windowFrame",position:{x:3,y:5,z:11},color:"#F5F5DC"},{type:"windowFrame",position:{x:4,y:5,z:11},color:"#F5F5DC"},{type:"pyramid",position:{x:3,y:6,z:12},color:"#2F4F4F"},{type:"finial",position:{x:3,y:7,z:12},color:"#FFD700"},{type:"bench",position:{x:4,y:0,z:0},color:"#8B4513"},{type:"bench",position:{x:9,y:0,z:0},color:"#8B4513"},{type:"bench",position:{x:14,y:0,z:0},color:"#8B4513"},{type:"bench",position:{x:4,y:0,z:9},color:"#8B4513"},{type:"bench",position:{x:9,y:0,z:9},color:"#8B4513"},{type:"bench",position:{x:14,y:0,z:9},color:"#8B4513"},{type:"pillar",position:{x:5,y:0,z:1},color:"#2F4F4F"},{type:"pillar",position:{x:5,y:1,z:1},color:"#2F4F4F"},{type:"lightFixture",position:{x:5,y:2,z:1},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1,radius:3}},{type:"pillar",position:{x:10,y:0,z:1},color:"#2F4F4F"},{type:"pillar",position:{x:10,y:1,z:1},color:"#2F4F4F"},{type:"lightFixture",position:{x:10,y:2,z:1},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1,radius:3}},{type:"pillar",position:{x:5,y:0,z:8},color:"#2F4F4F"},{type:"pillar",position:{x:5,y:1,z:8},color:"#2F4F4F"},{type:"lightFixture",position:{x:5,y:2,z:8},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1,radius:3}},{type:"pillar",position:{x:10,y:0,z:8},color:"#2F4F4F"},{type:"pillar",position:{x:10,y:1,z:8},color:"#2F4F4F"},{type:"lightFixture",position:{x:10,y:2,z:8},color:"#FFD700",emissive:{enabled:!0,color:"#FFFACD",intensity:1,radius:3}},{type:"locker",position:{x:1,y:0,z:0},color:"#2F4F4F"},{type:"locker",position:{x:16,y:0,z:9},color:"#2F4F4F"},{type:"bin",position:{x:6,y:0,z:0},color:"#404040"},{type:"bin",position:{x:11,y:0,z:9},color:"#404040"},{type:"sign",position:{x:3,y:2,z:1},color:"#000080"},{type:"sign",position:{x:3,y:2,z:8},color:"#000080"},{type:"pillar",position:{x:17,y:0,z:4},color:"#404040"},{type:"pillar",position:{x:17,y:1,z:4},color:"#404040"},{type:"pillar",position:{x:17,y:2,z:4},color:"#404040"},{type:"bulb",position:{x:17,y:3,z:4},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:1.5,radius:2}},{type:"crate",position:{x:15,y:0,z:1},color:"#8B4513"},{type:"crate",position:{x:15,y:1,z:1},color:"#A0522D"},{type:"stairs",position:{x:3,y:0,z:9},color:"#808080",rotation:{x:0,y:180,z:0}},{type:"stairs",position:{x:4,y:0,z:9},color:"#808080",rotation:{x:0,y:180,z:0}}]},solarArrayLarge:{name:"Large Solar Array",category:"energy",description:"Industrial solar panel installation",blocks:[...st(0,0,0,12,10,"#808080"),{type:"solarPanel",position:{x:0,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:1,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:2,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:3,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:4,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:5,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:6,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:7,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:8,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:9,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:10,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:11,y:0,z:0},color:"#1a237e"},{type:"solarPanel",position:{x:0,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:1,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:2,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:3,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:4,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:5,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:6,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:7,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:8,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:9,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:10,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:11,y:0,z:2},color:"#283593"},{type:"solarPanel",position:{x:0,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:1,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:2,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:3,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:4,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:5,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:6,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:7,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:8,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:9,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:10,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:11,y:0,z:4},color:"#1a237e"},{type:"solarPanel",position:{x:0,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:1,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:2,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:3,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:4,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:5,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:6,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:7,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:8,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:9,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:10,y:0,z:6},color:"#283593"},{type:"solarPanel",position:{x:11,y:0,z:6},color:"#283593"},{type:"cube",position:{x:0,y:0,z:8},color:"#606060"},{type:"cube",position:{x:1,y:0,z:8},color:"#606060"},{type:"cube",position:{x:0,y:1,z:8},color:"#505050"},{type:"cube",position:{x:1,y:1,z:8},color:"#505050"},{type:"vent",position:{x:0,y:2,z:8},color:"#404040"},{type:"vent",position:{x:1,y:2,z:8},color:"#404040"},...Et(0,0,9,12,"X","fence","#808080")]},windTurbine:{name:"Wind Turbine",category:"energy",description:"Modern wind turbine with detailed nacelle, blades, and electrical infrastructure",blocks:[...st(-1,0,-1,5,5,"#808080"),{type:"cylinder",position:{x:0,y:0,z:0},color:"#606060"},{type:"cylinder",position:{x:2,y:0,z:0},color:"#606060"},{type:"cylinder",position:{x:0,y:0,z:2},color:"#606060"},{type:"cylinder",position:{x:2,y:0,z:2},color:"#606060"},{type:"cylinder",position:{x:1,y:1,z:1},color:"#E8E8E8"},{type:"cylinder",position:{x:1,y:2,z:1},color:"#E8E8E8"},{type:"cylinder",position:{x:1,y:3,z:1},color:"#E8E8E8"},{type:"cylinder",position:{x:1,y:4,z:1},color:"#F0F0F0"},{type:"cylinder",position:{x:1,y:5,z:1},color:"#F0F0F0"},{type:"cylinder",position:{x:1,y:6,z:1},color:"#F0F0F0"},{type:"cylinder",position:{x:1,y:7,z:1},color:"#F0F0F0"},{type:"cylinder",position:{x:1,y:8,z:1},color:"#F5F5F5"},{type:"cylinder",position:{x:1,y:9,z:1},color:"#F5F5F5"},{type:"cylinder",position:{x:1,y:10,z:1},color:"#F5F5F5"},{type:"cylinder",position:{x:1,y:11,z:1},color:"#F5F5F5"},{type:"cube",position:{x:1,y:12,z:1},color:"#E0E0E0"},{type:"cube",position:{x:1,y:12,z:0},color:"#E0E0E0"},{type:"slab",position:{x:1,y:12,z:-1},color:"#D0D0D0"},{type:"dome",position:{x:1,y:13,z:0},color:"#E8E8E8"},{type:"sphere",position:{x:1,y:12,z:-2},color:"#D0D0D0"},{type:"wedgeFlat",position:{x:0,y:13,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:-1,y:14,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:-2,y:15,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:-3,y:16,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:2,y:13,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:3,y:14,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:4,y:15,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:5,y:16,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:1,y:11,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:1,y:10,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:1,y:9,z:-2},color:"#FFFFFF"},{type:"wedgeFlat",position:{x:1,y:8,z:-2},color:"#FFFFFF"},{type:"sphere",position:{x:1,y:13,z:1},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:3,radius:8}},{type:"sphere",position:{x:1,y:6,z:0},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:1,radius:3}},{type:"doorFrame",position:{x:1,y:1,z:-1},color:"#606060"},{type:"transformer",position:{x:3,y:0,z:1},color:"#556B2F"},{type:"conduitX",position:{x:2,y:0,z:1},color:"#505050"},{type:"conduitX",position:{x:3,y:0,z:1},color:"#505050"},{type:"powerBox",position:{x:3,y:0,z:2},color:"#404040"},{type:"ladder",position:{x:0,y:1,z:1},color:"#FFD700"},{type:"ladder",position:{x:0,y:2,z:1},color:"#FFD700"},{type:"pillar4",position:{x:-1,y:0,z:-1},color:"#CD7F32"},{type:"antenna",position:{x:1,y:13,z:2},color:"#808080"},{type:"slab",position:{x:1,y:0,z:3},color:"#A0A0A0"},{type:"slab",position:{x:1,y:0,z:4},color:"#909090"},{type:"post",position:{x:-1,y:0,z:3},color:"#FFFF00"},{type:"post",position:{x:3,y:0,z:3},color:"#FFFF00"}]},substationYard:{name:"Electrical Substation",category:"energy",description:"High-voltage power substation with transformers, insulators, bus bars, and control building",blocks:[...st(0,0,0,14,10,"#A0A0A0"),{type:"tank",position:{x:2,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:2,y:1,z:2},color:"#556B2F"},{type:"tank",position:{x:3,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:3,y:1,z:2},color:"#556B2F"},{type:"vent",position:{x:2,y:2,z:2},color:"#708090"},{type:"vent",position:{x:3,y:2,z:2},color:"#708090"},{type:"panel",position:{x:1,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:1,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:4,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:4,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"pillar2",position:{x:2,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:2,y:3,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:3,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:3,y:3,z:2},color:"#E8DCC8"},{type:"tank",position:{x:6,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:6,y:1,z:2},color:"#556B2F"},{type:"tank",position:{x:7,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:7,y:1,z:2},color:"#556B2F"},{type:"vent",position:{x:6,y:2,z:2},color:"#708090"},{type:"vent",position:{x:7,y:2,z:2},color:"#708090"},{type:"panel",position:{x:5,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:5,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:8,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:8,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"pillar2",position:{x:6,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:6,y:3,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:7,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:7,y:3,z:2},color:"#E8DCC8"},{type:"tank",position:{x:10,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:10,y:1,z:2},color:"#556B2F"},{type:"tank",position:{x:11,y:0,z:2},color:"#556B2F"},{type:"tank",position:{x:11,y:1,z:2},color:"#556B2F"},{type:"vent",position:{x:10,y:2,z:2},color:"#708090"},{type:"vent",position:{x:11,y:2,z:2},color:"#708090"},{type:"panel",position:{x:9,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:9,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:12,y:0,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"panel",position:{x:12,y:1,z:2},color:"#4A5A4A",rotation:{x:0,y:90,z:0}},{type:"pillar2",position:{x:10,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:10,y:3,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:11,y:2,z:2},color:"#E8DCC8"},{type:"pillar2",position:{x:11,y:3,z:2},color:"#E8DCC8"},{type:"iBeam",position:{x:2,y:0,z:5},color:"#708090"},{type:"iBeam",position:{x:2,y:1,z:5},color:"#708090"},{type:"iBeam",position:{x:2,y:2,z:5},color:"#708090"},{type:"iBeam",position:{x:2,y:3,z:5},color:"#708090"},{type:"iBeam",position:{x:6,y:0,z:5},color:"#708090"},{type:"iBeam",position:{x:6,y:1,z:5},color:"#708090"},{type:"iBeam",position:{x:6,y:2,z:5},color:"#708090"},{type:"iBeam",position:{x:6,y:3,z:5},color:"#708090"},{type:"iBeam",position:{x:10,y:0,z:5},color:"#708090"},{type:"iBeam",position:{x:10,y:1,z:5},color:"#708090"},{type:"iBeam",position:{x:10,y:2,z:5},color:"#708090"},{type:"iBeam",position:{x:10,y:3,z:5},color:"#708090"},{type:"beamX",position:{x:1,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:2,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:3,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:5,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:6,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:7,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:9,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:10,y:4,z:5},color:"#708090"},{type:"beamX",position:{x:11,y:4,z:5},color:"#708090"},{type:"pillar2",position:{x:2,y:4,z:5},color:"#E8DCC8"},{type:"pillar2",position:{x:6,y:4,z:5},color:"#E8DCC8"},{type:"pillar2",position:{x:10,y:4,z:5},color:"#E8DCC8"},...Et(2,5,5,10,"X","pipeX","#C0C0C0"),{type:"transformer",position:{x:2,y:0,z:4},color:"#4682B4"},{type:"transformer",position:{x:6,y:0,z:4},color:"#4682B4"},{type:"transformer",position:{x:10,y:0,z:4},color:"#4682B4"},{type:"switchBox",position:{x:3,y:0,z:4},color:"#FF4500"},{type:"switchBox",position:{x:7,y:0,z:4},color:"#FF4500"},{type:"switchBox",position:{x:11,y:0,z:4},color:"#FF4500"},{type:"pillar",position:{x:1,y:0,z:3},color:"#4682B4"},{type:"pillar",position:{x:1,y:1,z:3},color:"#E8DCC8"},{type:"pillar",position:{x:5,y:0,z:3},color:"#4682B4"},{type:"pillar",position:{x:5,y:1,z:3},color:"#E8DCC8"},{type:"pillar",position:{x:9,y:0,z:3},color:"#4682B4"},{type:"pillar",position:{x:9,y:1,z:3},color:"#E8DCC8"},...st(0,0,7,5,3,"#606060"),...ae(0,1,7,5,3,"#D3D3D3"),...ae(0,2,5,5,3,"#D3D3D3"),...st(0,3,7,5,3,"#505050"),{type:"doorFrame",position:{x:2,y:1,z:7},color:"#404040"},{type:"windowFrame",position:{x:0,y:2,z:7},color:"#4682B4"},{type:"windowFrame",position:{x:4,y:2,z:7},color:"#4682B4"},{type:"acUnit",position:{x:4,y:1,z:9},color:"#C0C0C0"},{type:"fuseBox",position:{x:1,y:1,z:8},color:"#404040"},{type:"fuseBox",position:{x:3,y:1,z:8},color:"#404040"},{type:"iBeam",position:{x:0,y:0,z:5},color:"#708090"},{type:"iBeam",position:{x:0,y:1,z:5},color:"#708090"},{type:"iBeam",position:{x:0,y:2,z:5},color:"#708090"},{type:"iBeam",position:{x:0,y:3,z:5},color:"#708090"},{type:"iBeam",position:{x:0,y:4,z:5},color:"#708090"},{type:"iBeam",position:{x:0,y:5,z:5},color:"#708090"},{type:"crossBeam",position:{x:0,y:6,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:0,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:1,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:2,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:3,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:4,z:5},color:"#708090"},{type:"iBeam",position:{x:13,y:5,z:5},color:"#708090"},{type:"crossBeam",position:{x:13,y:6,z:5},color:"#708090"},{type:"channel",position:{x:2,y:0,z:3},color:"#505050"},{type:"channel",position:{x:3,y:0,z:3},color:"#505050"},{type:"channel",position:{x:6,y:0,z:3},color:"#505050"},{type:"channel",position:{x:7,y:0,z:3},color:"#505050"},{type:"channel",position:{x:10,y:0,z:3},color:"#505050"},{type:"channel",position:{x:11,y:0,z:3},color:"#505050"},...Et(0,0,0,14,"X","fence","#808080"),...Et(0,1,0,14,"X","railing","#404040"),...Et(0,0,9,14,"X","fence","#808080"),...Et(0,1,9,14,"X","railing","#404040"),{type:"fenceZ",position:{x:0,y:0,z:1},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:2},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:3},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:4},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:5},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:6},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:7},color:"#808080"},{type:"fenceZ",position:{x:0,y:0,z:8},color:"#808080"},{type:"railingZ",position:{x:0,y:1,z:1},color:"#404040"},{type:"railingZ",position:{x:0,y:1,z:3},color:"#404040"},{type:"railingZ",position:{x:0,y:1,z:5},color:"#404040"},{type:"railingZ",position:{x:0,y:1,z:7},color:"#404040"},{type:"fenceZ",position:{x:13,y:0,z:1},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:2},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:3},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:4},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:5},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:6},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:7},color:"#808080"},{type:"fenceZ",position:{x:13,y:0,z:8},color:"#808080"},{type:"railingZ",position:{x:13,y:1,z:2},color:"#404040"},{type:"railingZ",position:{x:13,y:1,z:4},color:"#404040"},{type:"railingZ",position:{x:13,y:1,z:6},color:"#404040"},{type:"railingZ",position:{x:13,y:1,z:8},color:"#404040"},{type:"sign",position:{x:6,y:1,z:0},color:"#FFD700"},{type:"sign",position:{x:7,y:1,z:0},color:"#FFD700"},{type:"barrier",position:{x:4,y:0,z:1},color:"#FF0000"},{type:"barrier",position:{x:8,y:0,z:1},color:"#FF0000"},{type:"post",position:{x:1,y:0,z:1},color:"#B87333"},{type:"post",position:{x:12,y:0,z:1},color:"#B87333"},{type:"post",position:{x:1,y:0,z:6},color:"#B87333"},{type:"post",position:{x:12,y:0,z:6},color:"#B87333"},{type:"pillar",position:{x:4,y:0,z:6},color:"#505050"},{type:"pillar",position:{x:4,y:1,z:6},color:"#505050"},{type:"pillar",position:{x:4,y:2,z:6},color:"#505050"},{type:"spotlight",position:{x:4,y:3,z:6},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:5}},{type:"pillar",position:{x:9,y:0,z:6},color:"#505050"},{type:"pillar",position:{x:9,y:1,z:6},color:"#505050"},{type:"pillar",position:{x:9,y:2,z:6},color:"#505050"},{type:"spotlight",position:{x:9,y:3,z:6},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:5}}]},coolingTowers:{name:"Cooling Towers",category:"energy",description:"Industrial cooling tower complex with basins, pump house, and control building",blocks:[...st(0,0,0,16,16,"#505050"),...st(1,-1,1,5,5,"#2F4F4F"),...st(10,-1,1,5,5,"#2F4F4F"),...st(1,-1,10,5,5,"#2F4F4F"),...st(10,-1,10,5,5,"#2F4F4F"),{type:"cylinder",position:{x:3,y:0,z:3},color:"#C0C0C0"},{type:"cylinder",position:{x:3,y:1,z:3},color:"#C0C0C0"},{type:"cylinder",position:{x:3,y:2,z:3},color:"#B8B8B8"},{type:"cylinder",position:{x:3,y:3,z:3},color:"#B0B0B0"},{type:"cylinder",position:{x:3,y:4,z:3},color:"#A8A8A8"},{type:"cylinder",position:{x:3,y:5,z:3},color:"#A0A0A0"},{type:"cylinder",position:{x:3,y:6,z:3},color:"#989898"},{type:"tube",position:{x:3,y:7,z:3},color:"#909090"},{type:"dome",position:{x:3,y:8,z:3},color:"#E0E0E0",emissive:{enabled:!0,color:"#FFFFFF",intensity:.3,radius:2}},{type:"cylinder",position:{x:12,y:0,z:3},color:"#C0C0C0"},{type:"cylinder",position:{x:12,y:1,z:3},color:"#C0C0C0"},{type:"cylinder",position:{x:12,y:2,z:3},color:"#B8B8B8"},{type:"cylinder",position:{x:12,y:3,z:3},color:"#B0B0B0"},{type:"cylinder",position:{x:12,y:4,z:3},color:"#A8A8A8"},{type:"cylinder",position:{x:12,y:5,z:3},color:"#A0A0A0"},{type:"cylinder",position:{x:12,y:6,z:3},color:"#989898"},{type:"tube",position:{x:12,y:7,z:3},color:"#909090"},{type:"dome",position:{x:12,y:8,z:3},color:"#E0E0E0",emissive:{enabled:!0,color:"#FFFFFF",intensity:.3,radius:2}},{type:"cylinder",position:{x:3,y:0,z:12},color:"#C0C0C0"},{type:"cylinder",position:{x:3,y:1,z:12},color:"#C0C0C0"},{type:"cylinder",position:{x:3,y:2,z:12},color:"#B8B8B8"},{type:"cylinder",position:{x:3,y:3,z:12},color:"#B0B0B0"},{type:"cylinder",position:{x:3,y:4,z:12},color:"#A8A8A8"},{type:"cylinder",position:{x:3,y:5,z:12},color:"#A0A0A0"},{type:"cylinder",position:{x:3,y:6,z:12},color:"#989898"},{type:"tube",position:{x:3,y:7,z:12},color:"#909090"},{type:"dome",position:{x:3,y:8,z:12},color:"#E0E0E0",emissive:{enabled:!0,color:"#FFFFFF",intensity:.3,radius:2}},{type:"cylinder",position:{x:12,y:0,z:12},color:"#C0C0C0"},{type:"cylinder",position:{x:12,y:1,z:12},color:"#C0C0C0"},{type:"cylinder",position:{x:12,y:2,z:12},color:"#B8B8B8"},{type:"cylinder",position:{x:12,y:3,z:12},color:"#B0B0B0"},{type:"cylinder",position:{x:12,y:4,z:12},color:"#A8A8A8"},{type:"cylinder",position:{x:12,y:5,z:12},color:"#A0A0A0"},{type:"cylinder",position:{x:12,y:6,z:12},color:"#989898"},{type:"tube",position:{x:12,y:7,z:12},color:"#909090"},{type:"dome",position:{x:12,y:8,z:12},color:"#E0E0E0",emissive:{enabled:!0,color:"#FFFFFF",intensity:.3,radius:2}},{type:"pillar2",position:{x:5,y:0,z:3},color:"#4A4A4A"},{type:"pillar2",position:{x:7,y:0,z:3},color:"#4A4A4A"},{type:"pillar2",position:{x:10,y:0,z:3},color:"#4A4A4A"},{type:"pillar2",position:{x:5,y:0,z:12},color:"#4A4A4A"},{type:"pillar2",position:{x:7,y:0,z:12},color:"#4A4A4A"},{type:"pillar2",position:{x:10,y:0,z:12},color:"#4A4A4A"},{type:"pillar2",position:{x:7,y:0,z:7},color:"#4A4A4A"},{type:"pillar2",position:{x:8,y:0,z:8},color:"#4A4A4A"},...Et(4,1,3,8,"X","pipeX","#708090"),...Et(4,1,12,8,"X","pipeX","#708090"),...Et(7,1,4,8,"Z","pipeZ","#708090"),...Et(8,1,4,8,"Z","pipeZ","#708090"),{type:"pipeCross",position:{x:7,y:1,z:3},color:"#708090"},{type:"pipeCross",position:{x:8,y:1,z:3},color:"#708090"},{type:"pipeCross",position:{x:7,y:1,z:12},color:"#708090"},{type:"pipeCross",position:{x:8,y:1,z:12},color:"#708090"},{type:"valve",position:{x:5,y:1,z:3},color:"#B22222"},{type:"valve",position:{x:10,y:1,z:3},color:"#B22222"},{type:"valve",position:{x:5,y:1,z:12},color:"#B22222"},{type:"valve",position:{x:10,y:1,z:12},color:"#B22222"},{type:"valve",position:{x:7,y:1,z:7},color:"#FFD700"},{type:"valve",position:{x:8,y:1,z:8},color:"#FFD700"},...st(14,0,6,3,4,"#606060"),...Wt(14,1,6,4,2,"#708090"),...Wt(16,1,6,4,2,"#708090"),...ne(14,1,6,3,2,"#708090"),...ne(14,1,9,3,2,"#708090"),...st(14,3,6,3,4,"#606060"),{type:"tank",position:{x:15,y:1,z:7},color:"#4682B4"},{type:"tank",position:{x:15,y:2,z:7},color:"#4682B4"},{type:"tank",position:{x:15,y:1,z:8},color:"#4682B4"},{type:"tank",position:{x:15,y:2,z:8},color:"#4682B4"},...Et(12,1,7,3,"X","pipeX","#708090"),{type:"pipeElbowXZ",position:{x:12,y:1,z:7},color:"#708090"},...st(-3,0,6,4,5,"#505050"),...Wt(-3,1,6,5,3,"#808080"),...Wt(0,1,6,5,3,"#808080"),...ne(-3,1,6,4,3,"#808080"),...ne(-3,1,10,4,3,"#808080"),...st(-3,4,6,4,5,"#606060"),{type:"doorFrame",position:{x:-1,y:1,z:6},color:"#4682B4"},{type:"doorFrame",position:{x:-1,y:2,z:6},color:"#4682B4"},{type:"windowFrame",position:{x:-2,y:2,z:6},color:"#87CEEB"},{type:"windowFrame",position:{x:-3,y:2,z:8},color:"#87CEEB"},{type:"desk",position:{x:-2,y:1,z:8},color:"#8B4513"},{type:"monitor",position:{x:-2,y:2,z:8},color:"#1E1E1E",emissive:{enabled:!0,color:"#00FF00",intensity:.5,radius:2}},{type:"switchBox",position:{x:-1,y:2,z:10},color:"#808080"},{type:"acUnit",position:{x:-2,y:4,z:8},color:"#C0C0C0"},{type:"post",position:{x:1,y:0,z:0},color:"#505050"},{type:"post",position:{x:1,y:1,z:0},color:"#505050"},{type:"post",position:{x:4,y:0,z:0},color:"#505050"},{type:"post",position:{x:4,y:1,z:0},color:"#505050"},{type:"post",position:{x:6,y:0,z:0},color:"#505050"},{type:"post",position:{x:6,y:1,z:0},color:"#505050"},{type:"post",position:{x:9,y:0,z:0},color:"#505050"},{type:"post",position:{x:9,y:1,z:0},color:"#505050"},{type:"post",position:{x:12,y:0,z:0},color:"#505050"},{type:"post",position:{x:12,y:1,z:0},color:"#505050"},{type:"post",position:{x:14,y:0,z:0},color:"#505050"},{type:"post",position:{x:14,y:1,z:0},color:"#505050"},{type:"post",position:{x:0,y:0,z:1},color:"#505050"},{type:"post",position:{x:0,y:1,z:1},color:"#505050"},{type:"post",position:{x:0,y:0,z:3},color:"#505050"},{type:"post",position:{x:0,y:1,z:3},color:"#505050"},{type:"post",position:{x:0,y:0,z:5},color:"#505050"},{type:"post",position:{x:0,y:1,z:5},color:"#505050"},{type:"post",position:{x:15,y:0,z:1},color:"#505050"},{type:"post",position:{x:15,y:1,z:1},color:"#505050"},{type:"post",position:{x:15,y:0,z:3},color:"#505050"},{type:"post",position:{x:15,y:1,z:3},color:"#505050"},{type:"post",position:{x:15,y:0,z:5},color:"#505050"},{type:"post",position:{x:15,y:1,z:5},color:"#505050"},...Et(1,2,0,6,"X","catwalk","#404040"),...Et(9,2,0,6,"X","catwalk","#404040"),...Et(0,2,1,5,"Z","catwalk","#404040"),...Et(15,2,1,5,"Z","catwalk","#404040"),...Et(1,2,0,6,"X","railing","#606060"),...Et(9,2,0,6,"X","railing","#606060"),{type:"ladder",position:{x:2,y:0,z:3},color:"#FFD700"},{type:"ladder",position:{x:2,y:1,z:3},color:"#FFD700"},{type:"ladder",position:{x:2,y:2,z:3},color:"#FFD700"},{type:"ladder",position:{x:2,y:3,z:3},color:"#FFD700"},{type:"transformer",position:{x:0,y:0,z:0},color:"#505050"},{type:"powerBox",position:{x:0,y:1,z:0},color:"#404040"},...Et(1,0,0,7,"X","conduitX","#404040"),{type:"conduitElbow",position:{x:7,y:0,z:0},color:"#404040"},...Et(7,0,1,5,"Z","conduitZ","#404040"),...Et(-4,0,5,1,"Z","fence","#808080"),...Et(-4,0,11,5,"Z","fence","#808080"),...Et(-4,0,16,21,"X","fence","#808080"),...Et(16,0,0,16,"Z","fence","#808080"),...Et(0,0,-1,16,"X","fence","#808080"),{type:"barrier",position:{x:7,y:0,z:-1},color:"#FF0000"},{type:"barrier",position:{x:8,y:0,z:-1},color:"#FF0000"},{type:"sign",position:{x:7,y:1,z:-1},color:"#FFD700"},{type:"sign",position:{x:15,y:1,z:6},color:"#FFD700"},{type:"sphere",position:{x:3,y:9,z:3},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"sphere",position:{x:12,y:9,z:3},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"sphere",position:{x:3,y:9,z:12},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"sphere",position:{x:12,y:9,z:12},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"post",position:{x:7,y:0,z:7},color:"#404040"},{type:"post",position:{x:7,y:1,z:7},color:"#404040"},{type:"post",position:{x:7,y:2,z:7},color:"#404040"},{type:"lightFixture",position:{x:7,y:3,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}}]},powerPlant:{name:"Power Plant",category:"industrial",description:"Complete power generation facility with boiler house, turbine hall, control room, and transformer yard",blocks:[...st(0,0,0,20,16,"#505050"),...st(0,0,4,8,8,"#404040"),...ne(0,1,4,8,6,"#606060"),...ne(0,1,11,8,6,"#606060"),...Wt(0,1,5,6,6,"#606060"),...Wt(7,1,5,6,6,"#606060"),...st(0,7,4,8,8,"#505050"),{type:"tank",position:{x:2,y:1,z:6},color:"#8B0000"},{type:"tank",position:{x:2,y:2,z:6},color:"#8B0000"},{type:"tank",position:{x:2,y:3,z:6},color:"#8B0000"},{type:"tank",position:{x:2,y:4,z:6},color:"#8B0000"},{type:"tank",position:{x:2,y:5,z:6},color:"#8B0000"},{type:"tank",position:{x:5,y:1,z:6},color:"#8B0000"},{type:"tank",position:{x:5,y:2,z:6},color:"#8B0000"},{type:"tank",position:{x:5,y:3,z:6},color:"#8B0000"},{type:"tank",position:{x:5,y:4,z:6},color:"#8B0000"},{type:"tank",position:{x:5,y:5,z:6},color:"#8B0000"},{type:"cylinder",position:{x:2,y:7,z:6},color:"#A0522D"},{type:"cylinder",position:{x:2,y:8,z:6},color:"#A0522D"},{type:"cylinder",position:{x:2,y:9,z:6},color:"#8B4513"},{type:"cylinder",position:{x:2,y:10,z:6},color:"#8B4513"},{type:"cylinder",position:{x:2,y:11,z:6},color:"#704214"},{type:"dome",position:{x:2,y:12,z:6},color:"#808080",emissive:{enabled:!0,color:"#AAAAAA",intensity:.4,radius:2}},{type:"cylinder",position:{x:5,y:7,z:6},color:"#A0522D"},{type:"cylinder",position:{x:5,y:8,z:6},color:"#A0522D"},{type:"cylinder",position:{x:5,y:9,z:6},color:"#8B4513"},{type:"cylinder",position:{x:5,y:10,z:6},color:"#8B4513"},{type:"cylinder",position:{x:5,y:11,z:6},color:"#704214"},{type:"dome",position:{x:5,y:12,z:6},color:"#808080",emissive:{enabled:!0,color:"#AAAAAA",intensity:.4,radius:2}},...Et(3,3,6,2,"X","pipeX","#708090"),{type:"valve",position:{x:3,y:3,z:6},color:"#B22222"},{type:"valve",position:{x:4,y:3,z:6},color:"#B22222"},...Et(2,4,7,4,"Z","pipeZ","#C0C0C0"),...Et(5,4,7,4,"Z","pipeZ","#C0C0C0"),...st(8,0,4,8,8,"#454545"),...ne(8,1,4,8,5,"#707070"),...ne(8,1,11,8,5,"#707070"),...Wt(8,1,5,6,5,"#707070"),...Wt(15,1,5,6,5,"#707070"),...st(8,6,4,8,8,"#505050"),{type:"cylinder",position:{x:10,y:1,z:6},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:10,y:1,z:7},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:10,y:1,z:8},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:10,y:2,z:7},color:"#4169E1"},{type:"cylinder",position:{x:13,y:1,z:6},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:13,y:1,z:7},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:13,y:1,z:8},color:"#4682B4",rotation:{x:0,y:0,z:90}},{type:"cylinder",position:{x:13,y:2,z:7},color:"#4169E1"},{type:"cube",position:{x:11,y:1,z:7},color:"#2F4F4F"},{type:"cube",position:{x:11,y:2,z:7},color:"#2F4F4F"},{type:"cube",position:{x:14,y:1,z:7},color:"#2F4F4F"},{type:"cube",position:{x:14,y:2,z:7},color:"#2F4F4F"},{type:"iBeam",position:{x:9,y:5,z:5},color:"#FFD700"},{type:"iBeam",position:{x:10,y:5,z:5},color:"#FFD700"},{type:"iBeam",position:{x:11,y:5,z:5},color:"#FFD700"},{type:"iBeam",position:{x:12,y:5,z:5},color:"#FFD700"},{type:"iBeam",position:{x:13,y:5,z:5},color:"#FFD700"},{type:"iBeam",position:{x:14,y:5,z:5},color:"#FFD700"},...st(16,0,4,5,6,"#505050"),...Wt(16,1,4,6,3,"#708090"),...Wt(20,1,4,6,3,"#708090"),...ne(16,1,4,5,3,"#708090"),...ne(16,1,9,5,3,"#708090"),...st(16,4,4,5,6,"#505050"),{type:"doorFrame",position:{x:16,y:1,z:6},color:"#4682B4"},{type:"doorFrame",position:{x:16,y:2,z:6},color:"#4682B4"},{type:"windowFrame",position:{x:16,y:2,z:5},color:"#87CEEB"},{type:"windowFrame",position:{x:16,y:2,z:7},color:"#87CEEB"},{type:"windowFrame",position:{x:16,y:2,z:8},color:"#87CEEB"},{type:"switchBox",position:{x:18,y:1,z:5},color:"#2F4F4F"},{type:"monitor",position:{x:18,y:2,z:5},color:"#1E1E1E",emissive:{enabled:!0,color:"#00FF00",intensity:.5,radius:2}},{type:"switchBox",position:{x:19,y:1,z:5},color:"#2F4F4F"},{type:"monitor",position:{x:19,y:2,z:5},color:"#1E1E1E",emissive:{enabled:!0,color:"#00BFFF",intensity:.5,radius:2}},{type:"desk",position:{x:17,y:1,z:7},color:"#4A4A4A"},{type:"chair",position:{x:17,y:1,z:6},color:"#2F2F2F"},{type:"acUnit",position:{x:18,y:4,z:7},color:"#C0C0C0"},...st(0,0,12,8,4,"#3A3A3A"),{type:"cube",position:{x:1,y:0,z:13},color:"#1A1A1A"},{type:"cube",position:{x:2,y:0,z:13},color:"#1A1A1A"},{type:"cube",position:{x:3,y:0,z:13},color:"#1A1A1A"},{type:"cube",position:{x:2,y:0,z:14},color:"#1A1A1A"},{type:"wedge",position:{x:1,y:1,z:13},color:"#1A1A1A"},{type:"wedge",position:{x:2,y:1,z:13},color:"#1A1A1A"},{type:"conveyor",position:{x:4,y:1,z:13},color:"#505050"},{type:"conveyor",position:{x:5,y:1,z:13},color:"#505050"},{type:"conveyor",position:{x:6,y:2,z:13},color:"#505050"},{type:"conveyor",position:{x:6,y:2,z:12},color:"#505050"},{type:"hopper",position:{x:6,y:3,z:12},color:"#696969"},...st(16,0,10,6,6,"#606060"),{type:"transformer",position:{x:17,y:0,z:11},color:"#505050"},{type:"transformer",position:{x:17,y:1,z:11},color:"#505050"},{type:"transformer",position:{x:19,y:0,z:11},color:"#505050"},{type:"transformer",position:{x:19,y:1,z:11},color:"#505050"},{type:"pillar4",position:{x:17,y:2,z:11},color:"#8B4513"},{type:"pillar4",position:{x:19,y:2,z:11},color:"#8B4513"},{type:"iBeam",position:{x:17,y:3,z:11},color:"#C0C0C0"},{type:"iBeam",position:{x:18,y:3,z:11},color:"#C0C0C0"},{type:"iBeam",position:{x:19,y:3,z:11},color:"#C0C0C0"},{type:"switchBox",position:{x:17,y:0,z:13},color:"#808080"},{type:"switchBox",position:{x:19,y:0,z:13},color:"#808080"},{type:"cableX",position:{x:20,y:3,z:11},color:"#1E1E1E"},{type:"cableX",position:{x:21,y:3,z:11},color:"#1E1E1E"},{type:"sign",position:{x:16,y:1,z:10},color:"#FFD700"},...Et(16,0,15,6,"X","fence","#808080"),...Et(21,0,10,5,"Z","fence","#808080"),...st(8,-1,12,6,4,"#2F4F4F"),{type:"cube",position:{x:10,y:0,z:13},color:"#708090"},{type:"cube",position:{x:11,y:0,z:13},color:"#708090"},{type:"cube",position:{x:10,y:1,z:13},color:"#708090"},{type:"cube",position:{x:11,y:1,z:13},color:"#708090"},...Et(8,1,14,4,"X","pipeX","#708090"),{type:"valve",position:{x:9,y:1,z:14},color:"#B22222"},...Et(0,0,0,22,"X","fence","#808080"),...Et(0,0,0,16,"Z","fence","#808080"),...Et(0,0,16,16,"X","fence","#808080"),{type:"barrier",position:{x:10,y:0,z:0},color:"#FF0000"},{type:"barrier",position:{x:11,y:0,z:0},color:"#FF0000"},{type:"cube",position:{x:9,y:0,z:1},color:"#808080"},{type:"cube",position:{x:9,y:1,z:1},color:"#808080"},{type:"windowFrame",position:{x:9,y:1,z:1},color:"#87CEEB"},{type:"sphere",position:{x:2,y:13,z:6},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"sphere",position:{x:5,y:13,z:6},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:2,radius:3}},{type:"pillar4",position:{x:4,y:0,z:2},color:"#404040"},{type:"pillar4",position:{x:4,y:1,z:2},color:"#404040"},{type:"pillar4",position:{x:4,y:2,z:2},color:"#404040"},{type:"pillar4",position:{x:4,y:3,z:2},color:"#404040"},{type:"lightFixture",position:{x:4,y:4,z:2},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}},{type:"pillar4",position:{x:12,y:0,z:2},color:"#404040"},{type:"pillar4",position:{x:12,y:1,z:2},color:"#404040"},{type:"pillar4",position:{x:12,y:2,z:2},color:"#404040"},{type:"pillar4",position:{x:12,y:3,z:2},color:"#404040"},{type:"lightFixture",position:{x:12,y:4,z:2},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}},{type:"pillar4",position:{x:18,y:0,z:12},color:"#404040"},{type:"pillar4",position:{x:18,y:1,z:12},color:"#404040"},{type:"pillar4",position:{x:18,y:2,z:12},color:"#404040"},{type:"pillar4",position:{x:18,y:3,z:12},color:"#404040"},{type:"lightFixture",position:{x:18,y:4,z:12},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:1,radius:5}}]},warehouseDistrict:{name:"Warehouse District",category:"industrial",description:"Multiple warehouses with loading docks",blocks:[...st(0,0,0,15,12,"#3A3A3A"),...st(0,0,0,5,4,"#708090"),...ne(0,1,0,5,2,"#808080"),...ne(0,1,3,5,2,"#808080"),...Wt(0,1,1,2,2,"#808080"),...Wt(4,1,1,2,2,"#808080"),...st(0,3,0,5,4,"#606060"),{type:"doorFrame",position:{x:2,y:1,z:0},color:"#FFD700"},...st(7,0,0,5,4,"#708090"),...ne(7,1,0,5,2,"#909090"),...ne(7,1,3,5,2,"#909090"),...Wt(7,1,1,2,2,"#909090"),...Wt(11,1,1,2,2,"#909090"),...st(7,3,0,5,4,"#707070"),{type:"doorFrame",position:{x:9,y:1,z:0},color:"#FFD700"},...st(0,0,6,7,5,"#708090"),...ne(0,1,6,7,3,"#808080"),...ne(0,1,10,7,3,"#808080"),...Wt(0,1,7,3,3,"#808080"),...Wt(6,1,7,3,3,"#808080"),...st(0,4,6,7,5,"#606060"),{type:"doorFrame",position:{x:2,y:1,z:6},color:"#FFD700"},{type:"doorFrame",position:{x:3,y:1,z:6},color:"#FFD700"},{type:"doorFrame",position:{x:4,y:1,z:6},color:"#FFD700"},{type:"slab",position:{x:2,y:0,z:5},color:"#505050"},{type:"slab",position:{x:3,y:0,z:5},color:"#505050"},{type:"slab",position:{x:4,y:0,z:5},color:"#505050"},{type:"crate",position:{x:9,y:0,z:6},color:"#8B4513"},{type:"crate",position:{x:10,y:0,z:6},color:"#A0522D"},{type:"crate",position:{x:9,y:1,z:6},color:"#CD853F"},{type:"barrel",position:{x:12,y:0,z:6},color:"#2F4F4F"},{type:"barrel",position:{x:13,y:0,z:6},color:"#006400"},{type:"pillar2",position:{x:5,y:0,z:4},color:"#2F2F2F"},{type:"pillar2",position:{x:5,y:1,z:4},color:"#2F2F2F"},{type:"pillar2",position:{x:5,y:2,z:4},color:"#2F2F2F"},{type:"sphere",position:{x:5,y:3,z:4},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFE0",intensity:2,radius:5}}]},gasStation:{name:"Gas Station",category:"modern",description:"Modern fuel station with pumps, convenience store, car wash, and detailed infrastructure",blocks:[...st(0,0,0,12,10,"#2F2F2F"),{type:"slab",position:{x:0,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:1,y:0,z:4},color:"#2F2F2F"},{type:"slab",position:{x:2,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:3,y:0,z:4},color:"#2F2F2F"},{type:"slab",position:{x:4,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:2,y:0,z:2},color:"#808080"},{type:"slab",position:{x:3,y:0,z:2},color:"#808080"},{type:"pillar2",position:{x:2,y:0,z:2},color:"#FF0000"},{type:"pillar2",position:{x:2,y:1,z:2},color:"#C0C0C0"},{type:"pillar2",position:{x:3,y:0,z:2},color:"#FF0000"},{type:"pillar2",position:{x:3,y:1,z:2},color:"#C0C0C0"},{type:"slab",position:{x:2,y:0,z:6},color:"#808080"},{type:"slab",position:{x:3,y:0,z:6},color:"#808080"},{type:"pillar2",position:{x:2,y:0,z:6},color:"#FF0000"},{type:"pillar2",position:{x:2,y:1,z:6},color:"#C0C0C0"},{type:"pillar2",position:{x:3,y:0,z:6},color:"#FF0000"},{type:"pillar2",position:{x:3,y:1,z:6},color:"#C0C0C0"},{type:"bollard",position:{x:1,y:0,z:2},color:"#FFFF00"},{type:"bollard",position:{x:4,y:0,z:2},color:"#FFFF00"},{type:"bollard",position:{x:1,y:0,z:6},color:"#FFFF00"},{type:"bollard",position:{x:4,y:0,z:6},color:"#FFFF00"},{type:"pillar",position:{x:0,y:0,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:0,y:1,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:0,y:2,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:0,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:1,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:2,z:1},color:"#E0E0E0"},{type:"pillar",position:{x:0,y:0,z:7},color:"#E0E0E0"},{type:"pillar",position:{x:0,y:1,z:7},color:"#E0E0E0"},{type:"pillar",position:{x:0,y:2,z:7},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:0,z:7},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:1,z:7},color:"#E0E0E0"},{type:"pillar",position:{x:5,y:2,z:7},color:"#E0E0E0"},...st(0,3,0,6,9,"#F0F0F0"),{type:"slab",position:{x:0,y:3,z:4},color:"#FF0000"},{type:"slab",position:{x:1,y:3,z:4},color:"#FF0000"},{type:"slab",position:{x:2,y:3,z:4},color:"#FF0000"},{type:"slab",position:{x:3,y:3,z:4},color:"#FF0000"},{type:"slab",position:{x:4,y:3,z:4},color:"#FF0000"},{type:"slab",position:{x:5,y:3,z:4},color:"#FF0000"},{type:"lightFixture",position:{x:1,y:3,z:2},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFFF",intensity:3,radius:5}},{type:"lightFixture",position:{x:4,y:3,z:2},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFFF",intensity:3,radius:5}},{type:"lightFixture",position:{x:1,y:3,z:6},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFFF",intensity:3,radius:5}},{type:"lightFixture",position:{x:4,y:3,z:6},color:"#FFFACD",emissive:{enabled:!0,color:"#FFFFFF",intensity:3,radius:5}},...st(7,0,1,5,7,"#505050"),...ae(7,1,1,5,7,"#DEB887"),...ae(7,2,1,5,7,"#DEB887"),...st(7,3,1,5,7,"#8B0000"),{type:"acUnit",position:{x:8,y:3,z:3},color:"#909090"},{type:"acUnit",position:{x:10,y:3,z:5},color:"#909090"},{type:"doorFrame",position:{x:7,y:1,z:4},color:"#4682B4"},{type:"doorFrame",position:{x:7,y:2,z:4},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:1,z:2},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:1,z:3},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:1,z:5},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:1,z:6},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:2,z:2},color:"#4682B4"},{type:"windowFrame",position:{x:7,y:2,z:6},color:"#4682B4"},{type:"sign",position:{x:7,y:2,z:4},color:"#FF0000",emissive:{enabled:!0,color:"#FF0000",intensity:1,radius:2}},{type:"cube",position:{x:0,y:0,z:9},color:"#4169E1"},{type:"pillar2",position:{x:0,y:1,z:9},color:"#C0C0C0"},{type:"cableLoop",position:{x:1,y:0,z:9},color:"#1A1A1A"},{type:"cylinder",position:{x:1,y:0,z:0},color:"#FFD700"},{type:"cylinder",position:{x:3,y:0,z:0},color:"#FFD700"},{type:"pipeY",position:{x:0,y:0,z:0},color:"#808080"},{type:"pipeY",position:{x:0,y:1,z:0},color:"#808080"},{type:"pipeY",position:{x:0,y:2,z:0},color:"#808080"},{type:"cube",position:{x:9,y:0,z:9},color:"#4682B4"},{type:"cube",position:{x:10,y:0,z:9},color:"#4682B4"},{type:"cube",position:{x:11,y:0,z:9},color:"#4682B4"},{type:"cube",position:{x:9,y:1,z:9},color:"#87CEEB"},{type:"cube",position:{x:10,y:1,z:9},color:"#87CEEB"},{type:"cube",position:{x:11,y:1,z:9},color:"#87CEEB"},{type:"slab",position:{x:9,y:2,z:9},color:"#4682B4"},{type:"slab",position:{x:10,y:2,z:9},color:"#4682B4"},{type:"slab",position:{x:11,y:2,z:9},color:"#4682B4"},{type:"pillarRound",position:{x:9,y:0,z:9},color:"#0000CD"},{type:"pillarRound",position:{x:11,y:0,z:9},color:"#0000CD"},{type:"pillar",position:{x:-1,y:0,z:4},color:"#E0E0E0"},{type:"pillar",position:{x:-1,y:1,z:4},color:"#E0E0E0"},{type:"pillar",position:{x:-1,y:2,z:4},color:"#E0E0E0"},{type:"cube",position:{x:-1,y:3,z:4},color:"#FFFFFF"},{type:"cube",position:{x:-1,y:4,z:4},color:"#FF0000"},{type:"barrel",position:{x:6,y:0,z:2},color:"#006400"},{type:"barrel",position:{x:6,y:0,z:6},color:"#006400"},{type:"cube",position:{x:6,y:0,z:4},color:"#FFFFFF"},{type:"cube",position:{x:6,y:1,z:4},color:"#4169E1"},{type:"fence",position:{x:11,y:0,z:1},color:"#C0C0C0"},{type:"barrel",position:{x:11,y:0,z:2},color:"#87CEEB"},{type:"barrel",position:{x:11,y:0,z:3},color:"#87CEEB"}]},helipad:{name:"Helipad",category:"modern",description:"Complete heliport with control room, fuel station, fire safety, and service area",blocks:[...st(4,0,2,10,10,"#404040"),...st(6,0,4,6,6,"#353535"),{type:"slab",position:{x:7,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:8,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:9,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:10,y:0,z:4},color:"#FFFF00"},{type:"slab",position:{x:6,y:0,z:5},color:"#FFFF00"},{type:"slab",position:{x:11,y:0,z:5},color:"#FFFF00"},{type:"slab",position:{x:6,y:0,z:6},color:"#FFFF00"},{type:"slab",position:{x:11,y:0,z:6},color:"#FFFF00"},{type:"slab",position:{x:6,y:0,z:7},color:"#FFFF00"},{type:"slab",position:{x:11,y:0,z:7},color:"#FFFF00"},{type:"slab",position:{x:6,y:0,z:8},color:"#FFFF00"},{type:"slab",position:{x:11,y:0,z:8},color:"#FFFF00"},{type:"slab",position:{x:7,y:0,z:9},color:"#FFFF00"},{type:"slab",position:{x:8,y:0,z:9},color:"#FFFF00"},{type:"slab",position:{x:9,y:0,z:9},color:"#FFFF00"},{type:"slab",position:{x:10,y:0,z:9},color:"#FFFF00"},{type:"slab",position:{x:7,y:0,z:5},color:"#FFFFFF"},{type:"slab",position:{x:7,y:0,z:6},color:"#FFFFFF"},{type:"slab",position:{x:7,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:7,y:0,z:8},color:"#FFFFFF"},{type:"slab",position:{x:8,y:0,z:6},color:"#FFFFFF"},{type:"slab",position:{x:8,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:9,y:0,z:6},color:"#FFFFFF"},{type:"slab",position:{x:9,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:5},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:6},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:7},color:"#FFFFFF"},{type:"slab",position:{x:10,y:0,z:8},color:"#FFFFFF"},{type:"sphere",position:{x:4,y:0,z:2},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:8,y:0,z:2},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:13,y:0,z:2},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:4,y:0,z:11},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:8,y:0,z:11},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:13,y:0,z:11},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:4,y:0,z:6},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},{type:"sphere",position:{x:13,y:0,z:6},color:"#00FF00",emissive:{enabled:!0,color:"#00FF00",intensity:1.5,radius:3}},...st(0,0,4,4,6,"#606060"),...Wt(0,1,4,6,3,"#808080"),...Wt(3,1,4,6,3,"#808080"),...ne(0,1,4,4,3,"#808080"),...ne(0,1,9,4,3,"#808080"),...st(0,4,4,4,6,"#505050"),{type:"doorFrame",position:{x:3,y:1,z:6},color:"#4682B4"},{type:"doorFrame",position:{x:3,y:2,z:6},color:"#4682B4"},{type:"windowFrame",position:{x:3,y:2,z:5},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:2,z:7},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:2,z:8},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:3,z:5},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:3,z:6},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:3,z:7},color:"#87CEEB"},{type:"windowFrame",position:{x:3,y:3,z:8},color:"#87CEEB"},{type:"desk",position:{x:1,y:1,z:6},color:"#4A4A4A"},{type:"monitor",position:{x:1,y:2,z:6},color:"#1E1E1E",emissive:{enabled:!0,color:"#00BFFF",intensity:.5,radius:2}},{type:"desk",position:{x:1,y:1,z:7},color:"#4A4A4A"},{type:"monitor",position:{x:1,y:2,z:7},color:"#1E1E1E",emissive:{enabled:!0,color:"#00FF00",intensity:.5,radius:2}},{type:"chair",position:{x:2,y:1,z:6},color:"#2F2F2F"},{type:"chair",position:{x:2,y:1,z:7},color:"#2F2F2F"},{type:"antenna",position:{x:1,y:4,z:6},color:"#C0C0C0"},{type:"antenna",position:{x:1,y:5,z:6},color:"#C0C0C0"},{type:"acUnit",position:{x:2,y:4,z:8},color:"#A0A0A0"},...st(0,0,0,4,4,"#505050"),{type:"tank",position:{x:1,y:0,z:1},color:"#FF4500"},{type:"tank",position:{x:1,y:1,z:1},color:"#FF4500"},{type:"tank",position:{x:2,y:0,z:1},color:"#FF4500"},{type:"tank",position:{x:2,y:1,z:1},color:"#FF4500"},{type:"pillar",position:{x:1,y:0,z:2},color:"#FFD700"},{type:"powerBox",position:{x:1,y:1,z:2},color:"#FFD700"},{type:"cylinder",position:{x:2,y:0,z:2},color:"#2F2F2F"},{type:"sign",position:{x:0,y:1,z:0},color:"#FF0000"},{type:"drain",position:{x:1,y:0,z:3},color:"#404040"},...st(0,0,10,4,4,"#505050"),{type:"locker",position:{x:1,y:0,z:11},color:"#FF0000"},{type:"locker",position:{x:1,y:1,z:11},color:"#FF0000"},{type:"tank",position:{x:2,y:0,z:12},color:"#FFFF00"},{type:"tank",position:{x:2,y:1,z:12},color:"#FFFF00"},{type:"cylinder",position:{x:1,y:0,z:12},color:"#B22222"},{type:"cabinet",position:{x:3,y:0,z:11},color:"#FFFFFF"},{type:"cross",position:{x:3,y:1,z:11},color:"#FF0000"},{type:"bench",position:{x:3,y:0,z:12},color:"#FF8C00"},{type:"pillar4",position:{x:14,y:0,z:7},color:"#C0C0C0"},{type:"pillar4",position:{x:14,y:1,z:7},color:"#C0C0C0"},{type:"pillar4",position:{x:14,y:2,z:7},color:"#C0C0C0"},{type:"pillar4",position:{x:14,y:3,z:7},color:"#C0C0C0"},{type:"cone",position:{x:14,y:4,z:7},color:"#FF6600",rotation:{x:0,y:0,z:90}},{type:"sphere",position:{x:8,y:0,z:0},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:3}},{type:"sphere",position:{x:9,y:0,z:0},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:3}},{type:"sphere",position:{x:8,y:0,z:1},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1,radius:2}},{type:"sphere",position:{x:9,y:0,z:1},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1,radius:2}},{type:"pillar",position:{x:4,y:0,z:0},color:"#404040"},{type:"pillar",position:{x:4,y:1,z:0},color:"#404040"},{type:"pillar",position:{x:4,y:2,z:0},color:"#404040"},{type:"spotlight",position:{x:4,y:3,z:0},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:2,radius:6}},{type:"pillar",position:{x:13,y:0,z:0},color:"#404040"},{type:"pillar",position:{x:13,y:1,z:0},color:"#404040"},{type:"pillar",position:{x:13,y:2,z:0},color:"#404040"},{type:"spotlight",position:{x:13,y:3,z:0},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:2,radius:6}},...Et(4,0,12,10,"X","barrier","#FF0000"),...Et(14,0,2,10,"Z","barrier","#FF0000"),{type:"cube",position:{x:14,y:0,z:10},color:"#FFD700"},{type:"seat",position:{x:14,y:1,z:10},color:"#2F2F2F"},{type:"crate",position:{x:14,y:0,z:11},color:"#4682B4"},{type:"crate",position:{x:14,y:0,z:12},color:"#B22222"}]},highway:{name:"Highway Interchange",category:"infrastructure",description:"Elevated highway with exit ramp, signage, lighting, and sound barriers",blocks:[...st(0,0,0,24,16,"#3D5C3D"),...st(2,0,6,20,4,"#2F2F2F"),...Et(4,0,8,16,"X","slab","#FFFFFF"),{type:"column",position:{x:4,y:0,z:2},color:"#808080"},{type:"column",position:{x:4,y:1,z:2},color:"#808080"},{type:"column",position:{x:4,y:2,z:2},color:"#808080"},{type:"column",position:{x:4,y:3,z:2},color:"#808080"},{type:"column",position:{x:4,y:0,z:13},color:"#808080"},{type:"column",position:{x:4,y:1,z:13},color:"#808080"},{type:"column",position:{x:4,y:2,z:13},color:"#808080"},{type:"column",position:{x:4,y:3,z:13},color:"#808080"},{type:"column",position:{x:11,y:0,z:2},color:"#808080"},{type:"column",position:{x:11,y:1,z:2},color:"#808080"},{type:"column",position:{x:11,y:2,z:2},color:"#808080"},{type:"column",position:{x:11,y:3,z:2},color:"#808080"},{type:"column",position:{x:11,y:0,z:13},color:"#808080"},{type:"column",position:{x:11,y:1,z:13},color:"#808080"},{type:"column",position:{x:11,y:2,z:13},color:"#808080"},{type:"column",position:{x:11,y:3,z:13},color:"#808080"},{type:"column",position:{x:18,y:0,z:2},color:"#808080"},{type:"column",position:{x:18,y:1,z:2},color:"#808080"},{type:"column",position:{x:18,y:2,z:2},color:"#808080"},{type:"column",position:{x:18,y:3,z:2},color:"#808080"},{type:"column",position:{x:18,y:0,z:13},color:"#808080"},{type:"column",position:{x:18,y:1,z:13},color:"#808080"},{type:"column",position:{x:18,y:2,z:13},color:"#808080"},{type:"column",position:{x:18,y:3,z:13},color:"#808080"},...st(0,4,0,24,6,"#2A2A2A"),...st(0,4,10,24,6,"#2A2A2A"),...st(0,4,6,24,4,"#404040"),{type:"slab",position:{x:2,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:4,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:6,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:8,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:10,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:12,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:14,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:16,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:18,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:20,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:22,y:4,z:2},color:"#FFFFFF"},{type:"slab",position:{x:2,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:4,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:6,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:8,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:10,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:12,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:14,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:16,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:18,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:20,y:4,z:13},color:"#FFFFFF"},{type:"slab",position:{x:22,y:4,z:13},color:"#FFFFFF"},...Et(0,4,5,24,"X","slab","#FFD700"),...Et(0,4,10,24,"X","slab","#FFD700"),...Et(0,4,0,24,"X","barrier","#C0C0C0"),...Et(0,4,15,24,"X","barrier","#C0C0C0"),...Et(0,4,6,24,"X","barrier","#C0C0C0"),...Et(0,4,9,24,"X","barrier","#C0C0C0"),...st(16,4,16,4,4,"#2A2A2A"),...st(18,3,18,4,4,"#2A2A2A"),...st(20,2,20,4,4,"#2A2A2A"),...st(20,1,22,4,4,"#2A2A2A"),...Et(16,4,19,4,"X","barrier","#C0C0C0"),...Et(18,3,21,4,"X","barrier","#C0C0C0"),...Et(20,2,23,4,"X","barrier","#C0C0C0"),{type:"column",position:{x:19,y:0,z:19},color:"#808080"},{type:"column",position:{x:19,y:1,z:19},color:"#808080"},{type:"column",position:{x:19,y:2,z:19},color:"#808080"},{type:"column",position:{x:8,y:4,z:-1},color:"#2F4F2F"},{type:"column",position:{x:8,y:5,z:-1},color:"#2F4F2F"},{type:"column",position:{x:8,y:6,z:-1},color:"#2F4F2F"},{type:"column",position:{x:8,y:7,z:-1},color:"#2F4F2F"},{type:"column",position:{x:8,y:4,z:16},color:"#2F4F2F"},{type:"column",position:{x:8,y:5,z:16},color:"#2F4F2F"},{type:"column",position:{x:8,y:6,z:16},color:"#2F4F2F"},{type:"column",position:{x:8,y:7,z:16},color:"#2F4F2F"},...Et(8,7,0,16,"Z","iBeam","#2F4F2F"),{type:"sign",position:{x:8,y:6,z:3},color:"#006400"},{type:"sign",position:{x:8,y:6,z:4},color:"#006400"},{type:"sign",position:{x:8,y:6,z:12},color:"#006400"},{type:"sign",position:{x:8,y:6,z:13},color:"#006400"},{type:"sign",position:{x:14,y:5,z:15},color:"#228B22"},{type:"pillar4",position:{x:1,y:4,z:0},color:"#FFFFFF"},{type:"sign",position:{x:1,y:5,z:0},color:"#228B22"},{type:"pillar4",position:{x:3,y:4,z:7},color:"#404040"},{type:"pillar4",position:{x:3,y:5,z:7},color:"#404040"},{type:"pillar4",position:{x:3,y:6,z:7},color:"#404040"},{type:"lightFixture",position:{x:3,y:7,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFCC",intensity:1.5,radius:6}},{type:"pillar4",position:{x:10,y:4,z:7},color:"#404040"},{type:"pillar4",position:{x:10,y:5,z:7},color:"#404040"},{type:"pillar4",position:{x:10,y:6,z:7},color:"#404040"},{type:"lightFixture",position:{x:10,y:7,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFCC",intensity:1.5,radius:6}},{type:"pillar4",position:{x:17,y:4,z:7},color:"#404040"},{type:"pillar4",position:{x:17,y:5,z:7},color:"#404040"},{type:"pillar4",position:{x:17,y:6,z:7},color:"#404040"},{type:"lightFixture",position:{x:17,y:7,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFCC",intensity:1.5,radius:6}},{type:"post",position:{x:0,y:0,z:16},color:"#606060"},{type:"post",position:{x:0,y:1,z:16},color:"#606060"},{type:"post",position:{x:0,y:2,z:16},color:"#606060"},{type:"post",position:{x:0,y:3,z:16},color:"#606060"},{type:"post",position:{x:4,y:0,z:16},color:"#606060"},{type:"post",position:{x:4,y:1,z:16},color:"#606060"},{type:"post",position:{x:4,y:2,z:16},color:"#606060"},{type:"post",position:{x:4,y:3,z:16},color:"#606060"},{type:"post",position:{x:8,y:0,z:16},color:"#606060"},{type:"post",position:{x:8,y:1,z:16},color:"#606060"},{type:"post",position:{x:8,y:2,z:16},color:"#606060"},{type:"post",position:{x:8,y:3,z:16},color:"#606060"},{type:"post",position:{x:12,y:0,z:16},color:"#606060"},{type:"post",position:{x:12,y:1,z:16},color:"#606060"},{type:"post",position:{x:12,y:2,z:16},color:"#606060"},{type:"post",position:{x:12,y:3,z:16},color:"#606060"},{type:"post",position:{x:15,y:0,z:16},color:"#606060"},{type:"post",position:{x:15,y:1,z:16},color:"#606060"},{type:"post",position:{x:15,y:2,z:16},color:"#606060"},{type:"post",position:{x:15,y:3,z:16},color:"#606060"},...Et(0,4,16,16,"X","panel","#A0A0A0"),...Et(0,5,16,16,"X","panel","#909090"),...Et(0,6,16,16,"X","panel","#808080"),{type:"pillar4",position:{x:6,y:4,z:0},color:"#4169E1"},{type:"powerBox",position:{x:6,y:5,z:0},color:"#4169E1"},{type:"locker",position:{x:12,y:4,z:0},color:"#FF0000"},{type:"beamZ",position:{x:8,y:3,z:6},color:"#404040"},{type:"beamZ",position:{x:8,y:3,z:7},color:"#404040"},{type:"beamZ",position:{x:8,y:3,z:8},color:"#404040"},{type:"lightFixture",position:{x:8,y:3,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:.8,radius:4}},{type:"beamZ",position:{x:14,y:3,z:6},color:"#404040"},{type:"beamZ",position:{x:14,y:3,z:7},color:"#404040"},{type:"beamZ",position:{x:14,y:3,z:8},color:"#404040"},{type:"lightFixture",position:{x:14,y:3,z:7},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFEE",intensity:.8,radius:4}},{type:"grate",position:{x:6,y:0,z:7},color:"#2F2F2F"},{type:"grate",position:{x:12,y:0,z:7},color:"#2F2F2F"},{type:"grate",position:{x:18,y:0,z:7},color:"#2F2F2F"}]},harbor:{name:"Harbor",category:"infrastructure",description:"Busy shipping harbor with crane, warehouse, lighthouse, boat, and cargo containers",blocks:[...st(0,-1,0,16,6,"#1E4D6B"),...st(0,0,0,16,1,"#1E90FF"),...st(0,0,6,16,8,"#696969"),...Et(0,0,6,16,"X","ledge","#505050"),...st(0,0,6,6,3,"#8B4513"),...st(6,0,2,4,4,"#654321"),{type:"pillar",position:{x:6,y:-1,z:2},color:"#3A2A1A"},{type:"pillar",position:{x:9,y:-1,z:2},color:"#3A2A1A"},{type:"pillar",position:{x:6,y:-1,z:5},color:"#3A2A1A"},{type:"pillar",position:{x:9,y:-1,z:5},color:"#3A2A1A"},{type:"beamX",position:{x:2,y:0,z:8},color:"#505050"},{type:"beamX",position:{x:3,y:0,z:8},color:"#505050"},{type:"beamX",position:{x:4,y:0,z:8},color:"#505050"},{type:"beamX",position:{x:2,y:0,z:11},color:"#505050"},{type:"beamX",position:{x:3,y:0,z:11},color:"#505050"},{type:"beamX",position:{x:4,y:0,z:11},color:"#505050"},{type:"iBeam",position:{x:2,y:1,z:8},color:"#FFD700"},{type:"iBeam",position:{x:2,y:2,z:8},color:"#FFD700"},{type:"iBeam",position:{x:2,y:3,z:8},color:"#FFD700"},{type:"iBeam",position:{x:2,y:4,z:8},color:"#FFD700"},{type:"iBeam",position:{x:2,y:5,z:8},color:"#FFD700"},{type:"iBeam",position:{x:4,y:1,z:8},color:"#FFD700"},{type:"iBeam",position:{x:4,y:2,z:8},color:"#FFD700"},{type:"iBeam",position:{x:4,y:3,z:8},color:"#FFD700"},{type:"iBeam",position:{x:4,y:4,z:8},color:"#FFD700"},{type:"iBeam",position:{x:4,y:5,z:8},color:"#FFD700"},{type:"iBeam",position:{x:2,y:1,z:11},color:"#FFD700"},{type:"iBeam",position:{x:2,y:2,z:11},color:"#FFD700"},{type:"iBeam",position:{x:2,y:3,z:11},color:"#FFD700"},{type:"iBeam",position:{x:2,y:4,z:11},color:"#FFD700"},{type:"iBeam",position:{x:2,y:5,z:11},color:"#FFD700"},{type:"iBeam",position:{x:4,y:1,z:11},color:"#FFD700"},{type:"iBeam",position:{x:4,y:2,z:11},color:"#FFD700"},{type:"iBeam",position:{x:4,y:3,z:11},color:"#FFD700"},{type:"iBeam",position:{x:4,y:4,z:11},color:"#FFD700"},{type:"iBeam",position:{x:4,y:5,z:11},color:"#FFD700"},{type:"beamZ",position:{x:2,y:6,z:8},color:"#FFD700"},{type:"beamZ",position:{x:2,y:6,z:9},color:"#FFD700"},{type:"beamZ",position:{x:2,y:6,z:10},color:"#FFD700"},{type:"beamZ",position:{x:2,y:6,z:11},color:"#FFD700"},{type:"beamZ",position:{x:4,y:6,z:8},color:"#FFD700"},{type:"beamZ",position:{x:4,y:6,z:9},color:"#FFD700"},{type:"beamZ",position:{x:4,y:6,z:10},color:"#FFD700"},{type:"beamZ",position:{x:4,y:6,z:11},color:"#FFD700"},{type:"beamX",position:{x:2,y:6,z:9},color:"#FF8C00"},{type:"beamX",position:{x:3,y:6,z:9},color:"#FF8C00"},{type:"beamX",position:{x:4,y:6,z:9},color:"#FF8C00"},{type:"beamZ",position:{x:3,y:6,z:7},color:"#FF8C00"},{type:"beamZ",position:{x:3,y:6,z:6},color:"#FF8C00"},{type:"beamZ",position:{x:3,y:6,z:5},color:"#FF8C00"},{type:"beamZ",position:{x:3,y:6,z:4},color:"#FF8C00"},{type:"chain",position:{x:3,y:5,z:5},color:"#404040"},{type:"chain",position:{x:3,y:4,z:5},color:"#404040"},{type:"chain",position:{x:3,y:3,z:5},color:"#404040"},{type:"valve",position:{x:3,y:2,z:5},color:"#808080"},...st(10,0,7,6,6,"#505050"),...ne(10,1,7,6,3,"#A0522D"),...ne(10,1,12,6,3,"#A0522D"),...Wt(10,1,8,4,3,"#A0522D"),...Wt(15,1,8,4,3,"#A0522D"),...st(10,4,7,6,6,"#8B4513"),{type:"doorFrame",position:{x:12,y:1,z:7},color:"#8B4513"},{type:"doorFrame",position:{x:13,y:1,z:7},color:"#8B4513"},{type:"doorFrame",position:{x:12,y:2,z:7},color:"#8B4513"},{type:"doorFrame",position:{x:13,y:2,z:7},color:"#8B4513"},{type:"windowFrame",position:{x:11,y:2,z:7},color:"#4682B4"},{type:"windowFrame",position:{x:14,y:2,z:7},color:"#4682B4"},{type:"sign",position:{x:12,y:3,z:7},color:"#FFD700"},{type:"cylinder",position:{x:0,y:0,z:0},color:"#F5F5F5"},{type:"cylinder",position:{x:0,y:1,z:0},color:"#DC143C"},{type:"cylinder",position:{x:0,y:2,z:0},color:"#F5F5F5"},{type:"cylinder",position:{x:0,y:3,z:0},color:"#DC143C"},{type:"cylinder",position:{x:0,y:4,z:0},color:"#F5F5F5"},{type:"windowFrame",position:{x:0,y:5,z:0},color:"#1A1A1A"},{type:"bulb",position:{x:0,y:5,z:0},color:"#FFFF00",emissive:{enabled:!0,color:"#FFFF00",intensity:3,radius:8}},{type:"dome",position:{x:0,y:6,z:0},color:"#DC143C"},{type:"hull",position:{x:12,y:0,z:2},color:"#F5F5F5"},{type:"hull",position:{x:13,y:0,z:2},color:"#F5F5F5"},{type:"hull",position:{x:14,y:0,z:2},color:"#F5F5F5"},{type:"cube",position:{x:13,y:1,z:2},color:"#E6E6FA"},{type:"pillar2",position:{x:12,y:1,z:2},color:"#8B4513"},{type:"pillar2",position:{x:12,y:2,z:2},color:"#8B4513"},{type:"crateLarge",position:{x:6,y:0,z:7},color:"#B22222"},{type:"crateLarge",position:{x:6,y:1,z:7},color:"#B22222"},{type:"crateLarge",position:{x:6,y:0,z:9},color:"#4169E1"},{type:"crateLarge",position:{x:6,y:0,z:11},color:"#228B22"},{type:"crateLarge",position:{x:6,y:1,z:11},color:"#FFD700"},{type:"crate",position:{x:8,y:0,z:8},color:"#8B4513"},{type:"crate",position:{x:8,y:0,z:9},color:"#A0522D"},{type:"crate",position:{x:8,y:1,z:8},color:"#CD853F"},{type:"barrel",position:{x:8,y:0,z:10},color:"#2F4F4F"},{type:"barrel",position:{x:8,y:0,z:11},color:"#006400"},{type:"bollard",position:{x:0,y:0,z:6},color:"#404040"},{type:"bollard",position:{x:4,y:0,z:6},color:"#404040"},{type:"bollard",position:{x:8,y:0,z:6},color:"#404040"},{type:"bollard",position:{x:12,y:0,z:6},color:"#404040"},{type:"bollard",position:{x:6,y:0,z:2},color:"#404040"},{type:"bollard",position:{x:9,y:0,z:2},color:"#404040"},{type:"pillar",position:{x:2,y:0,z:12},color:"#404040"},{type:"pillar",position:{x:2,y:1,z:12},color:"#404040"},{type:"pillar",position:{x:2,y:2,z:12},color:"#404040"},{type:"spotlight",position:{x:2,y:3,z:12},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:5}},{type:"pillar",position:{x:10,y:0,z:12},color:"#404040"},{type:"pillar",position:{x:10,y:1,z:12},color:"#404040"},{type:"pillar",position:{x:10,y:2,z:12},color:"#404040"},{type:"spotlight",position:{x:10,y:3,z:12},color:"#FFFFFF",emissive:{enabled:!0,color:"#FFFFFF",intensity:1.5,radius:5}},{type:"torus",position:{x:5,y:1,z:6},color:"#FF4500"},{type:"railing",position:{x:6,y:0,z:2},color:"#FFD700"},{type:"railing",position:{x:7,y:0,z:2},color:"#FFD700"},{type:"railing",position:{x:8,y:0,z:2},color:"#FFD700"},{type:"railing",position:{x:9,y:0,z:2},color:"#FFD700"},{type:"wheel",position:{x:9,y:0,z:9},color:"#1A1A1A"},{type:"seat",position:{x:9,y:0,z:10},color:"#FFD700"}]},oilDerrick:{name:"Oil Derrick",category:"oil",description:"Classic oil drilling tower with lattice structure and drilling equipment",blocks:[...st(0,0,0,8,7,"#8B7355"),...st(2,0,1,4,4,"#606060"),{type:"iBeam",position:{x:2,y:1,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:2,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:3,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:4,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:5,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:6,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:7,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:1,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:2,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:3,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:4,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:5,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:6,z:1},color:"#8B0000"},{type:"iBeam",position:{x:5,y:7,z:1},color:"#8B0000"},{type:"iBeam",position:{x:2,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:3,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:4,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:5,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:6,z:4},color:"#8B0000"},{type:"iBeam",position:{x:2,y:7,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:3,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:4,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:5,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:6,z:4},color:"#8B0000"},{type:"iBeam",position:{x:5,y:7,z:4},color:"#8B0000"},{type:"beamX",position:{x:3,y:2,z:1},color:"#B22222"},{type:"beamX",position:{x:4,y:2,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:4,z:1},color:"#B22222"},{type:"beamX",position:{x:4,y:4,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:6,z:1},color:"#B22222"},{type:"beamX",position:{x:4,y:6,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:2,z:4},color:"#B22222"},{type:"beamX",position:{x:4,y:2,z:4},color:"#B22222"},{type:"beamX",position:{x:3,y:4,z:4},color:"#B22222"},{type:"beamX",position:{x:4,y:4,z:4},color:"#B22222"},{type:"beamX",position:{x:3,y:6,z:4},color:"#B22222"},{type:"beamX",position:{x:4,y:6,z:4},color:"#B22222"},{type:"beamZ",position:{x:2,y:2,z:2},color:"#B22222"},{type:"beamZ",position:{x:2,y:2,z:3},color:"#B22222"},{type:"beamZ",position:{x:2,y:4,z:2},color:"#B22222"},{type:"beamZ",position:{x:2,y:4,z:3},color:"#B22222"},{type:"beamZ",position:{x:2,y:6,z:2},color:"#B22222"},{type:"beamZ",position:{x:2,y:6,z:3},color:"#B22222"},{type:"beamZ",position:{x:5,y:2,z:2},color:"#B22222"},{type:"beamZ",position:{x:5,y:2,z:3},color:"#B22222"},{type:"beamZ",position:{x:5,y:4,z:2},color:"#B22222"},{type:"beamZ",position:{x:5,y:4,z:3},color:"#B22222"},{type:"beamZ",position:{x:5,y:6,z:2},color:"#B22222"},{type:"beamZ",position:{x:5,y:6,z:3},color:"#B22222"},{type:"crossBeam",position:{x:3,y:1,z:1},color:"#A52A2A"},{type:"crossBeam",position:{x:4,y:3,z:1},color:"#A52A2A"},{type:"crossBeam",position:{x:3,y:5,z:1},color:"#A52A2A"},{type:"crossBeam",position:{x:3,y:1,z:4},color:"#A52A2A"},{type:"crossBeam",position:{x:4,y:3,z:4},color:"#A52A2A"},{type:"crossBeam",position:{x:3,y:5,z:4},color:"#A52A2A"},{type:"grateFloor",position:{x:3,y:8,z:2},color:"#404040"},{type:"grateFloor",position:{x:4,y:8,z:2},color:"#404040"},{type:"grateFloor",position:{x:3,y:8,z:3},color:"#404040"},{type:"grateFloor",position:{x:4,y:8,z:3},color:"#404040"},{type:"cylinder",position:{x:3,y:8,z:2},color:"#505050"},{type:"cylinder",position:{x:4,y:8,z:3},color:"#505050"},{type:"beamZ",position:{x:2,y:5,z:2},color:"#B22222"},{type:"beamZ",position:{x:2,y:5,z:3},color:"#B22222"},{type:"beamZ",position:{x:5,y:5,z:2},color:"#B22222"},{type:"beamZ",position:{x:5,y:5,z:3},color:"#B22222"},{type:"catwalk",position:{x:3,y:5,z:2},color:"#404040"},{type:"catwalk",position:{x:4,y:5,z:2},color:"#404040"},{type:"catwalk",position:{x:3,y:5,z:3},color:"#404040"},{type:"catwalk",position:{x:4,y:5,z:3},color:"#404040"},{type:"railing",position:{x:3,y:5,z:1},color:"#FFD700"},{type:"railing",position:{x:4,y:5,z:1},color:"#FFD700"},{type:"wellHead",position:{x:3,y:0,z:2},color:"#B22222"},{type:"wellHead",position:{x:4,y:0,z:2},color:"#B22222"},{type:"wellHead",position:{x:3,y:0,z:3},color:"#B22222"},{type:"wellHead",position:{x:4,y:0,z:3},color:"#B22222"},{type:"pipeY",position:{x:3,y:1,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:2,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:3,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:4,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:5,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:6,z:2},color:"#708090"},{type:"pipeY",position:{x:3,y:7,z:2},color:"#708090"},...st(0,0,1,2,3,"#505050"),{type:"cube",position:{x:0,y:1,z:1},color:"#404040"},{type:"cube",position:{x:1,y:1,z:1},color:"#404040"},{type:"cube",position:{x:0,y:1,z:2},color:"#404040"},{type:"cube",position:{x:1,y:1,z:2},color:"#404040"},{type:"cube",position:{x:0,y:1,z:3},color:"#404040"},{type:"cube",position:{x:1,y:1,z:3},color:"#404040"},{type:"slab",position:{x:0,y:2,z:1},color:"#303030"},{type:"slab",position:{x:1,y:2,z:1},color:"#303030"},{type:"slab",position:{x:0,y:2,z:2},color:"#303030"},{type:"slab",position:{x:1,y:2,z:2},color:"#303030"},{type:"slab",position:{x:0,y:2,z:3},color:"#303030"},{type:"slab",position:{x:1,y:2,z:3},color:"#303030"},{type:"pipeY",position:{x:0,y:2,z:1},color:"#2F2F2F"},{type:"pipeY",position:{x:0,y:3,z:1},color:"#2F2F2F"},{type:"tank",position:{x:6,y:0,z:1},color:"#2F4F4F"},{type:"tank",position:{x:6,y:1,z:1},color:"#2F4F4F"},{type:"tank",position:{x:7,y:0,z:1},color:"#2F4F4F"},{type:"tank",position:{x:7,y:1,z:1},color:"#2F4F4F"},{type:"tank",position:{x:6,y:0,z:3},color:"#4A6B4A"},{type:"tank",position:{x:6,y:1,z:3},color:"#4A6B4A"},{type:"tank",position:{x:7,y:0,z:3},color:"#4A6B4A"},{type:"tank",position:{x:7,y:1,z:3},color:"#4A6B4A"},{type:"pipeX",position:{x:5,y:0,z:1},color:"#708090"},{type:"pipeX",position:{x:5,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:5,y:0,z:2},color:"#708090"},{type:"catwalk",position:{x:0,y:0,z:5},color:"#606060"},{type:"catwalk",position:{x:1,y:0,z:5},color:"#606060"},{type:"catwalk",position:{x:2,y:0,z:5},color:"#606060"},{type:"catwalk",position:{x:3,y:0,z:5},color:"#606060"},{type:"pipeX",position:{x:0,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:1,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:2,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:3,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:0,y:0,z:6},color:"#708090"},{type:"pipeX",position:{x:1,y:0,z:6},color:"#708090"},{type:"pipeX",position:{x:2,y:0,z:6},color:"#708090"},{type:"pipeX",position:{x:3,y:0,z:6},color:"#708090"},{type:"valve",position:{x:2,y:1,z:2},color:"#B22222"},{type:"valve",position:{x:2,y:1,z:3},color:"#B22222"},{type:"valve",position:{x:5,y:0,z:2},color:"#FF4500"},{type:"barrier",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:7,y:0,z:0},color:"#FFD700"},{type:"trafficCone",position:{x:6,y:0,z:5},color:"#FF6600"},{type:"trafficCone",position:{x:7,y:0,z:5},color:"#FF6600"},{type:"spotlight",position:{x:2,y:4,z:1},color:"#FFFF99"},{type:"spotlight",position:{x:5,y:4,z:4},color:"#FFFF99"}]},pumpJackStation:{name:"Pump Jack Station",category:"oil",description:"Oil production site with multiple pump jacks, storage, and control systems",blocks:[...st(0,0,0,10,8,"#8B7355"),{type:"slab",position:{x:1,y:0,z:1},color:"#606060"},{type:"slab",position:{x:2,y:0,z:1},color:"#606060"},{type:"slab",position:{x:1,y:0,z:2},color:"#606060"},{type:"slab",position:{x:2,y:0,z:2},color:"#606060"},{type:"pumpJack",position:{x:1,y:0,z:1},color:"#CD5C5C"},{type:"wellHead",position:{x:2,y:0,z:2},color:"#505050"},{type:"slab",position:{x:1,y:0,z:5},color:"#606060"},{type:"slab",position:{x:2,y:0,z:5},color:"#606060"},{type:"slab",position:{x:1,y:0,z:6},color:"#606060"},{type:"slab",position:{x:2,y:0,z:6},color:"#606060"},{type:"pumpJack",position:{x:1,y:0,z:5},color:"#B22222"},{type:"wellHead",position:{x:2,y:0,z:6},color:"#505050"},{type:"oilTankSmall",position:{x:7,y:0,z:1},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:8,y:0,z:1},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:9,y:0,z:1},color:"#4A6B4A"},{type:"oilTankSmall",position:{x:7,y:0,z:3},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:8,y:0,z:3},color:"#2F4F4F"},{type:"tank",position:{x:9,y:0,z:3},color:"#4682B4"},{type:"tank",position:{x:9,y:1,z:3},color:"#4682B4"},{type:"oilTank",position:{x:5,y:0,z:2},color:"#708090"},{type:"pipeY",position:{x:5,y:1,z:2},color:"#505050"},{type:"pipeX",position:{x:3,y:0,z:2},color:"#708090"},{type:"pipeX",position:{x:4,y:0,z:2},color:"#708090"},{type:"valve",position:{x:3,y:0,z:2},color:"#B22222"},{type:"pipeX",position:{x:3,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:4,y:0,z:5},color:"#708090"},{type:"pipeZ",position:{x:4,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:4,y:0,z:4},color:"#708090"},{type:"valve",position:{x:3,y:0,z:5},color:"#B22222"},{type:"pipeX",position:{x:6,y:0,z:2},color:"#708090"},{type:"pipeZ",position:{x:6,y:0,z:1},color:"#708090"},{type:"valve",position:{x:6,y:0,z:2},color:"#FF4500"},{type:"cube",position:{x:7,y:0,z:5},color:"#F5F5DC"},{type:"cube",position:{x:8,y:0,z:5},color:"#F5F5DC"},{type:"cube",position:{x:7,y:0,z:6},color:"#F5F5DC"},{type:"cube",position:{x:8,y:0,z:6},color:"#F5F5DC"},{type:"cube",position:{x:7,y:1,z:5},color:"#F5F5DC"},{type:"cube",position:{x:8,y:1,z:5},color:"#F5F5DC"},{type:"cube",position:{x:7,y:1,z:6},color:"#F5F5DC"},{type:"cube",position:{x:8,y:1,z:6},color:"#F5F5DC"},{type:"slab",position:{x:7,y:2,z:5},color:"#696969"},{type:"slab",position:{x:8,y:2,z:5},color:"#696969"},{type:"slab",position:{x:7,y:2,z:6},color:"#696969"},{type:"slab",position:{x:8,y:2,z:6},color:"#696969"},{type:"doorFrame",position:{x:7,y:0,z:5},color:"#8B4513"},{type:"windowFrame",position:{x:8,y:1,z:5},color:"#8B4513"},{type:"acUnit",position:{x:7,y:2,z:6},color:"#C0C0C0"},{type:"transformer",position:{x:5,y:0,z:6},color:"#505050"},{type:"powerBox",position:{x:5,y:0,z:5},color:"#2F4F4F"},{type:"conduitX",position:{x:4,y:0,z:6},color:"#505050"},{type:"conduitX",position:{x:3,y:0,z:6},color:"#505050"},{type:"slab",position:{x:5,y:0,z:0},color:"#606060"},{type:"valve",position:{x:5,y:0,z:0},color:"#FFD700"},{type:"pipeX",position:{x:6,y:0,z:0},color:"#708090"},{type:"pipeX",position:{x:7,y:0,z:0},color:"#708090"},{type:"fence",position:{x:0,y:0,z:0},color:"#8B8B8B"},{type:"fence",position:{x:1,y:0,z:0},color:"#8B8B8B"},{type:"fence",position:{x:2,y:0,z:0},color:"#8B8B8B"},{type:"fence",position:{x:3,y:0,z:0},color:"#8B8B8B"},{type:"fence",position:{x:4,y:0,z:0},color:"#8B8B8B"},{type:"fence",position:{x:0,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:1,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:2,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:3,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:4,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:5,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:6,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:7,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:8,y:0,z:7},color:"#8B8B8B"},{type:"fence",position:{x:9,y:0,z:7},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:1},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:2},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:3},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:4},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:5},color:"#8B8B8B"},{type:"fenceZ",position:{x:0,y:0,z:6},color:"#8B8B8B"},{type:"fenceZ",position:{x:9,y:0,z:5},color:"#8B8B8B"},{type:"fenceZ",position:{x:9,y:0,z:6},color:"#8B8B8B"},{type:"barrier",position:{x:8,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:9,y:0,z:0},color:"#FFD700"},{type:"trafficCone",position:{x:3,y:0,z:3},color:"#FF6600"},{type:"trafficCone",position:{x:3,y:0,z:4},color:"#FF6600"},{type:"sign",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"oilBarrel",position:{x:9,y:0,z:5},color:"#1a1a1a"},{type:"oilBarrel",position:{x:9,y:0,z:6},color:"#B22222"}]},oilStorageFacility:{name:"Oil Storage Facility",category:"oil",description:"Tank farm with containment, truck loading, and fire suppression systems",blocks:[...st(0,0,0,14,12,"#707070"),{type:"slab",position:{x:1,y:0,z:1},color:"#505050"},{type:"slab",position:{x:2,y:0,z:1},color:"#505050"},{type:"slab",position:{x:3,y:0,z:1},color:"#505050"},{type:"slab",position:{x:4,y:0,z:1},color:"#505050"},{type:"slab",position:{x:1,y:0,z:4},color:"#505050"},{type:"slab",position:{x:2,y:0,z:4},color:"#505050"},{type:"slab",position:{x:3,y:0,z:4},color:"#505050"},{type:"slab",position:{x:4,y:0,z:4},color:"#505050"},{type:"oilTank",position:{x:2,y:0,z:2},color:"#1a1a1a"},{type:"oilTank",position:{x:2,y:0,z:3},color:"#1a1a1a"},{type:"slab",position:{x:6,y:0,z:1},color:"#505050"},{type:"slab",position:{x:7,y:0,z:1},color:"#505050"},{type:"slab",position:{x:8,y:0,z:1},color:"#505050"},{type:"slab",position:{x:6,y:0,z:4},color:"#505050"},{type:"slab",position:{x:7,y:0,z:4},color:"#505050"},{type:"slab",position:{x:8,y:0,z:4},color:"#505050"},{type:"tank",position:{x:6,y:0,z:2},color:"#E8E8E8"},{type:"tank",position:{x:6,y:1,z:2},color:"#E8E8E8"},{type:"tank",position:{x:6,y:2,z:2},color:"#E8E8E8"},{type:"tank",position:{x:8,y:0,z:2},color:"#E8E8E8"},{type:"tank",position:{x:8,y:1,z:2},color:"#E8E8E8"},{type:"tank",position:{x:8,y:2,z:2},color:"#E8E8E8"},{type:"tank",position:{x:6,y:0,z:3},color:"#C0C0C0"},{type:"tank",position:{x:6,y:1,z:3},color:"#C0C0C0"},{type:"tank",position:{x:6,y:2,z:3},color:"#C0C0C0"},{type:"tank",position:{x:8,y:0,z:3},color:"#C0C0C0"},{type:"tank",position:{x:8,y:1,z:3},color:"#C0C0C0"},{type:"tank",position:{x:8,y:2,z:3},color:"#C0C0C0"},{type:"stairs",position:{x:7,y:0,z:2},color:"#FFD700"},{type:"stairs",position:{x:7,y:1,z:2},color:"#FFD700"},{type:"oilTankSmall",position:{x:10,y:0,z:1},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:11,y:0,z:1},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:12,y:0,z:1},color:"#4A6B4A"},{type:"oilTankSmall",position:{x:10,y:0,z:3},color:"#4682B4"},{type:"oilTankSmall",position:{x:11,y:0,z:3},color:"#4682B4"},{type:"oilTankSmall",position:{x:12,y:0,z:3},color:"#B8860B"},{type:"pipeX",position:{x:3,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:4,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:5,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:6,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:7,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:9,y:0,z:5},color:"#708090"},{type:"pipeX",position:{x:10,y:0,z:5},color:"#708090"},{type:"pipeZ",position:{x:3,y:0,z:4},color:"#708090"},{type:"pipeZ",position:{x:6,y:0,z:4},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:4},color:"#708090"},{type:"pipeZ",position:{x:10,y:0,z:4},color:"#708090"},{type:"valve",position:{x:3,y:0,z:5},color:"#B22222"},{type:"valve",position:{x:6,y:0,z:5},color:"#B22222"},{type:"valve",position:{x:8,y:0,z:5},color:"#B22222"},{type:"valve",position:{x:10,y:0,z:5},color:"#B22222"},...st(1,0,6,3,2,"#606060"),{type:"cube",position:{x:1,y:1,z:6},color:"#8B8B8B"},{type:"cube",position:{x:2,y:1,z:6},color:"#8B8B8B"},{type:"cube",position:{x:3,y:1,z:6},color:"#8B8B8B"},{type:"cube",position:{x:1,y:1,z:7},color:"#8B8B8B"},{type:"cube",position:{x:2,y:1,z:7},color:"#8B8B8B"},{type:"cube",position:{x:3,y:1,z:7},color:"#8B8B8B"},{type:"slab",position:{x:1,y:2,z:6},color:"#505050"},{type:"slab",position:{x:2,y:2,z:6},color:"#505050"},{type:"slab",position:{x:3,y:2,z:6},color:"#505050"},{type:"slab",position:{x:1,y:2,z:7},color:"#505050"},{type:"slab",position:{x:2,y:2,z:7},color:"#505050"},{type:"slab",position:{x:3,y:2,z:7},color:"#505050"},{type:"doorFrame",position:{x:2,y:1,z:6},color:"#8B4513"},{type:"cylinder",position:{x:1,y:0,z:6},color:"#2F4F4F"},{type:"cylinder",position:{x:3,y:0,z:7},color:"#2F4F4F"},{type:"pipeX",position:{x:0,y:0,z:6},color:"#708090"},{type:"pipeZ",position:{x:2,y:0,z:5},color:"#708090"},...st(1,0,9,6,3,"#404040"),{type:"pipeY",position:{x:2,y:0,z:10},color:"#708090"},{type:"pipeY",position:{x:2,y:1,z:10},color:"#708090"},{type:"pipeElbowXY",position:{x:2,y:2,z:10},color:"#708090"},{type:"pipeY",position:{x:5,y:0,z:10},color:"#708090"},{type:"pipeY",position:{x:5,y:1,z:10},color:"#708090"},{type:"pipeElbowXY",position:{x:5,y:2,z:10},color:"#708090"},{type:"valve",position:{x:2,y:1,z:10},color:"#FFD700"},{type:"valve",position:{x:5,y:1,z:10},color:"#FFD700"},{type:"pillar",position:{x:1,y:0,z:9},color:"#505050"},{type:"pillar",position:{x:1,y:1,z:9},color:"#505050"},{type:"pillar",position:{x:1,y:2,z:9},color:"#505050"},{type:"pillar",position:{x:6,y:0,z:9},color:"#505050"},{type:"pillar",position:{x:6,y:1,z:9},color:"#505050"},{type:"pillar",position:{x:6,y:2,z:9},color:"#505050"},{type:"pillar",position:{x:1,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:1,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:1,y:2,z:11},color:"#505050"},{type:"pillar",position:{x:6,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:6,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:6,y:2,z:11},color:"#505050"},{type:"beamX",position:{x:2,y:3,z:9},color:"#505050"},{type:"beamX",position:{x:3,y:3,z:9},color:"#505050"},{type:"beamX",position:{x:4,y:3,z:9},color:"#505050"},{type:"beamX",position:{x:5,y:3,z:9},color:"#505050"},{type:"beamX",position:{x:2,y:3,z:11},color:"#505050"},{type:"beamX",position:{x:3,y:3,z:11},color:"#505050"},{type:"beamX",position:{x:4,y:3,z:11},color:"#505050"},{type:"beamX",position:{x:5,y:3,z:11},color:"#505050"},...st(10,0,7,4,4,"#808080"),...ae(10,1,7,4,4,"#F5F5DC"),...ae(10,2,7,4,4,"#F5F5DC"),...st(10,3,7,4,4,"#696969"),{type:"doorFrame",position:{x:11,y:1,z:7},color:"#8B4513"},{type:"windowFrame",position:{x:12,y:2,z:7},color:"#8B4513"},{type:"windowFrame",position:{x:10,y:2,z:8},color:"#8B4513"},{type:"windowFrame",position:{x:13,y:2,z:9},color:"#8B4513"},{type:"acUnit",position:{x:12,y:3,z:9},color:"#C0C0C0"},{type:"tank",position:{x:10,y:0,z:5},color:"#B22222"},{type:"tank",position:{x:10,y:1,z:5},color:"#B22222"},{type:"tank",position:{x:10,y:2,z:5},color:"#B22222"},{type:"pipeY",position:{x:4,y:0,z:0},color:"#B22222"},{type:"valve",position:{x:4,y:0,z:0},color:"#FFD700"},{type:"pipeY",position:{x:9,y:0,z:0},color:"#B22222"},{type:"valve",position:{x:9,y:0,z:0},color:"#FFD700"},{type:"pipeY",position:{x:0,y:0,z:5},color:"#B22222"},{type:"pipeY",position:{x:13,y:0,z:5},color:"#B22222"},{type:"barrier",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:13,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:11},color:"#FFD700"},{type:"barrier",position:{x:13,y:0,z:11},color:"#FFD700"},{type:"trafficCone",position:{x:0,y:0,z:9},color:"#FF6600"},{type:"trafficCone",position:{x:0,y:0,z:10},color:"#FF6600"},{type:"trafficCone",position:{x:7,y:0,z:10},color:"#FF6600"},{type:"sign",position:{x:1,y:0,z:0},color:"#FFD700"},{type:"sign",position:{x:12,y:0,z:0},color:"#FFD700"},{type:"transformer",position:{x:12,y:0,z:5},color:"#505050"},{type:"powerBox",position:{x:13,y:0,z:6},color:"#2F4F4F"},{type:"lightFixture",position:{x:5,y:0,z:0},color:"#FFFF99"},{type:"lightFixture",position:{x:8,y:0,z:0},color:"#FFFF99"},{type:"oilBarrel",position:{x:12,y:0,z:10},color:"#1a1a1a"},{type:"oilBarrel",position:{x:13,y:0,z:10},color:"#1a1a1a"},{type:"oilBarrel",position:{x:12,y:0,z:11},color:"#B22222"},{type:"oilBarrel",position:{x:13,y:0,z:11},color:"#4682B4"},{type:"oilBarrel",position:{x:12,y:1,z:10},color:"#1a1a1a"}]},oilFieldSite:{name:"Oil Field Site",category:"oil",description:"Large-scale oil production facility with drilling, pumps, processing and storage",blocks:[...st(0,0,0,18,16,"#8B7355"),...st(0,0,7,4,2,"#404040"),...st(1,0,1,4,4,"#606060"),{type:"iBeam",position:{x:1,y:1,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:2,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:3,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:4,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:5,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:6,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:1,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:2,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:3,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:4,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:5,z:1},color:"#8B0000"},{type:"iBeam",position:{x:4,y:6,z:1},color:"#8B0000"},{type:"iBeam",position:{x:1,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:1,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:1,y:3,z:4},color:"#8B0000"},{type:"iBeam",position:{x:1,y:4,z:4},color:"#8B0000"},{type:"iBeam",position:{x:1,y:5,z:4},color:"#8B0000"},{type:"iBeam",position:{x:1,y:6,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:1,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:2,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:3,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:4,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:5,z:4},color:"#8B0000"},{type:"iBeam",position:{x:4,y:6,z:4},color:"#8B0000"},{type:"beamX",position:{x:2,y:2,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:2,z:1},color:"#B22222"},{type:"beamX",position:{x:2,y:4,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:4,z:1},color:"#B22222"},{type:"beamX",position:{x:2,y:6,z:1},color:"#B22222"},{type:"beamX",position:{x:3,y:6,z:1},color:"#B22222"},{type:"beamX",position:{x:2,y:2,z:4},color:"#B22222"},{type:"beamX",position:{x:3,y:2,z:4},color:"#B22222"},{type:"beamX",position:{x:2,y:4,z:4},color:"#B22222"},{type:"beamX",position:{x:3,y:4,z:4},color:"#B22222"},{type:"beamX",position:{x:2,y:6,z:4},color:"#B22222"},{type:"beamX",position:{x:3,y:6,z:4},color:"#B22222"},{type:"beamZ",position:{x:1,y:2,z:2},color:"#B22222"},{type:"beamZ",position:{x:1,y:2,z:3},color:"#B22222"},{type:"beamZ",position:{x:1,y:4,z:2},color:"#B22222"},{type:"beamZ",position:{x:1,y:4,z:3},color:"#B22222"},{type:"beamZ",position:{x:4,y:2,z:2},color:"#B22222"},{type:"beamZ",position:{x:4,y:2,z:3},color:"#B22222"},{type:"beamZ",position:{x:4,y:4,z:2},color:"#B22222"},{type:"beamZ",position:{x:4,y:4,z:3},color:"#B22222"},{type:"grateFloor",position:{x:2,y:7,z:2},color:"#404040"},{type:"grateFloor",position:{x:3,y:7,z:2},color:"#404040"},{type:"grateFloor",position:{x:2,y:7,z:3},color:"#404040"},{type:"grateFloor",position:{x:3,y:7,z:3},color:"#404040"},{type:"wellHead",position:{x:2,y:0,z:2},color:"#B22222"},{type:"wellHead",position:{x:3,y:0,z:2},color:"#B22222"},{type:"wellHead",position:{x:2,y:0,z:3},color:"#B22222"},{type:"wellHead",position:{x:3,y:0,z:3},color:"#B22222"},{type:"pipeY",position:{x:2,y:1,z:2},color:"#708090"},{type:"pipeY",position:{x:2,y:2,z:2},color:"#708090"},{type:"pipeY",position:{x:2,y:3,z:2},color:"#708090"},{type:"pipeY",position:{x:2,y:4,z:2},color:"#708090"},{type:"pipeY",position:{x:2,y:5,z:2},color:"#708090"},{type:"pipeY",position:{x:2,y:6,z:2},color:"#708090"},{type:"tank",position:{x:0,y:0,z:5},color:"#2F4F4F"},{type:"tank",position:{x:0,y:1,z:5},color:"#2F4F4F"},{type:"tank",position:{x:0,y:0,z:6},color:"#4A6B4A"},{type:"tank",position:{x:0,y:1,z:6},color:"#4A6B4A"},{type:"slab",position:{x:6,y:0,z:2},color:"#606060"},{type:"slab",position:{x:7,y:0,z:2},color:"#606060"},{type:"pumpJack",position:{x:6,y:0,z:2},color:"#CD5C5C"},{type:"wellHead",position:{x:7,y:0,z:2},color:"#505050"},{type:"slab",position:{x:6,y:0,z:5},color:"#606060"},{type:"slab",position:{x:7,y:0,z:5},color:"#606060"},{type:"pumpJack",position:{x:6,y:0,z:5},color:"#B22222"},{type:"wellHead",position:{x:7,y:0,z:5},color:"#505050"},{type:"slab",position:{x:6,y:0,z:10},color:"#606060"},{type:"slab",position:{x:7,y:0,z:10},color:"#606060"},{type:"pumpJack",position:{x:6,y:0,z:10},color:"#CD5C5C"},{type:"wellHead",position:{x:7,y:0,z:10},color:"#505050"},{type:"slab",position:{x:6,y:0,z:13},color:"#606060"},{type:"slab",position:{x:7,y:0,z:13},color:"#606060"},{type:"pumpJack",position:{x:6,y:0,z:13},color:"#B22222"},{type:"wellHead",position:{x:7,y:0,z:13},color:"#505050"},...st(9,0,1,4,5,"#707070"),{type:"oilTank",position:{x:10,y:0,z:2},color:"#708090"},{type:"oilTank",position:{x:10,y:0,z:4},color:"#708090"},{type:"tank",position:{x:12,y:0,z:2},color:"#505050"},{type:"tank",position:{x:12,y:1,z:2},color:"#505050"},{type:"pipeY",position:{x:12,y:2,z:2},color:"#2F2F2F"},{type:"pipeX",position:{x:11,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:11,y:0,z:2},color:"#708090"},{type:"pipeZ",position:{x:11,y:0,z:4},color:"#708090"},{type:"valve",position:{x:11,y:0,z:3},color:"#B22222"},{type:"pipeY",position:{x:17,y:0,z:1},color:"#505050"},{type:"pipeY",position:{x:17,y:1,z:1},color:"#505050"},{type:"pipeY",position:{x:17,y:2,z:1},color:"#505050"},{type:"pipeY",position:{x:17,y:3,z:1},color:"#505050"},{type:"pipeY",position:{x:17,y:4,z:1},color:"#505050"},{type:"cone",position:{x:17,y:5,z:1},color:"#FF4500"},...st(13,0,7,5,6,"#707070"),{type:"tank",position:{x:14,y:0,z:8},color:"#E8E8E8"},{type:"tank",position:{x:14,y:1,z:8},color:"#E8E8E8"},{type:"tank",position:{x:14,y:2,z:8},color:"#E8E8E8"},{type:"tank",position:{x:16,y:0,z:8},color:"#E8E8E8"},{type:"tank",position:{x:16,y:1,z:8},color:"#E8E8E8"},{type:"tank",position:{x:16,y:2,z:8},color:"#E8E8E8"},{type:"tank",position:{x:14,y:0,z:11},color:"#C0C0C0"},{type:"tank",position:{x:14,y:1,z:11},color:"#C0C0C0"},{type:"tank",position:{x:14,y:2,z:11},color:"#C0C0C0"},{type:"tank",position:{x:16,y:0,z:11},color:"#C0C0C0"},{type:"tank",position:{x:16,y:1,z:11},color:"#C0C0C0"},{type:"tank",position:{x:16,y:2,z:11},color:"#C0C0C0"},{type:"stairs",position:{x:15,y:0,z:8},color:"#FFD700"},{type:"stairs",position:{x:15,y:1,z:8},color:"#FFD700"},{type:"oilTankSmall",position:{x:13,y:0,z:8},color:"#4682B4"},{type:"oilTankSmall",position:{x:13,y:0,z:11},color:"#4682B4"},{type:"pipeX",position:{x:8,y:0,z:2},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:5},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:9,y:0,z:3},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:10},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:13},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:11},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:12},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:6},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:7},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:8},color:"#708090"},{type:"pipeZ",position:{x:8,y:0,z:9},color:"#708090"},{type:"pipeX",position:{x:13,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:13,y:0,z:4},color:"#708090"},{type:"pipeZ",position:{x:13,y:0,z:5},color:"#708090"},{type:"pipeZ",position:{x:13,y:0,z:6},color:"#708090"},{type:"pipeZ",position:{x:13,y:0,z:7},color:"#708090"},{type:"valve",position:{x:8,y:0,z:2},color:"#B22222"},{type:"valve",position:{x:8,y:0,z:5},color:"#B22222"},{type:"valve",position:{x:8,y:0,z:10},color:"#B22222"},{type:"valve",position:{x:8,y:0,z:13},color:"#B22222"},{type:"valve",position:{x:13,y:0,z:3},color:"#FF4500"},...st(1,0,10,4,4,"#808080"),...ae(1,1,10,4,4,"#F5F5DC"),...ae(1,2,10,4,4,"#F5F5DC"),...st(1,3,10,4,4,"#696969"),{type:"doorFrame",position:{x:2,y:1,z:10},color:"#8B4513"},{type:"windowFrame",position:{x:3,y:2,z:10},color:"#8B4513"},{type:"windowFrame",position:{x:1,y:2,z:11},color:"#8B4513"},{type:"windowFrame",position:{x:4,y:2,z:12},color:"#8B4513"},{type:"acUnit",position:{x:3,y:3,z:12},color:"#C0C0C0"},{type:"antenna",position:{x:1,y:3,z:10},color:"#505050"},...st(1,0,14,3,2,"#505050"),{type:"cube",position:{x:1,y:1,z:14},color:"#2F4F4F"},{type:"cube",position:{x:2,y:1,z:14},color:"#2F4F4F"},{type:"cube",position:{x:1,y:1,z:15},color:"#2F4F4F"},{type:"cube",position:{x:2,y:1,z:15},color:"#2F4F4F"},{type:"pipeY",position:{x:1,y:2,z:14},color:"#2F2F2F"},{type:"transformer",position:{x:3,y:0,z:14},color:"#505050"},{type:"powerBox",position:{x:3,y:0,z:15},color:"#2F4F4F"},{type:"oilBarrel",position:{x:10,y:0,z:13},color:"#1a1a1a"},{type:"oilBarrel",position:{x:11,y:0,z:13},color:"#1a1a1a"},{type:"oilBarrel",position:{x:12,y:0,z:13},color:"#B22222"},{type:"oilBarrel",position:{x:10,y:0,z:14},color:"#2F4F4F"},{type:"oilBarrel",position:{x:11,y:0,z:14},color:"#1a1a1a"},{type:"oilBarrel",position:{x:12,y:0,z:14},color:"#4682B4"},{type:"oilBarrel",position:{x:10,y:1,z:13},color:"#B22222"},{type:"oilBarrel",position:{x:11,y:1,z:13},color:"#1a1a1a"},{type:"barrier",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:17,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:15},color:"#FFD700"},{type:"barrier",position:{x:17,y:0,z:15},color:"#FFD700"},{type:"barrier",position:{x:5,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:12,y:0,z:0},color:"#FFD700"},{type:"trafficCone",position:{x:5,y:0,z:3},color:"#FF6600"},{type:"trafficCone",position:{x:5,y:0,z:6},color:"#FF6600"},{type:"trafficCone",position:{x:5,y:0,z:9},color:"#FF6600"},{type:"trafficCone",position:{x:5,y:0,z:12},color:"#FF6600"},{type:"sign",position:{x:0,y:0,z:7},color:"#FFD700"},{type:"sign",position:{x:9,y:0,z:0},color:"#FFD700"},{type:"lightFixture",position:{x:5,y:0,z:0},color:"#FFFF99"},{type:"lightFixture",position:{x:12,y:0,z:0},color:"#FFFF99"},{type:"spotlight",position:{x:1,y:4,z:1},color:"#FFFF99"},{type:"spotlight",position:{x:4,y:4,z:4},color:"#FFFF99"},{type:"fence",position:{x:13,y:0,z:13},color:"#8B8B8B"},{type:"fence",position:{x:14,y:0,z:13},color:"#8B8B8B"},{type:"fence",position:{x:15,y:0,z:13},color:"#8B8B8B"},{type:"fence",position:{x:16,y:0,z:13},color:"#8B8B8B"},{type:"fence",position:{x:17,y:0,z:13},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:7},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:8},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:9},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:10},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:11},color:"#8B8B8B"},{type:"fenceZ",position:{x:17,y:0,z:12},color:"#8B8B8B"}]},offshorePlatform:{name:"Offshore Oil Platform",category:"oil",description:"Deep-water oil platform with helideck, crane, and living quarters",blocks:[...st(0,0,0,16,14,"#1E4D6B"),{type:"pillar",position:{x:2,y:0,z:2},color:"#505050"},{type:"pillar",position:{x:2,y:1,z:2},color:"#505050"},{type:"pillar",position:{x:2,y:2,z:2},color:"#505050"},{type:"pillar",position:{x:3,y:0,z:2},color:"#505050"},{type:"pillar",position:{x:3,y:1,z:2},color:"#505050"},{type:"pillar",position:{x:3,y:2,z:2},color:"#505050"},{type:"pillar",position:{x:2,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:2,y:1,z:3},color:"#505050"},{type:"pillar",position:{x:2,y:2,z:3},color:"#505050"},{type:"pillar",position:{x:3,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:3,y:1,z:3},color:"#505050"},{type:"pillar",position:{x:3,y:2,z:3},color:"#505050"},{type:"pillar",position:{x:12,y:0,z:2},color:"#505050"},{type:"pillar",position:{x:12,y:1,z:2},color:"#505050"},{type:"pillar",position:{x:12,y:2,z:2},color:"#505050"},{type:"pillar",position:{x:13,y:0,z:2},color:"#505050"},{type:"pillar",position:{x:13,y:1,z:2},color:"#505050"},{type:"pillar",position:{x:13,y:2,z:2},color:"#505050"},{type:"pillar",position:{x:12,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:12,y:1,z:3},color:"#505050"},{type:"pillar",position:{x:12,y:2,z:3},color:"#505050"},{type:"pillar",position:{x:13,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:13,y:1,z:3},color:"#505050"},{type:"pillar",position:{x:13,y:2,z:3},color:"#505050"},{type:"pillar",position:{x:2,y:0,z:10},color:"#505050"},{type:"pillar",position:{x:2,y:1,z:10},color:"#505050"},{type:"pillar",position:{x:2,y:2,z:10},color:"#505050"},{type:"pillar",position:{x:3,y:0,z:10},color:"#505050"},{type:"pillar",position:{x:3,y:1,z:10},color:"#505050"},{type:"pillar",position:{x:3,y:2,z:10},color:"#505050"},{type:"pillar",position:{x:2,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:2,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:2,y:2,z:11},color:"#505050"},{type:"pillar",position:{x:3,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:3,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:3,y:2,z:11},color:"#505050"},{type:"pillar",position:{x:12,y:0,z:10},color:"#505050"},{type:"pillar",position:{x:12,y:1,z:10},color:"#505050"},{type:"pillar",position:{x:12,y:2,z:10},color:"#505050"},{type:"pillar",position:{x:13,y:0,z:10},color:"#505050"},{type:"pillar",position:{x:13,y:1,z:10},color:"#505050"},{type:"pillar",position:{x:13,y:2,z:10},color:"#505050"},{type:"pillar",position:{x:12,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:12,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:12,y:2,z:11},color:"#505050"},{type:"pillar",position:{x:13,y:0,z:11},color:"#505050"},{type:"pillar",position:{x:13,y:1,z:11},color:"#505050"},{type:"pillar",position:{x:13,y:2,z:11},color:"#505050"},...st(1,3,1,14,12,"#707070"),...st(5,3,5,4,4,"#606060"),{type:"iBeam",position:{x:5,y:4,z:5},color:"#8B0000"},{type:"iBeam",position:{x:5,y:5,z:5},color:"#8B0000"},{type:"iBeam",position:{x:5,y:6,z:5},color:"#8B0000"},{type:"iBeam",position:{x:5,y:7,z:5},color:"#8B0000"},{type:"iBeam",position:{x:5,y:8,z:5},color:"#8B0000"},{type:"iBeam",position:{x:8,y:4,z:5},color:"#8B0000"},{type:"iBeam",position:{x:8,y:5,z:5},color:"#8B0000"},{type:"iBeam",position:{x:8,y:6,z:5},color:"#8B0000"},{type:"iBeam",position:{x:8,y:7,z:5},color:"#8B0000"},{type:"iBeam",position:{x:8,y:8,z:5},color:"#8B0000"},{type:"iBeam",position:{x:5,y:4,z:8},color:"#8B0000"},{type:"iBeam",position:{x:5,y:5,z:8},color:"#8B0000"},{type:"iBeam",position:{x:5,y:6,z:8},color:"#8B0000"},{type:"iBeam",position:{x:5,y:7,z:8},color:"#8B0000"},{type:"iBeam",position:{x:5,y:8,z:8},color:"#8B0000"},{type:"iBeam",position:{x:8,y:4,z:8},color:"#8B0000"},{type:"iBeam",position:{x:8,y:5,z:8},color:"#8B0000"},{type:"iBeam",position:{x:8,y:6,z:8},color:"#8B0000"},{type:"iBeam",position:{x:8,y:7,z:8},color:"#8B0000"},{type:"iBeam",position:{x:8,y:8,z:8},color:"#8B0000"},{type:"beamX",position:{x:6,y:5,z:5},color:"#B22222"},{type:"beamX",position:{x:7,y:5,z:5},color:"#B22222"},{type:"beamX",position:{x:6,y:7,z:5},color:"#B22222"},{type:"beamX",position:{x:7,y:7,z:5},color:"#B22222"},{type:"beamX",position:{x:6,y:5,z:8},color:"#B22222"},{type:"beamX",position:{x:7,y:5,z:8},color:"#B22222"},{type:"beamX",position:{x:6,y:7,z:8},color:"#B22222"},{type:"beamX",position:{x:7,y:7,z:8},color:"#B22222"},{type:"beamZ",position:{x:5,y:5,z:6},color:"#B22222"},{type:"beamZ",position:{x:5,y:5,z:7},color:"#B22222"},{type:"beamZ",position:{x:5,y:7,z:6},color:"#B22222"},{type:"beamZ",position:{x:5,y:7,z:7},color:"#B22222"},{type:"beamZ",position:{x:8,y:5,z:6},color:"#B22222"},{type:"beamZ",position:{x:8,y:5,z:7},color:"#B22222"},{type:"beamZ",position:{x:8,y:7,z:6},color:"#B22222"},{type:"beamZ",position:{x:8,y:7,z:7},color:"#B22222"},{type:"grateFloor",position:{x:6,y:9,z:6},color:"#404040"},{type:"grateFloor",position:{x:7,y:9,z:6},color:"#404040"},{type:"grateFloor",position:{x:6,y:9,z:7},color:"#404040"},{type:"grateFloor",position:{x:7,y:9,z:7},color:"#404040"},{type:"wellHead",position:{x:6,y:3,z:6},color:"#B22222"},{type:"wellHead",position:{x:7,y:3,z:7},color:"#B22222"},{type:"pipeY",position:{x:6,y:4,z:6},color:"#708090"},{type:"pipeY",position:{x:6,y:5,z:6},color:"#708090"},{type:"pipeY",position:{x:6,y:6,z:6},color:"#708090"},{type:"pipeY",position:{x:6,y:7,z:6},color:"#708090"},{type:"pipeY",position:{x:6,y:8,z:6},color:"#708090"},...st(10,3,1,4,4,"#2F4F2F"),{type:"slab",position:{x:11,y:3,z:2},color:"#FFFFFF"},{type:"slab",position:{x:12,y:3,z:2},color:"#FFFFFF"},{type:"slab",position:{x:11,y:3,z:3},color:"#FFFFFF"},{type:"slab",position:{x:12,y:3,z:3},color:"#FFFFFF"},{type:"lightFixture",position:{x:10,y:3,z:1},color:"#FF0000"},{type:"lightFixture",position:{x:13,y:3,z:1},color:"#FF0000"},{type:"lightFixture",position:{x:10,y:3,z:4},color:"#FF0000"},{type:"lightFixture",position:{x:13,y:3,z:4},color:"#FF0000"},...st(1,3,1,3,4,"#808080"),...ae(1,4,1,3,4,"#F5F5DC"),...ae(1,5,1,3,4,"#F5F5DC"),...st(1,6,1,3,4,"#696969"),{type:"doorFrame",position:{x:2,y:4,z:4},color:"#8B4513"},{type:"windowFrame",position:{x:1,y:5,z:1},color:"#8B4513"},{type:"windowFrame",position:{x:3,y:5,z:1},color:"#8B4513"},{type:"windowFrame",position:{x:1,y:5,z:3},color:"#8B4513"},{type:"acUnit",position:{x:2,y:6,z:3},color:"#C0C0C0"},{type:"antenna",position:{x:1,y:6,z:1},color:"#505050"},{type:"cylinder",position:{x:14,y:3,z:7},color:"#FFD700"},{type:"pillar",position:{x:14,y:4,z:7},color:"#FFD700"},{type:"pillar",position:{x:14,y:5,z:7},color:"#FFD700"},{type:"pillar",position:{x:14,y:6,z:7},color:"#FFD700"},{type:"beamZ",position:{x:14,y:6,z:5},color:"#FFD700"},{type:"beamZ",position:{x:14,y:6,z:6},color:"#FFD700"},{type:"beamZ",position:{x:14,y:6,z:8},color:"#FFD700"},{type:"beamZ",position:{x:14,y:6,z:9},color:"#FFD700"},{type:"chain",position:{x:14,y:5,z:5},color:"#505050"},{type:"oilTank",position:{x:10,y:3,z:6},color:"#708090"},{type:"oilTank",position:{x:10,y:3,z:8},color:"#708090"},{type:"oilTankSmall",position:{x:10,y:3,z:10},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:11,y:3,z:10},color:"#4682B4"},{type:"pipeX",position:{x:9,y:3,z:7},color:"#708090"},{type:"pipeZ",position:{x:9,y:3,z:8},color:"#708090"},{type:"pipeZ",position:{x:9,y:3,z:9},color:"#708090"},{type:"valve",position:{x:9,y:3,z:7},color:"#B22222"},{type:"beamX",position:{x:0,y:3,z:7},color:"#505050"},{type:"pipeY",position:{x:0,y:4,z:7},color:"#505050"},{type:"pipeY",position:{x:0,y:5,z:7},color:"#505050"},{type:"cone",position:{x:0,y:6,z:7},color:"#FF4500"},{type:"hull",position:{x:1,y:3,z:10},color:"#FF6600"},{type:"hull",position:{x:1,y:3,z:12},color:"#FF6600"},{type:"railing",position:{x:1,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:2,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:3,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:4,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:5,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:6,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:7,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:8,y:3,z:0},color:"#FFD700"},{type:"railing",position:{x:9,y:3,z:0},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:1},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:2},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:3},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:4},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:5},color:"#FFD700"},{type:"railingZ",position:{x:0,y:3,z:6},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:6},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:7},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:8},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:9},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:10},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:11},color:"#FFD700"},{type:"railingZ",position:{x:15,y:3,z:12},color:"#FFD700"},{type:"spotlight",position:{x:5,y:6,z:5},color:"#FFFF99"},{type:"spotlight",position:{x:8,y:6,z:8},color:"#FFFF99"},{type:"lightFixture",position:{x:14,y:3,z:12},color:"#FFFF99"}]},oilRefinery:{name:"Oil Refinery",category:"oil",description:"Petroleum refinery with distillation columns, cooling towers, and storage",blocks:[...st(0,0,0,18,14,"#707070"),...st(1,0,1,5,6,"#606060"),{type:"tank",position:{x:2,y:0,z:2},color:"#C0C0C0"},{type:"tank",position:{x:2,y:1,z:2},color:"#C0C0C0"},{type:"tank",position:{x:2,y:2,z:2},color:"#C0C0C0"},{type:"tank",position:{x:2,y:3,z:2},color:"#C0C0C0"},{type:"tank",position:{x:2,y:4,z:2},color:"#C0C0C0"},{type:"tank",position:{x:2,y:5,z:2},color:"#C0C0C0"},{type:"dome",position:{x:2,y:6,z:2},color:"#C0C0C0"},{type:"tank",position:{x:4,y:0,z:2},color:"#B0B0B0"},{type:"tank",position:{x:4,y:1,z:2},color:"#B0B0B0"},{type:"tank",position:{x:4,y:2,z:2},color:"#B0B0B0"},{type:"tank",position:{x:4,y:3,z:2},color:"#B0B0B0"},{type:"tank",position:{x:4,y:4,z:2},color:"#B0B0B0"},{type:"dome",position:{x:4,y:5,z:2},color:"#B0B0B0"},{type:"tank",position:{x:2,y:0,z:5},color:"#A0A0A0"},{type:"tank",position:{x:2,y:1,z:5},color:"#A0A0A0"},{type:"tank",position:{x:2,y:2,z:5},color:"#A0A0A0"},{type:"tank",position:{x:2,y:3,z:5},color:"#A0A0A0"},{type:"dome",position:{x:2,y:4,z:5},color:"#A0A0A0"},{type:"tank",position:{x:4,y:0,z:5},color:"#909090"},{type:"tank",position:{x:4,y:1,z:5},color:"#909090"},{type:"tank",position:{x:4,y:2,z:5},color:"#909090"},{type:"dome",position:{x:4,y:3,z:5},color:"#909090"},{type:"pillar2",position:{x:3,y:0,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:2},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:0,z:5},color:"#4A4A4A"},{type:"pillar2",position:{x:3,y:1,z:5},color:"#4A4A4A"},{type:"catwalk",position:{x:3,y:2,z:2},color:"#404040"},{type:"catwalk",position:{x:3,y:2,z:3},color:"#404040"},{type:"catwalk",position:{x:3,y:2,z:4},color:"#404040"},{type:"catwalk",position:{x:3,y:2,z:5},color:"#404040"},{type:"stairs",position:{x:1,y:0,z:3},color:"#FFD700"},{type:"stairs",position:{x:1,y:1,z:3},color:"#FFD700"},{type:"pipeZ",position:{x:3,y:1,z:3},color:"#708090"},{type:"pipeZ",position:{x:3,y:1,z:4},color:"#708090"},{type:"pipeX",position:{x:3,y:3,z:2},color:"#708090"},{type:"valve",position:{x:3,y:3,z:2},color:"#B22222"},...st(7,0,1,4,4,"#505050"),{type:"cylinder",position:{x:8,y:0,z:2},color:"#808080"},{type:"cylinder",position:{x:8,y:1,z:2},color:"#808080"},{type:"cylinder",position:{x:8,y:2,z:2},color:"#909090"},{type:"cylinder",position:{x:8,y:3,z:2},color:"#A0A0A0"},{type:"cylinder",position:{x:8,y:0,z:4},color:"#808080"},{type:"cylinder",position:{x:8,y:1,z:4},color:"#808080"},{type:"cylinder",position:{x:8,y:2,z:4},color:"#909090"},{type:"cylinder",position:{x:8,y:3,z:4},color:"#A0A0A0"},{type:"pipeZ",position:{x:7,y:0,z:2},color:"#4682B4"},{type:"pipeZ",position:{x:7,y:0,z:3},color:"#4682B4"},{type:"pipeZ",position:{x:7,y:0,z:4},color:"#4682B4"},...st(12,0,1,6,6,"#606060"),{type:"tank",position:{x:13,y:0,z:2},color:"#E8E8E8"},{type:"tank",position:{x:13,y:1,z:2},color:"#E8E8E8"},{type:"tank",position:{x:13,y:2,z:2},color:"#E8E8E8"},{type:"tank",position:{x:16,y:0,z:2},color:"#E8E8E8"},{type:"tank",position:{x:16,y:1,z:2},color:"#E8E8E8"},{type:"tank",position:{x:16,y:2,z:2},color:"#E8E8E8"},{type:"tank",position:{x:13,y:0,z:5},color:"#D8D8D8"},{type:"tank",position:{x:13,y:1,z:5},color:"#D8D8D8"},{type:"tank",position:{x:13,y:2,z:5},color:"#D8D8D8"},{type:"tank",position:{x:16,y:0,z:5},color:"#D8D8D8"},{type:"tank",position:{x:16,y:1,z:5},color:"#D8D8D8"},{type:"tank",position:{x:16,y:2,z:5},color:"#D8D8D8"},{type:"stairs",position:{x:14,y:0,z:2},color:"#FFD700"},{type:"stairs",position:{x:14,y:1,z:2},color:"#FFD700"},{type:"pillar",position:{x:6,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:6,y:1,z:3},color:"#505050"},{type:"pillar",position:{x:11,y:0,z:3},color:"#505050"},{type:"pillar",position:{x:11,y:1,z:3},color:"#505050"},{type:"pipeX",position:{x:5,y:1,z:3},color:"#708090"},{type:"pipeX",position:{x:6,y:1,z:3},color:"#708090"},{type:"pipeX",position:{x:7,y:1,z:3},color:"#2F4F4F"},{type:"pipeX",position:{x:8,y:1,z:3},color:"#2F4F4F"},{type:"pipeX",position:{x:9,y:1,z:3},color:"#4682B4"},{type:"pipeX",position:{x:10,y:1,z:3},color:"#4682B4"},{type:"pipeX",position:{x:11,y:1,z:3},color:"#708090"},{type:"pipeX",position:{x:12,y:1,z:3},color:"#708090"},{type:"pillar",position:{x:0,y:0,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:1,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:2,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:3,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:4,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:5,z:7},color:"#505050"},{type:"pillar",position:{x:0,y:6,z:7},color:"#505050"},{type:"cone",position:{x:0,y:7,z:7},color:"#FF4500"},{type:"oilTank",position:{x:1,y:0,z:8},color:"#708090"},{type:"pipeX",position:{x:0,y:0,z:8},color:"#505050"},...st(1,0,10,5,4,"#808080"),...ae(1,1,10,5,4,"#F5F5DC"),...ae(1,2,10,5,4,"#F5F5DC"),...st(1,3,10,5,4,"#696969"),{type:"doorFrame",position:{x:3,y:1,z:10},color:"#8B4513"},{type:"windowFrame",position:{x:2,y:2,z:10},color:"#8B4513"},{type:"windowFrame",position:{x:4,y:2,z:10},color:"#8B4513"},{type:"windowFrame",position:{x:1,y:2,z:12},color:"#8B4513"},{type:"windowFrame",position:{x:5,y:2,z:12},color:"#8B4513"},{type:"acUnit",position:{x:3,y:3,z:12},color:"#C0C0C0"},{type:"antenna",position:{x:1,y:3,z:10},color:"#505050"},...st(8,0,9,6,5,"#404040"),{type:"pipeY",position:{x:9,y:0,z:11},color:"#708090"},{type:"pipeY",position:{x:9,y:1,z:11},color:"#708090"},{type:"pipeElbowXY",position:{x:9,y:2,z:11},color:"#708090"},{type:"pipeY",position:{x:12,y:0,z:11},color:"#708090"},{type:"pipeY",position:{x:12,y:1,z:11},color:"#708090"},{type:"pipeElbowXY",position:{x:12,y:2,z:11},color:"#708090"},{type:"valve",position:{x:9,y:1,z:11},color:"#FFD700"},{type:"valve",position:{x:12,y:1,z:11},color:"#FFD700"},{type:"oilTankSmall",position:{x:15,y:0,z:9},color:"#B22222"},{type:"oilTankSmall",position:{x:16,y:0,z:9},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:17,y:0,z:9},color:"#4A6B4A"},{type:"oilTankSmall",position:{x:15,y:0,z:11},color:"#B8860B"},{type:"oilTankSmall",position:{x:16,y:0,z:11},color:"#4682B4"},{type:"oilTankSmall",position:{x:17,y:0,z:11},color:"#1a1a1a"},{type:"transformer",position:{x:15,y:0,z:13},color:"#505050"},{type:"transformer",position:{x:16,y:0,z:13},color:"#505050"},{type:"powerBox",position:{x:17,y:0,z:13},color:"#2F4F4F"},{type:"conduitX",position:{x:14,y:0,z:13},color:"#505050"},{type:"conduitX",position:{x:13,y:0,z:13},color:"#505050"},{type:"barrier",position:{x:0,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:17,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:13},color:"#FFD700"},{type:"barrier",position:{x:7,y:0,z:13},color:"#FFD700"},{type:"trafficCone",position:{x:8,y:0,z:8},color:"#FF6600"},{type:"trafficCone",position:{x:13,y:0,z:8},color:"#FF6600"},{type:"sign",position:{x:6,y:0,z:0},color:"#FFD700"},{type:"sign",position:{x:11,y:0,z:0},color:"#FFD700"},{type:"pipeY",position:{x:6,y:0,z:6},color:"#B22222"},{type:"pipeY",position:{x:11,y:0,z:6},color:"#B22222"},{type:"lightFixture",position:{x:3,y:0,z:0},color:"#FFFF99"},{type:"lightFixture",position:{x:9,y:0,z:0},color:"#FFFF99"},{type:"lightFixture",position:{x:15,y:0,z:0},color:"#FFFF99"},{type:"spotlight",position:{x:2,y:4,z:2},color:"#FFFF99"},{type:"spotlight",position:{x:4,y:3,z:5},color:"#FFFF99"}]},tankerLoadingStation:{name:"Tanker Loading Station",category:"oil",description:"Truck and rail tanker loading facility with metering and safety systems",blocks:[...st(0,0,0,14,10,"#707070"),...st(0,0,4,3,2,"#404040"),...st(3,0,1,8,4,"#505050"),{type:"pillar",position:{x:4,y:0,z:1},color:"#606060"},{type:"pillar",position:{x:4,y:1,z:1},color:"#606060"},{type:"pillar",position:{x:4,y:2,z:1},color:"#606060"},{type:"pillar",position:{x:4,y:0,z:4},color:"#606060"},{type:"pillar",position:{x:4,y:1,z:4},color:"#606060"},{type:"pillar",position:{x:4,y:2,z:4},color:"#606060"},{type:"beamZ",position:{x:4,y:3,z:2},color:"#505050"},{type:"beamZ",position:{x:4,y:3,z:3},color:"#505050"},{type:"pipeY",position:{x:4,y:0,z:2},color:"#708090"},{type:"pipeY",position:{x:4,y:1,z:2},color:"#708090"},{type:"pipeElbowXY",position:{x:4,y:2,z:2},color:"#708090"},{type:"valve",position:{x:4,y:1,z:2},color:"#B22222"},{type:"pillar",position:{x:7,y:0,z:1},color:"#606060"},{type:"pillar",position:{x:7,y:1,z:1},color:"#606060"},{type:"pillar",position:{x:7,y:2,z:1},color:"#606060"},{type:"pillar",position:{x:7,y:0,z:4},color:"#606060"},{type:"pillar",position:{x:7,y:1,z:4},color:"#606060"},{type:"pillar",position:{x:7,y:2,z:4},color:"#606060"},{type:"beamZ",position:{x:7,y:3,z:2},color:"#505050"},{type:"beamZ",position:{x:7,y:3,z:3},color:"#505050"},{type:"pipeY",position:{x:7,y:0,z:2},color:"#708090"},{type:"pipeY",position:{x:7,y:1,z:2},color:"#708090"},{type:"pipeElbowXY",position:{x:7,y:2,z:2},color:"#708090"},{type:"valve",position:{x:7,y:1,z:2},color:"#B22222"},{type:"pillar",position:{x:10,y:0,z:1},color:"#606060"},{type:"pillar",position:{x:10,y:1,z:1},color:"#606060"},{type:"pillar",position:{x:10,y:2,z:1},color:"#606060"},{type:"pillar",position:{x:10,y:0,z:4},color:"#606060"},{type:"pillar",position:{x:10,y:1,z:4},color:"#606060"},{type:"pillar",position:{x:10,y:2,z:4},color:"#606060"},{type:"beamZ",position:{x:10,y:3,z:2},color:"#505050"},{type:"beamZ",position:{x:10,y:3,z:3},color:"#505050"},{type:"pipeY",position:{x:10,y:0,z:2},color:"#708090"},{type:"pipeY",position:{x:10,y:1,z:2},color:"#708090"},{type:"pipeElbowXY",position:{x:10,y:2,z:2},color:"#708090"},{type:"valve",position:{x:10,y:1,z:2},color:"#B22222"},{type:"slab",position:{x:4,y:3,z:1},color:"#404040"},{type:"slab",position:{x:5,y:3,z:1},color:"#404040"},{type:"slab",position:{x:6,y:3,z:1},color:"#404040"},{type:"slab",position:{x:7,y:3,z:1},color:"#404040"},{type:"slab",position:{x:8,y:3,z:1},color:"#404040"},{type:"slab",position:{x:9,y:3,z:1},color:"#404040"},{type:"slab",position:{x:10,y:3,z:1},color:"#404040"},{type:"slab",position:{x:4,y:3,z:4},color:"#404040"},{type:"slab",position:{x:5,y:3,z:4},color:"#404040"},{type:"slab",position:{x:6,y:3,z:4},color:"#404040"},{type:"slab",position:{x:7,y:3,z:4},color:"#404040"},{type:"slab",position:{x:8,y:3,z:4},color:"#404040"},{type:"slab",position:{x:9,y:3,z:4},color:"#404040"},{type:"slab",position:{x:10,y:3,z:4},color:"#404040"},...st(3,0,5,4,2,"#606060"),{type:"cylinder",position:{x:4,y:0,z:5},color:"#2F4F4F"},{type:"cylinder",position:{x:5,y:0,z:5},color:"#2F4F4F"},{type:"cylinder",position:{x:4,y:0,z:6},color:"#2F4F4F"},{type:"cylinder",position:{x:5,y:0,z:6},color:"#2F4F4F"},{type:"valve",position:{x:4,y:0,z:5},color:"#FFD700"},{type:"valve",position:{x:5,y:0,z:6},color:"#FFD700"},{type:"pipeZ",position:{x:4,y:0,z:4},color:"#708090"},{type:"pipeZ",position:{x:4,y:0,z:3},color:"#708090"},{type:"pipeX",position:{x:5,y:0,z:3},color:"#708090"},{type:"pipeX",position:{x:6,y:0,z:3},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:3},color:"#708090"},{type:"pipeX",position:{x:9,y:0,z:3},color:"#708090"},{type:"oilTankSmall",position:{x:8,y:0,z:6},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:9,y:0,z:6},color:"#2F4F4F"},{type:"oilTankSmall",position:{x:10,y:0,z:6},color:"#4A6B4A"},{type:"tank",position:{x:12,y:0,z:2},color:"#E8E8E8"},{type:"tank",position:{x:12,y:1,z:2},color:"#E8E8E8"},{type:"tank",position:{x:12,y:2,z:2},color:"#E8E8E8"},{type:"tank",position:{x:12,y:0,z:5},color:"#C0C0C0"},{type:"tank",position:{x:12,y:1,z:5},color:"#C0C0C0"},{type:"tank",position:{x:12,y:2,z:5},color:"#C0C0C0"},{type:"pipeZ",position:{x:11,y:0,z:3},color:"#708090"},{type:"pipeZ",position:{x:11,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:10,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:9,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:8,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:7,y:0,z:4},color:"#708090"},{type:"pipeX",position:{x:6,y:0,z:4},color:"#708090"},{type:"valve",position:{x:11,y:0,z:3},color:"#B22222"},{type:"valve",position:{x:11,y:0,z:4},color:"#B22222"},{type:"cube",position:{x:1,y:0,z:1},color:"#F5F5DC"},{type:"cube",position:{x:2,y:0,z:1},color:"#F5F5DC"},{type:"cube",position:{x:1,y:0,z:2},color:"#F5F5DC"},{type:"cube",position:{x:2,y:0,z:2},color:"#F5F5DC"},{type:"cube",position:{x:1,y:1,z:1},color:"#F5F5DC"},{type:"cube",position:{x:2,y:1,z:1},color:"#F5F5DC"},{type:"cube",position:{x:1,y:1,z:2},color:"#F5F5DC"},{type:"cube",position:{x:2,y:1,z:2},color:"#F5F5DC"},{type:"slab",position:{x:1,y:2,z:1},color:"#696969"},{type:"slab",position:{x:2,y:2,z:1},color:"#696969"},{type:"slab",position:{x:1,y:2,z:2},color:"#696969"},{type:"slab",position:{x:2,y:2,z:2},color:"#696969"},{type:"doorFrame",position:{x:1,y:0,z:1},color:"#8B4513"},{type:"windowFrame",position:{x:2,y:1,z:1},color:"#8B4513"},{type:"acUnit",position:{x:1,y:2,z:2},color:"#C0C0C0"},...st(8,0,8,3,2,"#606060"),{type:"cylinder",position:{x:8,y:0,z:8},color:"#2F4F4F"},{type:"cylinder",position:{x:9,y:0,z:8},color:"#2F4F4F"},{type:"cylinder",position:{x:10,y:0,z:8},color:"#2F4F4F"},{type:"pipeX",position:{x:7,y:0,z:8},color:"#708090"},{type:"pipeX",position:{x:11,y:0,z:8},color:"#708090"},{type:"valve",position:{x:7,y:0,z:8},color:"#FF4500"},{type:"transformer",position:{x:1,y:0,z:8},color:"#505050"},{type:"powerBox",position:{x:2,y:0,z:8},color:"#2F4F4F"},{type:"conduitX",position:{x:3,y:0,z:8},color:"#505050"},{type:"conduitX",position:{x:4,y:0,z:8},color:"#505050"},{type:"conduitX",position:{x:5,y:0,z:8},color:"#505050"},{type:"conduitX",position:{x:6,y:0,z:8},color:"#505050"},{type:"barrier",position:{x:0,y:0,z:3},color:"#FFD700"},{type:"barrier",position:{x:0,y:0,z:6},color:"#FFD700"},{type:"barrier",position:{x:13,y:0,z:0},color:"#FFD700"},{type:"barrier",position:{x:13,y:0,z:9},color:"#FFD700"},{type:"trafficCone",position:{x:3,y:0,z:2},color:"#FF6600"},{type:"trafficCone",position:{x:3,y:0,z:3},color:"#FF6600"},{type:"trafficCone",position:{x:11,y:0,z:2},color:"#FF6600"},{type:"trafficCone",position:{x:11,y:0,z:3},color:"#FF6600"},{type:"sign",position:{x:0,y:0,z:4},color:"#FFD700"},{type:"sign",position:{x:6,y:0,z:0},color:"#FFD700"},{type:"pipeY",position:{x:3,y:0,z:1},color:"#B22222"},{type:"pipeY",position:{x:11,y:0,z:1},color:"#B22222"},{type:"drain",position:{x:5,y:0,z:2},color:"#404040"},{type:"drain",position:{x:8,y:0,z:2},color:"#404040"},{type:"grate",position:{x:6,y:0,z:2},color:"#505050"},{type:"grate",position:{x:9,y:0,z:2},color:"#505050"},{type:"beamZ",position:{x:4,y:3,z:2},color:"#505050"},{type:"beamZ",position:{x:4,y:3,z:3},color:"#505050"},{type:"beamZ",position:{x:7,y:3,z:2},color:"#505050"},{type:"beamZ",position:{x:7,y:3,z:3},color:"#505050"},{type:"lightFixture",position:{x:4,y:3,z:2},color:"#FFFF99"},{type:"lightFixture",position:{x:7,y:3,z:2},color:"#FFFF99"},{type:"lightFixture",position:{x:10,y:3,z:2},color:"#FFFF99"},{type:"lightFixture",position:{x:0,y:0,z:0},color:"#FFFF99"},{type:"lightFixture",position:{x:13,y:0,z:5},color:"#FFFF99"},{type:"oilBarrel",position:{x:1,y:0,z:6},color:"#1a1a1a"},{type:"oilBarrel",position:{x:2,y:0,z:6},color:"#B22222"},{type:"oilBarrel",position:{x:1,y:0,z:7},color:"#2F4F4F"}]}};function st(i,t,e,o,n,s){const r=[];for(let a=0;a<o;a++)for(let l=0;l<n;l++)r.push({type:"cube",position:{x:i+a,y:t,z:e+l},color:s});return r}function ae(i,t,e,o,n,s){const r=[];for(let a=0;a<o;a++)for(let l=0;l<n;l++)(a===0||a===o-1||l===0||l===n-1)&&r.push({type:"cube",position:{x:i+a,y:t,z:e+l},color:s});return r}function Ae(i,t,e,o,n,s,r){const a=[];for(let l=0;l<o;l++)for(let c=0;c<n;c++)if(l===0||l===o-1||c===0||c===n-1){const p=(l+c)%2===0;a.push({type:"cube",position:{x:i+l,y:t,z:e+c},color:p?r:s})}return a}function ne(i,t,e,o,n,s){const r=[];for(let a=0;a<o;a++)for(let l=0;l<n;l++)r.push({type:"cube",position:{x:i+a,y:t+l,z:e},color:s});return r}function Wt(i,t,e,o,n,s){const r=[];for(let a=0;a<o;a++)for(let l=0;l<n;l++)r.push({type:"cube",position:{x:i,y:t+l,z:e+a},color:s});return r}function Et(i,t,e,o,n,s,r){const a=[];for(let l=0;l<o;l++){const c=n==="X"?{x:i+l,y:t,z:e}:{x:i,y:t,z:e+l};a.push({type:s,position:c,color:r})}return a}function TM(){return Object.entries(AM).map(([i,t])=>({id:i,label:t.label,templates:t.templates.map(e=>{var o,n;return{id:e,name:((o=Yc[e])==null?void 0:o.name)||e,description:((n=Yc[e])==null?void 0:n.description)||""}})}))}function CM(i){return Yc[i]||null}function kM(i,t,e,o){const n=[],s=Math.round(o);for(let r=-s;r<=s;r++)for(let a=-s;a<=s;a++)for(let l=-s;l<=s;l++)r*r+a*a+l*l<=s*s&&n.push({x:Math.floor(i)+r,y:Math.floor(t)+a,z:Math.floor(e)+l});return n}function BM(i,t,e,o){const n=[],s=Math.floor(o/2);for(let r=-s;r<=s;r++)for(let a=-s;a<=s;a++)for(let l=-s;l<=s;l++)n.push({x:Math.floor(i)+r,y:Math.floor(t)+a,z:Math.floor(e)+l});return n}function PM(i,t,e,o){const n=[],s=Math.floor(o/2);for(let r=-s;r<=s;r++)for(let a=-s;a<=s;a++)for(let l=-s;l<=s;l++)(Math.abs(r)===s||Math.abs(a)===s||Math.abs(l)===s)&&n.push({x:Math.floor(i)+r,y:Math.floor(t)+a,z:Math.floor(e)+l});return n}function RM(i,t,e,o,n){const s=[],r=Math.round(o),a=Math.round(n);for(let l=0;l<a;l++)for(let c=-r;c<=r;c++)for(let p=-r;p<=r;p++)c*c+p*p<=r*r&&s.push({x:Math.floor(i)+c,y:Math.floor(t)+l,z:Math.floor(e)+p});return s}function DM(i,t,e,o){const n=[],s=Math.round(o);for(let r=-s;r<=s;r++)for(let a=-s;a<=s;a++){const l=r*r+a*a;l<=s*s&&l>(s-1)*(s-1)&&n.push({x:Math.floor(i)+r,y:Math.floor(t),z:Math.floor(e)+a})}return n}function IM(i,t,e,o){const n=[],s=Math.round(o);for(let r=-s;r<=s;r++)for(let a=-s;a<=s;a++)r*r+a*a<=s*s&&n.push({x:Math.floor(i)+r,y:Math.floor(t),z:Math.floor(e)+a});return n}function LM(i,t,e,o){const n=[],s=Math.round(o);for(let r=-s;r<=s;r++)for(let a=0;a<=s;a++)for(let l=-s;l<=s;l++)r*r+a*a+l*l<=s*s&&n.push({x:Math.floor(i)+r,y:Math.floor(t)+a,z:Math.floor(e)+l});return n}function UM(i,t,e,o,n,s){const r=[],a=Math.abs(o-i),l=Math.abs(n-t),c=Math.abs(s-e),p=i<o?1:-1,h=t<n?1:-1,u=e<s?1:-1,d=Math.max(a,l,c);let y=Math.floor(i),g=Math.floor(t),f=Math.floor(e),m=d/2,b=d/2,v=d/2;for(let x=0;x<=d;x++)r.push({x:y,y:g,z:f}),m-=a,b-=l,v-=c,m<0&&(m+=d,y+=p),b<0&&(b+=d,g+=h),v<0&&(v+=d,f+=u);return r}function NM(i,t,e,o,n,s){const r=[],a=Math.min(Math.floor(i),Math.floor(o)),l=Math.max(Math.floor(i),Math.floor(o)),c=Math.min(Math.floor(t),Math.floor(n)),p=Math.max(Math.floor(t),Math.floor(n)),h=Math.min(Math.floor(e),Math.floor(s)),u=Math.max(Math.floor(e),Math.floor(s));for(let d=a;d<=l;d++)for(let y=c;y<=p;y++)for(let g=h;g<=u;g++)r.push({x:d,y,z:g});return r}function T0(i,t,e){const o=e.x-t.x,n=e.y-t.y,s=e.z-t.z,r=Math.sqrt(o*o+n*n+s*s),a=Math.max(1,Math.round(r));switch(i){case"sphere":return kM(t.x,t.y,t.z,a);case"cube":return BM(t.x,t.y,t.z,a*2);case"hollowCube":return PM(t.x,t.y,t.z,a*2);case"cylinder":const l=Math.sqrt(o*o+s*s),c=Math.max(1,Math.round(l)),p=Math.max(1,Math.abs(Math.round(n))||c);return RM(t.x,t.y,t.z,c,p);case"circle":return DM(t.x,t.y,t.z,a);case"disc":return IM(t.x,t.y,t.z,a);case"dome":return LM(t.x,t.y,t.z,a);case"line3d":return UM(t.x,t.y,t.z,e.x,e.y,e.z);case"wall":return NM(t.x,t.y,t.z,e.x,e.y,e.z);default:return[]}}class OM{constructor(){this.layers=new Map,this.activeLayerId="default",this.onLayerChange=null,this.createLayer("default","Default","#ffffff")}createLayer(t,e,o="#ffffff"){if(this.layers.has(t))return console.warn(`Layer "${t}" already exists`),this.layers.get(t);const n={id:t,name:e,color:o,visible:!0,locked:!1,opacity:1,order:this.layers.size};return this.layers.set(t,n),this.notifyChange(),n}deleteLayer(t){return t==="default"?(console.warn("Cannot delete default layer"),!1):this.layers.has(t)?(this.layers.delete(t),this.activeLayerId===t&&(this.activeLayerId="default"),this.notifyChange(),!0):!1}getLayer(t){return this.layers.get(t)||null}getAllLayers(){return Array.from(this.layers.values()).sort((t,e)=>t.order-e.order)}setActiveLayer(t){return this.layers.has(t)?(this.activeLayerId=t,this.notifyChange(),!0):(console.warn(`Layer "${t}" does not exist`),!1)}getActiveLayer(){return this.layers.get(this.activeLayerId)}setLayerVisible(t,e){const o=this.layers.get(t);return o?(o.visible=e,this.notifyChange(),!0):!1}setLayerLocked(t,e){const o=this.layers.get(t);return o?(o.locked=e,this.notifyChange(),!0):!1}setLayerOpacity(t,e){const o=this.layers.get(t);return o?(o.opacity=Math.max(0,Math.min(1,e)),this.notifyChange(),!0):!1}setLayerName(t,e){const o=this.layers.get(t);return o?(o.name=e,this.notifyChange(),!0):!1}setLayerColor(t,e){const o=this.layers.get(t);return o?(o.color=e,this.notifyChange(),!0):!1}isLayerVisible(t){const e=this.layers.get(t);return e?e.visible:!0}isLayerLocked(t){const e=this.layers.get(t);return e?e.locked:!1}canEditLayer(t){const e=this.layers.get(t);return e?e.visible&&!e.locked:!1}moveLayerUp(t){const e=this.getAllLayers(),o=e.findIndex(n=>n.id===t);if(o>0){const n=e[o].order;return e[o].order=e[o-1].order,e[o-1].order=n,this.notifyChange(),!0}return!1}moveLayerDown(t){const e=this.getAllLayers(),o=e.findIndex(n=>n.id===t);if(o<e.length-1&&o>=0){const n=e[o].order;return e[o].order=e[o+1].order,e[o+1].order=n,this.notifyChange(),!0}return!1}notifyChange(){this.onLayerChange&&this.onLayerChange(this.getAllLayers(),this.activeLayerId)}generateLayerId(){let t=1;for(;this.layers.has(`layer_${t}`);)t++;return`layer_${t}`}toJSON(){return{layers:Array.from(this.layers.values()),activeLayerId:this.activeLayerId}}fromJSON(t){if(this.layers.clear(),t.layers&&Array.isArray(t.layers))for(const e of t.layers)this.layers.set(e.id,{...e});this.layers.has("default")||this.createLayer("default","Default","#ffffff"),this.activeLayerId=t.activeLayerId||"default",this.layers.has(this.activeLayerId)||(this.activeLayerId="default"),this.notifyChange()}clear(){this.layers.clear(),this.createLayer("default","Default","#ffffff"),this.activeLayerId="default",this.notifyChange()}}function C0(i,t,e){const o={...i};switch(t){case"x":o.x=2*e.x-i.x-1;break;case"y":o.y=2*e.y-i.y-1;break;case"z":o.z=2*e.z-i.z-1;break}return o}function k0(i,t){const e={...i};switch(t){case"x":e.y=(360-e.y)%360,e.z=(360-e.z)%360;break;case"y":e.x=(360-e.x)%360,e.z=(360-e.z)%360;break;case"z":e.x=(360-e.x)%360,e.y=(360-e.y)%360;break}return e}function B0(i){if(i.length===0)return{x:0,y:0,z:0};let t=1/0,e=1/0,o=1/0,n=-1/0,s=-1/0,r=-1/0;for(const a of i){const l=a.gridPosition;t=Math.min(t,l.x),e=Math.min(e,l.y),o=Math.min(o,l.z),n=Math.max(n,l.x+1),s=Math.max(s,l.y+1),r=Math.max(r,l.z+1)}return{x:(t+n)/2,y:(e+s)/2,z:(o+r)/2}}function VM(i,t,e){const o=C0(i.gridPosition,t,e),n=k0(i.rotation,t);return{type:i.type,position:o,dimensions:{...i.dimensions},rotation:n,color:i.color,emissive:i.emissive?{...i.emissive}:null,faces:i.faces?JSON.parse(JSON.stringify(i.faces)):null,layerId:i.layerId}}function HM(i,t,e=null){if(i.length===0)return[];const o=e||B0(i),n=[];for(const s of i)n.push(VM(s,t,o));return n}class GM{constructor(t){this.blockManager=t,this.symmetryMode=null,this.symmetryCenter={x:0,y:0,z:0}}setSymmetryMode(t){this.symmetryMode=t}setSymmetryCenter(t){this.symmetryCenter={...t}}getSymmetricBlockData(t){return this.symmetryMode?{...t,position:C0(t.position,this.symmetryMode,this.symmetryCenter),rotation:k0(t.rotation||{x:0,y:0,z:0},this.symmetryMode)}:null}mirrorSelectedBlocks(t,e=!0){const o=this.blockManager.getSelectedBlocks();if(o.length===0)return[];const n=B0(o),s=HM(o,t,n);if(e){const r=[];for(const a of s)if(!this.blockManager.wouldOverlapAt(a.type,a.position,a.dimensions)){const l=this.blockManager.addBlock(a);l&&r.push(l)}return r}return s}}class XM{constructor(t,e){this.camera=t,this.controls=e,this.bookmarks=new Map,this.onBookmarksChange=null}saveBookmark(t){const e=`bookmark_${Date.now()}`,o={id:e,name:t,position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},target:{x:this.controls.target.x,y:this.controls.target.y,z:this.controls.target.z},zoom:this.camera.zoom};return this.bookmarks.set(e,o),this.notifyChange(),o}restoreBookmark(t,e=!0){const o=this.bookmarks.get(t);return o?(e?this.animateTo(o.position,o.target,500):(this.camera.position.set(o.position.x,o.position.y,o.position.z),this.controls.target.set(o.target.x,o.target.y,o.target.z),this.controls.update()),!0):!1}animateTo(t,e,o=500){const n={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},s={x:this.controls.target.x,y:this.controls.target.y,z:this.controls.target.z},r=performance.now(),a=()=>{const l=performance.now()-r,c=Math.min(l/o,1),p=1-Math.pow(1-c,3);this.camera.position.x=n.x+(t.x-n.x)*p,this.camera.position.y=n.y+(t.y-n.y)*p,this.camera.position.z=n.z+(t.z-n.z)*p,this.controls.target.x=s.x+(e.x-s.x)*p,this.controls.target.y=s.y+(e.y-s.y)*p,this.controls.target.z=s.z+(e.z-s.z)*p,this.controls.update(),c<1&&requestAnimationFrame(a)};requestAnimationFrame(a)}deleteBookmark(t){return this.bookmarks.has(t)?(this.bookmarks.delete(t),this.notifyChange(),!0):!1}renameBookmark(t,e){const o=this.bookmarks.get(t);return o?(o.name=e,this.notifyChange(),!0):!1}getAllBookmarks(){return Array.from(this.bookmarks.values())}goToPreset(t){const o={front:{position:{x:0,y:5,z:15},target:{x:0,y:0,z:0}},back:{position:{x:0,y:5,z:-15},target:{x:0,y:0,z:0}},left:{position:{x:-15,y:5,z:0},target:{x:0,y:0,z:0}},right:{position:{x:15,y:5,z:0},target:{x:0,y:0,z:0}},top:{position:{x:0,y:20,z:.01},target:{x:0,y:0,z:0}},iso:{position:{x:10,y:10,z:10},target:{x:0,y:0,z:0}}}[t];o&&this.animateTo(o.position,o.target)}notifyChange(){this.onBookmarksChange&&this.onBookmarksChange(this.getAllBookmarks())}toJSON(){return{bookmarks:Array.from(this.bookmarks.values())}}fromJSON(t){if(this.bookmarks.clear(),t&&t.bookmarks&&Array.isArray(t.bookmarks))for(const e of t.bookmarks)this.bookmarks.set(e.id,e);this.notifyChange()}clear(){this.bookmarks.clear(),this.notifyChange()}}class WM{constructor(t,e,o){this.camera=t,this.controls=e,this.cameraBookmarks=o,this.isPlaying=!1,this.currentFrame=0,this.animationFrameId=null,this.curveType="easeInOut"}interpolate(t,e,o,n=null){const s=n||this.curveType;let r=o;switch(s){case"linear":r=o;break;case"easeIn":r=o*o;break;case"easeOut":r=1-Math.pow(1-o,2);break;case"easeInOut":r=o<.5?2*o*o:1-Math.pow(-2*o+2,2)/2;break;case"smoothstep":r=o*o*(3-2*o);break;default:r=o<.5?2*o*o:1-Math.pow(-2*o+2,2)/2;break}const a={x:t.position.x+(e.position.x-t.position.x)*r,y:t.position.y+(e.position.y-t.position.y)*r,z:t.position.z+(e.position.z-t.position.z)*r},l={x:t.target.x+(e.target.x-t.target.x)*r,y:t.target.y+(e.target.y-t.target.y)*r,z:t.target.z+(e.target.z-t.target.z)*r};return{position:a,target:l}}getCameraAtFrame(t,e,o){if(o.length<2)throw new Error("Need at least 2 bookmarks for camera path");t=Math.max(0,Math.min(t,e-1));const n=t/(e-1);if(o.length===2)return this.interpolate(o[0],o[1],n);const s=o.length-1,r=n*s,a=Math.floor(r),l=r-a;return a>=s?{position:{...o[o.length-1].position},target:{...o[o.length-1].target}}:this.interpolate(o[a],o[a+1],l)}setCameraState(t){this.camera.position.set(t.position.x,t.position.y,t.position.z),this.controls.target.set(t.target.x,t.target.y,t.target.z),this.controls.update()}preview(t,e=3e3,o=null){if(t.length<2){console.warn("Need at least 2 bookmarks to preview");return}this.stop();const n=performance.now(),r=Math.floor(e/1e3*60),a=()=>{const l=performance.now()-n,c=Math.min(l/e,1),p=Math.floor(c*r),h=this.getCameraAtFrame(p,r,t);this.setCameraState(h),c<1?this.animationFrameId=requestAnimationFrame(a):(this.isPlaying=!1,o&&o())};this.isPlaying=!0,this.animationFrameId=requestAnimationFrame(a)}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.isPlaying=!1}async renderSequence(t,e,o,n){if(t.length<2)throw new Error("Need at least 2 bookmarks to render sequence");this.stop();for(let s=0;s<e;s++){const r=this.getCameraAtFrame(s,e,t);this.setCameraState(r),o&&await o(s,e),await this.sleep(1)}n&&n()}sleep(t){return new Promise(e=>setTimeout(e,t))}}class na{constructor(t,e){this.engine=t,this.blockManager=e,this.enabled=!1,this.style="clean",this.inverted=!1,this.grayscale=!1,this.threshold=.5,this.lineWidth=2,this.showFills=!0,this.quality="medium",this.targetFPS=30,this.lastRenderTime=0,this.renderInterval=1e3/this.targetFPS,this.sceneHash=null,this.cachedImageData=null,this.cacheValid=!1,this.overlayCanvas=null,this.overlayCtx=null,this._tempVec3=new R,this._tempVec3_2=new R,this._tempVec3_3=new R,this.noiseSeed=Math.random()*1e3,window.addEventListener("resize",()=>this.onResize())}onResize(){this.overlayCanvas&&(this.overlayCanvas.width=window.innerWidth,this.overlayCanvas.height=window.innerHeight,this.enabled&&this.render())}setEnabled(t){this.enabled=t,t?(this.createOverlay(),this.render()):this.removeOverlay()}setStyle(t){this.style=t,this.enabled&&this.render()}setInverted(t){this.inverted=t,this.enabled&&this.render()}setGrayscale(t){this.grayscale=t,this.invalidateCache(),this.enabled&&this.render()}setThreshold(t){this.threshold=Math.max(0,Math.min(1,t)),this.enabled&&this.render()}setLineWidth(t){this.lineWidth=t,this.enabled&&this.render()}setShowFills(t){this.showFills=t,this.enabled&&this.render()}setQuality(t){this.quality=t,this.invalidateCache(),this.enabled&&this.render()}invalidateCache(){this.cacheValid=!1,this.sceneHash=null}generateSceneHash(){const t=this.engine.camera,e=`${t.position.x.toFixed(1)},${t.position.y.toFixed(1)},${t.position.z.toFixed(1)}`,o=`${t.rotation.x.toFixed(2)},${t.rotation.y.toFixed(2)},${t.rotation.z.toFixed(2)}`,n=this.blockManager.getAllBlocks().length,s=this.blockManager.getMergedMeshes?this.blockManager.getMergedMeshes().length:0,r=`${this.style}-${this.inverted}-${this.grayscale}-${this.threshold}-${this.quality}`;return`${e}|${o}|${n}|${s}|${r}`}getQualityMultiplier(){switch(this.quality){case"low":return .5;case"high":return 1.5;default:return 1}}createOverlay(){this.overlayCanvas||(this.overlayCanvas=document.createElement("canvas"),this.overlayCanvas.id="tattoo-overlay",this.overlayCanvas.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    `,this.overlayCanvas.width=window.innerWidth,this.overlayCanvas.height=window.innerHeight,this.overlayCtx=this.overlayCanvas.getContext("2d"),document.getElementById("app").appendChild(this.overlayCanvas))}removeOverlay(){this.overlayCanvas&&this.overlayCanvas.parentNode&&this.overlayCanvas.parentNode.removeChild(this.overlayCanvas),this.overlayCanvas=null,this.overlayCtx=null}getColors(){const t={clean:{bg:"#ffffff",fg:"#000000",accent:"#000000"},sketch:{bg:"#f5f5dc",fg:"#2c2c2c",accent:"#4a4a4a"},ink:{bg:"#fffef0",fg:"#1a1a1a",accent:"#000000"},crosshatch:{bg:"#ffffff",fg:"#000000",accent:"#444444"},blueprint:{bg:"#1e3a5f",fg:"#87ceeb",accent:"#add8e6"},comic:{bg:"#ffffff",fg:"#000000",accent:"#ff0000"},saturated:{bg:"#ffffff",fg:"#000000",accent:"#333333",preserveColor:!0},neon:{bg:"#0a0a0f",fg:"#00ffff",accent:"#ff00ff",glow:!0},scifi:{bg:"#0d1117",fg:"#58a6ff",accent:"#238636",grid:!0},watercolor:{bg:"#faf8f5",fg:"#2c4a52",accent:"#8b4513",soft:!0},noir:{bg:"#000000",fg:"#ffffff",accent:"#808080",highContrast:!0},synthwave:{bg:"#1a1a2e",fg:"#ff6ec7",accent:"#00fff7",gradient:!0},ascii:{bg:"#000000",fg:"#00ff00",accent:"#00aa00",monospace:!0}};let e=t[this.style]||t.clean;return this.inverted&&(e={...e,bg:e.fg,fg:e.bg}),e}render(t=!1){if(!this.enabled||!this.overlayCanvas)return;const e=performance.now();if(!t&&e-this.lastRenderTime<this.renderInterval)return;this.lastRenderTime=e;const o=this.overlayCanvas.width,n=this.overlayCanvas.height,s=this.overlayCtx,r=this.getColors(),a=this.generateSceneHash();if(this.cacheValid&&this.sceneHash===a&&this.cachedImageData){s.putImageData(this.cachedImageData,0,0);return}s.clearRect(0,0,o,n),s.fillStyle=r.bg,s.fillRect(0,0,o,n),this.style==="blueprint"?this.drawBlueprintGrid(s,o,n,r):this.style==="sketch"?this.drawPaperTexture(s,o,n):this.style==="scifi"?this.drawScifiBackground(s,o,n,r):this.style==="synthwave"?this.drawSynthwaveBackground(s,o,n,r):this.style==="neon"?this.drawNeonBackground(s,o,n,r):this.style==="watercolor"?this.drawWatercolorBackground(s,o,n,r):this.style==="ascii"&&this.drawAsciiBackground(s,o,n,r);const l=this.engine.camera;if(l.updateMatrixWorld(),this.style==="ascii"){const u=this.blockManager.getAllBlocks(),d=this.blockManager.getMergedMeshes?this.blockManager.getMergedMeshes():[];this.renderAsciiMode(s,u,d,l,o,n,r),this.cacheRenderedFrame(s,o,n,a);return}const c=[],p=this.blockManager.getAllBlocks(),h=this.blockManager.getMergedMeshes?this.blockManager.getMergedMeshes():[];for(const u of p)u.mesh.visible&&this.collectTriangles(u,l,c);for(const u of h)u.mesh.visible&&this.collectTrianglesFromMesh(u.mesh,u.color,l,c);c.sort((u,d)=>d.depth-u.depth),this.showFills&&this.renderFills(s,c,r),this.renderStyledEdges(s,p,h,l,o,n,r),this.cacheRenderedFrame(s,o,n,a)}cacheRenderedFrame(t,e,o,n){this.cachedImageData=t.getImageData(0,0,e,o),this.sceneHash=n,this.cacheValid=!0}renderFills(t,e,o){for(const n of e){const s=this.calculateLuminance(n.color);let r;if(this.style==="crosshatch"){this.drawCrosshatchTriangle(t,n,s,o);continue}else if(this.style==="comic"){this.drawComicTriangle(t,n,s,o);continue}else if(this.style==="saturated"){this.drawSaturatedTriangle(t,n,o);continue}else if(this.style==="neon"){this.drawNeonTriangle(t,n,s,o);continue}else if(this.style==="watercolor"){this.drawWatercolorTriangle(t,n,o);continue}else if(this.style==="noir"){this.drawNoirTriangle(t,n,s,o);continue}else if(this.style==="synthwave"){this.drawSynthwaveTriangle(t,n,o);continue}else if(this.style==="scifi"){this.drawScifiTriangle(t,n,s,o);continue}if(this.grayscale){let a=Math.round(s*255);this.inverted&&(a=255-a),r=`rgb(${a}, ${a}, ${a})`}else r=s>this.threshold?o.bg:o.fg;t.fillStyle=r,t.beginPath(),t.moveTo(n.points[0].x,n.points[0].y),t.lineTo(n.points[1].x,n.points[1].y),t.lineTo(n.points[2].x,n.points[2].y),t.closePath(),t.fill()}}renderStyledEdges(t,e,o,n,s,r,a){t.strokeStyle=a.fg,t.lineCap="round",t.lineJoin="round";const l=[];for(const c of e)c.mesh.visible&&l.push(...this.getEdgesFromBlock(c,n,s,r));for(const c of o)c.mesh.visible&&l.push(...this.getEdgesFromMerged(c,n,s,r));switch(this.style){case"sketch":this.drawSketchEdges(t,l,a);break;case"ink":this.drawInkEdges(t,l,a);break;case"blueprint":this.drawBlueprintEdges(t,l,a);break;case"comic":this.drawComicEdges(t,l,a);break;case"saturated":this.drawSaturatedEdges(t,l,a);break;case"neon":this.drawNeonEdges(t,l,a);break;case"scifi":this.drawScifiEdges(t,l,a);break;case"watercolor":this.drawWatercolorEdges(t,l,a);break;case"noir":this.drawNoirEdges(t,l,a);break;case"synthwave":this.drawSynthwaveEdges(t,l,a);break;default:this.drawCleanEdges(t,l,a)}}drawCleanEdges(t,e,o){t.strokeStyle=o.fg,t.lineWidth=this.lineWidth,t.beginPath();for(const n of e)t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2);t.stroke()}drawSketchEdges(t,e,o){t.strokeStyle=o.fg;for(const n of e)for(let s=0;s<2;s++){t.lineWidth=this.lineWidth*(.8+Math.random()*.4),t.beginPath();const r=8,a=(n.x2-n.x1)/r,l=(n.y2-n.y1)/r;t.moveTo(n.x1+this.sketchNoise(n.x1,n.y1,s)*2,n.y1+this.sketchNoise(n.y1,n.x1,s)*2);for(let c=1;c<=r;c++){const p=n.x1+a*c,h=n.y1+l*c,u=this.lineWidth*.5;t.lineTo(p+this.sketchNoise(p,h,s+c)*u,h+this.sketchNoise(h,p,s+c)*u)}t.stroke()}}drawInkEdges(t,e,o){t.strokeStyle=o.fg,t.fillStyle=o.fg;for(const n of e){const s=Math.sqrt(Math.pow(n.x2-n.x1,2)+Math.pow(n.y2-n.y1,2)),r=Math.max(4,Math.floor(s/10)),a=(n.x2-n.x1)/r,l=(n.y2-n.y1)/r;t.beginPath();for(let c=0;c<=r;c++){const p=c/r,h=n.x1+a*c,u=n.y1+l*c,d=Math.sin(p*Math.PI),y=this.lineWidth*(.5+d*1.5);c===0||(t.lineWidth=y,t.lineTo(h,u),t.stroke(),t.beginPath()),t.moveTo(h,u)}}}drawBlueprintEdges(t,e,o){t.shadowColor=o.fg,t.shadowBlur=2,t.strokeStyle=o.fg,t.lineWidth=this.lineWidth*.8,t.beginPath();for(const s of e)t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2);t.stroke(),t.shadowBlur=0,t.fillStyle=o.accent;const n=new Set;for(const s of e)n.add(`${Math.round(s.x1)},${Math.round(s.y1)}`),n.add(`${Math.round(s.x2)},${Math.round(s.y2)}`);for(const s of n){const[r,a]=s.split(",").map(Number);t.beginPath(),t.arc(r,a,this.lineWidth,0,Math.PI*2),t.fill()}}drawComicEdges(t,e,o){t.strokeStyle=o.fg,t.lineWidth=this.lineWidth*2,t.beginPath();for(const n of e)t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2);t.stroke(),t.strokeStyle=o.bg,t.lineWidth=this.lineWidth*.5,t.beginPath();for(const n of e)t.moveTo(n.x1+1,n.y1+-1),t.lineTo(n.x2+1,n.y2+-1);t.stroke()}drawSaturatedEdges(t,e,o){t.strokeStyle=o.fg,t.lineWidth=this.lineWidth*.75,t.beginPath();for(const n of e)t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2);t.stroke()}drawNeonEdges(t,e,o){t.shadowColor=o.fg,t.shadowBlur=15,t.strokeStyle=o.fg,t.lineWidth=this.lineWidth,t.beginPath();for(const s of e)t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2);t.stroke(),t.shadowBlur=8,t.strokeStyle="#ffffff",t.lineWidth=this.lineWidth*.3,t.beginPath();for(const s of e)t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2);t.stroke(),t.shadowColor=o.accent,t.shadowBlur=12,t.strokeStyle=o.accent,t.lineWidth=this.lineWidth*.8,t.beginPath();let n=0;for(const s of e)n++%3===0&&(t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2));t.stroke(),t.shadowBlur=0}drawScifiEdges(t,e,o){t.shadowColor=o.fg,t.shadowBlur=3,t.strokeStyle=o.fg,t.lineWidth=this.lineWidth,t.beginPath();for(const s of e)t.moveTo(s.x1,s.y1),t.lineTo(s.x2,s.y2);t.stroke(),t.shadowBlur=0,t.fillStyle=o.accent;const n=new Set;for(const s of e)n.add(`${Math.round(s.x1)},${Math.round(s.y1)}`),n.add(`${Math.round(s.x2)},${Math.round(s.y2)}`);for(const s of n){const[r,a]=s.split(",").map(Number);t.beginPath(),t.arc(r,a,this.lineWidth*.8,0,Math.PI*2),t.fill()}}drawWatercolorEdges(t,e,o){for(let n=0;n<3;n++){t.globalAlpha=.3,t.strokeStyle=o.fg,t.lineWidth=this.lineWidth*(2-n*.5),t.beginPath();for(const s of e)t.moveTo(s.x1+(Math.random()-.5)*2,s.y1+(Math.random()-.5)*2),t.lineTo(s.x2+(Math.random()-.5)*2,s.y2+(Math.random()-.5)*2);t.stroke()}t.globalAlpha=1}drawNoirEdges(t,e,o){t.strokeStyle=o.fg,t.lineWidth=this.lineWidth*1.5,t.beginPath();for(const n of e)t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2);t.stroke()}drawSynthwaveEdges(t,e,o){t.shadowColor=o.fg,t.shadowBlur=8;for(const n of e){const s=t.createLinearGradient(n.x1,n.y1,n.x2,n.y2);s.addColorStop(0,o.fg),s.addColorStop(.5,o.accent),s.addColorStop(1,o.fg),t.strokeStyle=s,t.lineWidth=this.lineWidth,t.beginPath(),t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2),t.stroke()}t.shadowBlur=0}drawCrosshatchTriangle(t,e,o,n){t.fillStyle=n.bg,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill(),t.save(),t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.clip();const s=Math.floor((1-o)*4);t.strokeStyle=n.fg,t.lineWidth=1;const r=Math.min(e.points[0].x,e.points[1].x,e.points[2].x),a=Math.max(e.points[0].x,e.points[1].x,e.points[2].x),l=Math.min(e.points[0].y,e.points[1].y,e.points[2].y),c=Math.max(e.points[0].y,e.points[1].y,e.points[2].y),p=8-s*1.5;if(s>=1){t.beginPath();for(let h=r-(c-l);h<a+(c-l);h+=p)t.moveTo(h,c),t.lineTo(h+(c-l),l);t.stroke()}if(s>=2){t.beginPath();for(let h=r-(c-l);h<a+(c-l);h+=p)t.moveTo(h,l),t.lineTo(h+(c-l),c);t.stroke()}if(s>=3){t.beginPath();for(let h=l;h<c;h+=p*1.5)t.moveTo(r,h),t.lineTo(a,h);t.stroke()}t.restore()}drawComicTriangle(t,e,o,n){if(t.fillStyle=n.bg,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill(),o<.7){t.save(),t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.clip(),t.fillStyle=n.fg;const s=Math.min(e.points[0].x,e.points[1].x,e.points[2].x),r=Math.max(e.points[0].x,e.points[1].x,e.points[2].x),a=Math.min(e.points[0].y,e.points[1].y,e.points[2].y),l=Math.max(e.points[0].y,e.points[1].y,e.points[2].y),c=2+(1-o)*3,p=8;for(let h=s;h<r;h+=p)for(let u=a;u<l;u+=p)t.beginPath(),t.arc(h,u,c,0,Math.PI*2),t.fill();t.restore()}}drawSaturatedTriangle(t,e,o){const n=e.color.replace("#","");let s=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),a=parseInt(n.substr(4,2),16);const l=(s+r+a)/3,c=1.3;s=Math.min(255,Math.max(0,Math.round(l+(s-l)*c))),r=Math.min(255,Math.max(0,Math.round(l+(r-l)*c))),a=Math.min(255,Math.max(0,Math.round(l+(a-l)*c))),t.fillStyle=`rgb(${s}, ${r}, ${a})`,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill()}drawNeonTriangle(t,e,o,n){const s=e.color.replace("#","");let r=parseInt(s.substr(0,2),16),a=parseInt(s.substr(2,2),16),l=parseInt(s.substr(4,2),16);r=Math.round(r*.15),a=Math.round(a*.15),l=Math.round(l*.15),t.fillStyle=`rgb(${r}, ${a}, ${l})`,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill()}drawWatercolorTriangle(t,e,o){const n=e.color.replace("#","");let s=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),a=parseInt(n.substr(4,2),16);const l=(s+r+a)/3;s=Math.round(s*.7+l*.3+30),r=Math.round(r*.7+l*.3+30),a=Math.round(a*.7+l*.3+30),s=Math.min(255,s),r=Math.min(255,r),a=Math.min(255,a),t.globalAlpha=.7,t.fillStyle=`rgb(${s}, ${r}, ${a})`,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill(),t.globalAlpha=1}drawNoirTriangle(t,e,o,n){t.fillStyle=o>.45?n.bg:n.fg,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill()}drawSynthwaveTriangle(t,e,o){const n=e.color.replace("#","");let s=parseInt(n.substr(0,2),16),r=parseInt(n.substr(2,2),16),a=parseInt(n.substr(4,2),16);(s+r+a)/3/255>.5?(s=Math.min(255,Math.round(s*.7+100)),r=Math.round(r*.5),a=Math.min(255,Math.round(a*.7+80))):(s=Math.round(s*.4+40),r=Math.round(r*.3),a=Math.min(255,Math.round(a*.5+60))),t.fillStyle=`rgb(${s}, ${r}, ${a})`,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill()}drawScifiTriangle(t,e,o,n){const s=e.color.replace("#","");let r=parseInt(s.substr(0,2),16),a=parseInt(s.substr(2,2),16),l=parseInt(s.substr(4,2),16);r=Math.round(r*.4),a=Math.min(255,Math.round(a*.6+30)),l=Math.min(255,Math.round(l*.7+50)),t.globalAlpha=.85,t.fillStyle=`rgb(${r}, ${a}, ${l})`,t.beginPath(),t.moveTo(e.points[0].x,e.points[0].y),t.lineTo(e.points[1].x,e.points[1].y),t.lineTo(e.points[2].x,e.points[2].y),t.closePath(),t.fill(),t.globalAlpha=1}drawBlueprintGrid(t,e,o,n){t.strokeStyle=n.accent,t.globalAlpha=.3,t.lineWidth=.5;const s=20;t.beginPath();for(let r=0;r<e;r+=s)t.moveTo(r,0),t.lineTo(r,o);for(let r=0;r<o;r+=s)t.moveTo(0,r),t.lineTo(e,r);t.stroke(),t.globalAlpha=.5,t.lineWidth=1,t.beginPath();for(let r=0;r<e;r+=s*5)t.moveTo(r,0),t.lineTo(r,o);for(let r=0;r<o;r+=s*5)t.moveTo(0,r),t.lineTo(e,r);t.stroke(),t.globalAlpha=1}drawPaperTexture(t,e,o){t.globalAlpha=.03,t.fillStyle="#000000";for(let n=0;n<5e3;n++){const s=Math.random()*e,r=Math.random()*o;t.fillRect(s,r,1,1)}t.globalAlpha=1}drawScifiBackground(t,e,o,n){t.strokeStyle=n.fg,t.globalAlpha=.05,t.lineWidth=1,t.beginPath();for(let a=0;a<o;a+=3)t.moveTo(0,a),t.lineTo(e,a);t.stroke(),t.globalAlpha=.1,t.lineWidth=.5;const s=40;t.beginPath();for(let a=0;a<e;a+=s)t.moveTo(a,0),t.lineTo(a,o);for(let a=0;a<o;a+=s)t.moveTo(0,a),t.lineTo(e,a);t.stroke(),t.globalAlpha=.3,t.strokeStyle=n.accent,t.lineWidth=2;const r=50;t.beginPath(),t.moveTo(10,10+r),t.lineTo(10,10),t.lineTo(10+r,10),t.stroke(),t.beginPath(),t.moveTo(e-10-r,10),t.lineTo(e-10,10),t.lineTo(e-10,10+r),t.stroke(),t.beginPath(),t.moveTo(10,o-10-r),t.lineTo(10,o-10),t.lineTo(10+r,o-10),t.stroke(),t.beginPath(),t.moveTo(e-10-r,o-10),t.lineTo(e-10,o-10),t.lineTo(e-10,o-10-r),t.stroke(),t.globalAlpha=1}drawSynthwaveBackground(t,e,o,n){const s=t.createLinearGradient(0,0,0,o);s.addColorStop(0,"#0f0f23"),s.addColorStop(.5,"#1a1a2e"),s.addColorStop(1,"#16213e"),t.fillStyle=s,t.fillRect(0,0,e,o),t.strokeStyle=n.accent,t.globalAlpha=.4,t.lineWidth=1;const r=o*.6,a=15;for(let u=0;u<=a;u++){const d=u/a,y=r+(o-r)*Math.pow(d,.7);t.globalAlpha=.2+d*.3,t.beginPath(),t.moveTo(0,y),t.lineTo(e,y),t.stroke()}t.globalAlpha=.3;const l=e/2;for(let u=-a;u<=a;u++){const d=l+u*80;t.beginPath(),t.moveTo(l,r),t.lineTo(d,o),t.stroke()}const c=r-60,p=50,h=t.createRadialGradient(e/2,c,0,e/2,c,p);h.addColorStop(0,"#ff6ec7"),h.addColorStop(.7,"#ff6ec7"),h.addColorStop(1,"transparent"),t.globalAlpha=.6,t.fillStyle=h,t.beginPath(),t.arc(e/2,c,p,0,Math.PI*2),t.fill(),t.globalAlpha=1}drawNeonBackground(t,e,o,n){t.fillStyle=n.bg,t.fillRect(0,0,e,o);const s=t.createRadialGradient(e/2,o/2,0,e/2,o/2,Math.max(e,o)*.7);s.addColorStop(0,"transparent"),s.addColorStop(1,"rgba(0, 0, 0, 0.5)"),t.fillStyle=s,t.fillRect(0,0,e,o),t.globalAlpha=.05;for(let r=0;r<20;r++){const a=Math.random()*e,l=Math.random()*o,c=20+Math.random()*40,p=t.createRadialGradient(a,l,0,a,l,c);p.addColorStop(0,r%2===0?n.fg:n.accent),p.addColorStop(1,"transparent"),t.fillStyle=p,t.beginPath(),t.arc(a,l,c,0,Math.PI*2),t.fill()}t.globalAlpha=1}drawAsciiBackground(t,e,o,n){t.globalAlpha=.05,t.strokeStyle=n.accent,t.lineWidth=1;for(let r=0;r<o;r+=4)t.beginPath(),t.moveTo(0,r),t.lineTo(e,r),t.stroke();const s=t.createRadialGradient(e/2,o/2,0,e/2,o/2,Math.max(e,o)*.6);s.addColorStop(0,"transparent"),s.addColorStop(1,"rgba(0, 0, 0, 0.4)"),t.globalAlpha=1,t.fillStyle=s,t.fillRect(0,0,e,o)}renderAsciiMode(t,e,o,n,s,r,a){const l=" .:-=+*#%@",c=this.getQualityMultiplier(),p=Math.max(6,Math.floor(12/c)),h=Math.max(8,Math.floor(16/c)),u=Math.max(8,Math.floor(14/c));t.font=`bold ${u}px monospace`,t.fillStyle=a.fg,t.textAlign="center",t.textBaseline="middle";const d=document.createElement("canvas");d.width=s,d.height=r;const y=d.getContext("2d"),g=[];for(const x of e)x.mesh.visible&&this.collectTriangles(x,n,g);for(const x of o)x.mesh.visible&&this.collectTrianglesFromMesh(x.mesh,x.color,n,g);g.sort((x,_)=>_.depth-x.depth);for(const x of g){const _=this.calculateLuminance(x.color),z=Math.round(_*255);y.fillStyle=`rgb(${z}, ${z}, ${z})`,y.beginPath(),y.moveTo(x.points[0].x,x.points[0].y),y.lineTo(x.points[1].x,x.points[1].y),y.lineTo(x.points[2].x,x.points[2].y),y.closePath(),y.fill()}const m=y.getImageData(0,0,s,r).data,b=Math.floor(s/p),v=Math.floor(r/h);for(let x=0;x<v;x++)for(let _=0;_<b;_++){const z=_*p,E=x*h,C=z+p/2,M=E+h/2;let S=0,k=0,A=0,B=0,F=0;for(let K=0;K<h&&E+K<r;K++)for(let pt=0;pt<p&&z+pt<s;pt++){const X=((E+K)*s+(z+pt))*4,Z=m[X],gt=m[X+1],Y=m[X+2];k+=Z,A+=gt,B+=Y;const tt=(.299*Z+.587*gt+.114*Y)/255;S+=tt,F++}const N=S/F;if(N<.01)continue;const G=Math.pow(N,.7),W=Math.floor(G*(l.length-1)),et=l[W];if(this.grayscale)t.fillStyle=a.fg;else{const K=Math.round(k/F),pt=Math.round(A/F),X=Math.round(B/F),Z=(K+pt+X)/3,gt=1.3,Y=Math.min(255,Math.max(0,Math.round(Z+(K-Z)*gt))),tt=Math.min(255,Math.max(0,Math.round(Z+(pt-Z)*gt))),_t=Math.min(255,Math.max(0,Math.round(Z+(X-Z)*gt)));t.fillStyle=`rgb(${Y}, ${tt}, ${_t})`}t.fillText(et,C,M)}}drawWatercolorBackground(t,e,o,n){t.globalAlpha=.02,t.fillStyle=n.fg;for(let s=0;s<3e3;s++){const r=Math.random()*e,a=Math.random()*o,l=Math.random()*3+1;t.beginPath(),t.arc(r,a,l,0,Math.PI*2),t.fill()}t.globalAlpha=.03;for(let s=0;s<5;s++){const r=Math.random()*e,a=Math.random()*o,l=100+Math.random()*200,c=t.createRadialGradient(r,a,0,r,a,l);c.addColorStop(0,n.accent),c.addColorStop(1,"transparent"),t.fillStyle=c,t.beginPath(),t.arc(r,a,l,0,Math.PI*2),t.fill()}t.globalAlpha=1}sketchNoise(t,e,o){const n=Math.sin(t*12.9898+e*78.233+o+this.noiseSeed)*43758.5453;return(n-Math.floor(n))*2-1}getEdgesFromBlock(t,e,o,n){const s=t.mesh;if(t.edges)return this.extractEdges(t.edges.geometry,s.matrixWorld,e,o,n);{const r=new Ts(s.geometry,30),a=this.extractEdges(r,s.matrixWorld,e,o,n);return r.dispose(),a}}getEdgesFromMerged(t,e,o,n){if(t.edges)return this.extractEdges(t.edges.geometry,t.mesh.matrixWorld,e,o,n);{const s=new Ts(t.mesh.geometry,30),r=this.extractEdges(s,t.mesh.matrixWorld,e,o,n);return s.dispose(),r}}extractEdges(t,e,o,n,s){const r=[],a=t.getAttribute("position");if(!a)return r;for(let l=0;l<a.count;l+=2){const c=new R(a.getX(l),a.getY(l),a.getZ(l)).applyMatrix4(e),p=new R(a.getX(l+1),a.getY(l+1),a.getZ(l+1)).applyMatrix4(e),h=c.project(o),u=p.project(o);h.z>1&&u.z>1||r.push({x1:(h.x+1)*n/2,y1:(-h.y+1)*s/2,x2:(u.x+1)*n/2,y2:(-u.y+1)*s/2})}return r}collectTriangles(t,e,o){const n=t.mesh;n.updateMatrixWorld();const s=n.geometry,r=s.getAttribute("position");if(!r)return;const a=s.index,l=n.matrixWorld,c=new R;e.getWorldDirection(c);const p=u=>{if(Array.isArray(n.material)){const d=s.groups;if(d&&d.length>0){for(const y of d)if(u*3>=y.start&&u*3<y.start+y.count)return"#"+n.material[y.materialIndex].color.getHexString()}return t.color}else return t.color},h=(u,d,y,g)=>{const f=this._tempVec3.set(r.getX(u),r.getY(u),r.getZ(u)).applyMatrix4(l),m=this._tempVec3_2.set(r.getX(d),r.getY(d),r.getZ(d)).applyMatrix4(l),b=this._tempVec3_3.set(r.getX(y),r.getY(y),r.getZ(y)).applyMatrix4(l),v=new R().subVectors(m,f),x=new R().subVectors(b,f),_=new R().crossVectors(v,x).normalize();if(_.dot(c)>.1)return;const z=f.clone().project(e),E=new R().copy(m).project(e),C=new R().copy(b).project(e);if(z.z>1||E.z>1||C.z>1)return;const M=(f.z+m.z+b.z)/3;o.push({points:[{x:(z.x+1)*window.innerWidth/2,y:(-z.y+1)*window.innerHeight/2},{x:(E.x+1)*window.innerWidth/2,y:(-E.y+1)*window.innerHeight/2},{x:(C.x+1)*window.innerWidth/2,y:(-C.y+1)*window.innerHeight/2}],depth:M,color:p(g),normal:_.clone()})};if(a)for(let u=0;u<a.count;u+=3){const d=Math.floor(u/3);h(a.getX(u),a.getX(u+1),a.getX(u+2),d)}else for(let u=0;u<r.count;u+=3){const d=Math.floor(u/3);h(u,u+1,u+2,d)}}collectTrianglesFromMesh(t,e,o,n){t.updateMatrixWorld();const s=t.geometry,r=s.getAttribute("position"),a=s.getAttribute("color");if(!r)return;const l=s.index,c=t.matrixWorld,p=new R;o.getWorldDirection(p);const h=(u,d,y)=>{const g=this._tempVec3.set(r.getX(u),r.getY(u),r.getZ(u)).applyMatrix4(c),f=this._tempVec3_2.set(r.getX(d),r.getY(d),r.getZ(d)).applyMatrix4(c),m=this._tempVec3_3.set(r.getX(y),r.getY(y),r.getZ(y)).applyMatrix4(c),b=new R().subVectors(f,g),v=new R().subVectors(m,g),x=new R().crossVectors(b,v).normalize();if(x.dot(p)>.1)return;const _=g.clone().project(o),z=new R().copy(f).project(o),E=new R().copy(m).project(o);if(_.z>1||z.z>1||E.z>1)return;const C=(g.z+f.z+m.z)/3;let M=e;if(a){const S=Math.round(a.getX(u)*255),k=Math.round(a.getY(u)*255),A=Math.round(a.getZ(u)*255);M=`#${S.toString(16).padStart(2,"0")}${k.toString(16).padStart(2,"0")}${A.toString(16).padStart(2,"0")}`}n.push({points:[{x:(_.x+1)*window.innerWidth/2,y:(-_.y+1)*window.innerHeight/2},{x:(z.x+1)*window.innerWidth/2,y:(-z.y+1)*window.innerHeight/2},{x:(E.x+1)*window.innerWidth/2,y:(-E.y+1)*window.innerHeight/2}],depth:C,color:M,normal:x.clone()})};if(l)for(let u=0;u<l.count;u+=3)h(l.getX(u),l.getX(u+1),l.getX(u+2));else for(let u=0;u<r.count;u+=3)h(u,u+1,u+2)}calculateLuminance(t){const e=t.replace("#",""),o=parseInt(e.substr(0,2),16)/255,n=parseInt(e.substr(2,2),16)/255,s=parseInt(e.substr(4,2),16)/255;return .299*o+.587*n+.114*s}capturePNG(t="render.png"){const e=this.enabled;e||(this.createOverlay(),this.render());const o=this.overlayCanvas,n=document.createElement("a");n.download=t,n.href=o.toDataURL("image/png"),n.click(),e||this.removeOverlay()}exportSVG(t="render.svg"){const e=window.innerWidth,o=window.innerHeight,n=this.getColors();let s=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${o}" viewBox="0 0 ${e} ${o}">
  <rect width="100%" height="100%" fill="${n.bg}"/>
  <g stroke="${n.fg}" stroke-width="${this.lineWidth}" stroke-linecap="round" stroke-linejoin="round" fill="none">
`;const r=this.engine.camera;r.updateMatrixWorld();const a=this.blockManager.getAllBlocks(),l=this.blockManager.getMergedMeshes?this.blockManager.getMergedMeshes():[];for(const h of a){if(!h.mesh.visible)continue;const u=this.getEdgesFromBlock(h,r,e,o);for(const d of u)s+=`    <line x1="${d.x1.toFixed(2)}" y1="${d.y1.toFixed(2)}" x2="${d.x2.toFixed(2)}" y2="${d.y2.toFixed(2)}"/>
`}for(const h of l){if(!h.mesh.visible)continue;const u=this.getEdgesFromMerged(h,r,e,o);for(const d of u)s+=`    <line x1="${d.x1.toFixed(2)}" y1="${d.y1.toFixed(2)}" x2="${d.x2.toFixed(2)}" y2="${d.y2.toFixed(2)}"/>
`}s+=`  </g>
</svg>`;const c=new Blob([s],{type:"image/svg+xml"}),p=document.createElement("a");p.download=t,p.href=URL.createObjectURL(c),p.click(),URL.revokeObjectURL(p.href)}update(){this.enabled&&this.render()}}const P0={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Ki{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ZM=new nc(-1,1,1,-1,0,1);class YM extends Xt{constructor(){super(),this.setAttribute("position",new Yt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Yt([0,2,0,0,2,0],2))}}const $M=new YM;class $c{constructor(t){this._mesh=new ge($M,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,ZM)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class R0 extends Ki{constructor(t,e){super(),this.textureID=e!==void 0?e:"tDiffuse",t instanceof io?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=_s.clone(t.uniforms),this.material=new io({name:t.name!==void 0?t.name:"unspecified",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new $c(this.material)}render(t,e,o){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=o.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class D0 extends Ki{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,o){const n=t.getContext(),s=t.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let r,a;this.inverse?(r=0,a=1):(r=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),t.setRenderTarget(o),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class qM extends Ki{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class I0{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),e===void 0){const o=t.getSize(new ct);this._width=o.width,this._height=o.height,e=new mo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:jo}),e.texture.name="EffectComposer.rt1"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new R0(P0),this.copyPass.material.blending=$o,this.clock=new Yu}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);e!==-1&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){t===void 0&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let o=!1;for(let n=0,s=this.passes.length;n<s;n++){const r=this.passes[n];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,o),r.needsSwap){if(o){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}D0!==void 0&&(r instanceof D0?o=!0:r instanceof qM&&(o=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(t===void 0){const e=this.renderer.getSize(new ct);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,t=this.renderTarget1.clone(),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const o=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(o,n),this.renderTarget2.setSize(o,n);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(o,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class jM extends Ki{constructor(t,e,o=null,n=null,s=null){super(),this.scene=t,this.camera=e,this.overrideMaterial=o,this.clearColor=n,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new bt}render(t,e,o){const n=t.autoClear;t.autoClear=!1;let s,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(t.getClearColor(this._oldClearColor),t.setClearColor(this.clearColor,t.getClearAlpha())),this.clearAlpha!==null&&(s=t.getClearAlpha(),t.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:o),this.clear===!0&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor!==null&&t.setClearColor(this._oldClearColor),this.clearAlpha!==null&&t.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),t.autoClear=n}}const KM={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new bt(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class Ji extends Ki{constructor(t,e,o,n){super(),this.strength=e!==void 0?e:1,this.radius=o,this.threshold=n,this.resolution=t!==void 0?new ct(t.x,t.y):new ct(256,256),this.clearColor=new bt(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);this.renderTargetBright=new mo(s,r,{type:jo}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let h=0;h<this.nMips;h++){const u=new mo(s,r,{type:jo});u.texture.name="UnrealBloomPass.h"+h,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);const d=new mo(s,r,{type:jo});d.texture.name="UnrealBloomPass.v"+h,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),s=Math.round(s/2),r=Math.round(r/2)}const a=KM;this.highPassUniforms=_s.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=n,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new io({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];s=Math.round(this.resolution.x/2),r=Math.round(this.resolution.y/2);for(let h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[h])),this.separableBlurMaterials[h].uniforms.invSize.value=new ct(1/s,1/r),s=Math.round(s/2),r=Math.round(r/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1;const c=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=c,this.bloomTintColors=[new R(1,1,1),new R(1,1,1),new R(1,1,1),new R(1,1,1),new R(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const p=P0;this.copyUniforms=_s.clone(p.uniforms),this.blendMaterial=new io({uniforms:this.copyUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,blending:Va,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new bt,this.oldClearAlpha=1,this.basic=new Ri,this.fsQuad=new $c(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,e){let o=Math.round(t/2),n=Math.round(e/2);this.renderTargetBright.setSize(o,n);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(o,n),this.renderTargetsVertical[s].setSize(o,n),this.separableBlurMaterials[s].uniforms.invSize.value=new ct(1/o,1/n),o=Math.round(o/2),n=Math.round(n/2)}render(t,e,o,n,s){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const r=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),s&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=o.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=o.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[l].uniforms.direction.value=Ji.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[l]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=Ji.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[l]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(o),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=r}getSeperableBlurMaterial(t){const e=[];for(let o=0;o<t;o++)e.push(.39894*Math.exp(-.5*o*o/(t*t))/t);return new io({defines:{KERNEL_RADIUS:t},uniforms:{colorTexture:{value:null},invSize:{value:new ct(.5,.5)},direction:{value:new ct(.5,.5)},gaussianCoefficients:{value:e}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new io({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}Ji.BlurDirectionX=new ct(1,0),Ji.BlurDirectionY=new ct(0,1);const JM={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class QM extends Ki{constructor(){super();const t=JM;this.uniforms=_s.clone(t.uniforms),this.material=new s2({name:t.name,uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new $c(this.material),this._outputColorSpace=null,this._toneMapping=null}render(t,e,o){this.uniforms.tDiffuse.value=o.texture,this.uniforms.toneMappingExposure.value=t.toneMappingExposure,(this._outputColorSpace!==t.outputColorSpace||this._toneMapping!==t.toneMapping)&&(this._outputColorSpace=t.outputColorSpace,this._toneMapping=t.toneMapping,this.material.defines={},re.getTransfer(this._outputColorSpace)===ue&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===Xp?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Wp?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===Zp?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===Yp?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===$p?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===qp&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}new ct(1920,1080),new bt(0),new bt(16777215);const tz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},lineColor:{value:new bt(0)},bgColor:{value:new bt(16777215)},spacing:{value:8},lineWidth:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform vec3 lineColor;
    uniform vec3 bgColor;
    uniform float spacing;
    uniform float lineWidth;
    varying vec2 vUv;

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    float hatchLine(vec2 uv, float angle, float sp) {
      float c = cos(angle);
      float s = sin(angle);
      vec2 rotUv = vec2(uv.x * c - uv.y * s, uv.x * s + uv.y * c);
      return step(mod(rotUv.x * resolution.x, sp), lineWidth);
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float lum = luma(texColor.rgb);
      float darkness = 1.0 - lum;

      vec2 pixelCoord = vUv * resolution;
      float hatch = 0.0;

      // Layer 1: diagonal lines (darkness > 0.25)
      if (darkness > 0.25) {
        hatch = max(hatch, hatchLine(pixelCoord, 0.785, spacing));
      }
      // Layer 2: opposite diagonal (darkness > 0.5)
      if (darkness > 0.5) {
        hatch = max(hatch, hatchLine(pixelCoord, -0.785, spacing));
      }
      // Layer 3: horizontal (darkness > 0.75)
      if (darkness > 0.75) {
        hatch = max(hatch, hatchLine(pixelCoord, 0.0, spacing * 1.5));
      }

      vec3 finalColor = mix(bgColor, lineColor, hatch);
      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},ez={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},dotColor:{value:new bt(0)},bgColor:{value:new bt(16777215)},dotSize:{value:4},spacing:{value:8},thickness:{value:2}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform vec3 dotColor;
    uniform vec3 bgColor;
    uniform float dotSize;
    uniform float spacing;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness * 2.0) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float t  = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float l  = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r  = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float b  = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.04, 0.12, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float lum = luma(texColor.rgb);
      float darkness = 1.0 - lum;

      vec2 pixelCoord = vUv * resolution;
      vec2 cell = floor(pixelCoord / spacing);
      vec2 cellCenter = (cell + 0.5) * spacing;
      float dist = length(pixelCoord - cellCenter);

      // Dot radius based on darkness
      float radius = darkness * dotSize;
      float dt = 1.0 - smoothstep(radius - 0.5, radius + 0.5, dist);

      vec3 finalColor = mix(bgColor, dotColor, dt);

      // Bold edge overlay (comic-style thick outlines)
      float edge = detectEdge(vUv);
      finalColor = mix(finalColor, dotColor, edge);

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},oz={uniforms:{tDiffuse:{value:null},tCharacters:{value:null},resolution:{value:new ct(1920,1080)},charSize:{value:new ct(8,16)},textColor:{value:new bt(65280)},bgColor:{value:new bt(0)},colorMode:{value:0}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform sampler2D tCharacters;
    uniform vec2 resolution;
    uniform vec2 charSize;
    uniform vec3 textColor;
    uniform vec3 bgColor;
    uniform int colorMode;
    varying vec2 vUv;

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    void main() {
      // Calculate which character cell we're in
      vec2 pixelCoord = vUv * resolution;
      vec2 cellCoord = floor(pixelCoord / charSize);
      vec2 cellUv = (cellCoord + 0.5) * charSize / resolution;

      // Sample the center of this cell
      vec4 texColor = texture2D(tDiffuse, cellUv);
      float lum = luma(texColor.rgb);

      // Map luminance to character index (0-9 for " .:-=+*#%@")
      int charIndex = int(lum * 9.0);

      // Position within character cell
      vec2 posInCell = mod(pixelCoord, charSize) / charSize;

      // Sample from character atlas
      float charWidth = 1.0 / 10.0; // 10 characters in atlas
      vec2 charUv = vec2(
        float(charIndex) * charWidth + posInCell.x * charWidth,
        posInCell.y
      );

      float charValue = texture2D(tCharacters, charUv).r;

      vec3 color;
      if (colorMode == 1) {
        // Colored mode - use original color boosted
        vec3 boosted = texColor.rgb * 1.3;
        color = mix(bgColor, boosted, charValue);
      } else {
        // Monochrome mode
        color = mix(bgColor, textColor, charValue);
      }

      gl_FragColor = vec4(color, 1.0);
    }
  `},nz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},glowColor:{value:new bt(65535)},accentColor:{value:new bt(16711935)},bgColor:{value:new bt(657935)},glowIntensity:{value:2},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform vec3 glowColor;
    uniform vec3 accentColor;
    uniform vec3 bgColor;
    uniform float glowIntensity;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.15, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);

      // Dark base from original
      vec3 darkBase = texColor.rgb * 0.15;

      // Alternate between glow colors based on position
      float alternate = step(0.5, fract(vUv.x * 20.0 + vUv.y * 20.0));
      vec3 edgeGlow = mix(glowColor, accentColor, alternate * 0.3);

      // Combine
      vec3 finalColor = mix(darkBase + bgColor * 0.5, edgeGlow * glowIntensity, edge);

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},iz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1},time:{value:0}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    uniform float time;
    varying vec2 vUv;

    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.15, sqrt(gx*gx + gy*gy));
    }

    vec3 synthwaveColor(vec3 color, vec2 uv) {
      float lum = dot(color, vec3(0.299, 0.587, 0.114));

      // Shift toward purple/cyan palette
      vec3 result;
      if (lum > 0.5) {
        // Bright: pink/cyan
        result.r = min(1.0, color.r * 0.7 + 0.4);
        result.g = color.g * 0.5;
        result.b = min(1.0, color.b * 0.7 + 0.3);
      } else {
        // Dark: deep purple
        result.r = color.r * 0.4 + 0.15;
        result.g = color.g * 0.3;
        result.b = min(1.0, color.b * 0.5 + 0.25);
      }
      return result;
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);

      // Background gradient
      vec3 bgTop = vec3(0.06, 0.06, 0.14);
      vec3 bgBot = vec3(0.09, 0.08, 0.15);
      vec3 bg = mix(bgBot, bgTop, vUv.y);

      // Color shift the original
      vec3 shifted = synthwaveColor(texColor.rgb, vUv);

      // Edge glow with gradient
      vec3 glowStart = vec3(1.0, 0.43, 0.78); // Pink
      vec3 glowEnd = vec3(0.0, 1.0, 0.97);    // Cyan
      vec3 edgeColor = mix(glowStart, glowEnd, vUv.y + sin(vUv.x * 10.0) * 0.2);

      vec3 finalColor = mix(shifted, bg, 0.3);
      finalColor = mix(finalColor, edgeColor * 1.5, edge);

      // Subtle grid on bottom half
      if (vUv.y < 0.5) {
        float gridX = step(0.98, fract(vUv.x * 20.0));
        float gridY = step(0.96, fract((0.5 - vUv.y) * 30.0 * (1.0 + vUv.y)));
        float grid = max(gridX, gridY) * 0.2 * (0.5 - vUv.y) * 2.0;
        finalColor += vec3(0.0, 1.0, 0.97) * grid;
      }

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},sz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},threshold:{value:.45},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float threshold;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness * 1.5) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float t  = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float l  = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r  = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float b  = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.15, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);
      float lum = luma(texColor.rgb);

      // High contrast threshold
      float bw = step(threshold, lum);

      // Add edge emphasis (white edges on black)
      bw = max(bw, edge);

      gl_FragColor = vec4(vec3(bw), 1.0);
    }
  `},rz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1},time:{value:0}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    uniform float time;
    varying vec2 vUv;

    float hash(vec2 p) {
      return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
    }

    float noise(vec2 p) {
      vec2 i = floor(p);
      vec2 f = fract(p);
      f = f * f * (3.0 - 2.0 * f);
      float a = hash(i);
      float b = hash(i + vec2(1.0, 0.0));
      float c = hash(i + vec2(0.0, 1.0));
      float d = hash(i + vec2(1.0, 1.0));
      return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);
    }

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float t  = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float l  = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r  = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float b  = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.03, 0.12, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec2 wobble = vec2(
        noise(vUv * 50.0) * 0.003,
        noise(vUv * 50.0 + 100.0) * 0.003
      );

      vec4 texColor = texture2D(tDiffuse, vUv + wobble);
      float edge = detectEdge(vUv);

      float gray = dot(texColor.rgb, vec3(0.299, 0.587, 0.114));
      vec3 softened = mix(texColor.rgb, vec3(gray), 0.3);
      softened = softened * 0.7 + 0.2;

      float paper = noise(vUv * resolution * 0.5) * 0.05;
      softened += paper;

      vec3 edgeColor = vec3(0.17, 0.29, 0.32);
      vec3 finalColor = mix(softened, edgeColor, edge * 0.6);
      finalColor = mix(finalColor, vec3(0.98, 0.97, 0.96), 0.1);

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},az={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1},time:{value:0}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    uniform float time;
    varying vec2 vUv;

    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.2, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);

      vec3 techColor = vec3(texColor.r * 0.4, min(1.0, texColor.g * 0.6 + 0.12), min(1.0, texColor.b * 0.7 + 0.2));
      vec3 bg = vec3(0.05, 0.07, 0.09);
      vec3 finalColor = mix(bg, techColor, 0.85);

      float scanline = sin(vUv.y * resolution.y * 2.0) * 0.03 + 0.97;
      finalColor *= scanline;

      vec3 edgeColor = vec3(0.34, 0.65, 1.0);
      finalColor = mix(finalColor, edgeColor * 1.2, edge);

      float gridSize = 40.0;
      float grid = max(step(0.97, fract(vUv.x * resolution.x / gridSize)), step(0.97, fract(vUv.y * resolution.y / gridSize))) * 0.15;
      finalColor += edgeColor * grid;

      vec2 corner = min(vUv, 1.0 - vUv);
      float bracket = step(corner.x, 0.02) * step(corner.y, 0.05) + step(corner.y, 0.02) * step(corner.x, 0.05);
      finalColor += vec3(0.14, 0.53, 0.21) * bracket * 0.5;

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},lz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.15, sqrt(gx*gx + gy*gy));
    }

    void main() {
      float edge = detectEdge(vUv);

      vec3 bg = vec3(0.12, 0.23, 0.37);
      vec3 lineColor = vec3(0.53, 0.81, 0.92);
      vec3 accentColor = vec3(0.68, 0.85, 0.90);

      vec2 pixelCoord = vUv * resolution;
      float minorGrid = max(step(0.95, fract(pixelCoord.x / 20.0)), step(0.95, fract(pixelCoord.y / 20.0))) * 0.2;
      float majorGrid = max(step(0.98, fract(pixelCoord.x / 100.0)), step(0.98, fract(pixelCoord.y / 100.0))) * 0.4;

      vec3 finalColor = bg + accentColor * minorGrid + accentColor * majorGrid;
      finalColor = mix(finalColor, lineColor * 1.3, edge);

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},cz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1},time:{value:0}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    uniform float time;
    varying vec2 vUv;

    float hash(vec2 p) { return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453); }
    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv, vec2 offset) {
      vec2 texel = vec2(thickness) / resolution;
      vec2 uvOff = uv + offset;
      float tl = luma(texture2D(tDiffuse, uvOff + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uvOff + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uvOff + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uvOff + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uvOff + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uvOff + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uvOff + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uvOff + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.03, 0.12, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec3 paper = vec3(0.96, 0.96, 0.86) - hash(floor(vUv * resolution)) * 0.03;

      float edge = 0.0;
      for (int i = 0; i < 3; i++) {
        vec2 offset = vec2(hash(vUv + float(i) * 0.1) - 0.5, hash(vUv + float(i) * 0.2 + 50.0) - 0.5) * 0.003;
        edge += detectEdge(vUv, offset);
      }
      edge = min(edge / 2.0, 1.0);

      vec3 finalColor = mix(paper, vec3(0.17), edge);
      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},pz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 c) { return dot(c, vec3(0.299, 0.587, 0.114)); }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness * 1.5) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float l = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float t = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float b = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.04, 0.15, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);
      float lum = luma(texColor.rgb);

      // Cream paper
      vec3 paper = vec3(1.0, 0.996, 0.94);
      vec3 ink = vec3(0.1, 0.1, 0.1);

      // Variable line width based on luminance
      float lineThickness = edge * (1.5 - lum * 0.5);

      // Ink wash for darker areas
      float wash = (1.0 - lum) * 0.15;

      vec3 finalColor = paper;
      finalColor = mix(finalColor, paper * 0.85, wash);
      finalColor = mix(finalColor, ink, min(lineThickness, 1.0));

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},hz={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},saturation:{value:1.4},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform float saturation;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    float detectEdge(vec2 uv) {
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float t  = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float l  = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r  = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float b  = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(0.05, 0.15, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);

      // Boost saturation
      float gray = dot(texColor.rgb, vec3(0.299, 0.587, 0.114));
      vec3 saturated = mix(vec3(gray), texColor.rgb, saturation);
      saturated = clamp(saturated, 0.0, 1.0);

      // Thin dark outlines
      vec3 finalColor = mix(saturated, vec3(0.0), edge * 0.8);

      gl_FragColor = vec4(finalColor, 1.0);
    }
  `},L0={uniforms:{tDiffuse:{value:null},resolution:{value:new ct(1920,1080)},bgColor:{value:new bt(1,1,1)},lineColor:{value:new bt(0,0,0)},sceneBg:{value:new bt(1710638)},threshold:{value:.1},thickness:{value:1}},vertexShader:`
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    uniform vec3 bgColor;
    uniform vec3 lineColor;
    uniform vec3 sceneBg;
    uniform float threshold;
    uniform float thickness;
    varying vec2 vUv;

    float luma(vec3 color) {
      vec3 c = clamp(color, 0.0, 1.0);
      return dot(c, vec3(0.299, 0.587, 0.114));
    }

    float detectEdge(vec2 uv) {
      if (resolution.x < 1.0 || resolution.y < 1.0) return 0.0;
      vec2 texel = vec2(thickness) / resolution;
      float tl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, texel.y)).rgb);
      float t  = luma(texture2D(tDiffuse, uv + vec2(0.0, texel.y)).rgb);
      float tr = luma(texture2D(tDiffuse, uv + vec2(texel.x, texel.y)).rgb);
      float l  = luma(texture2D(tDiffuse, uv + vec2(-texel.x, 0.0)).rgb);
      float r  = luma(texture2D(tDiffuse, uv + vec2(texel.x, 0.0)).rgb);
      float bl = luma(texture2D(tDiffuse, uv + vec2(-texel.x, -texel.y)).rgb);
      float b  = luma(texture2D(tDiffuse, uv + vec2(0.0, -texel.y)).rgb);
      float br = luma(texture2D(tDiffuse, uv + vec2(texel.x, -texel.y)).rgb);
      float gx = -tl - 2.0*l - bl + tr + 2.0*r + br;
      float gy = -tl - 2.0*t - tr + bl + 2.0*b + br;
      return smoothstep(threshold, threshold + 0.1, sqrt(gx*gx + gy*gy));
    }

    void main() {
      vec4 texColor = texture2D(tDiffuse, vUv);
      float edge = detectEdge(vUv);

      // Detect background vs geometry by comparing to scene clear color
      float dist = length(texColor.rgb - sceneBg);
      float isGeometry = smoothstep(0.02, 0.08, dist);

      // Show block fills where geometry exists, style bgColor otherwise
      vec3 fills = mix(bgColor, texColor.rgb, isGeometry);

      // Overlay edge lines
      vec3 finalColor = mix(fills, lineColor, edge);
      gl_FragColor = vec4(finalColor, 1.0);
    }
  `};class U0{constructor(t,e){this.engine=t,this.blockManager=e,this.renderer=t.renderer,this.scene=t.scene,this.camera=t.camera,this.enabled=!1,this.style="clean",this.inverted=!1,this.grayscale=!1,this.threshold=.5,this.lineWidth=2,this.showFills=!0,this.quality="medium",this.width=window.innerWidth,this.height=window.innerHeight,this.setupRenderTargets(),this.setupComposers(),this.createCharacterTexture(),this.time=0,window.addEventListener("resize",()=>this.onResize())}setupRenderTargets(){const t={minFilter:uo,magFilter:uo,format:fo};this.sceneTarget=new mo(this.width,this.height,t),this.edgeTarget=new mo(this.width,this.height,t)}setupComposers(){this.composer=new I0(this.renderer),this.stylePass=null}createCharacterTexture(){const t=document.createElement("canvas"),e=" .:-=+*#%@",o=16,n=24;t.width=o*e.length,t.height=n;const s=t.getContext("2d");s.fillStyle="#000000",s.fillRect(0,0,t.width,t.height),s.fillStyle="#ffffff",s.font="bold 20px monospace",s.textAlign="center",s.textBaseline="middle";for(let r=0;r<e.length;r++)s.fillText(e[r],r*o+o/2,n/2);this.charTexture=new yc(t),this.charTexture.minFilter=Se,this.charTexture.magFilter=Se}setEnabled(t){this.enabled=t,t?(this.updateStyle(),this.engine.customRender=()=>this.render()):this.engine.customRender=null}setStyle(t){this.style=t,this.enabled&&this.updateStyle()}setInverted(t){this.inverted=t,this.updateStyleUniforms()}setGrayscale(t){this.grayscale=t,this.updateStyleUniforms()}setThreshold(t){this.threshold=t,this.sobelPass&&(this.sobelPass.uniforms.threshold.value=t*.2)}setLineWidth(t){this.lineWidth=t,this.sobelPass&&(this.sobelPass.uniforms.thickness.value=t)}setShowFills(t){this.showFills=t}setQuality(t){this.quality=t}updateStyle(){this.composer=new I0(this.renderer),this.composer.setSize(this.width,this.height),this.renderPass=new jM(this.engine.scene,this.engine.camera),this.composer.addPass(this.renderPass);const e={clean:L0,sketch:cz,ink:pz,crosshatch:tz,blueprint:lz,comic:ez,saturated:hz,neon:nz,scifi:az,watercolor:rz,noir:sz,synthwave:iz,ascii:oz}[this.style]||L0;if(this.stylePass=new R0(e),this.composer.addPass(this.stylePass),["neon","synthwave","scifi"].includes(this.style)){const o=new Ji(new ct(this.width,this.height),.5,.4,.85);this.composer.addPass(o)}this.composer.addPass(new QM),this.updateStyleUniforms()}updateStyleUniforms(){if(!this.stylePass)return;const t=this.getColors(),e=this.stylePass.uniforms;switch(e.resolution&&e.resolution.value.set(this.width,this.height),e.bgColor&&e.bgColor.value.set(t.bg),e.lineColor&&e.lineColor.value.set(t.fg),e.threshold&&(e.threshold.value=this.threshold*.3),e.thickness&&(e.thickness.value=this.lineWidth),this.style){case"clean":break;case"crosshatch":e.spacing&&(e.spacing.value=10-this.lineWidth),e.lineWidth&&(e.lineWidth.value=this.lineWidth*.5);break;case"comic":e.dotSize.value=this.lineWidth*2,e.spacing.value=this.lineWidth*4,e.dotColor.value.set(t.fg);break;case"ascii":e.tCharacters.value=this.charTexture,e.charSize.value.set(8,16),e.textColor.value.set(t.fg),e.colorMode.value=this.grayscale?0:1;break;case"neon":e.glowColor.value.set(t.fg),e.accentColor.value.set(t.accent||16711935);break;case"noir":e.threshold.value=this.threshold;break;case"saturated":e.saturation.value=1.4;break}}getColors(){const t={clean:{bg:"#ffffff",fg:"#000000",accent:"#000000"},sketch:{bg:"#f5f5dc",fg:"#2c2c2c",accent:"#4a4a4a"},ink:{bg:"#fffef0",fg:"#1a1a1a",accent:"#000000"},crosshatch:{bg:"#ffffff",fg:"#000000",accent:"#444444"},blueprint:{bg:"#1e3a5f",fg:"#87ceeb",accent:"#add8e6"},comic:{bg:"#ffffff",fg:"#000000",accent:"#ff0000"},saturated:{bg:"#ffffff",fg:"#000000",accent:"#333333"},neon:{bg:"#0a0a0f",fg:"#00ffff",accent:"#ff00ff"},scifi:{bg:"#0d1117",fg:"#58a6ff",accent:"#238636"},watercolor:{bg:"#faf8f5",fg:"#2c4a52",accent:"#8b4513"},noir:{bg:"#000000",fg:"#ffffff",accent:"#808080"},synthwave:{bg:"#1a1a2e",fg:"#ff6ec7",accent:"#00fff7"},ascii:{bg:"#000000",fg:"#00ff00",accent:"#00aa00"}};let e=t[this.style]||t.clean;return this.inverted&&(e={...e,bg:e.fg,fg:e.bg}),e}onResize(){this.width=window.innerWidth,this.height=window.innerHeight,this.sceneTarget.setSize(this.width,this.height),this.edgeTarget.setSize(this.width,this.height),this.composer&&this.composer.setSize(this.width,this.height),this.sobelPass&&this.sobelPass.uniforms.resolution.value.set(this.width,this.height),this.updateStyleUniforms()}render(t=!1){if(!this.enabled){this.renderer.render(this.engine.scene,this.engine.camera);return}this.time+=.016,this.stylePass&&this.stylePass.uniforms.time&&(this.stylePass.uniforms.time.value=this.time),this.composer.render()}update(){this.enabled&&this.render()}invalidateCache(){}capturePNG(t="render.png"){this.render(!0);const e=this.renderer.domElement,o=document.createElement("a");o.download=t,o.href=e.toDataURL("image/png"),o.click()}exportSVG(t="render.svg"){console.warn("SVG export not fully supported in GPU mode")}dispose(){this.sceneTarget.dispose(),this.edgeTarget.dispose(),this.charTexture&&this.charTexture.dispose()}}class uz{constructor(t){this.engine=t,this.frames=[],this.isCapturing=!1,this.onProgress=null}async captureFrame(t,e="image/jpeg",o=.92){var a;this.engine.renderer.render(this.engine.scene,this.engine.camera);const n=document.getElementById("tattoo-overlay"),s=n&&n.style.display!=="none";if(s){const l=(a=window.appInstance)==null?void 0:a.tattooRenderer;l&&l.enabled&&l.render()}let r=this.engine.canvas;if(s){const l=document.createElement("canvas");l.width=this.engine.canvas.width,l.height=this.engine.canvas.height;const c=l.getContext("2d");c.drawImage(this.engine.canvas,0,0),c.drawImage(n,0,0),r=l}return new Promise(l=>{r.toBlob(c=>{l({frameNumber:t,blob:c,dataUrl:URL.createObjectURL(c),timestamp:Date.now()})},e,o)})}async captureSequence(t){const{animator:e,bookmarks:o,totalFrames:n,onProgress:s,format:r="image/jpeg",quality:a=.92}=t;if(o.length<2)throw new Error("Need at least 2 bookmarks to capture sequence");return this.frames=[],this.isCapturing=!0,await e.renderSequence(o,n,async(l,c)=>{const p=await this.captureFrame(l,r,a);this.frames.push(p),s&&s({current:l+1,total:c,percent:((l+1)/c*100).toFixed(1)})},()=>{this.isCapturing=!1}),this.frames}async exportIndividualFrames(t=null,e="frame_"){const o=t||this.frames;for(let n=0;n<o.length;n++){const s=o[n],r=document.createElement("a"),a=String(s.frameNumber).padStart(4,"0");r.download=`${e}${a}.jpg`,r.href=s.dataUrl,r.click(),await this.sleep(100)}}async exportAsZip(t=null,e="camera_sequence.zip"){const o=t||this.frames;if(!window.JSZip)throw new Error("JSZip library not loaded. Please include it in your project.");const n=window.JSZip,s=new n;for(const a of o){const l=String(a.frameNumber).padStart(4,"0"),c=a.blob.type==="image/png"?"png":"jpg";s.file(`frame_${l}.${c}`,a.blob)}const r=await s.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}});return this.downloadBlob(r,e),r}async exportAsMP4Realtime(t,e,o=3e3,n="camera_path.webm",s=null){const a=Math.floor(o/1e3*30);return console.log(`Exporting video: ${a} frames at 30 FPS`),this.exportAsMP4FrameByFrame(t,e,a,30,n,s)}async exportAsMP4FrameByFrame(t,e,o,n,s="camera_path.webm",r=null){var f;const a=document.getElementById("tattoo-overlay"),l=a&&a.style.display!=="none",c=(f=window.appInstance)==null?void 0:f.tattooRenderer,p=document.createElement("canvas");p.width=this.engine.canvas.width,p.height=this.engine.canvas.height;const h=p.getContext("2d",{willReadFrequently:!0});console.log(`Starting WebM export: ${o} frames at ${n} FPS`);const u=p.captureStream(n);let d="video/webm;codecs=vp9";MediaRecorder.isTypeSupported(d)||(d="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(d)||(d="video/webm"));const y=new MediaRecorder(u,{mimeType:d,videoBitsPerSecond:8e6}),g=[];return new Promise((m,b)=>{y.ondataavailable=E=>{E.data.size>0&&(g.push(E.data),console.log(`Chunk received: ${E.data.size} bytes (total chunks: ${g.length})`))},y.onstop=()=>{console.log(`Recording stopped. Total chunks: ${g.length}, total size: ${g.reduce((C,M)=>C+M.size,0)} bytes`);const E=new Blob(g,{type:d});if(console.log(`Final video blob size: ${E.size} bytes`),E.size<1e4){console.error("Video blob is suspiciously small - recording may have failed"),b(new Error("Video recording failed - file too small. Try using JPG Sequence export instead."));return}this.downloadBlob(E,s),m(E)},y.onerror=b,y.start(100);let v=0;const x=1e3/n;let _=performance.now();const z=()=>{if(v>=o){setTimeout(()=>{y.stop()},1e3);return}const E=t.getCameraAtFrame(v,o,e);t.setCameraState(E),this.engine.renderer.render(this.engine.scene,this.engine.camera),l&&c&&c.enabled&&c.render(!0),h.fillStyle=`rgb(${v%255}, 0, 0)`,h.fillRect(0,0,1,1),h.clearRect(0,0,p.width,p.height),h.drawImage(this.engine.canvas,0,0),l&&a&&h.drawImage(a,0,0),v%30===0&&console.log(`Frame ${v}/${o} rendered, camera:`,t.camera.position.x.toFixed(1),t.camera.position.y.toFixed(1),t.camera.position.z.toFixed(1)),v++,r&&r({current:v,total:o,percent:(v/o*100).toFixed(1)});const M=performance.now()-_,S=v*x,k=Math.max(0,S-M);setTimeout(()=>{requestAnimationFrame(z)},k)};requestAnimationFrame(z)})}async exportAsMP4RealtimeOld(t,e,o=3e3,n="camera_path.webm"){let s,r,a;if(hasTattooOverlay)r=document.createElement("canvas"),r.width=this.engine.canvas.width,r.height=this.engine.canvas.height,a=r.getContext("2d"),s=r.captureStream(30);else{if(!this.engine.canvas.captureStream)throw new Error("Canvas.captureStream() not supported in this browser");s=this.engine.canvas.captureStream(30)}let l="video/webm;codecs=vp9";MediaRecorder.isTypeSupported(l)||(l="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(l)||(l="video/webm"));const c=new MediaRecorder(s,{mimeType:l,videoBitsPerSecond:8e6}),p=[];return new Promise((h,u)=>{var d;if(c.ondataavailable=y=>{y.data.size>0&&p.push(y.data)},c.onstop=()=>{const y=new Blob(p,{type:l});this.downloadBlob(y,n),h(y)},c.onerror=y=>{u(y)},c.start(),r&&a){const y=(d=window.appInstance)==null?void 0:d.tattooRenderer,g=this.engine.onUpdate;this.engine.onUpdate=f=>{g&&g(f),y&&y.enabled&&y.render(),a.clearRect(0,0,r.width,r.height),a.drawImage(this.engine.canvas,0,0),tattooOverlay&&a.drawImage(tattooOverlay,0,0)},t.preview(e,o,()=>{this.engine.onUpdate=g,setTimeout(()=>{c.stop()},500)})}else t.preview(e,o,()=>{setTimeout(()=>{c.stop()},500)})})}downloadBlob(t,e){const o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=e,n.click(),setTimeout(()=>URL.revokeObjectURL(o),100)}clear(){this.frames.forEach(t=>{t.dataUrl&&URL.revokeObjectURL(t.dataUrl)}),this.frames=[]}getMemoryUsage(){return(this.frames.reduce((e,o)=>e+o.blob.size,0)/1024/1024).toFixed(2)}sleep(t){return new Promise(e=>setTimeout(e,t))}}const N0=0,dz=1,fz=2,O0=2,qc=1.25,V0=1,qe=32,Ie=qe/4,H0=65535,ia=Math.pow(2,-24),jc=Symbol("SKIP_GENERATION"),G0={strategy:N0,maxDepth:40,maxLeafSize:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null,[jc]:!1};function Ee(i,t,e){return e.min.x=t[i],e.min.y=t[i+1],e.min.z=t[i+2],e.max.x=t[i+3],e.max.y=t[i+4],e.max.z=t[i+5],e}function X0(i){let t=-1,e=-1/0;for(let o=0;o<3;o++){const n=i[o+3]-i[o];n>e&&(e=n,t=o)}return t}function W0(i,t){t.set(i)}function Z0(i,t,e){let o,n;for(let s=0;s<3;s++){const r=s+3;o=i[s],n=t[s],e[s]=o<n?o:n,o=i[r],n=t[r],e[r]=o>n?o:n}}function sa(i,t,e){for(let o=0;o<3;o++){const n=t[i+2*o],s=t[i+2*o+1],r=n-s,a=n+s;r<e[o]&&(e[o]=r),a>e[o+3]&&(e[o+3]=a)}}function Os(i){const t=i[3]-i[0],e=i[4]-i[1],o=i[5]-i[2];return 2*(t*e+e*o+o*t)}function Le(i,t){return t[i+15]===H0}function je(i,t){return t[i+6]}function so(i,t){return t[i+14]}function Xe(i){return i+Ie}function We(i,t){const e=t[i+6];return i+e*Ie}function Kc(i,t){return t[i+7]}function QS(i){return i}function Jc(i,t,e,o,n){let s=1/0,r=1/0,a=1/0,l=-1/0,c=-1/0,p=-1/0,h=1/0,u=1/0,d=1/0,y=-1/0,g=-1/0,f=-1/0;const m=i.offset||0;for(let b=(t-m)*6,v=(t+e-m)*6;b<v;b+=6){const x=i[b+0],_=i[b+1],z=x-_,E=x+_;z<s&&(s=z),E>l&&(l=E),x<h&&(h=x),x>y&&(y=x);const C=i[b+2],M=i[b+3],S=C-M,k=C+M;S<r&&(r=S),k>c&&(c=k),C<u&&(u=C),C>g&&(g=C);const A=i[b+4],B=i[b+5],F=A-B,N=A+B;F<a&&(a=F),N>p&&(p=N),A<d&&(d=A),A>f&&(f=A)}o[0]=s,o[1]=r,o[2]=a,o[3]=l,o[4]=c,o[5]=p,n[0]=h,n[1]=u,n[2]=d,n[3]=y,n[4]=g,n[5]=f}const rn=32,mz=(i,t)=>i.candidate-t.candidate,En=new Array(rn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),ra=new Float32Array(6);function yz(i,t,e,o,n,s){let r=-1,a=0;if(s===N0)r=X0(t),r!==-1&&(a=(t[r]+t[r+3])/2);else if(s===dz)r=X0(i),r!==-1&&(a=gz(e,o,n,r));else if(s===fz){const l=Os(i);let c=qc*n;const p=e.offset||0,h=(o-p)*6,u=(o+n-p)*6;for(let d=0;d<3;d++){const y=t[d],m=(t[d+3]-y)/rn;if(n<rn/4){const b=[...En];b.length=n;let v=0;for(let _=h;_<u;_+=6,v++){const z=b[v];z.candidate=e[_+2*d],z.count=0;const{bounds:E,leftCacheBounds:C,rightCacheBounds:M}=z;for(let S=0;S<3;S++)M[S]=1/0,M[S+3]=-1/0,C[S]=1/0,C[S+3]=-1/0,E[S]=1/0,E[S+3]=-1/0;sa(_,e,E)}b.sort(mz);let x=n;for(let _=0;_<x;_++){const z=b[_];for(;_+1<x&&b[_+1].candidate===z.candidate;)b.splice(_+1,1),x--}for(let _=h;_<u;_+=6){const z=e[_+2*d];for(let E=0;E<x;E++){const C=b[E];z>=C.candidate?sa(_,e,C.rightCacheBounds):(sa(_,e,C.leftCacheBounds),C.count++)}}for(let _=0;_<x;_++){const z=b[_],E=z.count,C=n-z.count,M=z.leftCacheBounds,S=z.rightCacheBounds;let k=0;E!==0&&(k=Os(M)/l);let A=0;C!==0&&(A=Os(S)/l);const B=V0+qc*(k*E+A*C);B<c&&(r=d,c=B,a=z.candidate)}}else{for(let x=0;x<rn;x++){const _=En[x];_.count=0,_.candidate=y+m+x*m;const z=_.bounds;for(let E=0;E<3;E++)z[E]=1/0,z[E+3]=-1/0}for(let x=h;x<u;x+=6){let E=~~((e[x+2*d]-y)/m);E>=rn&&(E=rn-1);const C=En[E];C.count++,sa(x,e,C.bounds)}const b=En[rn-1];W0(b.bounds,b.rightCacheBounds);for(let x=rn-2;x>=0;x--){const _=En[x],z=En[x+1];Z0(_.bounds,z.rightCacheBounds,_.rightCacheBounds)}let v=0;for(let x=0;x<rn-1;x++){const _=En[x],z=_.count,E=_.bounds,M=En[x+1].rightCacheBounds;z!==0&&(v===0?W0(E,ra):Z0(E,ra,ra)),v+=z;let S=0,k=0;v!==0&&(S=Os(ra)/l);const A=n-v;A!==0&&(k=Os(M)/l);const B=V0+qc*(S*v+k*A);B<c&&(r=d,c=B,a=_.candidate)}}}}else console.warn(`BVH: Invalid build strategy value ${s} used.`);return{axis:r,pos:a}}function gz(i,t,e,o){let n=0;const s=i.offset;for(let r=t,a=t+e;r<a;r++)n+=i[(r-s)*6+o*2];return n/e}class Qc{constructor(){this.boundingData=new Float32Array(6)}}function xz(i,t,e,o,n,s){let r=o,a=o+n-1;const l=s.pos,c=s.axis*2,p=e.offset||0;for(;;){for(;r<=a&&e[(r-p)*6+c]<l;)r++;for(;r<=a&&e[(a-p)*6+c]>=l;)a--;if(r<a){for(let h=0;h<t;h++){let u=i[r*t+h];i[r*t+h]=i[a*t+h],i[a*t+h]=u}for(let h=0;h<6;h++){const u=r-p,d=a-p,y=e[u*6+h];e[u*6+h]=e[d*6+h],e[d*6+h]=y}r++,a--}else return r}}let Y0,aa,tp,$0;const bz=Math.pow(2,32);function ep(i){return"count"in i?1:1+ep(i.left)+ep(i.right)}function vz(i,t,e){return Y0=new Float32Array(e),aa=new Uint32Array(e),tp=new Uint16Array(e),$0=new Uint8Array(e),op(i,t)}function op(i,t){const e=i/4,o=i/2,n="count"in t,s=t.boundingData;for(let r=0;r<6;r++)Y0[e+r]=s[r];if(n)return t.buffer?($0.set(new Uint8Array(t.buffer),i),i+t.buffer.byteLength):(aa[e+6]=t.offset,tp[o+14]=t.count,tp[o+15]=H0,i+qe);{const{left:r,right:a,splitAxis:l}=t,c=i+qe;let p=op(c,r);const h=i/qe,d=p/qe-h;if(d>bz)throw new Error("MeshBVH: Cannot store relative child node offset greater than 32 bits.");return aa[e+6]=d,aa[e+7]=l,op(p,a)}}function _z(i,t,e,o,n){const{maxDepth:s,verbose:r,maxLeafSize:a,strategy:l,onProgress:c}=n,p=i.primitiveBuffer,h=i.primitiveBufferStride,u=new Float32Array(6);let d=!1;const y=new Qc;return Jc(t,e,o,y.boundingData,u),f(y,e,o,u),y;function g(m){c&&c(m/o)}function f(m,b,v,x=null,_=0){if(!d&&_>=s&&(d=!0,r&&console.warn(`BVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`)),v<=a||_>=s)return g(b+v),m.offset=b,m.count=v,m;const z=yz(m.boundingData,x,t,b,v,l);if(z.axis===-1)return g(b+v),m.offset=b,m.count=v,m;const E=xz(p,h,t,b,v,z);if(E===b||E===b+v)g(b+v),m.offset=b,m.count=v;else{m.splitAxis=z.axis;const C=new Qc,M=b,S=E-b;m.left=C,Jc(t,M,S,C.boundingData,u),f(C,M,S,u,_+1);const k=new Qc,A=E,B=v-S;m.right=k,Jc(t,A,B,k.boundingData,u),f(k,A,B,u,_+1)}return m}}function wz(i,t){const e=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=i.getRootRanges(t.range),n=o[0],s=o[o.length-1],r={offset:n.offset,count:s.offset+s.count-n.offset},a=new Float32Array(6*r.count);a.offset=r.offset,i.computePrimitiveBounds(r.offset,r.count,a),i._roots=o.map(l=>{const c=_z(i,a,l.offset,l.count,t),p=ep(c),h=new e(qe*p);return vz(0,c,h),h})}class np{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class Mz{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=o=>{e&&t.push(e),e=o,this.float32Array=new Float32Array(o),this.uint16Array=new Uint16Array(o),this.uint32Array=new Uint32Array(o)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const ve=new Mz;let Fn,Qi;const ts=[],la=new np(()=>new Ne);function zz(i,t,e,o,n,s){Fn=la.getPrimitive(),Qi=la.getPrimitive(),ts.push(Fn,Qi),ve.setBuffer(i._roots[t]);const r=ip(0,i.geometry,e,o,n,s);ve.clearBuffer(),la.releasePrimitive(Fn),la.releasePrimitive(Qi),ts.pop(),ts.pop();const a=ts.length;return a>0&&(Qi=ts[a-1],Fn=ts[a-2]),r}function ip(i,t,e,o,n=null,s=0,r=0){const{float32Array:a,uint16Array:l,uint32Array:c}=ve;let p=i*2;if(Le(p,l)){const u=je(i,c),d=so(p,l);return Ee(i,a,Fn),o(u,d,!1,r,s+i/Ie,Fn)}else{let S=function(A){const{uint16Array:B,uint32Array:F}=ve;let N=A*2;for(;!Le(N,B);)A=Xe(A),N=A*2;return je(A,F)},k=function(A){const{uint16Array:B,uint32Array:F}=ve;let N=A*2;for(;!Le(N,B);)A=We(A,F),N=A*2;return je(A,F)+so(N,B)};const u=Xe(i),d=We(i,c);let y=u,g=d,f,m,b,v;if(n&&(b=Fn,v=Qi,Ee(y,a,b),Ee(g,a,v),f=n(b),m=n(v),m<f)){y=d,g=u;const A=f;f=m,m=A,b=v}b||(b=Fn,Ee(y,a,b));const x=Le(y*2,l),_=e(b,x,f,r+1,s+y/Ie);let z;if(_===O0){const A=S(y),F=k(y)-A;z=o(A,F,!0,r+1,s+y/Ie,b)}else z=_&&ip(y,t,e,o,n,s,r+1);if(z)return!0;v=Qi,Ee(g,a,v);const E=Le(g*2,l),C=e(v,E,m,r+1,s+g/Ie);let M;if(C===O0){const A=S(g),F=k(g)-A;M=o(A,F,!0,r+1,s+g/Ie,v)}else M=C&&ip(g,t,e,o,n,s,r+1);return!!M}}const Vs=new ve.constructor,ca=new ve.constructor,An=new np(()=>new Ne),es=new Ne,os=new Ne,sp=new Ne,rp=new Ne;let ap=!1;function Sz(i,t,e,o){if(ap)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");ap=!0;const n=i._roots,s=t._roots;let r,a=0,l=0;const c=new $t().copy(e).invert();for(let p=0,h=n.length;p<h;p++){Vs.setBuffer(n[p]),l=0;const u=An.getPrimitive();Ee(0,Vs.float32Array,u),u.applyMatrix4(c);for(let d=0,y=s.length;d<y&&(ca.setBuffer(s[d]),r=Io(0,0,e,c,o,a,l,0,0,u),ca.clearBuffer(),l+=s[d].byteLength/qe,!r);d++);if(An.releasePrimitive(u),Vs.clearBuffer(),a+=n[p].byteLength/qe,r)break}return ap=!1,r}function Io(i,t,e,o,n,s=0,r=0,a=0,l=0,c=null,p=!1){let h,u;p?(h=ca,u=Vs):(h=Vs,u=ca);const d=h.float32Array,y=h.uint32Array,g=h.uint16Array,f=u.float32Array,m=u.uint32Array,b=u.uint16Array,v=i*2,x=t*2,_=Le(v,g),z=Le(x,b);let E=!1;if(z&&_)p?E=n(je(t,m),so(t*2,b),je(i,y),so(i*2,g),l,r+t/Ie,a,s+i/Ie):E=n(je(i,y),so(i*2,g),je(t,m),so(t*2,b),a,s+i/Ie,l,r+t/Ie);else if(z){const C=An.getPrimitive();Ee(t,f,C),C.applyMatrix4(e);const M=Xe(i),S=We(i,y);Ee(M,d,es),Ee(S,d,os);const k=C.intersectsBox(es),A=C.intersectsBox(os);E=k&&Io(t,M,o,e,n,r,s,l,a+1,C,!p)||A&&Io(t,S,o,e,n,r,s,l,a+1,C,!p),An.releasePrimitive(C)}else{const C=Xe(t),M=We(t,m);Ee(C,f,sp),Ee(M,f,rp);const S=c.intersectsBox(sp),k=c.intersectsBox(rp);if(S&&k)E=Io(i,C,e,o,n,s,r,a,l+1,c,p)||Io(i,M,e,o,n,s,r,a,l+1,c,p);else if(S)if(_)E=Io(i,C,e,o,n,s,r,a,l+1,c,p);else{const A=An.getPrimitive();A.copy(sp).applyMatrix4(e);const B=Xe(i),F=We(i,y);Ee(B,d,es),Ee(F,d,os);const N=A.intersectsBox(es),G=A.intersectsBox(os);E=N&&Io(C,B,o,e,n,r,s,l,a+1,A,!p)||G&&Io(C,F,o,e,n,r,s,l,a+1,A,!p),An.releasePrimitive(A)}else if(k)if(_)E=Io(i,M,e,o,n,s,r,a,l+1,c,p);else{const A=An.getPrimitive();A.copy(rp).applyMatrix4(e);const B=Xe(i),F=We(i,y);Ee(B,d,es),Ee(F,d,os);const N=A.intersectsBox(es),G=A.intersectsBox(os);E=N&&Io(M,B,o,e,n,r,s,l,a+1,A,!p)||G&&Io(M,F,o,e,n,r,s,l,a+1,A,!p),An.releasePrimitive(A)}}return E}const q0=new Ne,ns=new Float32Array(6);class Ez{constructor(){this._roots=null,this.primitiveBuffer=null,this.primitiveBufferStride=null}init(t){t={...G0,...t},wz(this,t)}getRootRanges(){throw new Error("BVH: getRootRanges() not implemented")}writePrimitiveBounds(){throw new Error("BVH: writePrimitiveBounds() not implemented")}writePrimitiveRangeBounds(t,e,o,n){let s=1/0,r=1/0,a=1/0,l=-1/0,c=-1/0,p=-1/0;for(let h=t,u=t+e;h<u;h++){this.writePrimitiveBounds(h,ns,0);const[d,y,g,f,m,b]=ns;d<s&&(s=d),f>l&&(l=f),y<r&&(r=y),m>c&&(c=m),g<a&&(a=g),b>p&&(p=b)}return o[n+0]=s,o[n+1]=r,o[n+2]=a,o[n+3]=l,o[n+4]=c,o[n+5]=p,o}computePrimitiveBounds(t,e,o){const n=o.offset||0;for(let s=t,r=t+e;s<r;s++){this.writePrimitiveBounds(s,ns,0);const[a,l,c,p,h,u]=ns,d=(a+p)/2,y=(l+h)/2,g=(c+u)/2,f=(p-a)/2,m=(h-l)/2,b=(u-c)/2,v=(s-n)*6;o[v+0]=d,o[v+1]=f+(Math.abs(d)+f)*ia,o[v+2]=y,o[v+3]=m+(Math.abs(y)+m)*ia,o[v+4]=g,o[v+5]=b+(Math.abs(g)+b)*ia}return o}shiftPrimitiveOffsets(t){const e=this._indirectBuffer;if(e)for(let o=0,n=e.length;o<n;o++)e[o]+=t;else{const o=this._roots;for(let n=0;n<o.length;n++){const s=o[n],r=new Uint32Array(s),a=new Uint16Array(s),l=s.byteLength/qe;for(let c=0;c<l;c++){const p=Ie*c,h=2*p;Le(h,a)&&(r[p+6]+=t)}}}}traverse(t,e=0){const o=this._roots[e],n=new Uint32Array(o),s=new Uint16Array(o);r(0);function r(a,l=0){const c=a*2,p=Le(c,s);if(p){const h=n[a+6],u=s[c+14];t(l,p,new Float32Array(o,a*4,6),h,u)}else{const h=Xe(a),u=We(a,n),d=Kc(a,n);t(l,p,new Float32Array(o,a*4,6),d)||(r(h,l+1),r(u,l+1))}}}refit(){const t=this._roots;for(let e=0,o=t.length;e<o;e++){const n=t[e],s=new Uint32Array(n),r=new Uint16Array(n),a=new Float32Array(n),l=n.byteLength/qe;for(let c=l-1;c>=0;c--){const p=c*Ie,h=p*2;if(Le(h,r)){const d=je(p,s),y=so(h,r);this.writePrimitiveRangeBounds(d,y,ns,0),a.set(ns,p)}else{const d=Xe(p),y=We(p,s);for(let g=0;g<3;g++){const f=a[d+g],m=a[d+g+3],b=a[y+g],v=a[y+g+3];a[p+g]=f<b?f:b,a[p+g+3]=m>v?m:v}}}}}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(o=>{Ee(0,new Float32Array(o),q0),t.union(q0)}),t}shapecast(t){let{boundsTraverseOrder:e,intersectsBounds:o,intersectsRange:n,intersectsPrimitive:s,scratchPrimitive:r,iterate:a}=t;if(n&&s){const h=n;n=(u,d,y,g,f)=>h(u,d,y,g,f)?!0:a(u,d,this,s,y,g,r)}else n||(s?n=(h,u,d,y)=>a(h,u,this,s,d,y,r):n=(h,u,d)=>d);let l=!1,c=0;const p=this._roots;for(let h=0,u=p.length;h<u;h++){const d=p[h];if(l=zz(this,h,o,n,e,c),l)break;c+=d.byteLength/qe}return l}bvhcast(t,e,o){let{intersectsRanges:n}=o;return Sz(this,t,e,n)}}function Fz(){return typeof SharedArrayBuffer<"u"}function lp(i){return i.index?i.index.count:i.attributes.position.count}function pa(i){return lp(i)/3}function Az(i,t=ArrayBuffer){return i>65535?new Uint32Array(new t(4*i)):new Uint16Array(new t(2*i))}function Tz(i,t){if(!i.index){const e=i.attributes.position.count,o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=Az(e,o);i.setIndex(new Gt(n,1));for(let s=0;s<e;s++)n[s]=s}}function Cz(i,t,e){const o=lp(i)/e,n=t||i.drawRange,s=n.start/e,r=(n.start+n.count)/e,a=Math.max(0,s),l=Math.min(o,r)-a;return{offset:Math.floor(a),count:Math.floor(l)}}function kz(i,t){return i.groups.map(e=>({offset:e.start/t,count:e.count/t}))}function j0(i,t,e){const o=Cz(i,t,e),n=kz(i,e);if(!n.length)return[o];const s=[],r=o.offset,a=o.offset+o.count,l=lp(i)/e,c=[];for(const u of n){const{offset:d,count:y}=u,g=d,f=isFinite(y)?y:l-d,m=d+f;g<a&&m>r&&(c.push({pos:Math.max(r,g),isStart:!0}),c.push({pos:Math.min(a,m),isStart:!1}))}c.sort((u,d)=>u.pos!==d.pos?u.pos-d.pos:u.type==="end"?-1:1);let p=0,h=null;for(const u of c){const d=u.pos;p!==0&&d!==h&&s.push({offset:h,count:d-h}),p+=u.isStart?1:-1,h=d}return s}function Bz(i,t){const e=i[i.length-1],o=e.offset+e.count>2**16,n=i.reduce((c,p)=>c+p.count,0),s=o?4:2,r=t?new SharedArrayBuffer(n*s):new ArrayBuffer(n*s),a=o?new Uint32Array(r):new Uint16Array(r);let l=0;for(let c=0;c<i.length;c++){const{offset:p,count:h}=i[c];for(let u=0;u<h;u++)a[l+u]=p+u;l+=h}return a}class Pz extends Ez{get indirect(){return!!this._indirectBuffer}get primitiveStride(){return null}get primitiveBufferStride(){return this.indirect?1:this.primitiveStride}set primitiveBufferStride(t){}get primitiveBuffer(){return this.indirect?this._indirectBuffer:this.geometry.index.array}set primitiveBuffer(t){}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("BVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("BVH: Only BufferGeometries are supported.");if(e.useSharedArrayBuffer&&!Fz())throw new Error("BVH: SharedArrayBuffer is not available.");super(),this.geometry=t,this.resolvePrimitiveIndex=e.indirect?o=>this._indirectBuffer[o]:o=>o,this.primitiveBuffer=null,this.primitiveBufferStride=null,this._indirectBuffer=null,e={...G0,...e},e[jc]||this.init(e)}init(t){const{geometry:e,primitiveStride:o}=this;if(t.indirect){const n=j0(e,t.range,o),s=Bz(n,t.useSharedArrayBuffer);this._indirectBuffer=s}else Tz(e,t);super.init(t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ne))}getRootRanges(t){return this.indirect?[{offset:0,count:this._indirectBuffer.length}]:j0(this.geometry,t,this.primitiveStride)}raycastObject3D(){throw new Error("BVH: raycastObject3D() not implemented")}}class an{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let o=1/0,n=-1/0;for(let s=0,r=t.length;s<r;s++){const l=t[s][e];o=l<o?l:o,n=l>n?l:n}this.min=o,this.max=n}setFromPoints(t,e){let o=1/0,n=-1/0;for(let s=0,r=e.length;s<r;s++){const a=e[s],l=t.dot(a);o=l<o?l:o,n=l>n?l:n}this.min=o,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}}an.prototype.setFromBox=(function(){const i=new R;return function(e,o){const n=o.min,s=o.max;let r=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let p=0;p<=1;p++){i.x=n.x*l+s.x*(1-l),i.y=n.y*c+s.y*(1-c),i.z=n.z*p+s.z*(1-p);const h=e.dot(i);r=Math.min(h,r),a=Math.max(h,a)}this.min=r,this.max=a}})();const Rz=(function(){const i=new R,t=new R,e=new R;return function(n,s,r){const a=n.start,l=i,c=s.start,p=t;e.subVectors(a,c),i.subVectors(n.end,n.start),t.subVectors(s.end,s.start);const h=e.dot(p),u=p.dot(l),d=p.dot(p),y=e.dot(l),f=l.dot(l)*d-u*u;let m,b;f!==0?m=(h*u-y*d)/f:m=0,b=(h+m*u)/d,r.x=m,r.y=b}})(),cp=(function(){const i=new ct,t=new R,e=new R;return function(n,s,r,a){Rz(n,s,i);let l=i.x,c=i.y;if(l>=0&&l<=1&&c>=0&&c<=1){n.at(l,r),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),n.closestPointToPoint(a,!0,r);return}else if(c>=0&&c<=1){l<0?n.at(0,r):n.at(1,r),s.closestPointToPoint(r,!0,a);return}else{let p;l<0?p=n.start:p=n.end;let h;c<0?h=s.start:h=s.end;const u=t,d=e;if(n.closestPointToPoint(h,!0,t),s.closestPointToPoint(p,!0,e),u.distanceToSquared(h)<=d.distanceToSquared(p)){r.copy(u),a.copy(h);return}else{r.copy(p),a.copy(d);return}}}})(),Dz=(function(){const i=new R,t=new R,e=new Do,o=new Eo;return function(s,r){const{radius:a,center:l}=s,{a:c,b:p,c:h}=r;if(o.start=c,o.end=p,o.closestPointToPoint(l,!0,i).distanceTo(l)<=a||(o.start=c,o.end=h,o.closestPointToPoint(l,!0,i).distanceTo(l)<=a)||(o.start=p,o.end=h,o.closestPointToPoint(l,!0,i).distanceTo(l)<=a))return!0;const g=r.getPlane(e);if(Math.abs(g.distanceToPoint(l))<=a){const m=g.projectPoint(l,t);if(r.containsPoint(m))return!0}return!1}})(),Iz=["x","y","z"],ln=1e-15,K0=ln*ln;function Fo(i){return Math.abs(i)<ln}class Ao extends ye{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new R),this.satBounds=new Array(4).fill().map(()=>new an),this.points=[this.a,this.b,this.c],this.plane=new Do,this.isDegenerateIntoSegment=!1,this.isDegenerateIntoPoint=!1,this.degenerateSegment=new Eo,this.needsUpdate=!0}intersectsSphere(t){return Dz(t,this)}update(){const t=this.a,e=this.b,o=this.c,n=this.points,s=this.satAxes,r=this.satBounds,a=s[0],l=r[0];this.getNormal(a),l.setFromPoints(a,n);const c=s[1],p=r[1];c.subVectors(t,e),p.setFromPoints(c,n);const h=s[2],u=r[2];h.subVectors(e,o),u.setFromPoints(h,n);const d=s[3],y=r[3];d.subVectors(o,t),y.setFromPoints(d,n);const g=c.length(),f=h.length(),m=d.length();this.isDegenerateIntoPoint=!1,this.isDegenerateIntoSegment=!1,g<ln?f<ln||m<ln?this.isDegenerateIntoPoint=!0:(this.isDegenerateIntoSegment=!0,this.degenerateSegment.start.copy(t),this.degenerateSegment.end.copy(o)):f<ln?m<ln?this.isDegenerateIntoPoint=!0:(this.isDegenerateIntoSegment=!0,this.degenerateSegment.start.copy(e),this.degenerateSegment.end.copy(t)):m<ln&&(this.isDegenerateIntoSegment=!0,this.degenerateSegment.start.copy(o),this.degenerateSegment.end.copy(e)),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}Ao.prototype.closestPointToSegment=(function(){const i=new R,t=new R,e=new Eo;return function(n,s=null,r=null){const{start:a,end:l}=n,c=this.points;let p,h=1/0;for(let u=0;u<3;u++){const d=(u+1)%3;e.start.copy(c[u]),e.end.copy(c[d]),cp(e,n,i,t),p=i.distanceToSquared(t),p<h&&(h=p,s&&s.copy(i),r&&r.copy(t))}return this.closestPointToPoint(a,i),p=a.distanceToSquared(i),p<h&&(h=p,s&&s.copy(i),r&&r.copy(a)),this.closestPointToPoint(l,i),p=l.distanceToSquared(i),p<h&&(h=p,s&&s.copy(i),r&&r.copy(l)),Math.sqrt(h)}})(),Ao.prototype.intersectsTriangle=(function(){const i=new Ao,t=new an,e=new an,o=new R,n=new R,s=new R,r=new R,a=new Eo,l=new Eo,c=new R,p=new ct,h=new ct;function u(v,x,_,z){const E=o;!v.isDegenerateIntoPoint&&!v.isDegenerateIntoSegment?E.copy(v.plane.normal):E.copy(x.plane.normal);const C=v.satBounds,M=v.satAxes;for(let A=1;A<4;A++){const B=C[A],F=M[A];if(t.setFromPoints(F,x.points),B.isSeparated(t)||(r.copy(E).cross(F),t.setFromPoints(r,v.points),e.setFromPoints(r,x.points),t.isSeparated(e)))return!1}const S=x.satBounds,k=x.satAxes;for(let A=1;A<4;A++){const B=S[A],F=k[A];if(t.setFromPoints(F,v.points),B.isSeparated(t)||(r.crossVectors(E,F),t.setFromPoints(r,v.points),e.setFromPoints(r,x.points),t.isSeparated(e)))return!1}return _&&(z||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),_.start.set(0,0,0),_.end.set(0,0,0)),!0}function d(v,x,_,z,E,C,M,S,k,A,B){let F=M/(M-S);A.x=z+(E-z)*F,B.start.subVectors(x,v).multiplyScalar(F).add(v),F=M/(M-k),A.y=z+(C-z)*F,B.end.subVectors(_,v).multiplyScalar(F).add(v)}function y(v,x,_,z,E,C,M,S,k,A,B){if(E>0)d(v.c,v.a,v.b,z,x,_,k,M,S,A,B);else if(C>0)d(v.b,v.a,v.c,_,x,z,S,M,k,A,B);else if(S*k>0||M!=0)d(v.a,v.b,v.c,x,_,z,M,S,k,A,B);else if(S!=0)d(v.b,v.a,v.c,_,x,z,S,M,k,A,B);else if(k!=0)d(v.c,v.a,v.b,z,x,_,k,M,S,A,B);else return!0;return!1}function g(v,x,_,z){const E=x.degenerateSegment,C=v.plane.distanceToPoint(E.start),M=v.plane.distanceToPoint(E.end);return Fo(C)?Fo(M)?u(v,x,_,z):(_&&(_.start.copy(E.start),_.end.copy(E.start)),v.containsPoint(E.start)):Fo(M)?(_&&(_.start.copy(E.end),_.end.copy(E.end)),v.containsPoint(E.end)):v.plane.intersectLine(E,o)!=null?(_&&(_.start.copy(o),_.end.copy(o)),v.containsPoint(o)):!1}function f(v,x,_){const z=x.a;return Fo(v.plane.distanceToPoint(z))&&v.containsPoint(z)?(_&&(_.start.copy(z),_.end.copy(z)),!0):!1}function m(v,x,_){const z=v.degenerateSegment,E=x.a;return z.closestPointToPoint(E,!0,o),E.distanceToSquared(o)<K0?(_&&(_.start.copy(E),_.end.copy(E)),!0):!1}function b(v,x,_,z){if(v.isDegenerateIntoSegment)if(x.isDegenerateIntoSegment){const E=v.degenerateSegment,C=x.degenerateSegment,M=n,S=s;E.delta(M),C.delta(S);const k=o.subVectors(C.start,E.start),A=M.x*S.y-M.y*S.x;if(Fo(A))return!1;const B=(k.x*S.y-k.y*S.x)/A,F=-(M.x*k.y-M.y*k.x)/A;if(B<0||B>1||F<0||F>1)return!1;const N=E.start.z+M.z*B,G=C.start.z+S.z*F;return Fo(N-G)?(_&&(_.start.copy(E.start).addScaledVector(M,B),_.end.copy(E.start).addScaledVector(M,B)),!0):!1}else return x.isDegenerateIntoPoint?m(v,x,_):g(x,v,_,z);else{if(v.isDegenerateIntoPoint)return x.isDegenerateIntoPoint?x.a.distanceToSquared(v.a)<K0?(_&&(_.start.copy(v.a),_.end.copy(v.a)),!0):!1:x.isDegenerateIntoSegment?m(x,v,_):f(x,v,_);if(x.isDegenerateIntoPoint)return f(v,x,_);if(x.isDegenerateIntoSegment)return g(v,x,_,z)}}return function(x,_=null,z=!1){this.needsUpdate&&this.update(),x.isExtendedTriangle?x.needsUpdate&&x.update():(i.copy(x),i.update(),x=i);const E=b(this,x,_,z);if(E!==void 0)return E;const C=this.plane,M=x.plane;let S=M.distanceToPoint(this.a),k=M.distanceToPoint(this.b),A=M.distanceToPoint(this.c);Fo(S)&&(S=0),Fo(k)&&(k=0),Fo(A)&&(A=0);const B=S*k,F=S*A;if(B>0&&F>0)return!1;let N=C.distanceToPoint(x.a),G=C.distanceToPoint(x.b),W=C.distanceToPoint(x.c);Fo(N)&&(N=0),Fo(G)&&(G=0),Fo(W)&&(W=0);const et=N*G,K=N*W;if(et>0&&K>0)return!1;n.copy(C.normal),s.copy(M.normal);const pt=n.cross(s);let X=0,Z=Math.abs(pt.x);const gt=Math.abs(pt.y);gt>Z&&(Z=gt,X=1),Math.abs(pt.z)>Z&&(X=2);const tt=Iz[X],_t=this.a[tt],ft=this.b[tt],xt=this.c[tt],Ft=x.a[tt],Dt=x.b[tt],Ot=x.c[tt];if(y(this,_t,ft,xt,B,F,S,k,A,p,a))return u(this,x,_,z);if(y(x,Ft,Dt,Ot,et,K,N,G,W,h,l))return u(this,x,_,z);if(p.y<p.x){const ht=p.y;p.y=p.x,p.x=ht,c.copy(a.start),a.start.copy(a.end),a.end.copy(c)}if(h.y<h.x){const ht=h.y;h.y=h.x,h.x=ht,c.copy(l.start),l.start.copy(l.end),l.end.copy(c)}return p.y<h.x||h.y<p.x?!1:(_&&(h.x>p.x?_.start.copy(l.start):_.start.copy(a.start),h.y<p.y?_.end.copy(l.end):_.end.copy(a.end)),!0)}})(),Ao.prototype.distanceToPoint=(function(){const i=new R;return function(e){return this.closestPointToPoint(e,i),e.distanceTo(i)}})(),Ao.prototype.distanceToTriangle=(function(){const i=new R,t=new R,e=["a","b","c"],o=new Eo,n=new Eo;return function(r,a=null,l=null){const c=a||l?o:null;if(this.intersectsTriangle(r,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let p=1/0;for(let h=0;h<3;h++){let u;const d=e[h],y=r[d];this.closestPointToPoint(y,i),u=y.distanceToSquared(i),u<p&&(p=u,a&&a.copy(i),l&&l.copy(y));const g=this[d];r.closestPointToPoint(g,i),u=g.distanceToSquared(i),u<p&&(p=u,a&&a.copy(g),l&&l.copy(i))}for(let h=0;h<3;h++){const u=e[h],d=e[(h+1)%3];o.set(this[u],this[d]);for(let y=0;y<3;y++){const g=e[y],f=e[(y+1)%3];n.set(r[g],r[f]),cp(o,n,i,t);const m=i.distanceToSquared(t);m<p&&(p=m,a&&a.copy(i),l&&l.copy(t))}}return Math.sqrt(p)}})();class ro{constructor(t,e,o){this.isOrientedBox=!0,this.min=new R,this.max=new R,this.matrix=new $t,this.invMatrix=new $t,this.points=new Array(8).fill().map(()=>new R),this.satAxes=new Array(3).fill().map(()=>new R),this.satBounds=new Array(3).fill().map(()=>new an),this.alignedSatBounds=new Array(3).fill().map(()=>new an),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),o&&this.matrix.copy(o)}set(t,e,o){this.min.copy(t),this.max.copy(e),this.matrix.copy(o),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}ro.prototype.update=(function(){return function(){const t=this.matrix,e=this.min,o=this.max,n=this.points;for(let c=0;c<=1;c++)for(let p=0;p<=1;p++)for(let h=0;h<=1;h++){const u=1*c|2*p|4*h,d=n[u];d.x=c?o.x:e.x,d.y=p?o.y:e.y,d.z=h?o.z:e.z,d.applyMatrix4(t)}const s=this.satBounds,r=this.satAxes,a=n[0];for(let c=0;c<3;c++){const p=r[c],h=s[c],u=1<<c,d=n[u];p.subVectors(a,d),h.setFromPoints(p,n)}const l=this.alignedSatBounds;l[0].setFromPointsField(n,"x"),l[1].setFromPointsField(n,"y"),l[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})(),ro.prototype.intersectsBox=(function(){const i=new an;return function(e){this.needsUpdate&&this.update();const o=e.min,n=e.max,s=this.satBounds,r=this.satAxes,a=this.alignedSatBounds;if(i.min=o.x,i.max=n.x,a[0].isSeparated(i)||(i.min=o.y,i.max=n.y,a[1].isSeparated(i))||(i.min=o.z,i.max=n.z,a[2].isSeparated(i)))return!1;for(let l=0;l<3;l++){const c=r[l],p=s[l];if(i.setFromBox(c,e),p.isSeparated(i))return!1}return!0}})(),ro.prototype.intersectsTriangle=(function(){const i=new Ao,t=new Array(3),e=new an,o=new an,n=new R;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(i.copy(r),i.update(),r=i);const a=this.satBounds,l=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const d=a[u],y=l[u];if(e.setFromPoints(y,t),d.isSeparated(e))return!1}const c=r.satBounds,p=r.satAxes,h=this.points;for(let u=0;u<3;u++){const d=c[u],y=p[u];if(e.setFromPoints(y,h),d.isSeparated(e))return!1}for(let u=0;u<3;u++){const d=l[u];for(let y=0;y<4;y++){const g=p[y];if(n.crossVectors(d,g),e.setFromPoints(n,t),o.setFromPoints(n,h),e.isSeparated(o))return!1}}return!0}})(),ro.prototype.closestPointToPoint=(function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}})(),ro.prototype.distanceToPoint=(function(){const i=new R;return function(e){return this.closestPointToPoint(e,i),e.distanceTo(i)}})(),ro.prototype.distanceToBox=(function(){const i=["x","y","z"],t=new Array(12).fill().map(()=>new Eo),e=new Array(12).fill().map(()=>new Eo),o=new R,n=new R;return function(r,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(l||c)&&(r.getCenter(n),this.closestPointToPoint(n,o),r.closestPointToPoint(o,n),l&&l.copy(o),c&&c.copy(n)),0;const p=a*a,h=r.min,u=r.max,d=this.points;let y=1/0;for(let f=0;f<8;f++){const m=d[f];n.copy(m).clamp(h,u);const b=m.distanceToSquared(n);if(b<y&&(y=b,l&&l.copy(m),c&&c.copy(n),b<p))return Math.sqrt(b)}let g=0;for(let f=0;f<3;f++)for(let m=0;m<=1;m++)for(let b=0;b<=1;b++){const v=(f+1)%3,x=(f+2)%3,_=m<<v|b<<x,z=1<<f|m<<v|b<<x,E=d[_],C=d[z];t[g].set(E,C);const S=i[f],k=i[v],A=i[x],B=e[g],F=B.start,N=B.end;F[S]=h[S],F[k]=m?h[k]:u[k],F[A]=b?h[A]:u[k],N[S]=u[S],N[k]=m?h[k]:u[k],N[A]=b?h[A]:u[k],g++}for(let f=0;f<=1;f++)for(let m=0;m<=1;m++)for(let b=0;b<=1;b++){n.x=f?u.x:h.x,n.y=m?u.y:h.y,n.z=b?u.z:h.z,this.closestPointToPoint(n,o);const v=n.distanceToSquared(o);if(v<y&&(y=v,l&&l.copy(o),c&&c.copy(n),v<p))return Math.sqrt(v)}for(let f=0;f<12;f++){const m=t[f];for(let b=0;b<12;b++){const v=e[b];cp(m,v,o,n);const x=o.distanceToSquared(n);if(x<y&&(y=x,l&&l.copy(o),c&&c.copy(n),x<p))return Math.sqrt(x)}}return Math.sqrt(y)}})();class Lz extends np{constructor(){super(()=>new Ao)}}const To=new Lz,Hs=new R,pp=new R;function Uz(i,t,e={},o=0,n=1/0){const s=o*o,r=n*n;let a=1/0,l=null;if(i.shapecast({boundsTraverseOrder:p=>(Hs.copy(t).clamp(p.min,p.max),Hs.distanceToSquared(t)),intersectsBounds:(p,h,u)=>u<a&&u<r,intersectsTriangle:(p,h)=>{p.closestPointToPoint(t,Hs);const u=t.distanceToSquared(Hs);return u<a&&(pp.copy(Hs),a=u,l=h),u<s}}),a===1/0)return null;const c=Math.sqrt(a);return e.point?e.point.copy(pp):e.point=pp.clone(),e.distance=c,e.faceIndex=l,e}const ha=parseInt(lo)>=169,Nz=parseInt(lo)<=161,ei=new R,oi=new R,ni=new R,ua=new ct,da=new ct,fa=new ct,J0=new R,Q0=new R,td=new R,Gs=new R;function Oz(i,t,e,o,n,s,r,a){let l;if(s===Qe?l=i.intersectTriangle(o,e,t,!0,n):l=i.intersectTriangle(t,e,o,s!==Ze,n),l===null)return null;const c=i.origin.distanceTo(n);return c<r||c>a?null:{distance:c,point:n.clone()}}function ed(i,t,e,o,n,s,r,a,l,c,p){ei.fromBufferAttribute(t,s),oi.fromBufferAttribute(t,r),ni.fromBufferAttribute(t,a);const h=Oz(i,ei,oi,ni,Gs,l,c,p);if(h){if(o){ua.fromBufferAttribute(o,s),da.fromBufferAttribute(o,r),fa.fromBufferAttribute(o,a),h.uv=new ct;const d=ye.getInterpolation(Gs,ei,oi,ni,ua,da,fa,h.uv);ha||(h.uv=d)}if(n){ua.fromBufferAttribute(n,s),da.fromBufferAttribute(n,r),fa.fromBufferAttribute(n,a),h.uv1=new ct;const d=ye.getInterpolation(Gs,ei,oi,ni,ua,da,fa,h.uv1);ha||(h.uv1=d),Nz&&(h.uv2=h.uv1)}if(e){J0.fromBufferAttribute(e,s),Q0.fromBufferAttribute(e,r),td.fromBufferAttribute(e,a),h.normal=new R;const d=ye.getInterpolation(Gs,ei,oi,ni,J0,Q0,td,h.normal);h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1),ha||(h.normal=d)}const u={a:s,b:r,c:a,normal:new R,materialIndex:0};if(ye.getNormal(ei,oi,ni,u.normal),h.face=u,h.faceIndex=s,ha){const d=new R;ye.getBarycoord(Gs,ei,oi,ni,d),h.barycoord=d}}return h}function od(i){return i&&i.isMaterial?i.side:i}function ma(i,t,e,o,n,s,r){const a=o*3;let l=a+0,c=a+1,p=a+2;const{index:h,groups:u}=i;i.index&&(l=h.getX(l),c=h.getX(c),p=h.getX(p));const{position:d,normal:y,uv:g,uv1:f}=i.attributes;if(Array.isArray(t)){const m=o*3;for(let b=0,v=u.length;b<v;b++){const{start:x,count:_,materialIndex:z}=u[b];if(m>=x&&m<x+_){const E=od(t[z]),C=ed(e,d,y,g,f,l,c,p,E,s,r);if(C)if(C.faceIndex=o,C.face.materialIndex=z,n)n.push(C);else return C}}}else{const m=od(t),b=ed(e,d,y,g,f,l,c,p,m,s,r);if(b)if(b.faceIndex=o,b.face.materialIndex=0,n)n.push(b);else return b}return null}function Be(i,t,e,o){const n=i.a,s=i.b,r=i.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),n.x=o.getX(a),n.y=o.getY(a),n.z=o.getZ(a),s.x=o.getX(l),s.y=o.getY(l),s.z=o.getZ(l),r.x=o.getX(c),r.y=o.getY(c),r.z=o.getZ(c)}function Vz(i,t,e,o,n,s,r,a){const{geometry:l,_indirectBuffer:c}=i;for(let p=o,h=o+n;p<h;p++)ma(l,t,e,p,s,r,a)}function Hz(i,t,e,o,n,s,r){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,p=null;for(let h=o,u=o+n;h<u;h++){let d;d=ma(a,t,e,h,null,s,r),d&&d.distance<c&&(p=d,c=d.distance)}return p}function Gz(i,t,e,o,n,s,r){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let p=i,h=t+i;p<h;p++){let u;if(u=p,Be(r,u*3,l,c),r.needsUpdate=!0,o(r,u,n,s))return!0}return!1}function Xz(i,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=i.geometry,o=e.index?e.index.array:null,n=e.attributes.position;let s,r,a,l,c=0;const p=i._roots;for(let u=0,d=p.length;u<d;u++)s=p[u],r=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(u,d,y=!1){const g=u*2;if(Le(g,a)){const f=je(u,r),m=so(g,a);let b=1/0,v=1/0,x=1/0,_=-1/0,z=-1/0,E=-1/0;for(let C=3*f,M=3*(f+m);C<M;C++){let S=o[C];const k=n.getX(S),A=n.getY(S),B=n.getZ(S);k<b&&(b=k),k>_&&(_=k),A<v&&(v=A),A>z&&(z=A),B<x&&(x=B),B>E&&(E=B)}return l[u+0]!==b||l[u+1]!==v||l[u+2]!==x||l[u+3]!==_||l[u+4]!==z||l[u+5]!==E?(l[u+0]=b,l[u+1]=v,l[u+2]=x,l[u+3]=_,l[u+4]=z,l[u+5]=E,!0):!1}else{const f=Xe(u),m=We(u,r);let b=y,v=!1,x=!1;if(t){if(!b){const S=f/Ie+d/qe,k=m/Ie+d/qe;v=t.has(S),x=t.has(k),b=!v&&!x}}else v=!0,x=!0;const _=b||v,z=b||x;let E=!1;_&&(E=h(f,d,b));let C=!1;z&&(C=h(m,d,b));const M=E||C;if(M)for(let S=0;S<3;S++){const k=f+S,A=m+S,B=l[k],F=l[k+3],N=l[A],G=l[A+3];l[u+S]=B<N?B:N,l[u+S+3]=F>G?F:G}return M}}}function Tn(i,t,e,o,n){let s,r,a,l,c,p;const h=1/e.direction.x,u=1/e.direction.y,d=1/e.direction.z,y=e.origin.x,g=e.origin.y,f=e.origin.z;let m=t[i],b=t[i+3],v=t[i+1],x=t[i+3+1],_=t[i+2],z=t[i+3+2];return h>=0?(s=(m-y)*h,r=(b-y)*h):(s=(b-y)*h,r=(m-y)*h),u>=0?(a=(v-g)*u,l=(x-g)*u):(a=(x-g)*u,l=(v-g)*u),s>l||a>r||((a>s||isNaN(s))&&(s=a),(l<r||isNaN(r))&&(r=l),d>=0?(c=(_-f)*d,p=(z-f)*d):(c=(z-f)*d,p=(_-f)*d),s>p||c>r)?!1:((c>s||s!==s)&&(s=c),(p<r||r!==r)&&(r=p),s<=n&&r>=o)}function Wz(i,t,e,o,n,s,r,a){const{geometry:l,_indirectBuffer:c}=i;for(let p=o,h=o+n;p<h;p++){let u=c?c[p]:p;ma(l,t,e,u,s,r,a)}}function Zz(i,t,e,o,n,s,r){const{geometry:a,_indirectBuffer:l}=i;let c=1/0,p=null;for(let h=o,u=o+n;h<u;h++){let d;d=ma(a,t,e,l?l[h]:h,null,s,r),d&&d.distance<c&&(p=d,c=d.distance)}return p}function Yz(i,t,e,o,n,s,r){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let p=i,h=t+i;p<h;p++){let u;if(u=e.resolveTriangleIndex(p),Be(r,u*3,l,c),r.needsUpdate=!0,o(r,u,n,s))return!0}return!1}function $z(i,t,e,o,n,s,r){ve.setBuffer(i._roots[t]),hp(0,i,e,o,n,s,r),ve.clearBuffer()}function hp(i,t,e,o,n,s,r){const{float32Array:a,uint16Array:l,uint32Array:c}=ve,p=i*2;if(Le(p,l)){const u=je(i,c),d=so(p,l);Vz(t,e,o,u,d,n,s,r)}else{const u=Xe(i);Tn(u,a,o,s,r)&&hp(u,t,e,o,n,s,r);const d=We(i,c);Tn(d,a,o,s,r)&&hp(d,t,e,o,n,s,r)}}const qz=["x","y","z"];function jz(i,t,e,o,n,s){ve.setBuffer(i._roots[t]);const r=up(0,i,e,o,n,s);return ve.clearBuffer(),r}function up(i,t,e,o,n,s){const{float32Array:r,uint16Array:a,uint32Array:l}=ve;let c=i*2;if(Le(c,a)){const h=je(i,l),u=so(c,a);return Hz(t,e,o,h,u,n,s)}else{const h=Kc(i,l),u=qz[h],y=o.direction[u]>=0;let g,f;y?(g=Xe(i),f=We(i,l)):(g=We(i,l),f=Xe(i));const b=Tn(g,r,o,n,s)?up(g,t,e,o,n,s):null;if(b){const _=b.point[u];if(y?_<=r[f+h]:_>=r[f+h+3])return b}const x=Tn(f,r,o,n,s)?up(f,t,e,o,n,s):null;return b&&x?b.distance<=x.distance?b:x:b||x||null}}const ya=new Ne,is=new Ao,ss=new Ao,Xs=new $t,nd=new ro,ga=new ro;function Kz(i,t,e,o){ve.setBuffer(i._roots[t]);const n=dp(0,i,e,o);return ve.clearBuffer(),n}function dp(i,t,e,o,n=null){const{float32Array:s,uint16Array:r,uint32Array:a}=ve;let l=i*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),nd.set(e.boundingBox.min,e.boundingBox.max,o),n=nd),Le(l,r)){const p=t.geometry,h=p.index,u=p.attributes.position,d=e.index,y=e.attributes.position,g=je(i,a),f=so(l,r);if(Xs.copy(o).invert(),e.boundsTree)return Ee(i,s,ga),ga.matrix.copy(Xs),ga.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>ga.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(o),b.b.applyMatrix4(o),b.c.applyMatrix4(o),b.needsUpdate=!0;for(let v=g*3,x=(f+g)*3;v<x;v+=3)if(Be(ss,v,h,u),ss.needsUpdate=!0,b.intersectsTriangle(ss))return!0;return!1}});{const m=pa(e);for(let b=g*3,v=(f+g)*3;b<v;b+=3){Be(is,b,h,u),is.a.applyMatrix4(Xs),is.b.applyMatrix4(Xs),is.c.applyMatrix4(Xs),is.needsUpdate=!0;for(let x=0,_=m*3;x<_;x+=3)if(Be(ss,x,d,y),ss.needsUpdate=!0,is.intersectsTriangle(ss))return!0}}}else{const p=Xe(i),h=We(i,a);return Ee(p,s,ya),!!(n.intersectsBox(ya)&&dp(p,t,e,o,n)||(Ee(h,s,ya),n.intersectsBox(ya)&&dp(h,t,e,o,n)))}}const xa=new $t,fp=new ro,Ws=new ro,Jz=new R,Qz=new R,t3=new R,e3=new R;function o3(i,t,e,o={},n={},s=0,r=1/0){t.boundingBox||t.computeBoundingBox(),fp.set(t.boundingBox.min,t.boundingBox.max,e),fp.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,p=t.attributes.position,h=t.index,u=To.getPrimitive(),d=To.getPrimitive();let y=Jz,g=Qz,f=null,m=null;n&&(f=t3,m=e3);let b=1/0,v=null,x=null;return xa.copy(e).invert(),Ws.matrix.copy(xa),i.shapecast({boundsTraverseOrder:_=>fp.distanceToBox(_),intersectsBounds:(_,z,E)=>E<b&&E<r?(z&&(Ws.min.copy(_.min),Ws.max.copy(_.max),Ws.needsUpdate=!0),!0):!1,intersectsRange:(_,z)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:C=>Ws.distanceToBox(C),intersectsBounds:(C,M,S)=>S<b&&S<r,intersectsRange:(C,M)=>{for(let S=C,k=C+M;S<k;S++){Be(d,3*S,h,p),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let A=_,B=_+z;A<B;A++){Be(u,3*A,c,l),u.needsUpdate=!0;const F=u.distanceToTriangle(d,y,f);if(F<b&&(g.copy(y),m&&m.copy(f),b=F,v=A,x=S),F<s)return!0}}}});{const E=pa(t);for(let C=0,M=E;C<M;C++){Be(d,3*C,h,p),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let S=_,k=_+z;S<k;S++){Be(u,3*S,c,l),u.needsUpdate=!0;const A=u.distanceToTriangle(d,y,f);if(A<b&&(g.copy(y),m&&m.copy(f),b=A,v=S,x=C),A<s)return!0}}}}}),To.releasePrimitive(u),To.releasePrimitive(d),b===1/0?null:(o.point?o.point.copy(g):o.point=g.clone(),o.distance=b,o.faceIndex=v,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(xa),g.applyMatrix4(xa),n.distance=g.sub(n.point).length(),n.faceIndex=x),o)}function n3(i,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=i.geometry,o=e.index?e.index.array:null,n=e.attributes.position;let s,r,a,l,c=0;const p=i._roots;for(let u=0,d=p.length;u<d;u++)s=p[u],r=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),h(0,c),c+=s.byteLength;function h(u,d,y=!1){const g=u*2;if(Le(g,a)){const f=je(u,r),m=so(g,a);let b=1/0,v=1/0,x=1/0,_=-1/0,z=-1/0,E=-1/0;for(let C=f,M=f+m;C<M;C++){const S=3*i.resolveTriangleIndex(C);for(let k=0;k<3;k++){let A=S+k;A=o?o[A]:A;const B=n.getX(A),F=n.getY(A),N=n.getZ(A);B<b&&(b=B),B>_&&(_=B),F<v&&(v=F),F>z&&(z=F),N<x&&(x=N),N>E&&(E=N)}}return l[u+0]!==b||l[u+1]!==v||l[u+2]!==x||l[u+3]!==_||l[u+4]!==z||l[u+5]!==E?(l[u+0]=b,l[u+1]=v,l[u+2]=x,l[u+3]=_,l[u+4]=z,l[u+5]=E,!0):!1}else{const f=Xe(u),m=We(u,r);let b=y,v=!1,x=!1;if(t){if(!b){const S=f/Ie+d/qe,k=m/Ie+d/qe;v=t.has(S),x=t.has(k),b=!v&&!x}}else v=!0,x=!0;const _=b||v,z=b||x;let E=!1;_&&(E=h(f,d,b));let C=!1;z&&(C=h(m,d,b));const M=E||C;if(M)for(let S=0;S<3;S++){const k=f+S,A=m+S,B=l[k],F=l[k+3],N=l[A],G=l[A+3];l[u+S]=B<N?B:N,l[u+S+3]=F>G?F:G}return M}}}function i3(i,t,e,o,n,s,r){ve.setBuffer(i._roots[t]),mp(0,i,e,o,n,s,r),ve.clearBuffer()}function mp(i,t,e,o,n,s,r){const{float32Array:a,uint16Array:l,uint32Array:c}=ve,p=i*2;if(Le(p,l)){const u=je(i,c),d=so(p,l);Wz(t,e,o,u,d,n,s,r)}else{const u=Xe(i);Tn(u,a,o,s,r)&&mp(u,t,e,o,n,s,r);const d=We(i,c);Tn(d,a,o,s,r)&&mp(d,t,e,o,n,s,r)}}const s3=["x","y","z"];function r3(i,t,e,o,n,s){ve.setBuffer(i._roots[t]);const r=yp(0,i,e,o,n,s);return ve.clearBuffer(),r}function yp(i,t,e,o,n,s){const{float32Array:r,uint16Array:a,uint32Array:l}=ve;let c=i*2;if(Le(c,a)){const h=je(i,l),u=so(c,a);return Zz(t,e,o,h,u,n,s)}else{const h=Kc(i,l),u=s3[h],y=o.direction[u]>=0;let g,f;y?(g=Xe(i),f=We(i,l)):(g=We(i,l),f=Xe(i));const b=Tn(g,r,o,n,s)?yp(g,t,e,o,n,s):null;if(b){const _=b.point[u];if(y?_<=r[f+h]:_>=r[f+h+3])return b}const x=Tn(f,r,o,n,s)?yp(f,t,e,o,n,s):null;return b&&x?b.distance<=x.distance?b:x:b||x||null}}const ba=new Ne,rs=new Ao,as=new Ao,Zs=new $t,id=new ro,va=new ro;function a3(i,t,e,o){ve.setBuffer(i._roots[t]);const n=gp(0,i,e,o);return ve.clearBuffer(),n}function gp(i,t,e,o,n=null){const{float32Array:s,uint16Array:r,uint32Array:a}=ve;let l=i*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),id.set(e.boundingBox.min,e.boundingBox.max,o),n=id),Le(l,r)){const p=t.geometry,h=p.index,u=p.attributes.position,d=e.index,y=e.attributes.position,g=je(i,a),f=so(l,r);if(Zs.copy(o).invert(),e.boundsTree)return Ee(i,s,va),va.matrix.copy(Zs),va.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>va.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(o),b.b.applyMatrix4(o),b.c.applyMatrix4(o),b.needsUpdate=!0;for(let v=g,x=f+g;v<x;v++)if(Be(as,3*t.resolveTriangleIndex(v),h,u),as.needsUpdate=!0,b.intersectsTriangle(as))return!0;return!1}});{const m=pa(e);for(let b=g,v=f+g;b<v;b++){const x=t.resolveTriangleIndex(b);Be(rs,3*x,h,u),rs.a.applyMatrix4(Zs),rs.b.applyMatrix4(Zs),rs.c.applyMatrix4(Zs),rs.needsUpdate=!0;for(let _=0,z=m*3;_<z;_+=3)if(Be(as,_,d,y),as.needsUpdate=!0,rs.intersectsTriangle(as))return!0}}}else{const p=Xe(i),h=We(i,a);return Ee(p,s,ba),!!(n.intersectsBox(ba)&&gp(p,t,e,o,n)||(Ee(h,s,ba),n.intersectsBox(ba)&&gp(h,t,e,o,n)))}}const _a=new $t,xp=new ro,Ys=new ro,l3=new R,c3=new R,p3=new R,h3=new R;function u3(i,t,e,o={},n={},s=0,r=1/0){t.boundingBox||t.computeBoundingBox(),xp.set(t.boundingBox.min,t.boundingBox.max,e),xp.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,p=t.attributes.position,h=t.index,u=To.getPrimitive(),d=To.getPrimitive();let y=l3,g=c3,f=null,m=null;n&&(f=p3,m=h3);let b=1/0,v=null,x=null;return _a.copy(e).invert(),Ys.matrix.copy(_a),i.shapecast({boundsTraverseOrder:_=>xp.distanceToBox(_),intersectsBounds:(_,z,E)=>E<b&&E<r?(z&&(Ys.min.copy(_.min),Ys.max.copy(_.max),Ys.needsUpdate=!0),!0):!1,intersectsRange:(_,z)=>{if(t.boundsTree){const E=t.boundsTree;return E.shapecast({boundsTraverseOrder:C=>Ys.distanceToBox(C),intersectsBounds:(C,M,S)=>S<b&&S<r,intersectsRange:(C,M)=>{for(let S=C,k=C+M;S<k;S++){const A=E.resolveTriangleIndex(S);Be(d,3*A,h,p),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let B=_,F=_+z;B<F;B++){const N=i.resolveTriangleIndex(B);Be(u,3*N,c,l),u.needsUpdate=!0;const G=u.distanceToTriangle(d,y,f);if(G<b&&(g.copy(y),m&&m.copy(f),b=G,v=B,x=S),G<s)return!0}}}})}else{const E=pa(t);for(let C=0,M=E;C<M;C++){Be(d,3*C,h,p),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let S=_,k=_+z;S<k;S++){const A=i.resolveTriangleIndex(S);Be(u,3*A,c,l),u.needsUpdate=!0;const B=u.distanceToTriangle(d,y,f);if(B<b&&(g.copy(y),m&&m.copy(f),b=B,v=S,x=C),B<s)return!0}}}}}),To.releasePrimitive(u),To.releasePrimitive(d),b===1/0?null:(o.point?o.point.copy(g):o.point=g.clone(),o.distance=b,o.faceIndex=v,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(_a),g.applyMatrix4(_a),n.distance=g.sub(n.point).length(),n.faceIndex=x),o)}function sd(i,t,e){return i===null?null:(i.point.applyMatrix4(t.matrixWorld),i.distance=i.point.distanceTo(e.ray.origin),i.object=t,i)}const wa=new ro,Ma=new On,rd=new R,ad=new $t,ld=new R,bp=["getX","getY","getZ"];class za extends Pz{static serialize(t,e={}){e={cloneBuffers:!0,...e};const o=t.geometry,n=t._roots,s=t._indirectBuffer,r=o.getIndex(),a={version:1,roots:null,index:null,indirectBuffer:null};return e.cloneBuffers?(a.roots=n.map(l=>l.slice()),a.index=r?r.array.slice():null,a.indirectBuffer=s?s.slice():null):(a.roots=n,a.index=r?r.array:null,a.indirectBuffer=s),a}static deserialize(t,e,o={}){o={setIndex:!0,indirect:!!t.indirectBuffer,...o};const{index:n,roots:s,indirectBuffer:r}=t;t.version||(console.warn("MeshBVH.deserialize: Serialization format has been changed and will be fixed up. It is recommended to regenerate any stored serialized data."),l(s));const a=new za(e,{...o,[jc]:!0});if(a._roots=s,a._indirectBuffer=r||null,o.setIndex){const c=e.getIndex();if(c===null){const p=new Gt(t.index,1,!1);e.setIndex(p)}else c.array!==n&&(c.array.set(n),c.needsUpdate=!0)}return a;function l(c){for(let p=0;p<c.length;p++){const h=c[p],u=new Uint32Array(h),d=new Uint16Array(h);for(let y=0,g=h.byteLength/qe;y<g;y++){const f=Ie*y,m=2*f;Le(m,d)||(u[f+6]=u[f+6]/Ie-y)}}}}get primitiveStride(){return 3}get resolveTriangleIndex(){return this.resolvePrimitiveIndex}constructor(t,e={}){e.maxLeafTris&&(console.warn('MeshBVH: "maxLeafTris" option has been deprecated. Use maxLeafSize, instead.'),e={...e,maxLeafSize:e.maxLeafTris}),super(t,e)}shiftTriangleOffsets(t){return super.shiftPrimitiveOffsets(t)}writePrimitiveBounds(t,e,o){const n=this.geometry,s=this._indirectBuffer,r=n.attributes.position,a=n.index?n.index.array:null,c=(s?s[t]:t)*3;let p=c+0,h=c+1,u=c+2;a&&(p=a[p],h=a[h],u=a[u]);for(let d=0;d<3;d++){const y=r[bp[d]](p),g=r[bp[d]](h),f=r[bp[d]](u);let m=y;g<m&&(m=g),f<m&&(m=f);let b=y;g>b&&(b=g),f>b&&(b=f),e[o+d]=m,e[o+d+3]=b}return e}computePrimitiveBounds(t,e,o){const n=this.geometry,s=this._indirectBuffer,r=n.attributes.position,a=n.index?n.index.array:null,l=r.normalized;if(t<0||e+t-o.offset>o.length/6)throw new Error("MeshBVH: compute triangle bounds range is invalid.");const c=r.array,p=r.offset||0;let h=3;r.isInterleavedBufferAttribute&&(h=r.data.stride);const u=["getX","getY","getZ"],d=o.offset;for(let y=t,g=t+e;y<g;y++){const m=(s?s[y]:y)*3,b=(y-d)*6;let v=m+0,x=m+1,_=m+2;a&&(v=a[v],x=a[x],_=a[_]),l||(v=v*h+p,x=x*h+p,_=_*h+p);for(let z=0;z<3;z++){let E,C,M;l?(E=r[u[z]](v),C=r[u[z]](x),M=r[u[z]](_)):(E=c[v+z],C=c[x+z],M=c[_+z]);let S=E;C<S&&(S=C),M<S&&(S=M);let k=E;C>k&&(k=C),M>k&&(k=M);const A=(k-S)/2,B=z*2;o[b+B+0]=S+A,o[b+B+1]=A+(Math.abs(S)+A)*ia}}return o}raycastObject3D(t,e,o=[]){const{material:n}=t;if(n===void 0)return;ad.copy(t.matrixWorld).invert(),Ma.copy(e.ray).applyMatrix4(ad),ld.setFromMatrixScale(t.matrixWorld),rd.copy(Ma.direction).multiply(ld);const s=rd.length(),r=e.near/s,a=e.far/s;if(e.firstHitOnly===!0){let l=this.raycastFirst(Ma,n,r,a);l=sd(l,t,e),l&&o.push(l)}else{const l=this.raycast(Ma,n,r,a);for(let c=0,p=l.length;c<p;c++){const h=sd(l[c],t,e);h&&o.push(h)}}return o}refit(t=null){return(this.indirect?n3:Xz)(this,t)}raycast(t,e=Oo,o=0,n=1/0){const s=this._roots,r=[],a=this.indirect?i3:$z;for(let l=0,c=s.length;l<c;l++)a(this,l,e,t,r,o,n);return r}raycastFirst(t,e=Oo,o=0,n=1/0){const s=this._roots;let r=null;const a=this.indirect?r3:jz;for(let l=0,c=s.length;l<c;l++){const p=a(this,l,e,t,o,n);p!=null&&(r==null||p.distance<r.distance)&&(r=p)}return r}intersectsGeometry(t,e){let o=!1;const n=this._roots,s=this.indirect?a3:Kz;for(let r=0,a=n.length;r<a&&(o=s(this,r,t,e),!o);r++);return o}shapecast(t){const e=To.getPrimitive(),o=super.shapecast({...t,intersectsPrimitive:t.intersectsTriangle,scratchPrimitive:e,iterate:this.indirect?Yz:Gz});return To.releasePrimitive(e),o}bvhcast(t,e,o){let{intersectsRanges:n,intersectsTriangles:s}=o;const r=To.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?y=>{const g=this.resolveTriangleIndex(y);Be(r,g*3,a,l)}:y=>{Be(r,y*3,a,l)},p=To.getPrimitive(),h=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?y=>{const g=t.resolveTriangleIndex(y);Be(p,g*3,h,u)}:y=>{Be(p,y*3,h,u)};if(s){if(!(t instanceof za))throw new Error('MeshBVH: "intersectsTriangles" callback can only be used with another MeshBVH.');const y=(g,f,m,b,v,x,_,z)=>{for(let E=m,C=m+b;E<C;E++){d(E),p.a.applyMatrix4(e),p.b.applyMatrix4(e),p.c.applyMatrix4(e),p.needsUpdate=!0;for(let M=g,S=g+f;M<S;M++)if(c(M),r.needsUpdate=!0,s(r,p,M,E,v,x,_,z))return!0}return!1};if(n){const g=n;n=function(f,m,b,v,x,_,z,E){return g(f,m,b,v,x,_,z,E)?!0:y(f,m,b,v,x,_,z,E)}}else n=y}return super.bvhcast(t,e,{intersectsRanges:n})}intersectsBox(t,e){return wa.set(t.min,t.max,e),wa.needsUpdate=!0,this.shapecast({intersectsBounds:o=>wa.intersectsBox(o),intersectsTriangle:o=>wa.intersectsTriangle(o)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,o={},n={},s=0,r=1/0){return(this.indirect?u3:o3)(this,t,e,o,n,s,r)}closestPointToPoint(t,e={},o=0,n=1/0){return Uz(this,t,e,o,n)}}const cd=1e-6,d3=cd*.5,pd=Math.pow(10,-Math.log10(cd)),f3=d3*pd;function Wo(i){return~~(i*pd+f3)}function m3(i){return`${Wo(i.x)},${Wo(i.y)}`}function hd(i){return`${Wo(i.x)},${Wo(i.y)},${Wo(i.z)}`}function y3(i){return`${Wo(i.x)},${Wo(i.y)},${Wo(i.z)},${Wo(i.w)}`}function g3(i,t,e){e.direction.subVectors(t,i).normalize();const o=i.dot(e.direction);return e.origin.copy(i).addScaledVector(e.direction,-o),e}function ud(){return typeof SharedArrayBuffer<"u"}function x3(i){if(i.buffer instanceof SharedArrayBuffer)return i;const t=i.constructor,e=i.buffer,o=new SharedArrayBuffer(e.byteLength),n=new Uint8Array(e);return new Uint8Array(o).set(n,0),new t(o)}function b3(i,t=ArrayBuffer){return i>65535?new Uint32Array(new t(4*i)):new Uint16Array(new t(2*i))}function v3(i,t){if(!i.index){const e=i.attributes.position.count,o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=b3(e,o);i.setIndex(new Gt(n,1));for(let s=0;s<e;s++)n[s]=s}}function _3(i){return i.index?i.index.count:i.attributes.position.count}function vp(i){return _3(i)/3}const w3=1e-8,M3=new R;function z3(i){return~~(i/3)}function S3(i){return i%3}function dd(i,t){return i.start-t.start}function fd(i,t){return M3.subVectors(t,i.origin).dot(i.direction)}function E3(i,t,e,o=w3){i.sort(dd),t.sort(dd);for(let a=0;a<i.length;a++){const l=i[a];for(let c=0;c<t.length;c++){const p=t[c];if(!(p.start>l.end)){if(l.end<p.start||p.end<l.start)continue;if(l.start<=p.start&&l.end>=p.end)s(p.end,l.end)||i.splice(a+1,0,{start:p.end,end:l.end,index:l.index}),l.end=p.start,p.start=0,p.end=0;else if(l.start>=p.start&&l.end<=p.end)s(l.end,p.end)||t.splice(c+1,0,{start:l.end,end:p.end,index:p.index}),p.end=l.start,l.start=0,l.end=0;else if(l.start<=p.start&&l.end<=p.end){const h=l.end;l.end=p.start,p.start=h}else if(l.start>=p.start&&l.end>=p.end){const h=p.end;p.end=l.start,l.start=h}else throw new Error}if(e.has(l.index)||e.set(l.index,[]),e.has(p.index)||e.set(p.index,[]),e.get(l.index).push(p.index),e.get(p.index).push(l.index),r(p)&&(t.splice(c,1),c--),r(l)){i.splice(a,1),a--;break}}}n(i),n(t);function n(a){for(let l=0;l<a.length;l++)r(a[l])&&(a.splice(l,1),l--)}function s(a,l){return Math.abs(l-a)<o}function r(a){return Math.abs(a.end-a.start)<o}}const md=1e-5,yd=1e-4;class F3{constructor(){this._rays=[]}addRay(t){this._rays.push(t)}findClosestRay(t){const e=this._rays,o=t.clone();o.direction.multiplyScalar(-1);let n=1/0,s=null;for(let l=0,c=e.length;l<c;l++){const p=e[l];if(r(p,t)&&r(p,o))continue;const h=a(p,t),u=a(p,o),d=Math.min(h,u);d<n&&(n=d,s=p)}return s;function r(l,c){const p=l.origin.distanceTo(c.origin)>md;return l.direction.angleTo(c.direction)>yd||p}function a(l,c){const p=l.origin.distanceTo(c.origin),h=l.direction.angleTo(c.direction);return p/md+h/yd}}}const _p=new R,wp=new R,Sa=new On;function A3(i,t,e){const o=i.attributes,n=i.index,s=o.position,r=new Map,a=new Map,l=Array.from(t),c=new F3;for(let p=0,h=l.length;p<h;p++){const u=l[p],d=z3(u),y=S3(u);let g=3*d+y,f=3*d+(y+1)%3;n&&(g=n.getX(g),f=n.getX(f)),_p.fromBufferAttribute(s,g),wp.fromBufferAttribute(s,f),g3(_p,wp,Sa);let m,b=c.findClosestRay(Sa);b===null&&(b=Sa.clone(),c.addRay(b)),a.has(b)||a.set(b,{forward:[],reverse:[],ray:b}),m=a.get(b);let v=fd(b,_p),x=fd(b,wp);v>x&&([v,x]=[x,v]),Sa.direction.dot(b.direction)<0?m.reverse.push({start:v,end:x,index:u}):m.forward.push({start:v,end:x,index:u})}return a.forEach(({forward:p,reverse:h},u)=>{E3(p,h,r,e),p.length===0&&h.length===0&&a.delete(u)}),{disjointConnectivityMap:r,fragmentMap:a}}const T3=new ct,Mp=new R,C3=new se,zp=["","",""];class k3{constructor(t=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,t&&this.updateFrom(t)}getSiblingTriangleIndex(t,e){const o=this.data[t*3+e];return o===-1?-1:~~(o/3)}getSiblingEdgeIndex(t,e){const o=this.data[t*3+e];return o===-1?-1:o%3}getDisjointSiblingTriangleIndices(t,e){const o=t*3+e,n=this.disjointConnections.get(o);return n?n.map(s=>~~(s/3)):[]}getDisjointSiblingEdgeIndices(t,e){const o=t*3+e,n=this.disjointConnections.get(o);return n?n.map(s=>s%3):[]}isFullyConnected(){return this.unmatchedEdges===0}updateFrom(t){const{useAllAttributes:e,useDrawRange:o,matchDisjointEdges:n,degenerateEpsilon:s}=this,r=e?v:b,a=new Map,{attributes:l}=t,c=e?Object.keys(l):null,p=t.index,h=l.position;let u=vp(t);const d=u;let y=0;o&&(y=t.drawRange.start,t.drawRange.count!==1/0&&(u=~~(t.drawRange.count/3)));let g=this.data;(!g||g.length<3*d)&&(g=new Int32Array(3*d)),g.fill(-1);let f=0,m=new Set;for(let x=y,_=u*3+y;x<_;x+=3){const z=x;for(let E=0;E<3;E++){let C=z+E;p&&(C=p.getX(C)),zp[E]=r(C)}for(let E=0;E<3;E++){const C=(E+1)%3,M=zp[E],S=zp[C],k=`${S}_${M}`;if(a.has(k)){const A=z+E,B=a.get(k);g[A]=B,g[B]=A,a.delete(k),f+=2,m.delete(B)}else{const A=`${M}_${S}`,B=z+E;a.set(A,B),m.add(B)}}}if(n){const{fragmentMap:x,disjointConnectivityMap:_}=A3(t,m,s);m.clear(),x.forEach(({forward:z,reverse:E})=>{z.forEach(({index:C})=>m.add(C)),E.forEach(({index:C})=>m.add(C))}),this.unmatchedDisjointEdges=x,this.disjointConnections=_,f=u*3-m.size}this.matchedEdges=f,this.unmatchedEdges=m.size,this.data=g;function b(x){return Mp.fromBufferAttribute(h,x),hd(Mp)}function v(x){let _="";for(let z=0,E=c.length;z<E;z++){const C=l[c[z]];let M;switch(C.itemSize){case 1:M=Wo(C.getX(x));break;case 2:M=m3(T3.fromBufferAttribute(C,x));break;case 3:M=hd(Mp.fromBufferAttribute(C,x));break;case 4:M=y3(C3.fromBufferAttribute(C,x));break}_!==""&&(_+="|"),_+=M}return _}}}class Sp extends ge{constructor(...t){super(...t),this.isBrush=!0,this._previousMatrix=new $t,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:t,_previousMatrix:e}=this,o=t.elements,n=e.elements;for(let s=0;s<16;s++)if(o[s]!==n[s])return!0;return!1}prepareGeometry(){const t=this.geometry,e=t.attributes,o=ud();if(o)for(const n in e){const s=e[n];if(s.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");s.array=x3(s.array)}if(t.boundsTree||(v3(t,{useSharedArrayBuffer:o}),t.boundsTree=new za(t,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:o})),t.halfEdges||(t.halfEdges=new k3(t)),!t.groupIndices){const n=vp(t),s=new Uint16Array(n),r=t.groups;for(let a=0,l=r.length;a<l;a++){const{start:c,count:p}=r[a];for(let h=c/3,u=(c+p)/3;h<u;h++)s[h]=a}t.groupIndices=s}}disposeCacheData(){const{geometry:t}=this;t.halfEdges=null,t.boundsTree=null,t.groupIndices=null}}const B3=1e-14,Ep=new R,gd=new R,xd=new R;function Cn(i,t=B3){Ep.subVectors(i.b,i.a),gd.subVectors(i.c,i.a),xd.subVectors(i.b,i.c);const e=Ep.angleTo(gd),o=Ep.angleTo(xd),n=Math.PI-e-o;return Math.abs(e)<t||Math.abs(o)<t||Math.abs(n)<t||i.a.distanceToSquared(i.b)<t||i.a.distanceToSquared(i.c)<t||i.b.distanceToSquared(i.c)<t}const Fp=1e-10,$s=1e-10,P3=1e-10,cn=new Eo,Te=new Eo,pn=new R,Ap=new R,bd=new R,Ea=new Do,Tp=new Ao;class R3{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new ye),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class D3{constructor(){this.trianglePool=new R3,this.triangles=[],this.normal=new R,this.coplanarTriangleUsed=!1}initialize(t){this.reset();const{triangles:e,trianglePool:o,normal:n}=this;if(Array.isArray(t))for(let s=0,r=t.length;s<r;s++){const a=t[s];if(s===0)a.getNormal(n);else if(Math.abs(1-a.getNormal(pn).dot(n))>Fp)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const l=o.getTriangle();l.copy(a),e.push(l)}else{t.getNormal(n);const s=o.getTriangle();s.copy(t),e.push(s)}}splitByTriangle(t){const{normal:e,triangles:o}=this;if(t.getNormal(Ap).normalize(),Math.abs(1-Math.abs(Ap.dot(e)))<P3){this.coplanarTriangleUsed=!0;for(let s=0,r=o.length;s<r;s++){const a=o[s];a.coplanarCount=0}const n=[t.a,t.b,t.c];for(let s=0;s<3;s++){const r=(s+1)%3,a=n[s],l=n[r];pn.subVectors(l,a).normalize(),bd.crossVectors(Ap,pn),Ea.setFromNormalAndCoplanarPoint(bd,a),this.splitByPlane(Ea,t)}}else t.getPlane(Ea),this.splitByPlane(Ea,t)}splitByPlane(t,e){const{triangles:o,trianglePool:n}=this;Tp.copy(e),Tp.needsUpdate=!0;for(let s=0,r=o.length;s<r;s++){const a=o[s];if(!Tp.intersectsTriangle(a,cn,!0))continue;const{a:l,b:c,c:p}=a;let h=0,u=-1,d=!1,y=[],g=[];const f=[l,c,p];for(let m=0;m<3;m++){const b=(m+1)%3;cn.start.copy(f[m]),cn.end.copy(f[b]);const v=t.distanceToPoint(cn.start),x=t.distanceToPoint(cn.end);if(Math.abs(v)<$s&&Math.abs(x)<$s){d=!0;break}if(v>0?y.push(m):g.push(m),Math.abs(v)<$s)continue;let _=!!t.intersectLine(cn,pn);!_&&Math.abs(x)<$s&&(pn.copy(cn.end),_=!0),_&&!(pn.distanceTo(cn.start)<Fp)&&(pn.distanceTo(cn.end)<Fp&&(u=m),h===0?Te.start.copy(pn):Te.end.copy(pn),h++)}if(!d&&h===2&&Te.distance()>$s)if(u!==-1){u=(u+1)%3;let m=0;m===u&&(m=(m+1)%3);let b=m+1;b===u&&(b=(b+1)%3);const v=n.getTriangle();v.a.copy(f[b]),v.b.copy(Te.end),v.c.copy(Te.start),Cn(v)||o.push(v),a.a.copy(f[m]),a.b.copy(Te.start),a.c.copy(Te.end),Cn(a)&&(o.splice(s,1),s--,r--)}else{const m=y.length>=2?g[0]:y[0];if(m===0){let z=Te.start;Te.start=Te.end,Te.end=z}const b=(m+1)%3,v=(m+2)%3,x=n.getTriangle(),_=n.getTriangle();f[b].distanceToSquared(Te.start)<f[v].distanceToSquared(Te.end)?(x.a.copy(f[b]),x.b.copy(Te.start),x.c.copy(Te.end),_.a.copy(f[b]),_.b.copy(f[v]),_.c.copy(Te.start)):(x.a.copy(f[v]),x.b.copy(Te.start),x.c.copy(Te.end),_.a.copy(f[b]),_.b.copy(f[v]),_.c.copy(Te.end)),a.a.copy(f[m]),a.b.copy(Te.end),a.c.copy(Te.start),Cn(x)||o.push(x),Cn(_)||o.push(_),Cn(a)&&(o.splice(s,1),s--,r--)}else h===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}function I3(i){return i=~~i,i+4-i%4}class vd{constructor(t,e=500){this.expansionFactor=1.5,this.type=t,this.length=0,this.array=null,this.setSize(e)}setType(t){if(this.length!==0)throw new Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");const e=this.array.buffer;this.array=new t(e),this.type=t}setSize(t){if(this.array&&t===this.array.length)return;const e=this.type,o=ud()?SharedArrayBuffer:ArrayBuffer,n=new e(new o(I3(t*e.BYTES_PER_ELEMENT)));this.array&&n.set(this.array,0),this.array=n}expand(){const{array:t,expansionFactor:e}=this;this.setSize(t.length*e)}push(...t){let{array:e,length:o}=this;o+t.length>e.length&&(this.expand(),e=this.array);for(let n=0,s=t.length;n<s;n++)e[o+n]=t[n];this.length+=t.length}clear(){this.length=0}}class L3{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(t){return this.groupAttributes[0][t].type}getItemSize(t){return this.groupAttributes[0][t].itemSize}getNormalized(t){return this.groupAttributes[0][t].normalized}getCount(t){if(this.groupCount<=t)return 0;const e=this.getGroupAttrArray("position",t);return e.length/e.itemSize}getTotalLength(t){const{groupCount:e,groupAttributes:o}=this;let n=0;for(let s=0;s<e;s++){const r=o[s];n+=r[t].length}return n}getGroupAttrSet(t=0){const{groupAttributes:e}=this;if(e[t])return this.groupCount=Math.max(this.groupCount,t+1),e[t];const o=e[0];for(this.groupCount=Math.max(this.groupCount,t+1);t>=e.length;){const n={};e.push(n);for(const s in o){const r=o[s],a=new vd(r.type);a.itemSize=r.itemSize,a.normalized=r.normalized,n[s]=a}}return e[t]}getGroupAttrArray(t,e=0){const{groupAttributes:o}=this;if(!o[0][t])throw new Error(`TypedAttributeData: Attribute with "${t}" has not been initialized`);return this.getGroupAttrSet(e)[t]}initializeArray(t,e,o,n){const{groupAttributes:s}=this,a=s[0][t];if(a){if(a.type!==e)for(let l=0,c=s.length;l<c;l++){const p=s[l][t];p.setType(e),p.itemSize=o,p.normalized=n}}else for(let l=0,c=s.length;l<c;l++){const p=new vd(e);p.itemSize=o,p.normalized=n,s[l][t]=p}}clear(){this.groupCount=0;const{groupAttributes:t}=this;t.forEach(e=>{for(const o in e)e[o].clear()})}delete(t){this.groupAttributes.forEach(e=>{delete e[t]})}reset(){this.groupAttributes=[],this.groupCount=0}}class _d{constructor(){this.intersectionSet={},this.ids=[]}add(t,e){const{intersectionSet:o,ids:n}=this;o[t]||(o[t]=[],n.push(t)),o[t].push(e)}}const wd=0,U3=1,N3=2,O3=3,V3=4,Md=5,zd=6,Co=new On,Sd=new $t,ao=new ye,hn=new R,Ed=new se,Fd=new se,Ad=new se,Cp=new se,Fa=new se,Aa=new se,Td=new Eo,kp=new R,Bp=1e-8,H3=1e-15,ii=-1,si=1,Ta=-2,Ca=2,qs=0,ri=1,Pp=2,G3=1e-14;let ka=null;function Cd(i){ka=i}function kd(i,t){i.getMidpoint(Co.origin),i.getNormal(Co.direction);const e=t.raycastFirst(Co,Ze);return!!(e&&Co.direction.dot(e.face.normal)>0)?ii:si}function X3(i,t){function e(){return Math.random()-.5}i.getNormal(kp),Co.direction.copy(kp),i.getMidpoint(Co.origin);const o=3;let n=0,s=1/0;for(let r=0;r<o;r++){Co.direction.x+=e()*Bp,Co.direction.y+=e()*Bp,Co.direction.z+=e()*Bp,Co.direction.multiplyScalar(-1);const a=t.raycastFirst(Co,Ze);if(!!(a&&Co.direction.dot(a.face.normal)>0)&&n++,a!==null&&(s=Math.min(s,a.distance)),s<=H3)return a.face.normal.dot(kp)>0?Ca:Ta;if(n/o>.5||(r-n+1)/o>.5)break}return n/o>.5?ii:si}function W3(i,t){const e=new _d,o=new _d;return Sd.copy(i.matrixWorld).invert().multiply(t.matrixWorld),i.geometry.boundsTree.bvhcast(t.geometry.boundsTree,Sd,{intersectsTriangles(n,s,r,a){if(!Cn(n)&&!Cn(s)){let l=n.intersectsTriangle(s,Td,!0);if(!l){const c=n.plane,p=s.plane,h=c.normal,u=p.normal;h.dot(u)===1&&Math.abs(c.constant-p.constant)<G3&&(l=!0)}if(l){let c=i.geometry.boundsTree.resolveTriangleIndex(r),p=t.geometry.boundsTree.resolveTriangleIndex(a);e.add(c,p),o.add(p,c),ka&&(ka.addEdge(Td),ka.addIntersectingTriangles(r,n,a,s))}}return!1}}),{aIntersections:e,bIntersections:o}}function Z3(i,t,e,o,n,s,r=!1){const a=e.attributes,l=e.index,c=i*3,p=l.getX(c+0),h=l.getX(c+1),u=l.getX(c+2);for(const d in s){const y=a[d],g=s[d];if(!(d in a))throw new Error(`CSG Operations: Attribute ${d} not available on geometry.`);const f=y.itemSize;d==="position"?(ao.a.fromBufferAttribute(y,p).applyMatrix4(o),ao.b.fromBufferAttribute(y,h).applyMatrix4(o),ao.c.fromBufferAttribute(y,u).applyMatrix4(o),Rp(ao.a,ao.b,ao.c,t,3,g,r)):d==="normal"?(ao.a.fromBufferAttribute(y,p).applyNormalMatrix(n),ao.b.fromBufferAttribute(y,h).applyNormalMatrix(n),ao.c.fromBufferAttribute(y,u).applyNormalMatrix(n),r&&(ao.a.multiplyScalar(-1),ao.b.multiplyScalar(-1),ao.c.multiplyScalar(-1)),Rp(ao.a,ao.b,ao.c,t,3,g,r,!0)):(Ed.fromBufferAttribute(y,p),Fd.fromBufferAttribute(y,h),Ad.fromBufferAttribute(y,u),Rp(Ed,Fd,Ad,t,f,g,r))}}function Y3(i,t,e,o,n,s,r,a=!1){Dp(i,o,n,s,r,a),Dp(a?e:t,o,n,s,r,a),Dp(a?t:e,o,n,s,r,a)}function Bd(i,t,e=!1){switch(i){case wd:if(t===si||t===Ca&&!e)return ri;break;case U3:if(e){if(t===ii)return qs}else if(t===si||t===Ta)return ri;break;case N3:if(e){if(t===si||t===Ta)return ri}else if(t===ii)return qs;break;case V3:if(t===ii)return qs;if(t===si)return ri;break;case O3:if(t===ii||t===Ca&&!e)return ri;break;case Md:if(!e&&(t===si||t===Ta))return ri;break;case zd:if(!e&&(t===ii||t===Ca))return ri;break;default:throw new Error(`Unrecognized CSG operation enum "${i}".`)}return Pp}function Rp(i,t,e,o,n,s,r=!1,a=!1){const l=c=>{s.push(c.x),n>1&&s.push(c.y),n>2&&s.push(c.z),n>3&&s.push(c.w)};Cp.set(0,0,0,0).addScaledVector(i,o.a.x).addScaledVector(t,o.a.y).addScaledVector(e,o.a.z),Fa.set(0,0,0,0).addScaledVector(i,o.b.x).addScaledVector(t,o.b.y).addScaledVector(e,o.b.z),Aa.set(0,0,0,0).addScaledVector(i,o.c.x).addScaledVector(t,o.c.y).addScaledVector(e,o.c.z),a&&(Cp.normalize(),Fa.normalize(),Aa.normalize()),l(Cp),r?(l(Aa),l(Fa)):(l(Fa),l(Aa))}function Dp(i,t,e,o,n,s=!1){for(const r in n){const a=t[r],l=n[r];if(!(r in t))throw new Error(`CSG Operations: Attribute ${r} no available on geometry.`);const c=a.itemSize;r==="position"?(hn.fromBufferAttribute(a,i).applyMatrix4(e),l.push(hn.x,hn.y,hn.z)):r==="normal"?(hn.fromBufferAttribute(a,i).applyNormalMatrix(o),s&&hn.multiplyScalar(-1),l.push(hn.x,hn.y,hn.z)):(l.push(a.getX(i)),c>1&&l.push(a.getY(i)),c>2&&l.push(a.getZ(i)),c>3&&l.push(a.getW(i)))}}class $3{constructor(t){this.triangle=new ye().copy(t),this.intersects={}}addTriangle(t,e){this.intersects[t]=new ye().copy(e)}getIntersectArray(){const t=[],{intersects:e}=this;for(const o in e)t.push(e[o]);return t}}class Pd{constructor(){this.data={}}addTriangleIntersection(t,e,o,n){const{data:s}=this;s[t]||(s[t]=new $3(e)),s[t].addTriangle(o,n)}getTrianglesAsArray(t=null){const{data:e}=this,o=[];if(t!==null)t in e&&o.push(e[t].triangle);else for(const n in e)o.push(e[n].triangle);return o}getTriangleIndices(){return Object.keys(this.data).map(t=>parseInt(t))}getIntersectionIndices(t){const{data:e}=this;return e[t]?Object.keys(e[t].intersects).map(o=>parseInt(o)):[]}getIntersectionsAsArray(t=null,e=null){const{data:o}=this,n=new Set,s=[],r=a=>{if(o[a])if(e!==null)o[a].intersects[e]&&s.push(o[a].intersects[e]);else{const l=o[a].intersects;for(const c in l)n.has(c)||(n.add(c),s.push(l[c]))}};if(t!==null)r(t);else for(const a in o)r(a);return s}reset(){this.data={}}}class q3{constructor(){this.enabled=!1,this.triangleIntersectsA=new Pd,this.triangleIntersectsB=new Pd,this.intersectionEdges=[]}addIntersectingTriangles(t,e,o,n){const{triangleIntersectsA:s,triangleIntersectsB:r}=this;s.addTriangleIntersection(t,e,o,n),r.addTriangleIntersection(o,n,t,e)}addEdge(t){this.intersectionEdges.push(t.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),Cd(this))}complete(){this.enabled&&Cd(null)}}const kn=new $t,Ba=new Kt,ai=new ye,Pa=new ye,Bn=new ye,Ra=new ye,Lo=[],li=[];function j3(i){for(const t of i)return t}function K3(i,t,e,o,n,s={}){const{useGroups:r=!0}=s,{aIntersections:a,bIntersections:l}=W3(i,t),c=[];let p=null,h;return h=r?0:-1,Rd(i,t,a,e,!1,o,n,h),Dd(i,t,a,e,!1,n,h),e.findIndex(d=>d!==zd&&d!==Md)!==-1&&(h=r?i.geometry.groups.length||1:-1,Rd(t,i,l,e,!0,o,n,h),Dd(t,i,l,e,!0,n,h)),Lo.length=0,li.length=0,{groups:c,materials:p}}function Rd(i,t,e,o,n,s,r,a=0){const l=i.matrixWorld.determinant()<0;kn.copy(t.matrixWorld).invert().multiply(i.matrixWorld),Ba.getNormalMatrix(i.matrixWorld).multiplyScalar(l?-1:1);const c=i.geometry.groupIndices,p=i.geometry.index,h=i.geometry.attributes.position,u=t.geometry.boundsTree,d=t.geometry.index,y=t.geometry.attributes.position,g=e.ids,f=e.intersectionSet;for(let m=0,b=g.length;m<b;m++){const v=g[m],x=a===-1?0:c[v]+a,_=3*v,z=p.getX(_+0),E=p.getX(_+1),C=p.getX(_+2);ai.a.fromBufferAttribute(h,z).applyMatrix4(kn),ai.b.fromBufferAttribute(h,E).applyMatrix4(kn),ai.c.fromBufferAttribute(h,C).applyMatrix4(kn),s.reset(),s.initialize(ai);const M=f[v];for(let k=0,A=M.length;k<A;k++){const B=3*M[k],F=d.getX(B+0),N=d.getX(B+1),G=d.getX(B+2);Pa.a.fromBufferAttribute(y,F),Pa.b.fromBufferAttribute(y,N),Pa.c.fromBufferAttribute(y,G),s.splitByTriangle(Pa)}const S=s.triangles;for(let k=0,A=S.length;k<A;k++){const B=S[k],F=s.coplanarTriangleUsed?X3(B,u):kd(B,u);Lo.length=0,li.length=0;for(let N=0,G=o.length;N<G;N++){const W=Bd(o[N],F,n);W!==Pp&&(li.push(W),Lo.push(r[N].getGroupAttrSet(x)))}if(Lo.length!==0){ai.getBarycoord(B.a,Ra.a),ai.getBarycoord(B.b,Ra.b),ai.getBarycoord(B.c,Ra.c);for(let N=0,G=Lo.length;N<G;N++){const W=Lo[N],K=li[N]===qs;Z3(v,Ra,i.geometry,i.matrixWorld,Ba,W,l!==K)}}}}return g.length}function Dd(i,t,e,o,n,s,r=0){const a=i.matrixWorld.determinant()<0;kn.copy(t.matrixWorld).invert().multiply(i.matrixWorld),Ba.getNormalMatrix(i.matrixWorld).multiplyScalar(a?-1:1);const l=t.geometry.boundsTree,c=i.geometry.groupIndices,p=i.geometry.index,h=i.geometry.attributes,u=h.position,d=[],y=i.geometry.halfEdges,g=new Set,f=vp(i.geometry);for(let m=0,b=f;m<b;m++)m in e.intersectionSet||g.add(m);for(;g.size>0;){const m=j3(g);g.delete(m),d.push(m);const b=3*m,v=p.getX(b+0),x=p.getX(b+1),_=p.getX(b+2);Bn.a.fromBufferAttribute(u,v).applyMatrix4(kn),Bn.b.fromBufferAttribute(u,x).applyMatrix4(kn),Bn.c.fromBufferAttribute(u,_).applyMatrix4(kn);const z=kd(Bn,l);li.length=0,Lo.length=0;for(let E=0,C=o.length;E<C;E++){const M=Bd(o[E],z,n);M!==Pp&&(li.push(M),Lo.push(s[E]))}for(;d.length>0;){const E=d.pop();for(let C=0;C<3;C++){const M=y.getSiblingTriangleIndex(E,C);M!==-1&&g.has(M)&&(d.push(M),g.delete(M))}if(Lo.length!==0){const C=3*E,M=p.getX(C+0),S=p.getX(C+1),k=p.getX(C+2),A=r===-1?0:c[E]+r;if(Bn.a.fromBufferAttribute(u,M),Bn.b.fromBufferAttribute(u,S),Bn.c.fromBufferAttribute(u,k),!Cn(Bn))for(let B=0,F=Lo.length;B<F;B++){const N=li[B],G=Lo[B].getGroupAttrSet(A),W=N===qs;Y3(M,S,k,h,i.matrixWorld,Ba,G,W!==a)}}}}}function J3(i){for(let t=0;t<i.length-1;t++){const e=i[t],o=i[t+1];if(e.materialIndex===o.materialIndex){const n=e.start,s=o.start+o.count;o.start=n,o.count=s-n,i.splice(t,1),t--}}}function Q3(i,t,e,o){e.clear();const n=i.attributes;for(let s=0,r=o.length;s<r;s++){const a=o[s],l=n[a];e.initializeArray(a,l.array.constructor,l.itemSize,l.normalized)}for(const s in e.attributes)o.includes(s)||e.delete(s);for(const s in t.attributes)o.includes(s)||(t.deleteAttribute(s),t.dispose())}function tS(i,t,e){let o=!1,n=-1;const s=i.attributes,r=t.groupAttributes[0];for(const l in r){const c=t.getTotalLength(l),p=t.getType(l),h=t.getItemSize(l),u=t.getNormalized(l);let d=s[l];(!d||d.array.length<c)&&(d=new Gt(new p(c),h,u),i.setAttribute(l,d),o=!0);let y=0;for(let g=0,f=Math.min(e.length,t.groupCount);g<f;g++){const m=e[g].index,{array:b,type:v,length:x}=t.groupAttributes[m][l],_=new v(b.buffer,0,x);d.array.set(_,y),y+=_.length}d.needsUpdate=!0,n=c/d.itemSize}if(i.index){const l=i.index.array;if(l.length<n)i.index=null,o=!0;else for(let c=0,p=l.length;c<p;c++)l[c]=c}let a=0;i.clearGroups();for(let l=0,c=Math.min(e.length,t.groupCount);l<c;l++){const{index:p,materialIndex:h}=e[l],u=t.getCount(p);u!==0&&(i.addGroup(a,u,h),a+=u)}i.setDrawRange(0,n),i.boundsTree=null,o&&i.dispose()}function Id(i,t){let e=t;return Array.isArray(t)||(e=[],i.forEach(o=>{e[o.materialIndex]=t})),e}class eS{constructor(){this.triangleSplitter=new D3,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new q3}getGroupRanges(t){return!this.useGroups||t.groups.length===0?[{start:0,count:1/0,materialIndex:0}]:t.groups.map(e=>({...e}))}evaluate(t,e,o,n=new Sp){let s=!0;if(Array.isArray(o)||(o=[o]),Array.isArray(n)||(n=[n],s=!1),n.length!==o.length)throw new Error("Evaluator: operations and target array passed as different sizes.");t.prepareGeometry(),e.prepareGeometry();const{triangleSplitter:r,attributeData:a,attributes:l,useGroups:c,consolidateGroups:p,debug:h}=this;for(;a.length<n.length;)a.push(new L3);n.forEach((m,b)=>{Q3(t.geometry,m.geometry,a[b],l)}),h.init(),K3(t,e,o,r,a,{useGroups:c}),h.complete();const u=this.getGroupRanges(t.geometry),d=Id(u,t.material),y=this.getGroupRanges(e.geometry),g=Id(y,e.material);y.forEach(m=>m.materialIndex+=d.length);let f=[...u,...y].map((m,b)=>({...m,index:b}));if(c){const m=[...d,...g];p&&(f=f.map(v=>{const x=m[v.materialIndex];return v.materialIndex=m.indexOf(x),v}).sort((v,x)=>v.materialIndex-x.materialIndex));const b=[];for(let v=0,x=m.length;v<x;v++){let _=!1;for(let z=0,E=f.length;z<E;z++){const C=f[z];C.materialIndex===v&&(_=!0,C.materialIndex=b.length)}_&&b.push(m[v])}n.forEach(v=>{v.material=b})}else f=[{start:0,count:1/0,index:0,materialIndex:0}],n.forEach(m=>{m.material=d[0]});return n.forEach((m,b)=>{const v=m.geometry;tS(v,a[b],f),p&&J3(v.groups)}),s?n:n[0]}evaluateHierarchy(t,e=new Sp){t.updateMatrixWorld(!0);const o=(s,r)=>{const a=s.children;for(let l=0,c=a.length;l<c;l++){const p=a[l];p.isOperationGroup?o(p,r):r(p)}},n=s=>{const r=s.children;let a=!1;for(let c=0,p=r.length;c<p;c++){const h=r[c];a=n(h)||a}const l=s.isDirty();if(l&&s.markUpdated(),a&&!s.isOperationGroup){let c;return o(s,p=>{c?c=this.evaluate(c,p,p.operation):c=this.evaluate(s,p,p.operation)}),s._cachedGeometry=c.geometry,s._cachedMaterials=c.material,!0}else return a||l};return n(t),e.geometry=t._cachedGeometry,e.material=t._cachedMaterials,e}reset(){this.triangleSplitter.reset()}}let oS=0;class Ld{constructor(t={}){this.id=t.id||`merged_${++oS}`,this.type="merged",this.color=t.color||"#888888",this.layerId=t.layerId||"default",this.sourceBlocks=t.sourceBlocks||[],this.mesh=null,this.edges=null,this.boundingBox=new Ne,t.geometry&&this.createFromGeometry(t.geometry,t.material)}createFromGeometry(t,e){this.mesh=new ge(t,e||new Ge({color:this.color,roughness:.7,metalness:.1,vertexColors:t.hasAttribute("color")})),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.userData.mergedId=this.id,this.mesh.userData.merged=this,this.createEdges(t),t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox)}createEdges(t){const e=new Ts(t,30),o=new $n({color:0,transparent:!0,opacity:.3});this.edges=new Xi(e,o),this.mesh.add(this.edges)}setEdgesVisible(t){this.edges&&(this.edges.visible=t)}setEdgesOpacity(t){this.edges&&(this.edges.material.opacity=t)}setSelected(t){this.mesh.material.emissive&&this.mesh.material.emissive.set(t?3355443:0)}get gridPosition(){const t=new R;return this.boundingBox.getCenter(t),{x:Math.floor(t.x),y:Math.floor(t.y),z:Math.floor(t.z)}}toJSON(){return{id:this.id,type:"merged",color:this.color,layerId:this.layerId,sourceBlocks:this.sourceBlocks}}dispose(){this.edges&&(this.edges.geometry.dispose(),this.edges.material.dispose()),this.mesh&&(this.mesh.geometry.dispose(),Array.isArray(this.mesh.material)?this.mesh.material.forEach(t=>t.dispose()):this.mesh.material.dispose())}}class nS{constructor(t){this.blockManager=t,this.evaluator=new eS}findIslands(t){if(t.length===0)return[];const e=new Map,o=new Set(t.map(a=>a.id));for(const a of t){const l=a.gridPosition,c=`${l.x},${l.y},${l.z}`;e.set(c,a)}const n=new Set,s=[],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];for(const a of t){if(n.has(a.id))continue;const l=[],c=[a];for(;c.length>0;){const p=c.shift();if(n.has(p.id))continue;n.add(p.id),l.push(p);const h=p.gridPosition;for(const[u,d,y]of r){const g=`${h.x+u},${h.y+d},${h.z+y}`,f=e.get(g);f&&o.has(f.id)&&!n.has(f.id)&&c.push(f)}}l.length>0&&s.push(l)}return s}createBrushFromBlock(t){const e=t.mesh;e.updateMatrixWorld();const o=e.geometry.clone();if(o.applyMatrix4(e.matrixWorld),!o.index){const s=o.getAttribute("position"),r=[];for(let a=0;a<s.count;a++)r.push(a);o.setIndex(r)}const n=new Sp(o);return n.updateMatrixWorld(),n}mergeIsland(t){if(t.length===0)return null;const e=t[0].color;if(t.length===1){const a=t[0];a.mesh.updateMatrixWorld();const l=a.mesh.geometry.clone();l.applyMatrix4(a.mesh.matrixWorld),this.addVertexColors(l,a.color);const c=new Ge({color:16777215,vertexColors:!0,roughness:.7,metalness:.1});return new Ld({geometry:l,material:c,color:e,layerId:a.layerId,sourceBlocks:[a.toJSON()]})}const o=new Map;for(const a of t){const l=a.color.toLowerCase();o.has(l)||o.set(l,[]),o.get(l).push(a)}const n=[];for(const[a,l]of o)try{const c=this.csgMergeBlocks(l);c&&(this.addVertexColors(c,a),n.push({geometry:c,color:a}))}catch(c){console.error(`CSG merge failed for color ${a}:`,c);const p=this.simpleMergeBlocks(l);this.addVertexColors(p,a),n.push({geometry:p,color:a})}if(n.length===0)return null;const s=this.combineGeometriesWithColors(n),r=new Ge({color:16777215,vertexColors:!0,roughness:.7,metalness:.1});return new Ld({geometry:s,material:r,color:e,layerId:t[0].layerId,sourceBlocks:t.map(a=>a.toJSON())})}csgMergeBlocks(t){if(t.length===0)return null;if(t.length===1){const n=t[0];n.mesh.updateMatrixWorld();const s=n.mesh.geometry.clone();return s.applyMatrix4(n.mesh.matrixWorld),s}let e=this.createBrushFromBlock(t[0]);for(let n=1;n<t.length;n++){const s=this.createBrushFromBlock(t[n]),r=this.evaluator.evaluate(e,s,wd);e.geometry&&e.geometry.dispose(),s.geometry&&s.geometry.dispose(),e=r}const o=e.geometry;return o.getAttribute("normal")||o.computeVertexNormals(),o}simpleMergeBlocks(t){const e=[];for(const n of t){const s=n.mesh;s.updateMatrixWorld();const r=s.geometry.clone();r.applyMatrix4(s.matrixWorld),e.push(r)}const o=this.mergeGeometries(e);return e.forEach(n=>n.dispose()),o}addVertexColors(t,e){const o=new bt(e),n=t.getAttribute("position"),s=new Float32Array(n.count*3);for(let r=0;r<n.count;r++)s[r*3]=o.r,s[r*3+1]=o.g,s[r*3+2]=o.b;t.setAttribute("color",new Gt(s,3))}combineGeometriesWithColors(t){const e=[],o=[],n=[],s=[];let r=0;for(const{geometry:l}of t){const c=l.getAttribute("position"),p=l.getAttribute("normal"),h=l.getAttribute("color"),u=l.getIndex();for(let d=0;d<c.count;d++)e.push(c.getX(d),c.getY(d),c.getZ(d)),p&&o.push(p.getX(d),p.getY(d),p.getZ(d)),h&&n.push(h.getX(d),h.getY(d),h.getZ(d));if(u)for(let d=0;d<u.count;d++)s.push(u.getX(d)+r);else for(let d=0;d<c.count;d++)s.push(d+r);r+=c.count,l.dispose()}const a=new Xt;return a.setAttribute("position",new Yt(e,3)),o.length>0?a.setAttribute("normal",new Yt(o,3)):a.computeVertexNormals(),n.length>0&&a.setAttribute("color",new Yt(n,3)),a.setIndex(s),a}mergeGeometries(t){const e=[],o=[],n=[];let s=0;for(const a of t){const l=a.getAttribute("position"),c=a.getAttribute("normal"),p=a.getIndex();for(let h=0;h<l.count;h++)e.push(l.getX(h),l.getY(h),l.getZ(h)),c&&o.push(c.getX(h),c.getY(h),c.getZ(h));if(p)for(let h=0;h<p.count;h++)n.push(p.getX(h)+s);else for(let h=0;h<l.count;h++)n.push(h+s);s+=l.count}const r=new Xt;return r.setAttribute("position",new Yt(e,3)),o.length>0?r.setAttribute("normal",new Yt(o,3)):r.computeVertexNormals(),r.setIndex(n),r}flatten(t=null){const e=t||this.blockManager.getAllBlocks();if(e.length===0)return{mergedMeshes:[],removedBlockIds:[]};const o=this.findIslands(e),n=[],s=[];for(const r of o){const a=this.mergeIsland(r);a&&(n.push(a),s.push(...r.map(l=>l.id)))}return{mergedMeshes:n,removedBlockIds:s}}flattenAndApply(t=null){const{mergedMeshes:e,removedBlockIds:o}=this.flatten(t);for(const n of o)this.blockManager.removeBlock(n);for(const n of e)this.blockManager.addMergedMesh(n);return{mergedCount:e.length,blocksRemoved:o.length,mergedMeshes:e}}}const Da={pipes:{label:"Pipes",straight:{X:"pipeX",Y:"pipeY",Z:"pipeZ"},elbows:{"X+_Z+":{type:"pipeElbowXZ3",rotation:0},"X+_Z-":{type:"pipeElbowXZ2",rotation:0},"X-_Z+":{type:"pipeElbowXZ4",rotation:0},"X-_Z-":{type:"pipeElbowXZ",rotation:0},"Z+_X+":{type:"pipeElbowXZ3",rotation:0},"Z+_X-":{type:"pipeElbowXZ4",rotation:0},"Z-_X+":{type:"pipeElbowXZ2",rotation:0},"Z-_X-":{type:"pipeElbowXZ",rotation:0},"X+_Y+":{type:"pipeElbowXY",rotation:0},"X+_Y-":{type:"pipeElbowXY",rotation:180},"X-_Y+":{type:"pipeElbowXY2",rotation:0},"X-_Y-":{type:"pipeElbowXY2",rotation:180},"Y+_X+":{type:"pipeElbowXY",rotation:0},"Y+_X-":{type:"pipeElbowXY2",rotation:0},"Y-_X+":{type:"pipeElbowXY",rotation:180},"Y-_X-":{type:"pipeElbowXY2",rotation:180},"Z+_Y+":{type:"pipeElbowYZ",rotation:0},"Z+_Y-":{type:"pipeElbowYZ",rotation:180},"Z-_Y+":{type:"pipeElbowYZ2",rotation:0},"Z-_Y-":{type:"pipeElbowYZ2",rotation:180},"Y+_Z+":{type:"pipeElbowYZ",rotation:0},"Y+_Z-":{type:"pipeElbowYZ2",rotation:0},"Y-_Z+":{type:"pipeElbowYZ",rotation:180},"Y-_Z-":{type:"pipeElbowYZ2",rotation:180}},junctions:{cross:"pipeCross",tXZ:"pipeT",tXY:"pipeTY",tYZ:"pipeTZ"},decorative:["downspout"],allowedScales:[1,2,4],clusterBased:!1},cables:{label:"Cables",straight:{X:"cableX",Y:"cableY",Z:"cableZ"},elbows:{"X+_Z+":{type:"cableElbow",rotation:180},"X+_Z-":{type:"cableElbow",rotation:90},"X-_Z+":{type:"cableElbow",rotation:270},"X-_Z-":{type:"cableElbow",rotation:0},"Z+_X+":{type:"cableElbow",rotation:180},"Z+_X-":{type:"cableElbow",rotation:270},"Z-_X+":{type:"cableElbow",rotation:90},"Z-_X-":{type:"cableElbow",rotation:0},"X+_Y+":{type:"cableElbowY",rotation:0},"X-_Y+":{type:"cableElbowY",rotation:180},"Z+_Y+":{type:"cableElbowY",rotation:90},"Z-_Y+":{type:"cableElbowY",rotation:270},"Y+_X+":{type:"cableElbowY",rotation:0},"Y+_X-":{type:"cableElbowY",rotation:180},"Y+_Z+":{type:"cableElbowY",rotation:90},"Y+_Z-":{type:"cableElbowY",rotation:270}},junctions:{tXZ:"cableT"},decorative:["cableHanging","cableDroop","cableLoop"],allowedScales:[1,2,4],clusterBased:!1},conduits:{label:"Conduits",straight:{X:"conduitX",Y:"conduitY",Z:"conduitZ"},elbows:{"X+_Z+":{type:"conduitElbow",rotation:180},"X+_Z-":{type:"conduitElbow",rotation:90},"X-_Z+":{type:"conduitElbow",rotation:270},"X-_Z-":{type:"conduitElbow",rotation:0},"Z+_X+":{type:"conduitElbow",rotation:180},"Z+_X-":{type:"conduitElbow",rotation:270},"Z-_X+":{type:"conduitElbow",rotation:90},"Z-_X-":{type:"conduitElbow",rotation:0},"X+_Y+":{type:"conduitElbowY",rotation:0},"X-_Y+":{type:"conduitElbowY",rotation:180},"Z+_Y+":{type:"conduitElbowY",rotation:90},"Z-_Y+":{type:"conduitElbowY",rotation:270},"Y+_X+":{type:"conduitElbowY",rotation:0},"Y+_X-":{type:"conduitElbowY",rotation:180},"Y+_Z+":{type:"conduitElbowY",rotation:90},"Y+_Z-":{type:"conduitElbowY",rotation:270}},junctions:{tXZ:"conduitT"},decorative:[],allowedScales:[1,2,4],clusterBased:!1},industrial:{label:"Industrial",straight:{X:"ductX",Y:"iBeam",Z:"ductZ"},elbows:{"X+_Z+":{type:"ductCorner",rotation:180},"X+_Z-":{type:"ductCorner",rotation:90},"X-_Z+":{type:"ductCorner",rotation:270},"X-_Z-":{type:"ductCorner",rotation:0},"Z+_X+":{type:"ductCorner",rotation:180},"Z+_X-":{type:"ductCorner",rotation:270},"Z-_X+":{type:"ductCorner",rotation:90},"Z-_X-":{type:"ductCorner",rotation:0}},junctions:{},decorative:["tank","valve","vent","catwalk","grateFloor"],allowedScales:[1,2,4],clusterBased:!1},natural:{label:"Natural",blocks:["rock","bush","logX","logZ","stump","boulder","grass","flower","rockSmall","rockLarge","rockFlat","rockTall","rockJagged","rockCluster","rockPile","pebbles","slate","crystalSmall","crystalLarge","crystalCluster","crystalSpike","crystalFlat","crystalShard","crystalFormation","stalactite","stalagmite","mushroom","mushroomCluster","moss","vine","coral"],allowedScales:[1,2,4],clusterBased:!0},abstract:{label:"Abstract",blocks:["cube","sphere","cylinder","cone","pyramid","octagon","gem","crystal","prism"],allowedScales:[1,2,4],clusterBased:!0},beams:{label:"Beams",straight:{X:"beamX",Y:"pillar",Z:"beamZ"},elbows:{},junctions:{cross:"crossBeam"},decorative:["truss","post"],allowedScales:[1,2,4],clusterBased:!1},fences:{label:"Fences",straight:{X:"fence",Y:"fencePost",Z:"fenceZ"},elbows:{"X+_Z+":{type:"fenceCorner",rotation:180},"X+_Z-":{type:"fenceCorner",rotation:90},"X-_Z+":{type:"fenceCorner",rotation:270},"X-_Z-":{type:"fenceCorner",rotation:0},"Z+_X+":{type:"fenceCorner",rotation:180},"Z+_X-":{type:"fenceCorner",rotation:270},"Z-_X+":{type:"fenceCorner",rotation:90},"Z-_X-":{type:"fenceCorner",rotation:0}},junctions:{tXZ:"fenceT",cross:"fenceCross"},decorative:["gate","gateArch"],allowedScales:[1,2,4],clusterBased:!1},mixedTech:{label:"Tech Mix",blocks:["pipeX","pipeY","pipeZ","pipeElbowXZ","pipeCross","pipeT","cableX","cableY","cableZ","cableHanging","cableLoop","conduitX","conduitY","conduitZ","tank","valve","vent","antenna","ductX","ductZ"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedOrganic:{label:"Organic Mix",blocks:["rock","bush","logX","logZ","stump","boulder","grass","flower","rockSmall","rockLarge","rockFlat","rockJagged","rockCluster","pebbles","crystalSmall","crystalLarge","crystalCluster","crystalFormation","mushroom","mushroomCluster","moss","vine","coral","sphere","crystal","gem","prism","pillar","pillarRound","post"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedArchitecture:{label:"Architecture Mix",blocks:["cube","slab","slabTop","pillar","pillarRound","arch","archHalf","beamX","beamZ","crossBeam","truss","stairs","stairsCorner","ramp","dome","domeLow","halfX","halfZ","quarter","wedge"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedGeometric:{label:"Geometric Mix",blocks:["cube","sphere","cylinder","cone","pyramid","octagon","prism","gem","crystal","wedge","wedgeCorner","wedgeInner","slab","slabTop","quarter"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedChaos:{label:"Chaos Mix",blocks:["cube","sphere","cylinder","cone","pyramid","gem","pipeX","pipeY","pipeZ","tank","valve","rock","bush","crystal","pillar","arch","dome","stairs","beamX","beamZ","truss","wedge","slab","octagon"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedSciFi:{label:"Sci-Fi Mix",blocks:["pipeX","pipeY","pipeZ","pipeCross","antenna","tank","vent","valve","octagon","cylinder","dome","domeLow","slab","slabTop","grateFloor","catwalk","pillar","pillar2","iBeam"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},mixedRuins:{label:"Ruins Mix",blocks:["cube","slab","quarter","wedge","wedgeCorner","pillar","arch","archHalf","stairs","rock","boulder","bush","grass","moss","vine","rockSmall","rockFlat","rockCluster","pebbles","slate","halfX","halfZ","stump"],allowedScales:[1,2,4],clusterBased:!0,mixed:!0},cave:{label:"Cave",blocks:["rock","boulder","rockSmall","rockLarge","rockFlat","rockTall","rockJagged","rockCluster","rockPile","pebbles","slate","crystalSmall","crystalLarge","crystalCluster","crystalSpike","crystalFlat","crystalShard","crystalFormation","stalactite","stalagmite","mushroom","mushroomCluster","moss"],allowedScales:[1,2,4],clusterBased:!0},crystals:{label:"Crystals",blocks:["crystal","gem","prism","crystalSmall","crystalLarge","crystalCluster","crystalSpike","crystalFlat","crystalShard","crystalFormation"],allowedScales:[1,2,4],clusterBased:!0},rocks:{label:"Rocks",blocks:["rock","boulder","rockSmall","rockLarge","rockFlat","rockTall","rockJagged","rockCluster","rockPile","pebbles","slate"],allowedScales:[1,2,4],clusterBased:!0}};function iS(i,t,e){if(!i.elbows)return null;const o=`${t}_${e}`;return i.elbows[o]||null}function Ud(i,t){return i.straight&&i.straight[t]||null}function Nd(i){return!i.decorative||i.decorative.length===0?null:i.decorative[Math.floor(Math.random()*i.decorative.length)]}function sS(i){return!i.blocks||i.blocks.length===0?null:i.blocks[Math.floor(Math.random()*i.blocks.length)]}const Ia={walk:{label:"Random Walk",description:"Connected directional growth"},cluster:{label:"Cluster",description:"Organic blob spreading"},lsystem:{label:"L-System",description:"Fractal rule-based growth"},spiral:{label:"Spiral",description:"Spiral tower patterns"},tree:{label:"Tree",description:"Branching tree structures"},wave:{label:"Wave",description:"Sine wave patterns"},drunk:{label:"Drunkard's Walk",description:"Chaotic random movement"},crystal:{label:"Crystal",description:"Geometric crystalline growth"},vine:{label:"Vine",description:"Climbing vine patterns"},layers:{label:"Layered",description:"Stacked layers of different blocks"},scatter3d:{label:"Scatter 3D",description:"Random 3D cloud of mixed blocks"},radial:{label:"Radial Burst",description:"Exploding outward pattern"},gradient:{label:"Gradient",description:"Block types change with distance"},terrain:{label:"Terrain",description:"Heightmap-based mixed terrain"},galaxy:{label:"Galaxy",description:"Spiral arms with mixed blocks"},cavern:{label:"Cavern",description:"Cave with stalactites and stalagmites"},rockField:{label:"Rock Field",description:"Scattered rock landscape"},mushroomGrove:{label:"Mushroom Grove",description:"Forest of mushrooms"},crystalCave:{label:"Crystal Cave",description:"Crystalline cave formation"},coralReef:{label:"Coral Reef",description:"Underwater coral structures"},boulderPile:{label:"Boulder Pile",description:"Piled rocks and stones"}};class rS{constructor(t){this.blockManager=t,this.preset="pipes",this.algorithm="walk",this.maxBlocks=50,this.branchChance=.2,this.turnChance=.3,this.scaleRatio=.8,this.colorHarmony="analogous",this.verticalBias=.1,this.decorativeChance=.05,this.placedPositions=new Set}generate(t,e={}){const o=Da[this.preset];if(!o)return console.warn(`Unknown scatter preset: ${this.preset}`),[];const n={maxBlocks:e.maxBlocks??this.maxBlocks,branchChance:e.branchChance??this.branchChance,turnChance:e.turnChance??this.turnChance,scaleRatio:e.scaleRatio??this.scaleRatio,baseColor:e.baseColor||"#5588cc",colorHarmony:e.colorHarmony??this.colorHarmony,verticalBias:e.verticalBias??this.verticalBias,decorativeChance:e.decorativeChance??this.decorativeChance},s=this.generateColorPalette(n.baseColor,n.colorHarmony);switch(this.placedPositions.clear(),this.algorithm){case"walk":return this.generateDirectional(t,o,n,s);case"cluster":return this.generateCluster(t,o,n,s);case"lsystem":return this.generateLSystem(t,o,n,s);case"spiral":return this.generateSpiral(t,o,n,s);case"tree":return this.generateTree(t,o,n,s);case"wave":return this.generateWave(t,o,n,s);case"drunk":return this.generateDrunkard(t,o,n,s);case"crystal":return this.generateCrystal(t,o,n,s);case"vine":return this.generateVine(t,o,n,s);case"layers":return this.generateLayers(t,o,n,s);case"scatter3d":return this.generateScatter3D(t,o,n,s);case"radial":return this.generateRadial(t,o,n,s);case"gradient":return this.generateGradient(t,o,n,s);case"terrain":return this.generateTerrain(t,o,n,s);case"galaxy":return this.generateGalaxy(t,o,n,s);case"cavern":return this.generateCavern(t,o,n,s);case"rockField":return this.generateRockField(t,o,n,s);case"mushroomGrove":return this.generateMushroomGrove(t,o,n,s);case"crystalCave":return this.generateCrystalCave(t,o,n,s);case"coralReef":return this.generateCoralReef(t,o,n,s);case"boulderPile":return this.generateBoulderPile(t,o,n,s);default:return o.clusterBased?this.generateCluster(t,o,n,s):this.generateDirectional(t,o,n,s)}}generateDirectional(t,e,o,n){const s=[],r=[],a=["X+","X-","Z+","Z-"],l=a[Math.floor(Math.random()*a.length)];for(r.push({position:{...t},direction:l,previousDirection:null,depth:0});r.length>0&&s.length<o.maxBlocks;){const c=r.shift(),p=this.posKey(c.position);if(this.placedPositions.has(p))continue;const h=this.pickScale(e,o.scaleRatio);if(h>1&&(c.position.x=Math.floor(c.position.x/h)*h,c.position.z=Math.floor(c.position.z/h)*h),this.blockManager.wouldOverlapAt("cube",c.position,{w:1,h:1,d:1},null,h))continue;let u=null,d=0;if(c.previousDirection&&c.previousDirection!==c.direction&&this.getAxisFromDirection(c.previousDirection)!==this.getAxisFromDirection(c.direction)){const b=iS(e,c.previousDirection,c.direction);if(b)u=b.type,d=b.rotation;else{const v=this.getAxisFromDirection(c.direction);u=Ud(e,v)}}else{const b=this.getAxisFromDirection(c.direction);u=Ud(e,b)}if(!u&&(u=Nd(e),!u))continue;const g=n[Math.floor(Math.random()*n.length)];s.push({type:u,position:{...c.position},color:g,rotation:{x:0,y:d,z:0},scale:h}),this.placedPositions.add(p);const f=this.moveInDirection(c.position,c.direction,h);let m=c.direction;if(Math.random()<o.turnChance&&(Math.random()<o.verticalBias&&c.direction.charAt(0)!=="Y"?m="Y+":m=this.getPerpendicularDirection(c.direction,o.verticalBias)),r.push({position:f,direction:m,previousDirection:c.direction,depth:c.depth+1}),Math.random()<o.branchChance&&s.length<o.maxBlocks-5){const b=this.getPerpendicularDirection(c.direction,o.verticalBias),v=this.moveInDirection(c.position,b,h);r.push({position:v,direction:b,previousDirection:c.direction,depth:c.depth+1})}if(Math.random()<o.decorativeChance){const b=Nd(e);if(b){const v=this.getPerpendicularDirection(c.direction,0),x=this.moveInDirection(c.position,v,1),_=this.posKey(x);!this.placedPositions.has(_)&&!this.blockManager.wouldOverlapAt(b,x)&&(s.push({type:b,position:x,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(_))}}}return s}generateCluster(t,e,o,n){const s=[],r=[{...t}];for(;r.length>0&&s.length<o.maxBlocks;){const a=r.shift(),l=this.posKey(a);if(this.placedPositions.has(l))continue;const c=this.pickScale(e,o.scaleRatio),p={...a};if(c>1&&(p.x=Math.floor(a.x/c)*c,p.z=Math.floor(a.z/c)*c),this.blockManager.wouldOverlapAt("cube",p,{w:1,h:1,d:1},null,c))continue;const h=sS(e);if(!h)continue;const u=n[Math.floor(Math.random()*n.length)];s.push({type:h,position:p,color:u,rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:c}),this.placedPositions.add(l);const d=this.getNeighbors(a);for(const y of d){const g=.7-s.length/o.maxBlocks*.4;Math.random()<g&&r.push(y)}}return s}generateLSystem(t,e,o,n){const s=[],a={F:"F[+F]F[-F]F"},l=Math.min(4,Math.floor(Math.log2(o.maxBlocks/5)));let c="F";for(let y=0;y<l;y++){let g="";for(const f of c)g+=a[f]||f;c=g}const p=[];let h={...t},u=0;const d=25+Math.random()*20;for(const y of c){if(s.length>=o.maxBlocks)break;switch(y){case"F":{const g=this.posKey(h);if(!this.placedPositions.has(g)){const m=this.pickScale(e,o.scaleRatio),b=this.getBlockForPreset(e,"straight");this.blockManager.wouldOverlapAt(b,h,{w:1,h:1,d:1},null,m)||(s.push({type:b,position:{...h},color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.round(u/90)*90,z:0},scale:m}),this.placedPositions.add(g))}const f=u*Math.PI/180;h={x:h.x+Math.round(Math.sin(f)),y:h.y+(Math.random()<o.verticalBias?1:0),z:h.z+Math.round(Math.cos(f))};break}case"+":u+=d;break;case"-":u-=d;break;case"[":p.push({pos:{...h},angle:u});break;case"]":if(p.length>0){const g=p.pop();h=g.pos,u=g.angle}break}}return s}generateSpiral(t,e,o,n){const s=[],r=3+Math.random()*4,a=2+Math.random()*3,l=o.maxBlocks/(2*Math.PI*r);for(let c=0;c<o.maxBlocks;c++){const p=c/o.maxBlocks*l*2*Math.PI,h=r*(1-c/o.maxBlocks*.3),u={x:Math.round(t.x+Math.cos(p)*h),y:Math.round(t.y+p/(2*Math.PI)*a),z:Math.round(t.z+Math.sin(p)*h)},d=this.posKey(u);if(this.placedPositions.has(d))continue;const y=this.pickScale(e,o.scaleRatio),g=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(g,u,{w:1,h:1,d:1},null,y)||(s.push({type:g,position:u,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.round(p*180/Math.PI)%360,z:0},scale:y}),this.placedPositions.add(d))}return s}generateTree(t,e,o,n){const s=[],r=3+Math.floor(Math.random()*5),a=2+Math.floor(Math.random()*3);for(let p=0;p<r&&s.length<o.maxBlocks;p++){const h={x:t.x,y:t.y+p,z:t.z},u=this.posKey(h);if(!this.placedPositions.has(u)){const d=this.getBlockForPreset(e,"vertical");s.push({type:d,position:h,color:n[0],rotation:{x:0,y:0,z:0},scale:1}),this.placedPositions.add(u)}}const l=t.y+r,c=[{dx:1,dz:0},{dx:-1,dz:0},{dx:0,dz:1},{dx:0,dz:-1},{dx:1,dz:1},{dx:-1,dz:1},{dx:1,dz:-1},{dx:-1,dz:-1}];for(const p of c)if(!(Math.random()>o.branchChance*2+.3)){if(s.length>=o.maxBlocks)break;for(let h=1;h<=a;h++){const u={x:t.x+p.dx*h,y:l+Math.floor(h*.5)-1,z:t.z+p.dz*h},d=this.posKey(u);if(!this.placedPositions.has(d)&&s.length<o.maxBlocks){const y=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(y,u)||(s.push({type:y,position:u,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(d))}if(Math.random()<o.branchChance&&s.length<o.maxBlocks){const y={...u,y:u.y+1},g=this.posKey(y);if(!this.placedPositions.has(g)){const f=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(f,y)||(s.push({type:f,position:y,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(g))}}}}return s}generateWave(t,e,o,n){const s=[],r=4+Math.random()*4,a=2+Math.random()*3,l=Math.ceil(Math.sqrt(o.maxBlocks)),c=Math.ceil(o.maxBlocks/l);for(let p=0;p<c&&s.length<o.maxBlocks;p++)for(let h=0;h<l&&s.length<o.maxBlocks;h++){const u=Math.sin(p/r*2*Math.PI),d=Math.sin(h/r*2*Math.PI)*.5,y=Math.round((u+d)*a),g={x:t.x+p-Math.floor(c/2),y:t.y+y+Math.round(a),z:t.z+h-Math.floor(l/2)},f=this.posKey(g);if(this.placedPositions.has(f))continue;const m=this.pickScale(e,o.scaleRatio),b=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(b,g,{w:1,h:1,d:1},null,m)||(s.push({type:b,position:g,color:n[Math.floor((y+a)/(2*a)*n.length)%n.length],rotation:{x:0,y:0,z:0},scale:m}),this.placedPositions.add(f))}return s}generateDrunkard(t,e,o,n){const s=[];let r={...t};const a=[{dx:1,dy:0,dz:0},{dx:-1,dy:0,dz:0},{dx:0,dy:1,dz:0},{dx:0,dy:-1,dz:0},{dx:0,dy:0,dz:1},{dx:0,dy:0,dz:-1}];let l=0;const c=50;for(;s.length<o.maxBlocks&&l<c;){const p=this.posKey(r);if(!this.placedPositions.has(p)){const d=this.pickScale(e,o.scaleRatio),y=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(y,r,{w:1,h:1,d:1},null,d)?l++:(s.push({type:y,position:{...r},color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:d}),this.placedPositions.add(p),l=0)}const h=a[Math.floor(Math.random()*a.length)],u=Math.random()<.3?2:1;r={x:r.x+h.dx*u,y:Math.max(0,r.y+h.dy*u),z:r.z+h.dz*u}}return s}generateCrystal(t,e,o,n){const s=[],r=4+Math.floor(Math.random()*4),a=5+Math.floor(Math.random()*8),l=3+Math.random()*3;for(let c=0;c<a&&s.length<o.maxBlocks;c++){const p=c/a,h=l*(1-p*.8);for(let u=0;u<r;u++){const d=u/r*2*Math.PI,y=h*(.8+Math.random()*.4),g={x:Math.round(t.x+Math.cos(d)*y),y:t.y+c,z:Math.round(t.z+Math.sin(d)*y)},f=this.posKey(g);if(this.placedPositions.has(f))continue;if(s.length>=o.maxBlocks)break;const m=this.getBlockForPreset(e,"any");if(!this.blockManager.wouldOverlapAt(m,g)){const b=Math.floor(p*(n.length-1));s.push({type:m,position:g,color:n[b],rotation:{x:0,y:Math.round(d*180/Math.PI),z:0},scale:1}),this.placedPositions.add(f)}}if(p<.5&&s.length<o.maxBlocks){const u=this.posKey({...t,y:t.y+c});if(!this.placedPositions.has(u)){const d=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(d,{...t,y:t.y+c})||(s.push({type:d,position:{...t,y:t.y+c},color:n[0],rotation:{x:0,y:0,z:0},scale:1}),this.placedPositions.add(u))}}}return s}generateVine(t,e,o,n){const s=[],r=2+Math.floor(Math.random()*3);for(let a=0;a<r;a++){let l={x:t.x+Math.floor(Math.random()*3)-1,y:t.y,z:t.z+Math.floor(Math.random()*3)-1};const c=Math.floor(o.maxBlocks/r);let p=0,h=Math.floor(Math.random()*4)*90;for(;p<c&&s.length<o.maxBlocks;){const u=this.posKey(l);if(!this.placedPositions.has(u)){const d=this.getBlockForPreset(e,"vertical");this.blockManager.wouldOverlapAt(d,l)||(s.push({type:d,position:{...l},color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:h,z:0},scale:1}),this.placedPositions.add(u),p++)}if(Math.random()<.7)l.y++;else{const d=h*Math.PI/180;Math.random()<.5&&(l.x+=Math.round(Math.cos(d)),l.z+=Math.round(Math.sin(d))),Math.random()<o.turnChance&&(h=(h+(Math.random()<.5?90:-90)+360)%360)}if(Math.random()<o.branchChance*.5&&s.length<o.maxBlocks){const d=(h+(Math.random()<.5?90:-90))%360,y=d*Math.PI/180,g={x:l.x+Math.round(Math.cos(y)),y:l.y,z:l.z+Math.round(Math.sin(y))},f=this.posKey(g);if(!this.placedPositions.has(f)){const m=this.getBlockForPreset(e,"any");this.blockManager.wouldOverlapAt(m,g)||(s.push({type:m,position:g,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:d,z:0},scale:1}),this.placedPositions.add(f))}}}}return s}generateLayers(t,e,o,n){const s=[],r=this.getBlockList(e),a=Math.ceil(o.maxBlocks/r.length),l=Math.ceil(Math.sqrt(a/Math.PI));for(let c=0;c<r.length&&s.length<o.maxBlocks;c++){const p=r[c],h=t.y+c;for(let u=-l;u<=l&&s.length<o.maxBlocks;u++)for(let d=-l;d<=l&&s.length<o.maxBlocks;d++){const y=Math.sqrt(u*u+d*d);if(y>l||Math.random()>.7+.3*(1-y/l))continue;const g={x:t.x+u,y:h,z:t.z+d},f=this.posKey(g);!this.placedPositions.has(f)&&!this.blockManager.wouldOverlapAt(p,g)&&(s.push({type:p,position:g,color:n[c%n.length],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(f))}}return s}generateScatter3D(t,e,o,n){const s=[],r=this.getBlockList(e),a=Math.cbrt(o.maxBlocks)*1.5;let l=0;const c=o.maxBlocks*3;for(;s.length<o.maxBlocks&&l<c;){l++;const p=Math.random()*2*Math.PI,h=Math.acos(2*Math.random()-1),u=Math.cbrt(Math.random())*a,d={x:Math.round(t.x+u*Math.sin(h)*Math.cos(p)),y:Math.round(t.y+u*Math.cos(h)),z:Math.round(t.z+u*Math.sin(h)*Math.sin(p))};if(d.y<0)continue;const y=this.posKey(d);if(this.placedPositions.has(y))continue;const g=r[Math.floor(Math.random()*r.length)],f=this.pickScale(e,o.scaleRatio);this.blockManager.wouldOverlapAt(g,d,{w:1,h:1,d:1},null,f)||(s.push({type:g,position:d,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:f}),this.placedPositions.add(y))}return s}generateRadial(t,e,o,n){const s=[],r=this.getBlockList(e),a=Math.cbrt(o.maxBlocks)*2,l=8+Math.floor(Math.random()*8);for(let c=0;c<l&&s.length<o.maxBlocks;c++){const p=c/l*2*Math.PI,h=(Math.random()-.3)*Math.PI*.5;for(let u=0;u<=a&&s.length<o.maxBlocks;u++){const d=Math.floor(u/a*r.length),y=r[Math.min(d,r.length-1)],g={x:Math.round(t.x+u*Math.cos(p)*Math.cos(h)),y:Math.round(t.y+u*Math.sin(h)),z:Math.round(t.z+u*Math.sin(p)*Math.cos(h))};if(g.y<0)continue;const f=this.posKey(g);this.placedPositions.has(f)||Math.random()>.8-u/a*.5||this.blockManager.wouldOverlapAt(y,g)||(s.push({type:y,position:g,color:n[d%n.length],rotation:{x:0,y:Math.round(p*180/Math.PI),z:0},scale:1}),this.placedPositions.add(f))}}return s}generateGradient(t,e,o,n){const s=[],r=this.getBlockList(e),a=Math.ceil(Math.cbrt(o.maxBlocks));for(let l=-a;l<=a&&s.length<o.maxBlocks;l++)for(let c=0;c<=a&&s.length<o.maxBlocks;c++)for(let p=-a;p<=a&&s.length<o.maxBlocks;p++){const h=Math.sqrt(l*l+c*c+p*p);if(h>a)continue;const u=Math.sin(l*.5)*Math.cos(p*.5)*Math.sin(c*.7);if(Math.random()>.3+u*.2)continue;const d={x:t.x+l,y:t.y+c,z:t.z+p},y=this.posKey(d);if(this.placedPositions.has(y))continue;const g=Math.floor(h/a*r.length),f=r[Math.min(g,r.length-1)];this.blockManager.wouldOverlapAt(f,d)||(s.push({type:f,position:d,color:n[g%n.length],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(y))}return s}generateTerrain(t,e,o,n){const s=[],r=this.getBlockList(e),a=Math.ceil(Math.sqrt(o.maxBlocks)),l=6,c=(p,h)=>{const u=Math.sin(p*.3)*Math.cos(h*.3),d=Math.sin(p*.7+1)*Math.cos(h*.5+2),y=Math.sin(p*.15)*Math.cos(h*.15);return(u+d*.5+y*2)/3.5};for(let p=0;p<a&&s.length<o.maxBlocks;p++)for(let h=0;h<a&&s.length<o.maxBlocks;h++){const u=Math.round((c(p,h)+1)*l/2);for(let d=0;d<=u&&s.length<o.maxBlocks;d++){const y={x:t.x+p-Math.floor(a/2),y:t.y+d,z:t.z+h-Math.floor(a/2)},g=this.posKey(y);if(this.placedPositions.has(g))continue;const f=d/l,m=Math.floor(f*r.length),b=r[Math.min(m,r.length-1)];this.blockManager.wouldOverlapAt(b,y)||(s.push({type:b,position:y,color:n[m%n.length],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(g))}}return s}generateGalaxy(t,e,o,n){const s=[],r=this.getBlockList(e),a=2+Math.floor(Math.random()*3),l=Math.floor(o.maxBlocks/a);for(let c=0;c<a&&s.length<o.maxBlocks;c++){const p=c/a*2*Math.PI,h=r[c%r.length];for(let u=0;u<l&&s.length<o.maxBlocks;u++){const d=u/l,y=p+d*3*Math.PI,g=1+d*8,f=(Math.random()-.5)*2*(1+d),m=y+Math.PI/2,b={x:Math.round(t.x+Math.cos(y)*g+Math.cos(m)*f),y:Math.round(t.y+(Math.random()-.5)*2),z:Math.round(t.z+Math.sin(y)*g+Math.sin(m)*f)};b.y<0&&(b.y=0);const v=this.posKey(b);if(this.placedPositions.has(v))continue;const x=Math.random()<.3,_=x?r[Math.floor(Math.random()*r.length)]:h;this.blockManager.wouldOverlapAt(_,b)||(s.push({type:_,position:b,color:n[(c+(x?1:0))%n.length],rotation:{x:0,y:Math.round(y*180/Math.PI),z:0},scale:1}),this.placedPositions.add(v))}}return s}generateCavern(t,e,o,n){const s=[],r=Math.ceil(Math.sqrt(o.maxBlocks/2)),a=6+Math.floor(Math.random()*4),l=["stalactite","crystalSpike","crystalShard"],c=["stalagmite","rockTall","crystalSpike"],p=["rock","rockSmall","rockFlat","pebbles","moss"],h=["rockFlat","slate","moss"],u=["crystalSmall","crystalCluster","crystalFormation"];for(let d=-r;d<=r&&s.length<o.maxBlocks;d++)for(let y=-r;y<=r&&s.length<o.maxBlocks;y++){const g=Math.sqrt(d*d+y*y);if(g>r*1.2)continue;const f={x:t.x+d,y:t.y,z:t.z+y},m=this.posKey(f);if(!this.placedPositions.has(m)&&Math.random()<.4){const b=p[Math.floor(Math.random()*p.length)];this.blockManager.wouldOverlapAt(b,f)||(s.push({type:b,position:f,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(m))}if(Math.random()<.15&&s.length<o.maxBlocks){const b=1+Math.floor(Math.random()*3);for(let v=0;v<b&&s.length<o.maxBlocks;v++){const x={x:f.x,y:t.y+v,z:f.z},_=this.posKey(x);if(!this.placedPositions.has(_)){const z=v===b-1?c[Math.floor(Math.random()*c.length)]:"rockTall";this.blockManager.wouldOverlapAt(z,x)||(s.push({type:z,position:x,color:n[0],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(_))}}}if(Math.random()<.2&&s.length<o.maxBlocks){const b=1+Math.floor(Math.random()*3);for(let v=0;v<b&&s.length<o.maxBlocks;v++){const x={x:f.x,y:t.y+a-v,z:f.z},_=this.posKey(x);if(!this.placedPositions.has(_)){const z=v===b-1?l[Math.floor(Math.random()*l.length)]:h[Math.floor(Math.random()*h.length)];this.blockManager.wouldOverlapAt(z,x)||(s.push({type:z,position:x,color:n[Math.min(1,Math.floor(Math.random()*n.length))],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(_))}}}if(g>r*.7&&Math.random()<.3&&s.length<o.maxBlocks){const b=t.y+1+Math.floor(Math.random()*(a-2)),v={x:f.x,y:b,z:f.z},x=this.posKey(v);if(!this.placedPositions.has(x)){const _=u[Math.floor(Math.random()*u.length)];this.blockManager.wouldOverlapAt(_,v)||(s.push({type:_,position:v,color:n[2%n.length],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(x))}}}return s}generateRockField(t,e,o,n){const s=[],r=Math.ceil(Math.sqrt(o.maxBlocks)),a=["rockSmall","pebbles","slate"],l=["rock","rockFlat","rockCluster"],c=["rockLarge","rockTall","rockJagged","boulder","rockPile"],p=(h,u)=>Math.sin(h*.4)*Math.cos(u*.4)+Math.sin(h*.8+1)*Math.cos(u*.6)*.5;for(let h=-r;h<=r&&s.length<o.maxBlocks;h++)for(let u=-r;u<=r&&s.length<o.maxBlocks;u++){const d=p(h,u);if(Math.random()>.3+d*.3)continue;const y={x:t.x+h,y:t.y,z:t.z+u},g=this.posKey(y);if(this.placedPositions.has(g))continue;let f;const m=Math.random()+d*.3;m<.4?f=a:m<.8?f=l:f=c;const b=f[Math.floor(Math.random()*f.length)],v=c.includes(b)&&Math.random()>o.scaleRatio?2:1;if(!this.blockManager.wouldOverlapAt(b,y,{w:1,h:1,d:1},null,v)&&(s.push({type:b,position:y,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:v}),this.placedPositions.add(g),Math.random()<.2&&s.length<o.maxBlocks)){const x=[{dx:1,dz:0},{dx:-1,dz:0},{dx:0,dz:1},{dx:0,dz:-1}][Math.floor(Math.random()*4)],_={x:y.x+x.dx,y:t.y,z:y.z+x.dz},z=this.posKey(_);if(!this.placedPositions.has(z)){const E=Math.random()<.5?"moss":"pebbles";this.blockManager.wouldOverlapAt(E,_)||(s.push({type:E,position:_,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(z))}}}return s}generateMushroomGrove(t,e,o,n){const s=[],r=Math.ceil(Math.sqrt(o.maxBlocks)),a=["mushroom","mushroomCluster"],l=["moss","grass","pebbles"];let c=0;const p=o.maxBlocks*3;for(;s.length<o.maxBlocks&&c<p;){c++;const h={x:t.x+(Math.random()-.5)*r*2,z:t.z+(Math.random()-.5)*r*2},u=1+Math.floor(Math.random()*4);for(let d=0;d<u&&s.length<o.maxBlocks;d++){const y=d===0?{x:0,z:0}:{x:Math.floor((Math.random()-.5)*4),z:Math.floor((Math.random()-.5)*4)},g={x:Math.round(h.x+y.x),y:t.y,z:Math.round(h.z+y.z)},f=this.posKey(g);if(this.placedPositions.has(f))continue;const m=d===0&&u>2?"mushroomCluster":a[Math.floor(Math.random()*a.length)],b=m==="mushroomCluster"&&Math.random()>o.scaleRatio?2:1;if(!this.blockManager.wouldOverlapAt(m,g,{w:1,h:1,d:1},null,b)&&(s.push({type:m,position:g,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:b}),this.placedPositions.add(f),Math.random()<.4&&s.length<o.maxBlocks)){const v=[{dx:1,dz:0},{dx:-1,dz:0},{dx:0,dz:1},{dx:0,dz:-1}][Math.floor(Math.random()*4)],x={x:g.x+v.dx,y:t.y,z:g.z+v.dz},_=this.posKey(x);if(!this.placedPositions.has(_)){const z=l[Math.floor(Math.random()*l.length)];this.blockManager.wouldOverlapAt(z,x)||(s.push({type:z,position:x,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(_))}}}}return s}generateCrystalCave(t,e,o,n){const s=[],r=Math.ceil(Math.cbrt(o.maxBlocks)*1.5),a=["crystalSmall","crystalShard","gem"],l=["crystal","crystalFlat","crystalSpike"],c=["crystalLarge","crystalCluster","crystalFormation"],p=[{dir:"floor",yBase:0,yMod:1},{dir:"ceiling",yBase:r,yMod:-1},{dir:"wall",yBase:Math.floor(r/2),yMod:0}];for(const h of p){const u=Math.floor(o.maxBlocks/3);let d=0;for(;d<u&&s.length<o.maxBlocks;){const y=Math.random()*2*Math.PI,g=Math.random()*r,f={x:Math.round(t.x+Math.cos(y)*g),y:t.y+h.yBase+(h.yMod!==0?Math.floor(Math.random()*3)*h.yMod:0),z:Math.round(t.z+Math.sin(y)*g)};if(h.dir==="wall"){const E=r*(.8+Math.random()*.2);f.x=Math.round(t.x+Math.cos(y)*E),f.z=Math.round(t.z+Math.sin(y)*E),f.y=t.y+Math.floor(Math.random()*r)}const m=this.posKey(f);if(this.placedPositions.has(m)){d++;continue}const b=Math.sqrt(Math.pow(f.x-t.x,2)+Math.pow(f.z-t.z,2)),v=Math.random()+(1-b/r)*.5;let x;v<.4?x=a:v<.75?x=l:x=c;const _=x[Math.floor(Math.random()*x.length)],z=c.includes(_)&&Math.random()>o.scaleRatio?2:1;if(!this.blockManager.wouldOverlapAt(_,f,{w:1,h:1,d:1},null,z)){const E=Math.floor(y/(2*Math.PI)*n.length);s.push({type:_,position:f,color:n[E%n.length],rotation:{x:0,y:Math.round(y*180/Math.PI),z:0},scale:z}),this.placedPositions.add(m)}d++}}return s}generateCoralReef(t,e,o,n){const s=[],r=Math.ceil(Math.sqrt(o.maxBlocks)),a=["coral","crystalCluster","crystalFormation"],l=["vine","grass","moss"],c=["rockSmall","rockFlat","pebbles"],p=3+Math.floor(Math.random()*3),h=Math.floor(o.maxBlocks/p);for(let u=0;u<p&&s.length<o.maxBlocks;u++){const d={x:t.x+(Math.random()-.5)*r*1.5,z:t.z+(Math.random()-.5)*r*1.5},y=2+Math.random()*3,g=2+Math.floor(Math.random()*3);for(let f=0;f<h&&s.length<o.maxBlocks;f++){const m=Math.random()*2*Math.PI,b=Math.random()*y,v=1-b/y,x={x:Math.round(d.x+Math.cos(m)*b),y:t.y+Math.floor(Math.random()*g*v),z:Math.round(d.z+Math.sin(m)*b)},_=this.posKey(x);if(this.placedPositions.has(_))continue;let z;if(x.y===t.y)z=c[Math.floor(Math.random()*c.length)];else if(x.y>=t.y+g-1)z=a[Math.floor(Math.random()*a.length)];else{const E=Math.random();E<.5?z=a[Math.floor(Math.random()*a.length)]:E<.8?z=l[Math.floor(Math.random()*l.length)]:z=c[Math.floor(Math.random()*c.length)]}this.blockManager.wouldOverlapAt(z,x)||(s.push({type:z,position:x,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:1}),this.placedPositions.add(_))}}return s}generateBoulderPile(t,e,o,n){const s=[],r=Math.ceil(Math.cbrt(o.maxBlocks)*1.5),a=Math.ceil(r*.8),l=["boulder","rockLarge","rockPile"],c=["rock","rockJagged","rockCluster"],p=["rockFlat","rockSmall","pebbles","slate"];for(let h=0;h<a&&s.length<o.maxBlocks;h++){const u=r*(1-h/a*.7),d=h/a,y=.7-d*.4;for(let g=-Math.ceil(u);g<=Math.ceil(u)&&s.length<o.maxBlocks;g++)for(let f=-Math.ceil(u);f<=Math.ceil(u)&&s.length<o.maxBlocks;f++){if(Math.sqrt(g*g+f*f)>u||Math.random()>y)continue;const b={x:t.x+g,y:t.y+h,z:t.z+f},v=this.posKey(b);if(this.placedPositions.has(v))continue;let x;d<.3?x=Math.random()<.6?l:c:d<.7?x=Math.random()<.5?c:p:x=Math.random()<.7?p:c;const _=x[Math.floor(Math.random()*x.length)],z=l.includes(_)&&h<2&&Math.random()>o.scaleRatio?2:1;this.blockManager.wouldOverlapAt(_,b,{w:1,h:1,d:1},null,z)||(s.push({type:_,position:b,color:n[Math.floor(Math.random()*n.length)],rotation:{x:0,y:Math.floor(Math.random()*4)*90,z:0},scale:z}),this.placedPositions.add(v))}}return s}getBlockList(t){if(t.blocks&&t.blocks.length>0)return t.blocks;const e=[];return t.straight&&e.push(...Object.values(t.straight)),t.decorative&&e.push(...t.decorative),t.junctions&&e.push(...Object.values(t.junctions)),e.length>0?e:["cube"]}getBlockForPreset(t,e="any"){var o;if(t.clusterBased&&t.blocks)return t.blocks[Math.floor(Math.random()*t.blocks.length)];if(e==="vertical"&&((o=t.straight)!=null&&o.Y))return t.straight.Y;if(e==="straight"&&t.straight){const n=Object.keys(t.straight);return t.straight[n[Math.floor(Math.random()*n.length)]]}if(t.straight){const n=Object.keys(t.straight);return t.straight[n[Math.floor(Math.random()*n.length)]]}return t.decorative&&t.decorative.length>0?t.decorative[Math.floor(Math.random()*t.decorative.length)]:"cube"}getAxisFromDirection(t){return t.charAt(0)}getSignFromDirection(t){return t.charAt(1)==="+"?1:-1}moveInDirection(t,e,o=1){const n={...t},s=this.getSignFromDirection(e),r=this.getAxisFromDirection(e).toLowerCase();return n[r]+=s*o,n}getPerpendicularDirection(t,e=0){const o=this.getAxisFromDirection(t);let n;return o==="X"?(n=["Z+","Z-"],e>0&&Math.random()<e&&n.push("Y+","Y-")):o==="Z"?(n=["X+","X-"],e>0&&Math.random()<e&&n.push("Y+","Y-")):n=["X+","X-","Z+","Z-"],n[Math.floor(Math.random()*n.length)]}pickScale(t,e){const o=t.allowedScales||[1],n=o.includes(2),s=o.includes(4);if(!n&&!s)return 1;const r=Math.random();if(s&&n){const a=.3+e*.7,l=Math.max(0,(1-e)*.3),c=1-a-l;return r<a?1:r<a+c?2:4}else{if(n)return r>e?2:1;if(s)return r>e?4:1}return 1}getNeighbors(t){return[{x:t.x+1,y:t.y,z:t.z},{x:t.x-1,y:t.y,z:t.z},{x:t.x,y:t.y+1,z:t.z},{x:t.x,y:t.y-1,z:t.z},{x:t.x,y:t.y,z:t.z+1},{x:t.x,y:t.y,z:t.z-1}]}posKey(t){return`${Math.floor(t.x)},${Math.floor(t.y)},${Math.floor(t.z)}`}generateColorPalette(t,e){const o=new bt(t),n={h:0,s:0,l:0};o.getHSL(n);const s=[t];switch(e){case"analogous":s.push(this.hslToHex(n.h+.083,n.s,n.l),this.hslToHex(n.h-.083,n.s,n.l),this.hslToHex(n.h+.042,n.s,n.l*.7),this.hslToHex(n.h-.042,n.s*.8,Math.min(1,n.l*1.2)));break;case"complementary":s.push(this.hslToHex(n.h+.5,n.s,n.l),this.hslToHex(n.h,n.s*.6,n.l),this.hslToHex(n.h+.5,n.s*.6,n.l));break;case"triadic":s.push(this.hslToHex(n.h+.333,n.s,n.l),this.hslToHex(n.h+.666,n.s,n.l),this.hslToHex(n.h,n.s,n.l*.7));break;case"monochrome":s.push(this.hslToHex(n.h,n.s,n.l*.5),this.hslToHex(n.h,n.s,n.l*.7),this.hslToHex(n.h,n.s*.5,Math.min(1,n.l*1.2)),this.hslToHex(n.h,n.s*.3,Math.min(1,n.l*1.4)));break;case"split":s.push(this.hslToHex(n.h+.417,n.s,n.l),this.hslToHex(n.h+.583,n.s,n.l),this.hslToHex(n.h,n.s*.7,n.l*.8));break;default:for(let r=0;r<4;r++)s.push(this.hslToHex(n.h+(Math.random()-.5)*.2,Math.max(.2,n.s+(Math.random()-.5)*.3),Math.max(.2,Math.min(.9,n.l+(Math.random()-.5)*.3))))}return s}hslToHex(t,e,o){t=(t%1+1)%1,e=Math.max(0,Math.min(1,e)),o=Math.max(0,Math.min(1,o));const n=new bt;return n.setHSL(t,e,o),"#"+n.getHexString()}setPreset(t){Da[t]&&(this.preset=t)}setMaxBlocks(t){this.maxBlocks=Math.max(1,Math.min(500,t))}setBranchChance(t){this.branchChance=Math.max(0,Math.min(1,t))}setScaleRatio(t){this.scaleRatio=Math.max(0,Math.min(1,t))}setColorHarmony(t){this.colorHarmony=t}setAlgorithm(t){Ia[t]&&(this.algorithm=t)}}var La=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aS(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Ua(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ip={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */var Od;function lS(){return Od||(Od=1,(function(i,t){(function(e){i.exports=e()})(function(){return(function e(o,n,s){function r(c,p){if(!n[c]){if(!o[c]){var h=typeof Ua=="function"&&Ua;if(!p&&h)return h(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[c]={exports:{}};o[c][0].call(d.exports,function(y){var g=o[c][1][y];return r(g||y)},d,d.exports,e,o,n,s)}return n[c].exports}for(var a=typeof Ua=="function"&&Ua,l=0;l<s.length;l++)r(s[l]);return r})({1:[function(e,o,n){var s=e("./utils"),r=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,p,h,u,d,y,g,f=[],m=0,b=l.length,v=b,x=s.getTypeOf(l)!=="string";m<l.length;)v=b-m,h=x?(c=l[m++],p=m<b?l[m++]:0,m<b?l[m++]:0):(c=l.charCodeAt(m++),p=m<b?l.charCodeAt(m++):0,m<b?l.charCodeAt(m++):0),u=c>>2,d=(3&c)<<4|p>>4,y=1<v?(15&p)<<2|h>>6:64,g=2<v?63&h:64,f.push(a.charAt(u)+a.charAt(d)+a.charAt(y)+a.charAt(g));return f.join("")},n.decode=function(l){var c,p,h,u,d,y,g=0,f=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var b,v=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&v--,l.charAt(l.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=r.uint8array?new Uint8Array(0|v):new Array(0|v);g<l.length;)c=a.indexOf(l.charAt(g++))<<2|(u=a.indexOf(l.charAt(g++)))>>4,p=(15&u)<<4|(d=a.indexOf(l.charAt(g++)))>>2,h=(3&d)<<6|(y=a.indexOf(l.charAt(g++))),b[f++]=c,d!==64&&(b[f++]=p),y!==64&&(b[f++]=h);return b}},{"./support":30,"./utils":32}],2:[function(e,o,n){var s=e("./external"),r=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(p,h,u,d,y){this.compressedSize=p,this.uncompressedSize=h,this.crc32=u,this.compression=d,this.compressedContent=y}c.prototype={getContentWorker:function(){var p=new r(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return p.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new r(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(p,h,u){return p.pipe(new a).pipe(new l("uncompressedSize")).pipe(h.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},o.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,o,n){var s=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,o,n){var s=e("./utils"),r=(function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var p=0;p<8;p++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l})();o.exports=function(a,l){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(c,p,h,u){var d=r,y=u+h;c^=-1;for(var g=u;g<y;g++)c=c>>>8^d[255&(c^p[g])];return-1^c})(0|l,a,a.length,0):(function(c,p,h,u){var d=r,y=u+h;c^=-1;for(var g=u;g<y;g++)c=c>>>8^d[255&(c^p.charCodeAt(g))];return-1^c})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,o,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,o,n){var s=null;s=typeof Promise<"u"?Promise:e("lie"),o.exports={Promise:s}},{lie:37}],7:[function(e,o,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),c=s?"uint8array":"array";function p(h,u){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=u,this.meta={}}n.magic="\b\0",a.inherits(p,l),p.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,h.data),!1)},p.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(u){h.push({data:u,meta:h.meta})}},n.compressWorker=function(h){return new p("Deflate",h)},n.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,o,n){function s(d,y){var g,f="";for(g=0;g<y;g++)f+=String.fromCharCode(255&d),d>>>=8;return f}function r(d,y,g,f,m,b){var v,x,_=d.file,z=d.compression,E=b!==c.utf8encode,C=a.transformTo("string",b(_.name)),M=a.transformTo("string",c.utf8encode(_.name)),S=_.comment,k=a.transformTo("string",b(S)),A=a.transformTo("string",c.utf8encode(S)),B=M.length!==_.name.length,F=A.length!==S.length,N="",G="",W="",et=_.dir,K=_.date,pt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!g||(pt.crc32=d.crc32,pt.compressedSize=d.compressedSize,pt.uncompressedSize=d.uncompressedSize);var X=0;y&&(X|=8),E||!B&&!F||(X|=2048);var Z=0,gt=0;et&&(Z|=16),m==="UNIX"?(gt=798,Z|=(function(tt,_t){var ft=tt;return tt||(ft=_t?16893:33204),(65535&ft)<<16})(_.unixPermissions,et)):(gt=20,Z|=(function(tt){return 63&(tt||0)})(_.dosPermissions)),v=K.getUTCHours(),v<<=6,v|=K.getUTCMinutes(),v<<=5,v|=K.getUTCSeconds()/2,x=K.getUTCFullYear()-1980,x<<=4,x|=K.getUTCMonth()+1,x<<=5,x|=K.getUTCDate(),B&&(G=s(1,1)+s(p(C),4)+M,N+="up"+s(G.length,2)+G),F&&(W=s(1,1)+s(p(k),4)+A,N+="uc"+s(W.length,2)+W);var Y="";return Y+=`
\0`,Y+=s(X,2),Y+=z.magic,Y+=s(v,2),Y+=s(x,2),Y+=s(pt.crc32,4),Y+=s(pt.compressedSize,4),Y+=s(pt.uncompressedSize,4),Y+=s(C.length,2),Y+=s(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+Y+C+N,dirRecord:h.CENTRAL_FILE_HEADER+s(gt,2)+Y+s(k.length,2)+"\0\0\0\0"+s(Z,4)+s(f,4)+C+N+k}}var a=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),p=e("../crc32"),h=e("../signature");function u(d,y,g,f){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=g,this.encodeFileName=f,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(u,l),u.prototype.push=function(d){var y=d.meta.percent||0,g=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(y+100*(g-f-1))/g:100}}))},u.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var y=this.streamFiles&&!d.file.dir;if(y){var g=r(d,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(d){this.accumulate=!1;var y=this.streamFiles&&!d.file.dir,g=r(d,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),y)this.push({data:(function(f){return h.DATA_DESCRIPTOR+s(f.crc32,4)+s(f.compressedSize,4)+s(f.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var d=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var g=this.bytesWritten-d,f=(function(m,b,v,x,_){var z=a.transformTo("string",_(x));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(m,2)+s(m,2)+s(b,4)+s(v,4)+s(z.length,2)+z})(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(d){this._sources.push(d);var y=this;return d.on("data",function(g){y.processChunk(g)}),d.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),d.on("error",function(g){y.error(g)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(d){var y=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var g=0;g<y.length;g++)try{y[g].error(d)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,y=0;y<d.length;y++)d[y].lock()},o.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,o,n){var s=e("../compressions"),r=e("./ZipFileWorker");n.generateWorker=function(a,l,c){var p=new r(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{a.forEach(function(u,d){h++;var y=(function(b,v){var x=b||v,_=s[x];if(!_)throw new Error(x+" is not a valid compression method !");return _})(d.options.compression,l.compression),g=d.options.compressionOptions||l.compressionOptions||{},f=d.dir,m=d.date;d._compressWorker(y,g).withStreamInfo("file",{name:u,dir:f,date:m,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(p)}),p.entriesCount=h}catch(u){p.error(u)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,o,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new s;for(var a in this)typeof this[a]!="function"&&(r[a]=this[a]);return r}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(r,a){return new s().loadAsync(r,a)},s.external=e("./external"),o.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,o,n){var s=e("./utils"),r=e("./external"),a=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),p=e("./nodejsUtils");function h(u){return new r.Promise(function(d,y){var g=u.decompressed.getContentWorker().pipe(new c);g.on("error",function(f){y(f)}).on("end",function(){g.streamInfo.crc32!==u.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}o.exports=function(u,d){var y=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),p.isNode&&p.isStream(u)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",u,!0,d.optimizedBinaryString,d.base64).then(function(g){var f=new l(d);return f.load(g),f}).then(function(g){var f=[r.Promise.resolve(g)],m=g.files;if(d.checkCRC32)for(var b=0;b<m.length;b++)f.push(h(m[b]));return r.Promise.all(f)}).then(function(g){for(var f=g.shift(),m=f.files,b=0;b<m.length;b++){var v=m[b],x=v.fileNameStr,_=s.resolve(v.fileNameStr);y.file(_,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(y.file(_).unsafeOriginalName=x)}return f.zipComment.length&&(y.comment=f.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,o,n){var s=e("../utils"),r=e("../stream/GenericWorker");function a(l,c){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(a,r),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(p){c.push({data:p,meta:{percent:0}})}).on("error",function(p){c.isPaused?this.generatedError=p:c.error(p)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,o,n){var s=e("readable-stream").Readable;function r(a,l,c){s.call(this,l),this._helper=a;var p=this;a.on("data",function(h,u){p.push(h)||p._helper.pause(),c&&c(u)}).on("error",function(h){p.emit("error",h)}).on("end",function(){p.push(null)})}e("../utils").inherits(r,s),r.prototype._read=function(){this._helper.resume()},o.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,o,n){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,r);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,r)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var r=new Buffer(s);return r.fill(0),r},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,o,n){function s(_,z,E){var C,M=a.getTypeOf(z),S=a.extend(E||{},p);S.date=S.date||new Date,S.compression!==null&&(S.compression=S.compression.toUpperCase()),typeof S.unixPermissions=="string"&&(S.unixPermissions=parseInt(S.unixPermissions,8)),S.unixPermissions&&16384&S.unixPermissions&&(S.dir=!0),S.dosPermissions&&16&S.dosPermissions&&(S.dir=!0),S.dir&&(_=m(_)),S.createFolders&&(C=f(_))&&b.call(this,C,!0);var k=M==="string"&&S.binary===!1&&S.base64===!1;E&&E.binary!==void 0||(S.binary=!k),(z instanceof h&&z.uncompressedSize===0||S.dir||!z||z.length===0)&&(S.base64=!1,S.binary=!0,z="",S.compression="STORE",M="string");var A=null;A=z instanceof h||z instanceof l?z:y.isNode&&y.isStream(z)?new g(_,z):a.prepareContent(_,z,S.binary,S.optimizedBinaryString,S.base64);var B=new u(_,A,S);this.files[_]=B}var r=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),p=e("./defaults"),h=e("./compressedObject"),u=e("./zipObject"),d=e("./generate"),y=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),f=function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var z=_.lastIndexOf("/");return 0<z?_.substring(0,z):""},m=function(_){return _.slice(-1)!=="/"&&(_+="/"),_},b=function(_,z){return z=z!==void 0?z:p.createFolders,_=m(_),this.files[_]||s.call(this,_,null,{dir:!0,createFolders:z}),this.files[_]};function v(_){return Object.prototype.toString.call(_)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(_){var z,E,C;for(z in this.files)C=this.files[z],(E=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&_(E,C)},filter:function(_){var z=[];return this.forEach(function(E,C){_(E,C)&&z.push(C)}),z},file:function(_,z,E){if(arguments.length!==1)return _=this.root+_,s.call(this,_,z,E),this;if(v(_)){var C=_;return this.filter(function(S,k){return!k.dir&&C.test(S)})}var M=this.files[this.root+_];return M&&!M.dir?M:null},folder:function(_){if(!_)return this;if(v(_))return this.filter(function(M,S){return S.dir&&_.test(M)});var z=this.root+_,E=b.call(this,z),C=this.clone();return C.root=E.name,C},remove:function(_){_=this.root+_;var z=this.files[_];if(z||(_.slice(-1)!=="/"&&(_+="/"),z=this.files[_]),z&&!z.dir)delete this.files[_];else for(var E=this.filter(function(M,S){return S.name.slice(0,_.length)===_}),C=0;C<E.length;C++)delete this.files[E[C].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(_){var z,E={};try{if((E=a.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=E.type.toLowerCase(),E.compression=E.compression.toUpperCase(),E.type==="binarystring"&&(E.type="string"),!E.type)throw new Error("No output type specified.");a.checkSupport(E.type),E.platform!=="darwin"&&E.platform!=="freebsd"&&E.platform!=="linux"&&E.platform!=="sunos"||(E.platform="UNIX"),E.platform==="win32"&&(E.platform="DOS");var C=E.comment||this.comment||"";z=d.generateWorker(this,E,C)}catch(M){(z=new l("error")).error(M)}return new c(z,E.type||"string",E.mimeType)},generateAsync:function(_,z){return this.generateInternalStream(_).accumulate(z)},generateNodeStream:function(_,z){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(z)}};o.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,o,n){o.exports=e("stream")},{stream:void 0}],17:[function(e,o,n){var s=e("./DataReader");function r(a){s.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(r,s),r.prototype.byteAt=function(a){return this.data[this.zero+a]},r.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),p=a.charCodeAt(2),h=a.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===c&&this.data[u+2]===p&&this.data[u+3]===h)return u-this.zero;return-1},r.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),p=a.charCodeAt(2),h=a.charCodeAt(3),u=this.readData(4);return l===u[0]&&c===u[1]&&p===u[2]&&h===u[3]},r.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},o.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,o,n){var s=e("../utils");function r(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},o.exports=r},{"../utils":32}],19:[function(e,o,n){var s=e("./Uint8ArrayReader");function r(a){s.call(this,a)}e("../utils").inherits(r,s),r.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},o.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,o,n){var s=e("./DataReader");function r(a){s.call(this,a)}e("../utils").inherits(r,s),r.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},r.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},r.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},r.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},o.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,o,n){var s=e("./ArrayReader");function r(a){s.call(this,a)}e("../utils").inherits(r,s),r.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},o.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,o,n){var s=e("../utils"),r=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),p=e("./Uint8ArrayReader");o.exports=function(h){var u=s.getTypeOf(h);return s.checkSupport(u),u!=="string"||r.uint8array?u==="nodebuffer"?new c(h):r.uint8array?new p(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,o,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,o,n){var s=e("./GenericWorker"),r=e("../utils");function a(l){s.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(a,s),a.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},o.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,o,n){var s=e("./GenericWorker"),r=e("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,s),a.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},o.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,o,n){var s=e("../utils"),r=e("./GenericWorker");function a(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(a,r),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}r.prototype.processChunk.call(this,l)},o.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,o,n){var s=e("../utils"),r=e("./GenericWorker");function a(l){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(p){c.dataIsReady=!0,c.data=p,c.max=p&&p.length||0,c.type=s.getTypeOf(p),c.isPaused||c._tickAndRepeat()},function(p){c.error(p)})}s.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,o,n){function s(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,a){return this._listeners[r].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,a){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,a)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var a=this;return r.on("data",function(l){a.processChunk(l)}),r.on("end",function(){a.end()}),r.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,a){return this.extraStreamInfo[r]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},o.exports=s},{}],29:[function(e,o,n){var s=e("../utils"),r=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),c=e("../support"),p=e("../external"),h=null;if(c.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(y,g){return new p.Promise(function(f,m){var b=[],v=y._internalType,x=y._outputType,_=y._mimeType;y.on("data",function(z,E){b.push(z),g&&g(E)}).on("error",function(z){b=[],m(z)}).on("end",function(){try{var z=(function(E,C,M){switch(E){case"blob":return s.newBlob(s.transformTo("arraybuffer",C),M);case"base64":return l.encode(C);default:return s.transformTo(E,C)}})(x,(function(E,C){var M,S=0,k=null,A=0;for(M=0;M<C.length;M++)A+=C[M].length;switch(E){case"string":return C.join("");case"array":return Array.prototype.concat.apply([],C);case"uint8array":for(k=new Uint8Array(A),M=0;M<C.length;M++)k.set(C[M],S),S+=C[M].length;return k;case"nodebuffer":return Buffer.concat(C);default:throw new Error("concat : unsupported type '"+E+"'")}})(v,b),_);f(z)}catch(E){m(E)}b=[]}).resume()})}function d(y,g,f){var m=g;switch(g){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=g,this._mimeType=f,s.checkSupport(m),this._worker=y.pipe(new r(m)),y.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}d.prototype={accumulate:function(y){return u(this,y)},on:function(y,g){var f=this;return y==="data"?this._worker.on(y,function(m){g.call(f,m.data,m.meta)}):this._worker.on(y,function(){s.delay(g,arguments,f)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},y)}},o.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,o,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(s),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,o,n){for(var s=e("./utils"),r=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),p=0;p<256;p++)c[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}n.utf8encode=function(d){return r.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(y){var g,f,m,b,v,x=y.length,_=0;for(b=0;b<x;b++)(64512&(f=y.charCodeAt(b)))==55296&&b+1<x&&(64512&(m=y.charCodeAt(b+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),b++),_+=f<128?1:f<2048?2:f<65536?3:4;for(g=r.uint8array?new Uint8Array(_):new Array(_),b=v=0;v<_;b++)(64512&(f=y.charCodeAt(b)))==55296&&b+1<x&&(64512&(m=y.charCodeAt(b+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),b++),f<128?g[v++]=f:(f<2048?g[v++]=192|f>>>6:(f<65536?g[v++]=224|f>>>12:(g[v++]=240|f>>>18,g[v++]=128|f>>>12&63),g[v++]=128|f>>>6&63),g[v++]=128|63&f);return g})(d)},n.utf8decode=function(d){return r.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):(function(y){var g,f,m,b,v=y.length,x=new Array(2*v);for(g=f=0;g<v;)if((m=y[g++])<128)x[f++]=m;else if(4<(b=c[m]))x[f++]=65533,g+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&g<v;)m=m<<6|63&y[g++],b--;1<b?x[f++]=65533:m<65536?x[f++]=m:(m-=65536,x[f++]=55296|m>>10&1023,x[f++]=56320|1023&m)}return x.length!==f&&(x.subarray?x=x.subarray(0,f):x.length=f),s.applyFromCharCode(x)})(d=s.transformTo(r.uint8array?"uint8array":"array",d))},s.inherits(h,l),h.prototype.processChunk=function(d){var y=s.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=y;(y=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),y.set(g,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var f=(function(b,v){var x;for((v=v||b.length)>b.length&&(v=b.length),x=v-1;0<=x&&(192&b[x])==128;)x--;return x<0||x===0?v:x+c[b[x]]>v?x:v})(y),m=y;f!==y.length&&(r.uint8array?(m=y.subarray(0,f),this.leftOver=y.subarray(f,y.length)):(m=y.slice(0,f),this.leftOver=y.slice(f,y.length))),this.push({data:n.utf8decode(m),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=h,s.inherits(u,l),u.prototype.processChunk=function(d){this.push({data:n.utf8encode(d.data),meta:d.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,o,n){var s=e("./support"),r=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function c(g){return g}function p(g,f){for(var m=0;m<g.length;++m)f[m]=255&g.charCodeAt(m);return f}e("setimmediate"),n.newBlob=function(g,f){n.checkSupport("blob");try{return new Blob([g],{type:f})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(g),m.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,f,m){var b=[],v=0,x=g.length;if(x<=m)return String.fromCharCode.apply(null,g);for(;v<x;)f==="array"||f==="nodebuffer"?b.push(String.fromCharCode.apply(null,g.slice(v,Math.min(v+m,x)))):b.push(String.fromCharCode.apply(null,g.subarray(v,Math.min(v+m,x)))),v+=m;return b.join("")},stringifyByChar:function(g){for(var f="",m=0;m<g.length;m++)f+=String.fromCharCode(g[m]);return f},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function u(g){var f=65536,m=n.getTypeOf(g),b=!0;if(m==="uint8array"?b=h.applyCanBeUsed.uint8array:m==="nodebuffer"&&(b=h.applyCanBeUsed.nodebuffer),b)for(;1<f;)try{return h.stringifyByChunk(g,m,f)}catch{f=Math.floor(f/2)}return h.stringifyByChar(g)}function d(g,f){for(var m=0;m<g.length;m++)f[m]=g[m];return f}n.applyFromCharCode=u;var y={};y.string={string:c,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return y.string.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:function(g){return p(g,a.allocBuffer(g.length))}},y.array={string:u,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},y.arraybuffer={string:function(g){return u(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},y.uint8array={string:u,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return a.newBufferFrom(g)}},y.nodebuffer={string:u,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return y.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:c},n.transformTo=function(g,f){if(f=f||"",!g)return f;n.checkSupport(g);var m=n.getTypeOf(f);return y[m][g](f)},n.resolve=function(g){for(var f=g.split("/"),m=[],b=0;b<f.length;b++){var v=f[b];v==="."||v===""&&b!==0&&b!==f.length-1||(v===".."?m.pop():m.push(v))}return m.join("/")},n.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(g){var f,m,b="";for(m=0;m<(g||"").length;m++)b+="\\x"+((f=g.charCodeAt(m))<16?"0":"")+f.toString(16).toUpperCase();return b},n.delay=function(g,f,m){setImmediate(function(){g.apply(m||null,f||[])})},n.inherits=function(g,f){function m(){}m.prototype=f.prototype,g.prototype=new m},n.extend=function(){var g,f,m={};for(g=0;g<arguments.length;g++)for(f in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],f)&&m[f]===void 0&&(m[f]=arguments[g][f]);return m},n.prepareContent=function(g,f,m,b,v){return l.Promise.resolve(f).then(function(x){return s.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new l.Promise(function(_,z){var E=new FileReader;E.onload=function(C){_(C.target.result)},E.onerror=function(C){z(C.target.error)},E.readAsArrayBuffer(x)}):x}).then(function(x){var _=n.getTypeOf(x);return _?(_==="arraybuffer"?x=n.transformTo("uint8array",x):_==="string"&&(v?x=r.decode(x):m&&b!==!0&&(x=(function(z){return p(z,s.uint8array?new Uint8Array(z.length):new Array(z.length))})(x))),x):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,o,n){var s=e("./reader/readerFor"),r=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");function p(h){this.files=[],this.loadOptions=h}p.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(u)+", expected "+r.pretty(h)+")")}},isSignature:function(h,u){var d=this.reader.index;this.reader.setIndex(h);var y=this.reader.readString(4)===u;return this.reader.setIndex(d),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),u=c.uint8array?"uint8array":"array",d=r.transformTo(u,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,u,d,y=this.zip64EndOfCentralSize-44;0<y;)h=this.reader.readInt(2),u=this.reader.readInt(4),d=this.reader.readData(u),this.zip64ExtensibleData[h]={id:h,length:u,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,u;for(h=0;h<this.files.length;h++)u=this.files[h],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var u=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var y=u-d;if(0<y)this.isSignature(u,a.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,o,n){var s=e("./reader/readerFor"),r=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),p=e("./compressions"),h=e("./support");function u(d,y){this.options=d,this.loadOptions=y}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var y,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(f){for(var m in p)if(Object.prototype.hasOwnProperty.call(p,m)&&p[m].magic===f)return p[m];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,y,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var y=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(y),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var y,g,f,m=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<m;)y=d.readInt(2),g=d.readInt(2),f=d.readData(g),this.extraFields[y]={id:y,length:g,value:f};d.setIndex(m)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var g=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var m=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var y=s(d.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:c.utf8decode(y.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var y=s(d.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:c.utf8decode(y.readData(d.length-5))}return null}},o.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,o,n){function s(y,g,f){this.name=y,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=g,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var r=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),p=e("./stream/GenericWorker");s.prototype={internalStream:function(y){var g=null,f="string";try{if(!y)throw new Error("No output type specified.");var m=(f=y.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),g=this._decompressWorker();var b=!this._dataBinary;b&&!m&&(g=g.pipe(new l.Utf8EncodeWorker)),!b&&m&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(v){(g=new p("error")).error(v)}return new r(g,f,"")},async:function(y,g){return this.internalStream(y).accumulate(g)},nodeStream:function(y,g){return this.internalStream(y||"nodebuffer").toNodejsStream(g)},_compressWorker:function(y,g){if(this._data instanceof c&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(f,y,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof p?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=u;o.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,o,n){(function(s){var r,a,l=s.MutationObserver||s.WebKitMutationObserver;if(l){var c=0,p=new l(y),h=s.document.createTextNode("");p.observe(h,{characterData:!0}),r=function(){h.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)r="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){y(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(y,0)};else{var u=new s.MessageChannel;u.port1.onmessage=y,r=function(){u.port2.postMessage(0)}}var d=[];function y(){var g,f;a=!0;for(var m=d.length;m;){for(f=d,d=[],g=-1;++g<m;)f[g]();m=d.length}a=!1}o.exports=function(g){d.push(g)!==1||a||r()}}).call(this,typeof La<"u"?La:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,o,n){var s=e("immediate");function r(){}var a={},l=["REJECTED"],c=["FULFILLED"],p=["PENDING"];function h(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,m!==r&&g(this,m)}function u(m,b,v){this.promise=m,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(m,b,v){s(function(){var x;try{x=b(v)}catch(_){return a.reject(m,_)}x===m?a.reject(m,new TypeError("Cannot resolve promise with itself")):a.resolve(m,x)})}function y(m){var b=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof b=="function")return function(){b.apply(m,arguments)}}function g(m,b){var v=!1;function x(E){v||(v=!0,a.reject(m,E))}function _(E){v||(v=!0,a.resolve(m,E))}var z=f(function(){b(_,x)});z.status==="error"&&x(z.value)}function f(m,b){var v={};try{v.value=m(b),v.status="success"}catch(x){v.status="error",v.value=x}return v}(o.exports=h).prototype.finally=function(m){if(typeof m!="function")return this;var b=this.constructor;return this.then(function(v){return b.resolve(m()).then(function(){return v})},function(v){return b.resolve(m()).then(function(){throw v})})},h.prototype.catch=function(m){return this.then(null,m)},h.prototype.then=function(m,b){if(typeof m!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var v=new this.constructor(r);return this.state!==p?d(v,this.state===c?m:b,this.outcome):this.queue.push(new u(v,m,b)),v},u.prototype.callFulfilled=function(m){a.resolve(this.promise,m)},u.prototype.otherCallFulfilled=function(m){d(this.promise,this.onFulfilled,m)},u.prototype.callRejected=function(m){a.reject(this.promise,m)},u.prototype.otherCallRejected=function(m){d(this.promise,this.onRejected,m)},a.resolve=function(m,b){var v=f(y,b);if(v.status==="error")return a.reject(m,v.value);var x=v.value;if(x)g(m,x);else{m.state=c,m.outcome=b;for(var _=-1,z=m.queue.length;++_<z;)m.queue[_].callFulfilled(b)}return m},a.reject=function(m,b){m.state=l,m.outcome=b;for(var v=-1,x=m.queue.length;++v<x;)m.queue[v].callRejected(b);return m},h.resolve=function(m){return m instanceof this?m:a.resolve(new this(r),m)},h.reject=function(m){var b=new this(r);return a.reject(b,m)},h.all=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=m.length,x=!1;if(!v)return this.resolve([]);for(var _=new Array(v),z=0,E=-1,C=new this(r);++E<v;)M(m[E],E);return C;function M(S,k){b.resolve(S).then(function(A){_[k]=A,++z!==v||x||(x=!0,a.resolve(C,_))},function(A){x||(x=!0,a.reject(C,A))})}},h.race=function(m){var b=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=m.length,x=!1;if(!v)return this.resolve([]);for(var _=-1,z=new this(r);++_<v;)E=m[_],b.resolve(E).then(function(C){x||(x=!0,a.resolve(z,C))},function(C){x||(x=!0,a.reject(z,C))});var E;return z}},{immediate:36}],38:[function(e,o,n){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),o.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,o,n){var s=e("./zlib/deflate"),r=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),p=Object.prototype.toString,h=0,u=-1,d=0,y=8;function g(m){if(!(this instanceof g))return new g(m);this.options=r.assign({level:u,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},m||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(v!==h)throw new Error(l[v]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var x;if(x=typeof b.dictionary=="string"?a.string2buf(b.dictionary):p.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(v=s.deflateSetDictionary(this.strm,x))!==h)throw new Error(l[v]);this._dict_set=!0}}function f(m,b){var v=new g(b);if(v.push(m,!0),v.err)throw v.msg||l[v.err];return v.result}g.prototype.push=function(m,b){var v,x,_=this.strm,z=this.options.chunkSize;if(this.ended)return!1;x=b===~~b?b:b===!0?4:0,typeof m=="string"?_.input=a.string2buf(m):p.call(m)==="[object ArrayBuffer]"?_.input=new Uint8Array(m):_.input=m,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new r.Buf8(z),_.next_out=0,_.avail_out=z),(v=s.deflate(_,x))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(r.shrinkBuf(_.output,_.next_out))):this.onData(r.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&v!==1);return x===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):x!==2||(this.onEnd(h),!(_.avail_out=0))},g.prototype.onData=function(m){this.chunks.push(m)},g.prototype.onEnd=function(m){m===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Deflate=g,n.deflate=f,n.deflateRaw=function(m,b){return(b=b||{}).raw=!0,f(m,b)},n.gzip=function(m,b){return(b=b||{}).gzip=!0,f(m,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,o,n){var s=e("./zlib/inflate"),r=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),p=e("./zlib/zstream"),h=e("./zlib/gzheader"),u=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||g&&g.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var m=s.inflateInit2(this.strm,f.windowBits);if(m!==l.Z_OK)throw new Error(c[m]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function y(g,f){var m=new d(f);if(m.push(g,!0),m.err)throw m.msg||c[m.err];return m.result}d.prototype.push=function(g,f){var m,b,v,x,_,z,E=this.strm,C=this.options.chunkSize,M=this.options.dictionary,S=!1;if(this.ended)return!1;b=f===~~f?f:f===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?E.input=a.binstring2buf(g):u.call(g)==="[object ArrayBuffer]"?E.input=new Uint8Array(g):E.input=g,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new r.Buf8(C),E.next_out=0,E.avail_out=C),(m=s.inflate(E,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&M&&(z=typeof M=="string"?a.string2buf(M):u.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,m=s.inflateSetDictionary(this.strm,z)),m===l.Z_BUF_ERROR&&S===!0&&(m=l.Z_OK,S=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);E.next_out&&(E.avail_out!==0&&m!==l.Z_STREAM_END&&(E.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(E.output,E.next_out),x=E.next_out-v,_=a.buf2string(E.output,v),E.next_out=x,E.avail_out=C-x,x&&r.arraySet(E.output,E.output,v,x,0),this.onData(_)):this.onData(r.shrinkBuf(E.output,E.next_out)))),E.avail_in===0&&E.avail_out===0&&(S=!0)}while((0<E.avail_in||E.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(m=s.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(E.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Inflate=d,n.inflate=y,n.inflateRaw=function(g,f){return(f=f||{}).raw=!0,y(g,f)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,o,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var p=c.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var h in p)p.hasOwnProperty(h)&&(l[h]=p[h])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var r={arraySet:function(l,c,p,h,u){if(c.subarray&&l.subarray)l.set(c.subarray(p,p+h),u);else for(var d=0;d<h;d++)l[u+d]=c[p+d]},flattenChunks:function(l){var c,p,h,u,d,y;for(c=h=0,p=l.length;c<p;c++)h+=l[c].length;for(y=new Uint8Array(h),c=u=0,p=l.length;c<p;c++)d=l[c],y.set(d,u),u+=d.length;return y}},a={arraySet:function(l,c,p,h,u){for(var d=0;d<h;d++)l[u+d]=c[p+d]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(s)},{}],42:[function(e,o,n){var s=e("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new s.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function p(h,u){if(u<65537&&(h.subarray&&a||!h.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(h,u));for(var d="",y=0;y<u;y++)d+=String.fromCharCode(h[y]);return d}l[254]=l[254]=1,n.string2buf=function(h){var u,d,y,g,f,m=h.length,b=0;for(g=0;g<m;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<m&&(64512&(y=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),b+=d<128?1:d<2048?2:d<65536?3:4;for(u=new s.Buf8(b),g=f=0;f<b;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<m&&(64512&(y=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),d<128?u[f++]=d:(d<2048?u[f++]=192|d>>>6:(d<65536?u[f++]=224|d>>>12:(u[f++]=240|d>>>18,u[f++]=128|d>>>12&63),u[f++]=128|d>>>6&63),u[f++]=128|63&d);return u},n.buf2binstring=function(h){return p(h,h.length)},n.binstring2buf=function(h){for(var u=new s.Buf8(h.length),d=0,y=u.length;d<y;d++)u[d]=h.charCodeAt(d);return u},n.buf2string=function(h,u){var d,y,g,f,m=u||h.length,b=new Array(2*m);for(d=y=0;d<m;)if((g=h[d++])<128)b[y++]=g;else if(4<(f=l[g]))b[y++]=65533,d+=f-1;else{for(g&=f===2?31:f===3?15:7;1<f&&d<m;)g=g<<6|63&h[d++],f--;1<f?b[y++]=65533:g<65536?b[y++]=g:(g-=65536,b[y++]=55296|g>>10&1023,b[y++]=56320|1023&g)}return p(b,y)},n.utf8border=function(h,u){var d;for((u=u||h.length)>h.length&&(u=h.length),d=u-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?u:d+l[h[d]]>u?d:u}},{"./common":41}],43:[function(e,o,n){o.exports=function(s,r,a,l){for(var c=65535&s|0,p=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;p=p+(c=c+r[l++]|0)|0,--h;);c%=65521,p%=65521}return c|p<<16|0}},{}],44:[function(e,o,n){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,o,n){var s=(function(){for(var r,a=[],l=0;l<256;l++){r=l;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;a[l]=r}return a})();o.exports=function(r,a,l,c){var p=s,h=c+l;r^=-1;for(var u=c;u<h;u++)r=r>>>8^p[255&(r^a[u])];return-1^r}},{}],46:[function(e,o,n){var s,r=e("../utils/common"),a=e("./trees"),l=e("./adler32"),c=e("./crc32"),p=e("./messages"),h=0,u=4,d=0,y=-2,g=-1,f=4,m=2,b=8,v=9,x=286,_=30,z=19,E=2*x+1,C=15,M=3,S=258,k=S+M+1,A=42,B=113,F=1,N=2,G=3,W=4;function et(w,ot){return w.msg=p[ot],ot}function K(w){return(w<<1)-(4<w?9:0)}function pt(w){for(var ot=w.length;0<=--ot;)w[ot]=0}function X(w){var ot=w.state,V=ot.pending;V>w.avail_out&&(V=w.avail_out),V!==0&&(r.arraySet(w.output,ot.pending_buf,ot.pending_out,V,w.next_out),w.next_out+=V,ot.pending_out+=V,w.total_out+=V,w.avail_out-=V,ot.pending-=V,ot.pending===0&&(ot.pending_out=0))}function Z(w,ot){a._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,ot),w.block_start=w.strstart,X(w.strm)}function gt(w,ot){w.pending_buf[w.pending++]=ot}function Y(w,ot){w.pending_buf[w.pending++]=ot>>>8&255,w.pending_buf[w.pending++]=255&ot}function tt(w,ot){var V,U,D=w.max_chain_length,H=w.strstart,nt=w.prev_length,P=w.nice_match,T=w.strstart>w.w_size-k?w.strstart-(w.w_size-k):0,O=w.window,j=w.w_mask,$=w.prev,it=w.strstart+S,wt=O[H+nt-1],dt=O[H+nt];w.prev_length>=w.good_match&&(D>>=2),P>w.lookahead&&(P=w.lookahead);do if(O[(V=ot)+nt]===dt&&O[V+nt-1]===wt&&O[V]===O[H]&&O[++V]===O[H+1]){H+=2,V++;do;while(O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&O[++H]===O[++V]&&H<it);if(U=S-(it-H),H=it-S,nt<U){if(w.match_start=ot,P<=(nt=U))break;wt=O[H+nt-1],dt=O[H+nt]}}while((ot=$[ot&j])>T&&--D!=0);return nt<=w.lookahead?nt:w.lookahead}function _t(w){var ot,V,U,D,H,nt,P,T,O,j,$=w.w_size;do{if(D=w.window_size-w.lookahead-w.strstart,w.strstart>=$+($-k)){for(r.arraySet(w.window,w.window,$,$,0),w.match_start-=$,w.strstart-=$,w.block_start-=$,ot=V=w.hash_size;U=w.head[--ot],w.head[ot]=$<=U?U-$:0,--V;);for(ot=V=$;U=w.prev[--ot],w.prev[ot]=$<=U?U-$:0,--V;);D+=$}if(w.strm.avail_in===0)break;if(nt=w.strm,P=w.window,T=w.strstart+w.lookahead,O=D,j=void 0,j=nt.avail_in,O<j&&(j=O),V=j===0?0:(nt.avail_in-=j,r.arraySet(P,nt.input,nt.next_in,j,T),nt.state.wrap===1?nt.adler=l(nt.adler,P,j,T):nt.state.wrap===2&&(nt.adler=c(nt.adler,P,j,T)),nt.next_in+=j,nt.total_in+=j,j),w.lookahead+=V,w.lookahead+w.insert>=M)for(H=w.strstart-w.insert,w.ins_h=w.window[H],w.ins_h=(w.ins_h<<w.hash_shift^w.window[H+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[H+M-1])&w.hash_mask,w.prev[H&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=H,H++,w.insert--,!(w.lookahead+w.insert<M)););}while(w.lookahead<k&&w.strm.avail_in!==0)}function ft(w,ot){for(var V,U;;){if(w.lookahead<k){if(_t(w),w.lookahead<k&&ot===h)return F;if(w.lookahead===0)break}if(V=0,w.lookahead>=M&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,V=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),V!==0&&w.strstart-V<=w.w_size-k&&(w.match_length=tt(w,V)),w.match_length>=M)if(U=a._tr_tally(w,w.strstart-w.match_start,w.match_length-M),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=M){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,V=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else U=a._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(U&&(Z(w,!1),w.strm.avail_out===0))return F}return w.insert=w.strstart<M-1?w.strstart:M-1,ot===u?(Z(w,!0),w.strm.avail_out===0?G:W):w.last_lit&&(Z(w,!1),w.strm.avail_out===0)?F:N}function xt(w,ot){for(var V,U,D;;){if(w.lookahead<k){if(_t(w),w.lookahead<k&&ot===h)return F;if(w.lookahead===0)break}if(V=0,w.lookahead>=M&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,V=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=M-1,V!==0&&w.prev_length<w.max_lazy_match&&w.strstart-V<=w.w_size-k&&(w.match_length=tt(w,V),w.match_length<=5&&(w.strategy===1||w.match_length===M&&4096<w.strstart-w.match_start)&&(w.match_length=M-1)),w.prev_length>=M&&w.match_length<=w.prev_length){for(D=w.strstart+w.lookahead-M,U=a._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-M),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=D&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+M-1])&w.hash_mask,V=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=M-1,w.strstart++,U&&(Z(w,!1),w.strm.avail_out===0))return F}else if(w.match_available){if((U=a._tr_tally(w,0,w.window[w.strstart-1]))&&Z(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return F}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(U=a._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<M-1?w.strstart:M-1,ot===u?(Z(w,!0),w.strm.avail_out===0?G:W):w.last_lit&&(Z(w,!1),w.strm.avail_out===0)?F:N}function Ft(w,ot,V,U,D){this.good_length=w,this.max_lazy=ot,this.nice_length=V,this.max_chain=U,this.func=D}function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*E),this.dyn_dtree=new r.Buf16(2*(2*_+1)),this.bl_tree=new r.Buf16(2*(2*z+1)),pt(this.dyn_ltree),pt(this.dyn_dtree),pt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(C+1),this.heap=new r.Buf16(2*x+1),pt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*x+1),pt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ot(w){var ot;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=m,(ot=w.state).pending=0,ot.pending_out=0,ot.wrap<0&&(ot.wrap=-ot.wrap),ot.status=ot.wrap?A:B,w.adler=ot.wrap===2?0:1,ot.last_flush=h,a._tr_init(ot),d):et(w,y)}function ht(w){var ot=Ot(w);return ot===d&&(function(V){V.window_size=2*V.w_size,pt(V.head),V.max_lazy_match=s[V.level].max_lazy,V.good_match=s[V.level].good_length,V.nice_match=s[V.level].nice_length,V.max_chain_length=s[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=M-1,V.match_available=0,V.ins_h=0})(w.state),ot}function yt(w,ot,V,U,D,H){if(!w)return y;var nt=1;if(ot===g&&(ot=6),U<0?(nt=0,U=-U):15<U&&(nt=2,U-=16),D<1||v<D||V!==b||U<8||15<U||ot<0||9<ot||H<0||f<H)return et(w,y);U===8&&(U=9);var P=new Dt;return(w.state=P).strm=w,P.wrap=nt,P.gzhead=null,P.w_bits=U,P.w_size=1<<P.w_bits,P.w_mask=P.w_size-1,P.hash_bits=D+7,P.hash_size=1<<P.hash_bits,P.hash_mask=P.hash_size-1,P.hash_shift=~~((P.hash_bits+M-1)/M),P.window=new r.Buf8(2*P.w_size),P.head=new r.Buf16(P.hash_size),P.prev=new r.Buf16(P.w_size),P.lit_bufsize=1<<D+6,P.pending_buf_size=4*P.lit_bufsize,P.pending_buf=new r.Buf8(P.pending_buf_size),P.d_buf=1*P.lit_bufsize,P.l_buf=3*P.lit_bufsize,P.level=ot,P.strategy=H,P.method=V,ht(w)}s=[new Ft(0,0,0,0,function(w,ot){var V=65535;for(V>w.pending_buf_size-5&&(V=w.pending_buf_size-5);;){if(w.lookahead<=1){if(_t(w),w.lookahead===0&&ot===h)return F;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var U=w.block_start+V;if((w.strstart===0||w.strstart>=U)&&(w.lookahead=w.strstart-U,w.strstart=U,Z(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-k&&(Z(w,!1),w.strm.avail_out===0))return F}return w.insert=0,ot===u?(Z(w,!0),w.strm.avail_out===0?G:W):(w.strstart>w.block_start&&(Z(w,!1),w.strm.avail_out),F)}),new Ft(4,4,8,4,ft),new Ft(4,5,16,8,ft),new Ft(4,6,32,32,ft),new Ft(4,4,16,16,xt),new Ft(8,16,32,32,xt),new Ft(8,16,128,128,xt),new Ft(8,32,128,256,xt),new Ft(32,128,258,1024,xt),new Ft(32,258,258,4096,xt)],n.deflateInit=function(w,ot){return yt(w,ot,b,15,8,0)},n.deflateInit2=yt,n.deflateReset=ht,n.deflateResetKeep=Ot,n.deflateSetHeader=function(w,ot){return w&&w.state?w.state.wrap!==2?y:(w.state.gzhead=ot,d):y},n.deflate=function(w,ot){var V,U,D,H;if(!w||!w.state||5<ot||ot<0)return w?et(w,y):y;if(U=w.state,!w.output||!w.input&&w.avail_in!==0||U.status===666&&ot!==u)return et(w,w.avail_out===0?-5:y);if(U.strm=w,V=U.last_flush,U.last_flush=ot,U.status===A)if(U.wrap===2)w.adler=0,gt(U,31),gt(U,139),gt(U,8),U.gzhead?(gt(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),gt(U,255&U.gzhead.time),gt(U,U.gzhead.time>>8&255),gt(U,U.gzhead.time>>16&255),gt(U,U.gzhead.time>>24&255),gt(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),gt(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(gt(U,255&U.gzhead.extra.length),gt(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(w.adler=c(w.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(gt(U,0),gt(U,0),gt(U,0),gt(U,0),gt(U,0),gt(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),gt(U,3),U.status=B);else{var nt=b+(U.w_bits-8<<4)<<8;nt|=(2<=U.strategy||U.level<2?0:U.level<6?1:U.level===6?2:3)<<6,U.strstart!==0&&(nt|=32),nt+=31-nt%31,U.status=B,Y(U,nt),U.strstart!==0&&(Y(U,w.adler>>>16),Y(U,65535&w.adler)),w.adler=1}if(U.status===69)if(U.gzhead.extra){for(D=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),X(w),D=U.pending,U.pending!==U.pending_buf_size));)gt(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(U.status===73)if(U.gzhead.name){D=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),X(w),D=U.pending,U.pending===U.pending_buf_size)){H=1;break}H=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,gt(U,H)}while(H!==0);U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),H===0&&(U.gzindex=0,U.status=91)}else U.status=91;if(U.status===91)if(U.gzhead.comment){D=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),X(w),D=U.pending,U.pending===U.pending_buf_size)){H=1;break}H=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,gt(U,H)}while(H!==0);U.gzhead.hcrc&&U.pending>D&&(w.adler=c(w.adler,U.pending_buf,U.pending-D,D)),H===0&&(U.status=103)}else U.status=103;if(U.status===103&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&X(w),U.pending+2<=U.pending_buf_size&&(gt(U,255&w.adler),gt(U,w.adler>>8&255),w.adler=0,U.status=B)):U.status=B),U.pending!==0){if(X(w),w.avail_out===0)return U.last_flush=-1,d}else if(w.avail_in===0&&K(ot)<=K(V)&&ot!==u)return et(w,-5);if(U.status===666&&w.avail_in!==0)return et(w,-5);if(w.avail_in!==0||U.lookahead!==0||ot!==h&&U.status!==666){var P=U.strategy===2?(function(T,O){for(var j;;){if(T.lookahead===0&&(_t(T),T.lookahead===0)){if(O===h)return F;break}if(T.match_length=0,j=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,j&&(Z(T,!1),T.strm.avail_out===0))return F}return T.insert=0,O===u?(Z(T,!0),T.strm.avail_out===0?G:W):T.last_lit&&(Z(T,!1),T.strm.avail_out===0)?F:N})(U,ot):U.strategy===3?(function(T,O){for(var j,$,it,wt,dt=T.window;;){if(T.lookahead<=S){if(_t(T),T.lookahead<=S&&O===h)return F;if(T.lookahead===0)break}if(T.match_length=0,T.lookahead>=M&&0<T.strstart&&($=dt[it=T.strstart-1])===dt[++it]&&$===dt[++it]&&$===dt[++it]){wt=T.strstart+S;do;while($===dt[++it]&&$===dt[++it]&&$===dt[++it]&&$===dt[++it]&&$===dt[++it]&&$===dt[++it]&&$===dt[++it]&&$===dt[++it]&&it<wt);T.match_length=S-(wt-it),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=M?(j=a._tr_tally(T,1,T.match_length-M),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(j=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),j&&(Z(T,!1),T.strm.avail_out===0))return F}return T.insert=0,O===u?(Z(T,!0),T.strm.avail_out===0?G:W):T.last_lit&&(Z(T,!1),T.strm.avail_out===0)?F:N})(U,ot):s[U.level].func(U,ot);if(P!==G&&P!==W||(U.status=666),P===F||P===G)return w.avail_out===0&&(U.last_flush=-1),d;if(P===N&&(ot===1?a._tr_align(U):ot!==5&&(a._tr_stored_block(U,0,0,!1),ot===3&&(pt(U.head),U.lookahead===0&&(U.strstart=0,U.block_start=0,U.insert=0))),X(w),w.avail_out===0))return U.last_flush=-1,d}return ot!==u?d:U.wrap<=0?1:(U.wrap===2?(gt(U,255&w.adler),gt(U,w.adler>>8&255),gt(U,w.adler>>16&255),gt(U,w.adler>>24&255),gt(U,255&w.total_in),gt(U,w.total_in>>8&255),gt(U,w.total_in>>16&255),gt(U,w.total_in>>24&255)):(Y(U,w.adler>>>16),Y(U,65535&w.adler)),X(w),0<U.wrap&&(U.wrap=-U.wrap),U.pending!==0?d:1)},n.deflateEnd=function(w){var ot;return w&&w.state?(ot=w.state.status)!==A&&ot!==69&&ot!==73&&ot!==91&&ot!==103&&ot!==B&&ot!==666?et(w,y):(w.state=null,ot===B?et(w,-3):d):y},n.deflateSetDictionary=function(w,ot){var V,U,D,H,nt,P,T,O,j=ot.length;if(!w||!w.state||(H=(V=w.state).wrap)===2||H===1&&V.status!==A||V.lookahead)return y;for(H===1&&(w.adler=l(w.adler,ot,j,0)),V.wrap=0,j>=V.w_size&&(H===0&&(pt(V.head),V.strstart=0,V.block_start=0,V.insert=0),O=new r.Buf8(V.w_size),r.arraySet(O,ot,j-V.w_size,V.w_size,0),ot=O,j=V.w_size),nt=w.avail_in,P=w.next_in,T=w.input,w.avail_in=j,w.next_in=0,w.input=ot,_t(V);V.lookahead>=M;){for(U=V.strstart,D=V.lookahead-(M-1);V.ins_h=(V.ins_h<<V.hash_shift^V.window[U+M-1])&V.hash_mask,V.prev[U&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=U,U++,--D;);V.strstart=U,V.lookahead=M-1,_t(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=M-1,V.match_available=0,w.next_in=P,w.input=T,w.avail_in=nt,V.wrap=H,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,o,n){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,o,n){o.exports=function(s,r){var a,l,c,p,h,u,d,y,g,f,m,b,v,x,_,z,E,C,M,S,k,A,B,F,N;a=s.state,l=s.next_in,F=s.input,c=l+(s.avail_in-5),p=s.next_out,N=s.output,h=p-(r-s.avail_out),u=p+(s.avail_out-257),d=a.dmax,y=a.wsize,g=a.whave,f=a.wnext,m=a.window,b=a.hold,v=a.bits,x=a.lencode,_=a.distcode,z=(1<<a.lenbits)-1,E=(1<<a.distbits)-1;t:do{v<15&&(b+=F[l++]<<v,v+=8,b+=F[l++]<<v,v+=8),C=x[b&z];e:for(;;){if(b>>>=M=C>>>24,v-=M,(M=C>>>16&255)===0)N[p++]=65535&C;else{if(!(16&M)){if((64&M)==0){C=x[(65535&C)+(b&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}S=65535&C,(M&=15)&&(v<M&&(b+=F[l++]<<v,v+=8),S+=b&(1<<M)-1,b>>>=M,v-=M),v<15&&(b+=F[l++]<<v,v+=8,b+=F[l++]<<v,v+=8),C=_[b&E];o:for(;;){if(b>>>=M=C>>>24,v-=M,!(16&(M=C>>>16&255))){if((64&M)==0){C=_[(65535&C)+(b&(1<<M)-1)];continue o}s.msg="invalid distance code",a.mode=30;break t}if(k=65535&C,v<(M&=15)&&(b+=F[l++]<<v,(v+=8)<M&&(b+=F[l++]<<v,v+=8)),d<(k+=b&(1<<M)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=M,v-=M,(M=p-h)<k){if(g<(M=k-M)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(B=m,(A=0)===f){if(A+=y-M,M<S){for(S-=M;N[p++]=m[A++],--M;);A=p-k,B=N}}else if(f<M){if(A+=y+f-M,(M-=f)<S){for(S-=M;N[p++]=m[A++],--M;);if(A=0,f<S){for(S-=M=f;N[p++]=m[A++],--M;);A=p-k,B=N}}}else if(A+=f-M,M<S){for(S-=M;N[p++]=m[A++],--M;);A=p-k,B=N}for(;2<S;)N[p++]=B[A++],N[p++]=B[A++],N[p++]=B[A++],S-=3;S&&(N[p++]=B[A++],1<S&&(N[p++]=B[A++]))}else{for(A=p-k;N[p++]=N[A++],N[p++]=N[A++],N[p++]=N[A++],2<(S-=3););S&&(N[p++]=N[A++],1<S&&(N[p++]=N[A++]))}break}}break}}while(l<c&&p<u);l-=S=v>>3,b&=(1<<(v-=S<<3))-1,s.next_in=l,s.next_out=p,s.avail_in=l<c?c-l+5:5-(l-c),s.avail_out=p<u?u-p+257:257-(p-u),a.hold=b,a.bits=v}},{}],49:[function(e,o,n){var s=e("../utils/common"),r=e("./adler32"),a=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),p=1,h=2,u=0,d=-2,y=1,g=852,f=592;function m(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(A){var B;return A&&A.state?(B=A.state,A.total_in=A.total_out=B.total=0,A.msg="",B.wrap&&(A.adler=1&B.wrap),B.mode=y,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new s.Buf32(g),B.distcode=B.distdyn=new s.Buf32(f),B.sane=1,B.back=-1,u):d}function x(A){var B;return A&&A.state?((B=A.state).wsize=0,B.whave=0,B.wnext=0,v(A)):d}function _(A,B){var F,N;return A&&A.state?(N=A.state,B<0?(F=0,B=-B):(F=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?d:(N.window!==null&&N.wbits!==B&&(N.window=null),N.wrap=F,N.wbits=B,x(A))):d}function z(A,B){var F,N;return A?(N=new b,(A.state=N).window=null,(F=_(A,B))!==u&&(A.state=null),F):d}var E,C,M=!0;function S(A){if(M){var B;for(E=new s.Buf32(512),C=new s.Buf32(32),B=0;B<144;)A.lens[B++]=8;for(;B<256;)A.lens[B++]=9;for(;B<280;)A.lens[B++]=7;for(;B<288;)A.lens[B++]=8;for(c(p,A.lens,0,288,E,0,A.work,{bits:9}),B=0;B<32;)A.lens[B++]=5;c(h,A.lens,0,32,C,0,A.work,{bits:5}),M=!1}A.lencode=E,A.lenbits=9,A.distcode=C,A.distbits=5}function k(A,B,F,N){var G,W=A.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new s.Buf8(W.wsize)),N>=W.wsize?(s.arraySet(W.window,B,F-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(N<(G=W.wsize-W.wnext)&&(G=N),s.arraySet(W.window,B,F-N,G,W.wnext),(N-=G)?(s.arraySet(W.window,B,F-N,N,0),W.wnext=N,W.whave=W.wsize):(W.wnext+=G,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=G))),0}n.inflateReset=x,n.inflateReset2=_,n.inflateResetKeep=v,n.inflateInit=function(A){return z(A,15)},n.inflateInit2=z,n.inflate=function(A,B){var F,N,G,W,et,K,pt,X,Z,gt,Y,tt,_t,ft,xt,Ft,Dt,Ot,ht,yt,w,ot,V,U,D=0,H=new s.Buf8(4),nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return d;(F=A.state).mode===12&&(F.mode=13),et=A.next_out,G=A.output,pt=A.avail_out,W=A.next_in,N=A.input,K=A.avail_in,X=F.hold,Z=F.bits,gt=K,Y=pt,ot=u;t:for(;;)switch(F.mode){case y:if(F.wrap===0){F.mode=13;break}for(;Z<16;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(2&F.wrap&&X===35615){H[F.check=0]=255&X,H[1]=X>>>8&255,F.check=a(F.check,H,2,0),Z=X=0,F.mode=2;break}if(F.flags=0,F.head&&(F.head.done=!1),!(1&F.wrap)||(((255&X)<<8)+(X>>8))%31){A.msg="incorrect header check",F.mode=30;break}if((15&X)!=8){A.msg="unknown compression method",F.mode=30;break}if(Z-=4,w=8+(15&(X>>>=4)),F.wbits===0)F.wbits=w;else if(w>F.wbits){A.msg="invalid window size",F.mode=30;break}F.dmax=1<<w,A.adler=F.check=1,F.mode=512&X?10:12,Z=X=0;break;case 2:for(;Z<16;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(F.flags=X,(255&F.flags)!=8){A.msg="unknown compression method",F.mode=30;break}if(57344&F.flags){A.msg="unknown header flags set",F.mode=30;break}F.head&&(F.head.text=X>>8&1),512&F.flags&&(H[0]=255&X,H[1]=X>>>8&255,F.check=a(F.check,H,2,0)),Z=X=0,F.mode=3;case 3:for(;Z<32;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.head&&(F.head.time=X),512&F.flags&&(H[0]=255&X,H[1]=X>>>8&255,H[2]=X>>>16&255,H[3]=X>>>24&255,F.check=a(F.check,H,4,0)),Z=X=0,F.mode=4;case 4:for(;Z<16;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.head&&(F.head.xflags=255&X,F.head.os=X>>8),512&F.flags&&(H[0]=255&X,H[1]=X>>>8&255,F.check=a(F.check,H,2,0)),Z=X=0,F.mode=5;case 5:if(1024&F.flags){for(;Z<16;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.length=X,F.head&&(F.head.extra_len=X),512&F.flags&&(H[0]=255&X,H[1]=X>>>8&255,F.check=a(F.check,H,2,0)),Z=X=0}else F.head&&(F.head.extra=null);F.mode=6;case 6:if(1024&F.flags&&(K<(tt=F.length)&&(tt=K),tt&&(F.head&&(w=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Array(F.head.extra_len)),s.arraySet(F.head.extra,N,W,tt,w)),512&F.flags&&(F.check=a(F.check,N,tt,W)),K-=tt,W+=tt,F.length-=tt),F.length))break t;F.length=0,F.mode=7;case 7:if(2048&F.flags){if(K===0)break t;for(tt=0;w=N[W+tt++],F.head&&w&&F.length<65536&&(F.head.name+=String.fromCharCode(w)),w&&tt<K;);if(512&F.flags&&(F.check=a(F.check,N,tt,W)),K-=tt,W+=tt,w)break t}else F.head&&(F.head.name=null);F.length=0,F.mode=8;case 8:if(4096&F.flags){if(K===0)break t;for(tt=0;w=N[W+tt++],F.head&&w&&F.length<65536&&(F.head.comment+=String.fromCharCode(w)),w&&tt<K;);if(512&F.flags&&(F.check=a(F.check,N,tt,W)),K-=tt,W+=tt,w)break t}else F.head&&(F.head.comment=null);F.mode=9;case 9:if(512&F.flags){for(;Z<16;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(X!==(65535&F.check)){A.msg="header crc mismatch",F.mode=30;break}Z=X=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),A.adler=F.check=0,F.mode=12;break;case 10:for(;Z<32;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}A.adler=F.check=m(X),Z=X=0,F.mode=11;case 11:if(F.havedict===0)return A.next_out=et,A.avail_out=pt,A.next_in=W,A.avail_in=K,F.hold=X,F.bits=Z,2;A.adler=F.check=1,F.mode=12;case 12:if(B===5||B===6)break t;case 13:if(F.last){X>>>=7&Z,Z-=7&Z,F.mode=27;break}for(;Z<3;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}switch(F.last=1&X,Z-=1,3&(X>>>=1)){case 0:F.mode=14;break;case 1:if(S(F),F.mode=20,B!==6)break;X>>>=2,Z-=2;break t;case 2:F.mode=17;break;case 3:A.msg="invalid block type",F.mode=30}X>>>=2,Z-=2;break;case 14:for(X>>>=7&Z,Z-=7&Z;Z<32;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if((65535&X)!=(X>>>16^65535)){A.msg="invalid stored block lengths",F.mode=30;break}if(F.length=65535&X,Z=X=0,F.mode=15,B===6)break t;case 15:F.mode=16;case 16:if(tt=F.length){if(K<tt&&(tt=K),pt<tt&&(tt=pt),tt===0)break t;s.arraySet(G,N,W,tt,et),K-=tt,W+=tt,pt-=tt,et+=tt,F.length-=tt;break}F.mode=12;break;case 17:for(;Z<14;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(F.nlen=257+(31&X),X>>>=5,Z-=5,F.ndist=1+(31&X),X>>>=5,Z-=5,F.ncode=4+(15&X),X>>>=4,Z-=4,286<F.nlen||30<F.ndist){A.msg="too many length or distance symbols",F.mode=30;break}F.have=0,F.mode=18;case 18:for(;F.have<F.ncode;){for(;Z<3;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.lens[nt[F.have++]]=7&X,X>>>=3,Z-=3}for(;F.have<19;)F.lens[nt[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,V={bits:F.lenbits},ot=c(0,F.lens,0,19,F.lencode,0,F.work,V),F.lenbits=V.bits,ot){A.msg="invalid code lengths set",F.mode=30;break}F.have=0,F.mode=19;case 19:for(;F.have<F.nlen+F.ndist;){for(;Ft=(D=F.lencode[X&(1<<F.lenbits)-1])>>>16&255,Dt=65535&D,!((xt=D>>>24)<=Z);){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(Dt<16)X>>>=xt,Z-=xt,F.lens[F.have++]=Dt;else{if(Dt===16){for(U=xt+2;Z<U;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(X>>>=xt,Z-=xt,F.have===0){A.msg="invalid bit length repeat",F.mode=30;break}w=F.lens[F.have-1],tt=3+(3&X),X>>>=2,Z-=2}else if(Dt===17){for(U=xt+3;Z<U;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}Z-=xt,w=0,tt=3+(7&(X>>>=xt)),X>>>=3,Z-=3}else{for(U=xt+7;Z<U;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}Z-=xt,w=0,tt=11+(127&(X>>>=xt)),X>>>=7,Z-=7}if(F.have+tt>F.nlen+F.ndist){A.msg="invalid bit length repeat",F.mode=30;break}for(;tt--;)F.lens[F.have++]=w}}if(F.mode===30)break;if(F.lens[256]===0){A.msg="invalid code -- missing end-of-block",F.mode=30;break}if(F.lenbits=9,V={bits:F.lenbits},ot=c(p,F.lens,0,F.nlen,F.lencode,0,F.work,V),F.lenbits=V.bits,ot){A.msg="invalid literal/lengths set",F.mode=30;break}if(F.distbits=6,F.distcode=F.distdyn,V={bits:F.distbits},ot=c(h,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,V),F.distbits=V.bits,ot){A.msg="invalid distances set",F.mode=30;break}if(F.mode=20,B===6)break t;case 20:F.mode=21;case 21:if(6<=K&&258<=pt){A.next_out=et,A.avail_out=pt,A.next_in=W,A.avail_in=K,F.hold=X,F.bits=Z,l(A,Y),et=A.next_out,G=A.output,pt=A.avail_out,W=A.next_in,N=A.input,K=A.avail_in,X=F.hold,Z=F.bits,F.mode===12&&(F.back=-1);break}for(F.back=0;Ft=(D=F.lencode[X&(1<<F.lenbits)-1])>>>16&255,Dt=65535&D,!((xt=D>>>24)<=Z);){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(Ft&&(240&Ft)==0){for(Ot=xt,ht=Ft,yt=Dt;Ft=(D=F.lencode[yt+((X&(1<<Ot+ht)-1)>>Ot)])>>>16&255,Dt=65535&D,!(Ot+(xt=D>>>24)<=Z);){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}X>>>=Ot,Z-=Ot,F.back+=Ot}if(X>>>=xt,Z-=xt,F.back+=xt,F.length=Dt,Ft===0){F.mode=26;break}if(32&Ft){F.back=-1,F.mode=12;break}if(64&Ft){A.msg="invalid literal/length code",F.mode=30;break}F.extra=15&Ft,F.mode=22;case 22:if(F.extra){for(U=F.extra;Z<U;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.length+=X&(1<<F.extra)-1,X>>>=F.extra,Z-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=23;case 23:for(;Ft=(D=F.distcode[X&(1<<F.distbits)-1])>>>16&255,Dt=65535&D,!((xt=D>>>24)<=Z);){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if((240&Ft)==0){for(Ot=xt,ht=Ft,yt=Dt;Ft=(D=F.distcode[yt+((X&(1<<Ot+ht)-1)>>Ot)])>>>16&255,Dt=65535&D,!(Ot+(xt=D>>>24)<=Z);){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}X>>>=Ot,Z-=Ot,F.back+=Ot}if(X>>>=xt,Z-=xt,F.back+=xt,64&Ft){A.msg="invalid distance code",F.mode=30;break}F.offset=Dt,F.extra=15&Ft,F.mode=24;case 24:if(F.extra){for(U=F.extra;Z<U;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}F.offset+=X&(1<<F.extra)-1,X>>>=F.extra,Z-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){A.msg="invalid distance too far back",F.mode=30;break}F.mode=25;case 25:if(pt===0)break t;if(tt=Y-pt,F.offset>tt){if((tt=F.offset-tt)>F.whave&&F.sane){A.msg="invalid distance too far back",F.mode=30;break}_t=tt>F.wnext?(tt-=F.wnext,F.wsize-tt):F.wnext-tt,tt>F.length&&(tt=F.length),ft=F.window}else ft=G,_t=et-F.offset,tt=F.length;for(pt<tt&&(tt=pt),pt-=tt,F.length-=tt;G[et++]=ft[_t++],--tt;);F.length===0&&(F.mode=21);break;case 26:if(pt===0)break t;G[et++]=F.length,pt--,F.mode=21;break;case 27:if(F.wrap){for(;Z<32;){if(K===0)break t;K--,X|=N[W++]<<Z,Z+=8}if(Y-=pt,A.total_out+=Y,F.total+=Y,Y&&(A.adler=F.check=F.flags?a(F.check,G,Y,et-Y):r(F.check,G,Y,et-Y)),Y=pt,(F.flags?X:m(X))!==F.check){A.msg="incorrect data check",F.mode=30;break}Z=X=0}F.mode=28;case 28:if(F.wrap&&F.flags){for(;Z<32;){if(K===0)break t;K--,X+=N[W++]<<Z,Z+=8}if(X!==(4294967295&F.total)){A.msg="incorrect length check",F.mode=30;break}Z=X=0}F.mode=29;case 29:ot=1;break t;case 30:ot=-3;break t;case 31:return-4;case 32:default:return d}return A.next_out=et,A.avail_out=pt,A.next_in=W,A.avail_in=K,F.hold=X,F.bits=Z,(F.wsize||Y!==A.avail_out&&F.mode<30&&(F.mode<27||B!==4))&&k(A,A.output,A.next_out,Y-A.avail_out)?(F.mode=31,-4):(gt-=A.avail_in,Y-=A.avail_out,A.total_in+=gt,A.total_out+=Y,F.total+=Y,F.wrap&&Y&&(A.adler=F.check=F.flags?a(F.check,G,Y,A.next_out-Y):r(F.check,G,Y,A.next_out-Y)),A.data_type=F.bits+(F.last?64:0)+(F.mode===12?128:0)+(F.mode===20||F.mode===15?256:0),(gt==0&&Y===0||B===4)&&ot===u&&(ot=-5),ot)},n.inflateEnd=function(A){if(!A||!A.state)return d;var B=A.state;return B.window&&(B.window=null),A.state=null,u},n.inflateGetHeader=function(A,B){var F;return A&&A.state?(2&(F=A.state).wrap)==0?d:((F.head=B).done=!1,u):d},n.inflateSetDictionary=function(A,B){var F,N=B.length;return A&&A.state?(F=A.state).wrap!==0&&F.mode!==11?d:F.mode===11&&r(1,B,N,0)!==F.check?-3:k(A,B,N,N)?(F.mode=31,-4):(F.havedict=1,u):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,o,n){var s=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(p,h,u,d,y,g,f,m){var b,v,x,_,z,E,C,M,S,k=m.bits,A=0,B=0,F=0,N=0,G=0,W=0,et=0,K=0,pt=0,X=0,Z=null,gt=0,Y=new s.Buf16(16),tt=new s.Buf16(16),_t=null,ft=0;for(A=0;A<=15;A++)Y[A]=0;for(B=0;B<d;B++)Y[h[u+B]]++;for(G=k,N=15;1<=N&&Y[N]===0;N--);if(N<G&&(G=N),N===0)return y[g++]=20971520,y[g++]=20971520,m.bits=1,0;for(F=1;F<N&&Y[F]===0;F++);for(G<F&&(G=F),A=K=1;A<=15;A++)if(K<<=1,(K-=Y[A])<0)return-1;if(0<K&&(p===0||N!==1))return-1;for(tt[1]=0,A=1;A<15;A++)tt[A+1]=tt[A]+Y[A];for(B=0;B<d;B++)h[u+B]!==0&&(f[tt[h[u+B]]++]=B);if(E=p===0?(Z=_t=f,19):p===1?(Z=r,gt-=257,_t=a,ft-=257,256):(Z=l,_t=c,-1),A=F,z=g,et=B=X=0,x=-1,_=(pt=1<<(W=G))-1,p===1&&852<pt||p===2&&592<pt)return 1;for(;;){for(C=A-et,S=f[B]<E?(M=0,f[B]):f[B]>E?(M=_t[ft+f[B]],Z[gt+f[B]]):(M=96,0),b=1<<A-et,F=v=1<<W;y[z+(X>>et)+(v-=b)]=C<<24|M<<16|S|0,v!==0;);for(b=1<<A-1;X&b;)b>>=1;if(b!==0?(X&=b-1,X+=b):X=0,B++,--Y[A]==0){if(A===N)break;A=h[u+f[B]]}if(G<A&&(X&_)!==x){for(et===0&&(et=G),z+=F,K=1<<(W=A-et);W+et<N&&!((K-=Y[W+et])<=0);)W++,K<<=1;if(pt+=1<<W,p===1&&852<pt||p===2&&592<pt)return 1;y[x=X&_]=G<<24|W<<16|z-g|0}}return X!==0&&(y[z+X]=A-et<<24|64<<16|0),m.bits=G,0}},{"../utils/common":41}],51:[function(e,o,n){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,o,n){var s=e("../utils/common"),r=0,a=1;function l(D){for(var H=D.length;0<=--H;)D[H]=0}var c=0,p=29,h=256,u=h+1+p,d=30,y=19,g=2*u+1,f=15,m=16,b=7,v=256,x=16,_=17,z=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(u+2));l(k);var A=new Array(2*d);l(A);var B=new Array(512);l(B);var F=new Array(256);l(F);var N=new Array(p);l(N);var G,W,et,K=new Array(d);function pt(D,H,nt,P,T){this.static_tree=D,this.extra_bits=H,this.extra_base=nt,this.elems=P,this.max_length=T,this.has_stree=D&&D.length}function X(D,H){this.dyn_tree=D,this.max_code=0,this.stat_desc=H}function Z(D){return D<256?B[D]:B[256+(D>>>7)]}function gt(D,H){D.pending_buf[D.pending++]=255&H,D.pending_buf[D.pending++]=H>>>8&255}function Y(D,H,nt){D.bi_valid>m-nt?(D.bi_buf|=H<<D.bi_valid&65535,gt(D,D.bi_buf),D.bi_buf=H>>m-D.bi_valid,D.bi_valid+=nt-m):(D.bi_buf|=H<<D.bi_valid&65535,D.bi_valid+=nt)}function tt(D,H,nt){Y(D,nt[2*H],nt[2*H+1])}function _t(D,H){for(var nt=0;nt|=1&D,D>>>=1,nt<<=1,0<--H;);return nt>>>1}function ft(D,H,nt){var P,T,O=new Array(f+1),j=0;for(P=1;P<=f;P++)O[P]=j=j+nt[P-1]<<1;for(T=0;T<=H;T++){var $=D[2*T+1];$!==0&&(D[2*T]=_t(O[$]++,$))}}function xt(D){var H;for(H=0;H<u;H++)D.dyn_ltree[2*H]=0;for(H=0;H<d;H++)D.dyn_dtree[2*H]=0;for(H=0;H<y;H++)D.bl_tree[2*H]=0;D.dyn_ltree[2*v]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0}function Ft(D){8<D.bi_valid?gt(D,D.bi_buf):0<D.bi_valid&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0}function Dt(D,H,nt,P){var T=2*H,O=2*nt;return D[T]<D[O]||D[T]===D[O]&&P[H]<=P[nt]}function Ot(D,H,nt){for(var P=D.heap[nt],T=nt<<1;T<=D.heap_len&&(T<D.heap_len&&Dt(H,D.heap[T+1],D.heap[T],D.depth)&&T++,!Dt(H,P,D.heap[T],D.depth));)D.heap[nt]=D.heap[T],nt=T,T<<=1;D.heap[nt]=P}function ht(D,H,nt){var P,T,O,j,$=0;if(D.last_lit!==0)for(;P=D.pending_buf[D.d_buf+2*$]<<8|D.pending_buf[D.d_buf+2*$+1],T=D.pending_buf[D.l_buf+$],$++,P===0?tt(D,T,H):(tt(D,(O=F[T])+h+1,H),(j=E[O])!==0&&Y(D,T-=N[O],j),tt(D,O=Z(--P),nt),(j=C[O])!==0&&Y(D,P-=K[O],j)),$<D.last_lit;);tt(D,v,H)}function yt(D,H){var nt,P,T,O=H.dyn_tree,j=H.stat_desc.static_tree,$=H.stat_desc.has_stree,it=H.stat_desc.elems,wt=-1;for(D.heap_len=0,D.heap_max=g,nt=0;nt<it;nt++)O[2*nt]!==0?(D.heap[++D.heap_len]=wt=nt,D.depth[nt]=0):O[2*nt+1]=0;for(;D.heap_len<2;)O[2*(T=D.heap[++D.heap_len]=wt<2?++wt:0)]=1,D.depth[T]=0,D.opt_len--,$&&(D.static_len-=j[2*T+1]);for(H.max_code=wt,nt=D.heap_len>>1;1<=nt;nt--)Ot(D,O,nt);for(T=it;nt=D.heap[1],D.heap[1]=D.heap[D.heap_len--],Ot(D,O,1),P=D.heap[1],D.heap[--D.heap_max]=nt,D.heap[--D.heap_max]=P,O[2*T]=O[2*nt]+O[2*P],D.depth[T]=(D.depth[nt]>=D.depth[P]?D.depth[nt]:D.depth[P])+1,O[2*nt+1]=O[2*P+1]=T,D.heap[1]=T++,Ot(D,O,1),2<=D.heap_len;);D.heap[--D.heap_max]=D.heap[1],(function(dt,St){var Qt,mt,Rt,kt,Zt,It,qt=St.dyn_tree,Jt=St.max_code,me=St.stat_desc.static_tree,q=St.stat_desc.has_stree,Tt=St.stat_desc.extra_bits,lt=St.stat_desc.extra_base,ut=St.stat_desc.max_length,Ct=0;for(kt=0;kt<=f;kt++)dt.bl_count[kt]=0;for(qt[2*dt.heap[dt.heap_max]+1]=0,Qt=dt.heap_max+1;Qt<g;Qt++)ut<(kt=qt[2*qt[2*(mt=dt.heap[Qt])+1]+1]+1)&&(kt=ut,Ct++),qt[2*mt+1]=kt,Jt<mt||(dt.bl_count[kt]++,Zt=0,lt<=mt&&(Zt=Tt[mt-lt]),It=qt[2*mt],dt.opt_len+=It*(kt+Zt),q&&(dt.static_len+=It*(me[2*mt+1]+Zt)));if(Ct!==0){do{for(kt=ut-1;dt.bl_count[kt]===0;)kt--;dt.bl_count[kt]--,dt.bl_count[kt+1]+=2,dt.bl_count[ut]--,Ct-=2}while(0<Ct);for(kt=ut;kt!==0;kt--)for(mt=dt.bl_count[kt];mt!==0;)Jt<(Rt=dt.heap[--Qt])||(qt[2*Rt+1]!==kt&&(dt.opt_len+=(kt-qt[2*Rt+1])*qt[2*Rt],qt[2*Rt+1]=kt),mt--)}})(D,H),ft(O,wt,D.bl_count)}function w(D,H,nt){var P,T,O=-1,j=H[1],$=0,it=7,wt=4;for(j===0&&(it=138,wt=3),H[2*(nt+1)+1]=65535,P=0;P<=nt;P++)T=j,j=H[2*(P+1)+1],++$<it&&T===j||($<wt?D.bl_tree[2*T]+=$:T!==0?(T!==O&&D.bl_tree[2*T]++,D.bl_tree[2*x]++):$<=10?D.bl_tree[2*_]++:D.bl_tree[2*z]++,O=T,wt=($=0)===j?(it=138,3):T===j?(it=6,3):(it=7,4))}function ot(D,H,nt){var P,T,O=-1,j=H[1],$=0,it=7,wt=4;for(j===0&&(it=138,wt=3),P=0;P<=nt;P++)if(T=j,j=H[2*(P+1)+1],!(++$<it&&T===j)){if($<wt)for(;tt(D,T,D.bl_tree),--$!=0;);else T!==0?(T!==O&&(tt(D,T,D.bl_tree),$--),tt(D,x,D.bl_tree),Y(D,$-3,2)):$<=10?(tt(D,_,D.bl_tree),Y(D,$-3,3)):(tt(D,z,D.bl_tree),Y(D,$-11,7));O=T,wt=($=0)===j?(it=138,3):T===j?(it=6,3):(it=7,4)}}l(K);var V=!1;function U(D,H,nt,P){Y(D,(c<<1)+(P?1:0),3),(function(T,O,j,$){Ft(T),gt(T,j),gt(T,~j),s.arraySet(T.pending_buf,T.window,O,j,T.pending),T.pending+=j})(D,H,nt)}n._tr_init=function(D){V||((function(){var H,nt,P,T,O,j=new Array(f+1);for(T=P=0;T<p-1;T++)for(N[T]=P,H=0;H<1<<E[T];H++)F[P++]=T;for(F[P-1]=T,T=O=0;T<16;T++)for(K[T]=O,H=0;H<1<<C[T];H++)B[O++]=T;for(O>>=7;T<d;T++)for(K[T]=O<<7,H=0;H<1<<C[T]-7;H++)B[256+O++]=T;for(nt=0;nt<=f;nt++)j[nt]=0;for(H=0;H<=143;)k[2*H+1]=8,H++,j[8]++;for(;H<=255;)k[2*H+1]=9,H++,j[9]++;for(;H<=279;)k[2*H+1]=7,H++,j[7]++;for(;H<=287;)k[2*H+1]=8,H++,j[8]++;for(ft(k,u+1,j),H=0;H<d;H++)A[2*H+1]=5,A[2*H]=_t(H,5);G=new pt(k,E,h+1,u,f),W=new pt(A,C,0,d,f),et=new pt(new Array(0),M,0,y,b)})(),V=!0),D.l_desc=new X(D.dyn_ltree,G),D.d_desc=new X(D.dyn_dtree,W),D.bl_desc=new X(D.bl_tree,et),D.bi_buf=0,D.bi_valid=0,xt(D)},n._tr_stored_block=U,n._tr_flush_block=function(D,H,nt,P){var T,O,j=0;0<D.level?(D.strm.data_type===2&&(D.strm.data_type=(function($){var it,wt=4093624447;for(it=0;it<=31;it++,wt>>>=1)if(1&wt&&$.dyn_ltree[2*it]!==0)return r;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return a;for(it=32;it<h;it++)if($.dyn_ltree[2*it]!==0)return a;return r})(D)),yt(D,D.l_desc),yt(D,D.d_desc),j=(function($){var it;for(w($,$.dyn_ltree,$.l_desc.max_code),w($,$.dyn_dtree,$.d_desc.max_code),yt($,$.bl_desc),it=y-1;3<=it&&$.bl_tree[2*S[it]+1]===0;it--);return $.opt_len+=3*(it+1)+5+5+4,it})(D),T=D.opt_len+3+7>>>3,(O=D.static_len+3+7>>>3)<=T&&(T=O)):T=O=nt+5,nt+4<=T&&H!==-1?U(D,H,nt,P):D.strategy===4||O===T?(Y(D,2+(P?1:0),3),ht(D,k,A)):(Y(D,4+(P?1:0),3),(function($,it,wt,dt){var St;for(Y($,it-257,5),Y($,wt-1,5),Y($,dt-4,4),St=0;St<dt;St++)Y($,$.bl_tree[2*S[St]+1],3);ot($,$.dyn_ltree,it-1),ot($,$.dyn_dtree,wt-1)})(D,D.l_desc.max_code+1,D.d_desc.max_code+1,j+1),ht(D,D.dyn_ltree,D.dyn_dtree)),xt(D),P&&Ft(D)},n._tr_tally=function(D,H,nt){return D.pending_buf[D.d_buf+2*D.last_lit]=H>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&H,D.pending_buf[D.l_buf+D.last_lit]=255&nt,D.last_lit++,H===0?D.dyn_ltree[2*nt]++:(D.matches++,H--,D.dyn_ltree[2*(F[nt]+h+1)]++,D.dyn_dtree[2*Z(H)]++),D.last_lit===D.lit_bufsize-1},n._tr_align=function(D){Y(D,2,3),tt(D,v,k),(function(H){H.bi_valid===16?(gt(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)})(D)}},{"../utils/common":41}],53:[function(e,o,n){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,o,n){(function(s){(function(r,a){if(!r.setImmediate){var l,c,p,h,u=1,d={},y=!1,g=r.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(r);f=f&&f.setTimeout?f:r,l={}.toString.call(r.process)==="[object process]"?function(x){process.nextTick(function(){b(x)})}:(function(){if(r.postMessage&&!r.importScripts){var x=!0,_=r.onmessage;return r.onmessage=function(){x=!1},r.postMessage("","*"),r.onmessage=_,x}})()?(h="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",v,!1):r.attachEvent("onmessage",v),function(x){r.postMessage(h+x,"*")}):r.MessageChannel?((p=new MessageChannel).port1.onmessage=function(x){b(x.data)},function(x){p.port2.postMessage(x)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(x){var _=g.createElement("script");_.onreadystatechange=function(){b(x),_.onreadystatechange=null,c.removeChild(_),_=null},c.appendChild(_)}):function(x){setTimeout(b,0,x)},f.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var _=new Array(arguments.length-1),z=0;z<_.length;z++)_[z]=arguments[z+1];var E={callback:x,args:_};return d[u]=E,l(u),u++},f.clearImmediate=m}function m(x){delete d[x]}function b(x){if(y)setTimeout(b,0,x);else{var _=d[x];if(_){y=!0;try{(function(z){var E=z.callback,C=z.args;switch(C.length){case 0:E();break;case 1:E(C[0]);break;case 2:E(C[0],C[1]);break;case 3:E(C[0],C[1],C[2]);break;default:E.apply(a,C)}})(_)}finally{m(x),y=!1}}}}function v(x){x.source===r&&typeof x.data=="string"&&x.data.indexOf(h)===0&&b(+x.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof La<"u"?La:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ip)),Ip.exports}var cS=lS();const pS=aS(cS);function hS(i,t){let e;return function(...n){const s=()=>{clearTimeout(e),i(...n)};clearTimeout(e),e=setTimeout(s,t)}}class uS{constructor(){this.canvas=document.getElementById("viewport"),this.gridPosEl=document.getElementById("grid-pos"),this.blockCountEl=document.getElementById("block-count"),this.colorInput=document.getElementById("current-color"),this.colorPalette=document.getElementById("color-palette"),this.selectionProps=document.getElementById("selection-props"),this.fileInput=document.getElementById("file-input"),this.debouncedAutoSave=hS(()=>this.autoSave(),2e3),this.engine=new q2(this.canvas),this.grid=new j2(this.engine.scene,{gridSize:20,cellSize:1}),this.blockManager=new Ww(this.engine.scene),this.ghostBlock=new Yw(this.engine.scene),this.history=new qw,this.textureManager=new $w,this.facePainter=new J2(this.textureManager),this.animator=new Qw(this.blockManager),this.projectManager=new tM(this.blockManager,this.animator,this.textureManager),this.projectManager.onError=t=>this.showNotification(t,"error"),this.exporter=new SM,this.layerManager=new OM,this.layerManager.onLayerChange=()=>this.updateLayerUI(),this.projectManager.setLayerManager(this.layerManager),this.symmetryTool=new GM(this.blockManager),this.cameraBookmarks=new XM(this.engine.camera,this.engine.controls),this.cameraBookmarks.onBookmarksChange=()=>this.updateCameraBookmarksUI(),this.cameraPathAnimator=new WM(this.engine.camera,this.engine.controls,this.cameraBookmarks),this.frameSequencer=new uz(this.engine),window.JSZip=pS,this.lightBaker=new EM,this.textureBaker=new FM,this.useGPURenderer=!0;try{this.useGPURenderer?(this.tattooRenderer=new U0(this.engine,this.blockManager),console.log("Using GPU-accelerated style renderer")):(this.tattooRenderer=new na(this.engine,this.blockManager),console.log("Using CPU style renderer"))}catch(t){console.warn("GPU renderer failed, falling back to CPU:",t),this.tattooRenderer=new na(this.engine,this.blockManager)}this.blockFlattener=new nS(this.blockManager),this.scatterTool=new rS(this.blockManager),this.notificationsEl=document.getElementById("notifications"),this.bakedTexture=null,this.bakedUVData=null,this.inputManager=new Zw(this.canvas,this.engine.camera),this.inputManager.setGridPlane(this.grid.getRaycastPlane()),this.currentColor="#5588cc",this.currentBlockType="cube",this.currentRotation=0,this.clipboard=null,this.emissiveEnabled=!1,this.emissiveColor="#ffaa00",this.emissiveIntensity=1,this.emissiveRadius=3,this.showEdges=!0,this.edgeOpacity=.3,this.currentShape="sphere",this.shapeGhosts=[],this.paintMode="face",this.currentBlockScale=1,this.setupCallbacks(),this.setupToolbar(),this.setupPaintMode(),this.setupShapeBrush(),this.setupMoveControls(),this.setupColorPalette(),this.setupEmissiveControls(),this.setupEdgeControls(),this.setupMenuBar(),this.setupTimeline(),this.setupLayerPanel(),this.setupSymmetryTools(),this.setupCameraBookmarks(),this.setupCameraAnimation(),this.setupTattooMode(),this.setupScatterTool(),this.setupKeyboardShortcuts(),this.engine.onUpdate=t=>{this.animator.update(t),!this.useGPURenderer&&this.tattooRenderer.update&&this.tattooRenderer.update()},this.engine.start(),this.autoLoad()}setupCallbacks(){this.blockManager.onBlockCountChange=u=>{this.blockCountEl.textContent=`Blocks: ${u}`,this.inputManager.setRaycastTargets(this.blockManager.getBlockMeshes()),this.debouncedAutoSave()},this.history.onChange=({canUndo:u,canRedo:d})=>{document.getElementById("btn-undo").disabled=!u,document.getElementById("btn-redo").disabled=!d},this.history.notify();const t=(u,d)=>{const y={x:u.placementPosition.x,y:u.placementPosition.y,z:u.placementPosition.z};if(u.placementPosition.surfaceY!==void 0){const g=u.placementPosition.surfaceY;g%1!==0&&(y.y=Math.ceil(g))}return y},e=(u,d)=>d<=1?u:{x:Math.floor(u.x/d)*d,y:u.y,z:Math.floor(u.z/d)*d};this.inputManager.onMouseMove=u=>{if(this.inputManager.currentTool==="place"&&u){let d=t(u,this.currentBlockType);d=e(d,this.currentBlockScale),this.ghostBlock.show(),this.ghostBlock.setPosition(d),this.ghostBlock.setBlockType(this.currentBlockType),this.ghostBlock.setRotation(this.currentRotation);const y=this.blockManager.wouldOverlapAt(this.currentBlockType,d,{w:1,h:1,d:1},null,this.currentBlockScale);this.ghostBlock.setValid(!y),this.gridPosEl.textContent=`Grid: ${d.x}, ${d.y}, ${d.z}`}else this.ghostBlock.hide()};let o=null;const n=(u,d)=>{const y=[],g=Math.abs(d.x-u.x),f=Math.abs(d.y-u.y),m=Math.abs(d.z-u.z),b=u.x===d.x,v=u.y===d.y,x=u.z===d.z;if(b&&v||b&&x||v&&x){const _=u.x<d.x?1:u.x>d.x?-1:0,z=u.y<d.y?1:u.y>d.y?-1:0,E=u.z<d.z?1:u.z>d.z?-1:0,C=Math.max(g,f,m);for(let M=0;M<=C;M++)y.push({x:u.x+_*M,y:u.y+z*M,z:u.z+E*M})}else{const _=Math.min(u.x,d.x),z=Math.max(u.x,d.x),E=Math.min(u.y,d.y),C=Math.max(u.y,d.y),M=Math.min(u.z,d.z),S=Math.max(u.z,d.z);for(let k=_;k<=z;k++)for(let A=E;A<=C;A++)for(let B=M;B<=S;B++)y.push({x:k,y:A,z:B})}return y};this.inputManager.onPlace=(u,d)=>{if(!u)return;if(!this.canEditCurrentLayer()){this.showNotification("Layer is locked or hidden","warning");return}let y=t(u,this.currentBlockType);if(y=e(y,this.currentBlockScale),d&&o){const m=n(o,y);let b=!1;for(const v of m){if(this.blockManager.wouldOverlapAt(this.currentBlockType,v,{w:1,h:1,d:1},null,this.currentBlockScale))continue;const x={type:this.currentBlockType,position:{...v},color:this.currentColor,rotation:{x:0,y:this.currentRotation,z:0},layerId:this.getActiveLayerId(),scale:this.currentBlockScale,emissive:{enabled:this.emissiveEnabled,color:this.emissiveColor,intensity:this.emissiveIntensity,radius:this.emissiveRadius}},_=this.blockManager.addBlock(x);_&&(this.history.push(Us(this.blockManager,x,_)),b=!0)}b&&(o={...y});return}if(this.blockManager.wouldOverlapAt(this.currentBlockType,y,{w:1,h:1,d:1},null,this.currentBlockScale))return;const g={type:this.currentBlockType,position:y,color:this.currentColor,rotation:{x:0,y:this.currentRotation,z:0},layerId:this.getActiveLayerId(),scale:this.currentBlockScale,emissive:{enabled:this.emissiveEnabled,color:this.emissiveColor,intensity:this.emissiveIntensity,radius:this.emissiveRadius}},f=this.blockManager.addBlock(g);f&&(this.history.push(Us(this.blockManager,g,f)),o={...y})},this.inputManager.onDelete=u=>{u&&(this.history.push(Xc(this.blockManager,u)),this.blockManager.removeBlock(u.id))},this.inputManager.onSelect=(u,d)=>{d&&u?this.blockManager.toggleSelection(u):this.blockManager.selectBlock(u),this.updateSelectionUI()};const s=(u,d)=>{const y=new oo(Me.degToRad(d.rotation.x),Me.degToRad(d.rotation.y),Me.degToRad(d.rotation.z)),f=new Mo().setFromEuler(y).clone().invert(),m=u.clone().applyQuaternion(f);return this.facePainter.getFaceFromNormal(m)};let r=null,a=[],l=!1,c=0;const p=(u,d)=>{const y=this.paintMode==="face"&&!u.supportsPerFacePainting();if(y){const g=Date.now();if(g-c>2e3){c=g;const f=document.getElementById("tool-hint"),m=f.textContent;f.textContent=`Complex block "${u.type}" - painting entire block (face mode not supported)`,f.style.color="#ffaa00",setTimeout(()=>{f.textContent=m,f.style.color=""},2e3)}}if(this.paintMode==="block"||y){const g=u.color,f={};return Object.entries(u.faces).forEach(([m,b])=>{b&&b.color&&(f[m]={color:b.color})}),u.setColor(this.currentColor),Kw(u,g,this.currentColor,f)}else{const g=s(d,u),f=u.getFaceColor(g),m=u.faces[g]&&u.faces[g].color!==null;return u.setFaceColor(g,this.currentColor),jw(u,g,m?f:null,this.currentColor)}},h=(u,d,y)=>{const g=[],f=Math.abs(d.x-u.x),m=Math.abs(d.y-u.y),b=Math.abs(d.z-u.z);let v,x,_,z;f>=m&&f>=b?(v=f,x=u.x<d.x?1:-1,_=0,z=0):m>=f&&m>=b?(v=m,x=0,_=u.y<d.y?1:-1,z=0):(v=b,x=0,_=0,z=u.z<d.z?1:-1);for(let E=0;E<=v;E++){const C={x:u.x+x*E,y:u.y+_*E,z:u.z+z*E},M=this.blockManager.getBlockAtPosition(C);M&&g.push({block:M,normal:y})}return g};this.inputManager.onPaint=(u,d)=>{if(!u||!u.block)return;const y=u.block.gridPosition;if(d&&r){const g=h(r,y,u.normal),f=[];g.forEach(({block:m,normal:b})=>{const v=p(m,b);f.push(v)}),f.length>0&&this.history.push(_0(f))}else{const g=p(u.block,u.normal);this.inputManager.isPainting&&!l?(l=!0,a=[g]):this.inputManager.isPainting&&l?a.push(g):this.history.push(g)}r={...y},u.normal.clone()},this.canvas.onmouseup,this.canvas.addEventListener("mouseup",()=>{l&&a.length>0&&(a.length===1?this.history.push(a[0]):this.history.push(_0(a)),a=[]),l=!1}),this.inputManager.onPick=u=>{if(u&&u.block){const d=s(u.normal,u.block);this.currentColor=u.block.getFaceColor(d),this.colorInput.value=this.currentColor,this.updateColorSwatchSelection()}},this.inputManager.onPickBlock=u=>{this.pickBlock(u)},this.inputManager.onReplace=u=>{if(!u)return;const d=u.gridPosition;this.history.push(Xc(this.blockManager,u)),this.blockManager.removeBlock(u.id);const y=this.emissiveEnabled?{enabled:!0,color:this.emissiveColor,intensity:this.emissiveIntensity,radius:this.emissiveRadius}:null,g={type:this.currentBlockType,position:{x:d.x,y:d.y,z:d.z},color:this.currentColor,rotation:{x:0,y:this.currentRotation,z:0},emissive:y},f=this.blockManager.addBlock(g);f&&this.history.push(Us(this.blockManager,g,f))}}findMaterialIdByColor(t){for(const e of this.textureManager.getColorMaterials())if(e.baseColor.toLowerCase()===t.toLowerCase())return e.id;return null}setupToolbar(){document.querySelectorAll(".tool").forEach(r=>{r.addEventListener("click",()=>{const a=r.dataset.tool;this.setTool(a)})}),this.generateBlockPalette(),this.setupBlockSearch(),document.getElementById("btn-rotate").addEventListener("click",()=>{this.rotateBlock()});const t=document.getElementById("btn-scale-1x"),e=document.getElementById("btn-scale-2x"),o=document.getElementById("btn-scale-4x"),n=[t,e,o],s=r=>{n.forEach(a=>a.classList.remove("active")),r.classList.add("active")};t.addEventListener("click",()=>{this.setBlockScale(1),s(t)}),e.addEventListener("click",()=>{this.setBlockScale(2),s(e)}),o.addEventListener("click",()=>{this.setBlockScale(4),s(o)})}setBlockScale(t){this.currentBlockScale=t,this.ghostBlock.setScale(t)}generateBlockPalette(){const t=document.getElementById("block-palette");if(!t)return;t.innerHTML="";const e=["decorative","details","architectural","furniture","storage","industrial","electrical","natural","modern","medieval"];for(const[o,n]of Object.entries(Ic)){const s=document.createElement("div");s.className="block-category",e.includes(o)&&s.classList.add("collapsed");const r=document.createElement("div");r.className="block-category-header",r.innerHTML=`
        <span class="arrow"></span>
        <span class="label">${n.label}</span>
        <span class="count">${n.types.length}</span>
      `,r.addEventListener("click",()=>{s.classList.toggle("collapsed")}),s.appendChild(r);const a=document.createElement("div");a.className="block-category-content";for(const l of n.types){const c=n0[l]||{icon:"?",label:l},p=document.createElement("button");p.className="block-type",p.dataset.type=l,p.title=c.label,p.textContent=c.icon,l==="cube"&&p.classList.add("active"),p.addEventListener("click",()=>{this.setBlockType(l)}),a.appendChild(p)}s.appendChild(a),t.appendChild(s)}}setupBlockSearch(){const t=document.getElementById("block-search");t&&(t.addEventListener("input",e=>{this.filterBlocks(e.target.value)}),t.addEventListener("keydown",e=>{e.key==="Escape"&&(t.value="",this.filterBlocks(""),t.blur())}))}filterBlocks(t){const e=t.toLowerCase().trim();document.querySelectorAll(".block-category").forEach(n=>{const s=n.querySelectorAll(".block-type");let r=!1;s.forEach(a=>{const l=a.dataset.type,p=(n0[l]||{label:l}).label.toLowerCase(),h=!e||l.toLowerCase().includes(e)||p.includes(e);a.classList.toggle("search-hidden",!h),h&&(r=!0)}),n.classList.toggle("search-hidden",!r),n.classList.toggle("search-match",r&&e.length>0)})}setTool(t){this.inputManager.setTool(t),document.querySelectorAll(".tool").forEach(a=>{a.classList.toggle("active",a.dataset.tool===t)}),t!=="place"&&t!=="shape"&&this.ghostBlock.hide();const e=document.getElementById("shape-section");e&&(e.style.display=t==="shape"?"":"none");const o=document.getElementById("paint-section");o&&(o.style.display=t==="paint"?"":"none");const n=document.getElementById("scatter-section");n&&(n.style.display=t==="scatter"?"":"none"),t!=="shape"&&this.clearShapeGhosts();const r={place:"Left-click: place | Alt+click: pick block | Ctrl+click: replace",delete:"Left-click: delete | Alt+click: pick block",select:"Left-click: select | Shift+click: add | +/-: keyframe | Space: play",paint:`Click+drag: ${this.paintMode==="block"?"paint block":"paint face"} | Shift+click: paint line | Alt+click: pick block`,pick:"Left-click: pick color | Alt+click: pick block",shape:"Click+drag: define shape size | Release: place blocks",scatter:"Click: generate organic structure from point"};document.getElementById("tool-hint").textContent=r[t]||""}setBlockType(t){this.currentBlockType=t,document.querySelectorAll(".block-type").forEach(e=>{e.classList.toggle("active",e.dataset.type===t)})}rotateBlock(){this.currentRotation=(this.currentRotation+90)%360;const t=this.blockManager.getSelectedBlocks();for(const e of t)e.rotateY(90);t.length>0&&this.updateSelectionUI()}setupPaintMode(){document.querySelectorAll(".paint-mode").forEach(t=>{t.addEventListener("click",()=>{this.paintMode=t.dataset.mode,document.querySelectorAll(".paint-mode").forEach(e=>{e.classList.toggle("active",e.dataset.mode===this.paintMode)}),this.setTool("paint")})})}pickBlock(t){t&&(this.setTool("place"),this.setBlockType(t.type),this.currentColor=t.color,this.colorInput.value=t.color,this.currentRotation=t.rotation.y,this.ghostBlock.setBlockType(t.type),this.ghostBlock.setColor(t.color),this.ghostBlock.setRotation(this.currentRotation))}setupShapeBrush(){document.querySelectorAll(".shape-type").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.shape;this.currentShape=e,document.querySelectorAll(".shape-type").forEach(o=>{o.classList.toggle("active",o.dataset.shape===e)})})}),this.inputManager.onShapeDrag=(t,e)=>{this.updateShapePreview(t,e)},this.inputManager.onShapePlace=(t,e)=>{this.placeShape(t,e),this.clearShapeGhosts()}}updateShapePreview(t,e){this.clearShapeGhosts();const o=T0(this.currentShape,t,e),n=500,s=o.slice(0,n),r=new Ri({color:this.currentColor,transparent:!0,opacity:.4,side:Ze}),a=new I(.95,.95,.95);s.forEach(c=>{const p=new ge(a,r);p.position.set(c.x+.5,c.y+.5,c.z+.5),this.engine.scene.add(p),this.shapeGhosts.push(p)});const l=document.getElementById("tool-hint");o.length>n?l.textContent=`Shape: ${o.length} blocks (showing ${n}) | Release to place`:l.textContent=`Shape: ${o.length} blocks | Release to place`}clearShapeGhosts(){this.shapeGhosts.forEach(t=>{this.engine.scene.remove(t),t.geometry.dispose(),t.material.dispose()}),this.shapeGhosts=[]}placeShape(t,e){if(!this.canEditCurrentLayer()){this.showNotification("Layer is locked or hidden","warning");return}const o=T0(this.currentShape,t,e),n=1e3;if(o.length>n){alert(`Shape too large (${o.length} blocks). Maximum is ${n}.`);return}const s=this.emissiveEnabled?{color:this.emissiveColor,intensity:this.emissiveIntensity,radius:this.emissiveRadius}:null,r=[];if(o.forEach(a=>{if(!this.blockManager.wouldOverlapAt(this.currentBlockType,a,{w:1,h:1,d:1})){const l={type:this.currentBlockType,position:{...a},color:this.currentColor,rotation:{x:0,y:this.currentRotation,z:0},layerId:this.getActiveLayerId(),emissive:s},c=this.blockManager.addBlock(l);c&&r.push(c)}}),r.length>0){const a=r.map(l=>l.id);this.history.push({undo:()=>{a.forEach(l=>this.blockManager.removeBlock(l))},redo:()=>{o.forEach(l=>{this.blockManager.wouldOverlapAt(this.currentBlockType,l,{w:1,h:1,d:1})||this.blockManager.addBlock({type:this.currentBlockType,position:{...l},color:this.currentColor,rotation:{x:0,y:this.currentRotation,z:0},emissive:s})})}})}}setupScatterTool(){const t=document.getElementById("scatter-preset");Object.keys(Da).forEach(p=>{const h=document.createElement("option");h.value=p,h.textContent=Da[p].label||p,t.appendChild(h)}),t.addEventListener("change",p=>{this.scatterTool.setPreset(p.target.value)});const e=document.getElementById("scatter-algorithm");Object.keys(Ia).forEach(p=>{const h=document.createElement("option");h.value=p,h.textContent=Ia[p].label,h.title=Ia[p].description,e.appendChild(h)}),e.addEventListener("change",p=>{this.scatterTool.setAlgorithm(p.target.value)});const o=document.getElementById("scatter-count"),n=document.getElementById("scatter-count-val");o.addEventListener("input",p=>{const h=parseInt(p.target.value);this.scatterTool.setMaxBlocks(h),n.textContent=h});const s=document.getElementById("scatter-branch"),r=document.getElementById("scatter-branch-val");s.addEventListener("input",p=>{const h=parseFloat(p.target.value);this.scatterTool.setBranchChance(h),r.textContent=Math.round(h*100)+"%"});const a=document.getElementById("scatter-scale-ratio"),l=document.getElementById("scatter-scale-ratio-val");a.addEventListener("input",p=>{const h=parseFloat(p.target.value);this.scatterTool.setScaleRatio(h);const u=Math.round((.3+h*.7)*100),d=Math.round(Math.max(0,(1-h)*.3)*100),y=100-u-d;d>0?l.textContent=`${u}% 1 / ${y}% 2 / ${d}% 4`:l.textContent=`${u}% 1 / ${y}% 2`}),document.getElementById("scatter-harmony").addEventListener("change",p=>{this.scatterTool.setColorHarmony(p.target.value)}),this.inputManager.onScatterPlace=p=>{this.executeScatter(p)}}executeScatter(t){if(!this.canEditCurrentLayer()){this.showNotification("Layer is locked or hidden","warning");return}const e=t.placementPosition,o=this.scatterTool.generate(e,{baseColor:this.currentColor});if(o.length===0){this.showNotification("No blocks generated","warning");return}const n=[],s=[];if(o.forEach(r=>{if(!this.blockManager.wouldOverlapAt(r.type,r.position,{w:1,h:1,d:1},null,r.scale)){const a={type:r.type,position:{...r.position},color:r.color,rotation:r.rotation,scale:r.scale,layerId:this.getActiveLayerId()},l=this.blockManager.addBlock(a);l&&(n.push(l),s.push(a))}}),n.length>0){const r=n.map(a=>a.id);this.history.push({undo:()=>{r.forEach(a=>this.blockManager.removeBlock(a))},redo:()=>{s.forEach(a=>{this.blockManager.wouldOverlapAt(a.type,a.position,{w:1,h:1,d:1},null,a.scale)||this.blockManager.addBlock(a)})}}),this.showNotification(`Scattered ${n.length} blocks`,"success")}}moveSelectedBlocks(t,e,o){const n=this.blockManager.getSelectedBlocks();if(n.length===0)return;const s=new Set(n.map(r=>r.id));for(const r of n){const a={x:r.gridPosition.x+t,y:r.gridPosition.y+e,z:r.gridPosition.z+o};if(this.blockManager.wouldOverlapAt(r.type,a,r.dimensions,s))return}for(const r of n){const a={x:r.gridPosition.x+t,y:r.gridPosition.y+e,z:r.gridPosition.z+o};r.setPosition(a)}this.updateSelectionUI()}moveSelectedBlock(t,e,o){this.moveSelectedBlocks(t,e,o)}setupMoveControls(){document.querySelectorAll(".move-btn").forEach(t=>{t.addEventListener("click",()=>{switch(t.dataset.dir){case"up":this.moveSelectedBlock(0,0,-1);break;case"down":this.moveSelectedBlock(0,0,1);break;case"left":this.moveSelectedBlock(-1,0,0);break;case"right":this.moveSelectedBlock(1,0,0);break;case"raise":this.moveSelectedBlock(0,1,0);break;case"lower":this.moveSelectedBlock(0,-1,0);break}})})}setupColorPalette(){["#ffffff","#d0d0d0","#a0a0a0","#707070","#404040","#1a1a1a","#000000","#ffcccc","#ff6666","#e74c3c","#c0392b","#8b0000","#4a0000","#ffe0cc","#ffaa66","#e67e22","#d35400","#a04000","#602800","#ffffcc","#ffff66","#f1c40f","#d4ac0d","#b8860b","#806000","#ccffcc","#66ff66","#2ecc71","#27ae60","#1e8449","#145a32","#ccffff","#66ffff","#1abc9c","#16a085","#0e6655","#0a4a3a","#cce0ff","#66b3ff","#3498db","#2980b9","#1a5276","#0d2840","#e0ccff","#b366ff","#9b59b6","#8e44ad","#6c3483","#4a235a","#ffccee","#ff66cc","#e91e63","#c2185b","#880e4f","#4a0728","#e6d5c3","#c4a484","#a0522d","#795548","#5d4037","#3e2723","#ffd700","#c0c0c0","#cd7f32","#b87333","#4682b4","#708090"].forEach(e=>{const o=document.createElement("div");o.className="color-swatch",o.style.background=e,o.addEventListener("click",()=>{this.currentColor=e,this.colorInput.value=e,this.updateColorSwatchSelection()}),this.colorPalette.appendChild(o)}),this.colorInput.addEventListener("input",e=>{this.currentColor=e.target.value,this.updateColorSwatchSelection()}),this.updateColorSwatchSelection()}setupEmissiveControls(){const t=document.getElementById("emissive-enabled"),e=document.getElementById("emissive-color"),o=document.getElementById("emissive-intensity"),n=document.getElementById("emissive-intensity-val"),s=document.getElementById("emissive-radius"),r=document.getElementById("emissive-radius-val");t.addEventListener("change",a=>{this.emissiveEnabled=a.target.checked,this.ghostBlock.setColor(this.emissiveEnabled?this.emissiveColor:this.currentColor)}),e.addEventListener("input",a=>{this.emissiveColor=a.target.value,this.emissiveEnabled&&this.ghostBlock.setColor(this.emissiveColor)}),o.addEventListener("input",a=>{this.emissiveIntensity=parseFloat(a.target.value),n.textContent=this.emissiveIntensity.toFixed(1)}),s.addEventListener("input",a=>{this.emissiveRadius=parseFloat(a.target.value),r.textContent=this.emissiveRadius.toFixed(1)})}setupEdgeControls(){const t=document.getElementById("show-edges"),e=document.getElementById("edge-opacity");t.addEventListener("change",o=>{this.showEdges=o.target.checked,this.updateAllBlockEdges()}),e.addEventListener("input",o=>{this.edgeOpacity=parseFloat(o.target.value),this.updateAllBlockEdges()})}updateAllBlockEdges(){for(const t of this.blockManager.getAllBlocks())t.setEdgesVisible(this.showEdges),t.setEdgesOpacity(this.edgeOpacity)}setupLayerPanel(){document.getElementById("btn-add-layer").addEventListener("click",()=>{const e=prompt("Layer name:",`Layer ${this.layerManager.layers.size}`);if(e){const o=this.layerManager.generateLayerId();this.layerManager.createLayer(o,e),this.layerManager.setActiveLayer(o)}}),this.updateLayerUI()}updateLayerUI(){const t=document.getElementById("layer-list");if(!t)return;t.innerHTML="";const e=this.layerManager.getAllLayers(),o=this.layerManager.activeLayerId;e.forEach(n=>{const s=document.createElement("div");s.className="layer-item"+(n.id===o?" active":""),s.innerHTML=`
        <div class="layer-color" style="background: ${n.color}"></div>
        <span class="layer-name">${n.name}</span>
        <div class="layer-controls">
          <button class="layer-btn ${n.visible?"":"off"}" data-action="visibility" title="Toggle Visibility">
            ${n.visible?"":""}
          </button>
          <button class="layer-btn ${n.locked?"locked":""}" data-action="lock" title="Toggle Lock">
            ${n.locked?"":""}
          </button>
        </div>
      `,s.addEventListener("click",r=>{r.target.closest(".layer-btn")||this.layerManager.setActiveLayer(n.id)}),s.addEventListener("dblclick",r=>{if(r.target.closest(".layer-btn"))return;const a=prompt("Rename layer:",n.name);a&&this.layerManager.setLayerName(n.id,a)}),s.querySelector('[data-action="visibility"]').addEventListener("click",r=>{r.stopPropagation(),this.layerManager.setLayerVisible(n.id,!n.visible),this.updateBlockVisibility()}),s.querySelector('[data-action="lock"]').addEventListener("click",r=>{r.stopPropagation(),this.layerManager.setLayerLocked(n.id,!n.locked)}),t.appendChild(s)})}updateBlockVisibility(){for(const t of this.blockManager.getAllBlocks()){const e=this.layerManager.isLayerVisible(t.layerId);t.mesh.visible=e}}getActiveLayerId(){return this.layerManager.activeLayerId}canEditCurrentLayer(){return this.layerManager.canEditLayer(this.layerManager.activeLayerId)}setupSymmetryTools(){document.getElementById("btn-mirror-x").addEventListener("click",()=>{this.mirrorSelectedBlocks("x")}),document.getElementById("btn-mirror-y").addEventListener("click",()=>{this.mirrorSelectedBlocks("y")}),document.getElementById("btn-mirror-z").addEventListener("click",()=>{this.mirrorSelectedBlocks("z")})}mirrorSelectedBlocks(t){if(this.blockManager.getSelectedBlocks().length===0){this.showNotification("Select blocks to mirror","warning");return}const o=this.symmetryTool.mirrorSelectedBlocks(t,!0);if(o.length>0){this.showNotification(`Mirrored ${o.length} block(s) across ${t.toUpperCase()} axis`,"success");const n=o.map(s=>s.id);this.history.push({undo:()=>{n.forEach(s=>this.blockManager.removeBlock(s))},redo:()=>{this.symmetryTool.mirrorSelectedBlocks(t,!0)}})}else this.showNotification("Could not mirror - blocks may overlap","warning")}setupCameraBookmarks(){document.querySelectorAll(".preset-btn").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.preset;this.cameraBookmarks.goToPreset(e)})}),document.getElementById("btn-save-view").addEventListener("click",()=>{const t=prompt("Bookmark name:",`View ${this.cameraBookmarks.bookmarks.size+1}`);t&&(this.cameraBookmarks.saveBookmark(t),this.showNotification(`View "${t}" saved`,"success"))}),this.updateCameraBookmarksUI()}updateCameraBookmarksUI(){const t=document.getElementById("camera-bookmarks");if(!t)return;t.innerHTML="",this.cameraBookmarks.getAllBookmarks().forEach(o=>{const n=document.createElement("div");n.className="bookmark-item",n.innerHTML=`
        <span class="bookmark-name">${o.name}</span>
        <button class="bookmark-delete" title="Delete">&times;</button>
      `,n.addEventListener("click",s=>{s.target.closest(".bookmark-delete")||this.cameraBookmarks.restoreBookmark(o.id)}),n.addEventListener("dblclick",s=>{if(s.target.closest(".bookmark-delete"))return;const r=prompt("Rename bookmark:",o.name);r&&this.cameraBookmarks.renameBookmark(o.id,r)}),n.querySelector(".bookmark-delete").addEventListener("click",s=>{s.stopPropagation(),this.cameraBookmarks.deleteBookmark(o.id)}),t.appendChild(n)})}setupCameraAnimation(){const t=document.getElementById("camera-anim-frames"),e=document.getElementById("camera-anim-fps"),o=document.getElementById("camera-anim-curve"),n=document.getElementById("camera-anim-duration"),s=document.getElementById("btn-camera-preview"),r=document.getElementById("btn-camera-export-jpg"),a=document.getElementById("btn-camera-export-mp4"),l=document.getElementById("camera-anim-progress"),c=document.getElementById("camera-anim-progress-bar"),p=document.getElementById("camera-anim-progress-text"),h=()=>{const u=parseInt(t.value),d=parseInt(e.value),y=(u/d).toFixed(1);n.textContent=`${y}s`};t.addEventListener("input",h),e.addEventListener("input",h),o.addEventListener("change",()=>{this.cameraPathAnimator.curveType=o.value}),s.addEventListener("click",()=>{const u=this.cameraBookmarks.getAllBookmarks();if(u.length<2){this.showNotification("Save at least 2 camera views to preview animation","warning",3e3);return}const d=parseInt(t.value),y=parseInt(e.value),g=d/y*1e3;this.showNotification("Previewing camera animation...","info",2e3),this.cameraPathAnimator.preview(u,g,()=>{this.showNotification("Preview complete","success",2e3)})}),r.addEventListener("click",async()=>{const u=this.cameraBookmarks.getAllBookmarks();if(u.length<2){this.showNotification("Save at least 2 camera views to export animation","warning",3e3);return}const d=parseInt(t.value);parseInt(e.value),r.disabled=!0,a.disabled=!0,s.disabled=!0,l.style.display="block",c.style.width="0%",p.textContent="0%";try{this.showNotification(`Rendering ${d} frames...`,"info");const y=await this.frameSequencer.captureSequence({animator:this.cameraPathAnimator,bookmarks:u,totalFrames:d,onProgress:f=>{c.style.width=`${f.percent}%`,p.textContent=`${f.percent}% (${f.current}/${f.total})`}});this.showNotification("Creating ZIP archive...","info"),await this.frameSequencer.exportAsZip(y);const g=this.frameSequencer.getMemoryUsage();this.showNotification(`Exported ${d} frames (${g}MB)`,"success",4e3),this.frameSequencer.clear()}catch(y){console.error("Export failed:",y),this.showNotification(`Export failed: ${y.message}`,"error",4e3)}finally{r.disabled=!1,a.disabled=!1,s.disabled=!1,l.style.display="none"}}),a.addEventListener("click",async()=>{const u=this.cameraBookmarks.getAllBookmarks();if(u.length<2){this.showNotification("Save at least 2 camera views to export video","warning",3e3);return}const d=parseInt(t.value),y=parseInt(e.value),g=d/y*1e3;r.disabled=!0,a.disabled=!0,s.disabled=!0,l.style.display="block",c.style.width="0%",p.textContent="Starting...";try{const f=Math.floor(g/1e3*y);this.showNotification(`Rendering ${f} frames for video...`,"info"),await this.frameSequencer.exportAsMP4Realtime(this.cameraPathAnimator,u,g,"camera_path.webm",m=>{c.style.width=`${m.percent}%`,p.textContent=`${m.percent}% (${m.current}/${m.total})`}),this.showNotification("Video exported successfully","success",3e3)}catch(f){console.error("Video export failed:",f),this.showNotification(`Video export failed: ${f.message}`,"error",4e3)}finally{r.disabled=!1,a.disabled=!1,s.disabled=!1,l.style.display="none"}})}setupTattooMode(){const t=document.getElementById("tattoo-enabled"),e=document.getElementById("gpu-acceleration"),o=document.getElementById("render-style"),n=document.getElementById("tattoo-inverted"),s=document.getElementById("tattoo-grayscale"),r=document.getElementById("tattoo-fills"),a=document.getElementById("render-quality"),l=document.getElementById("tattoo-threshold"),c=document.getElementById("tattoo-threshold-val"),p=document.getElementById("tattoo-line-width"),h=document.getElementById("tattoo-line-width-val"),u=document.getElementById("btn-tattoo-png"),d=document.getElementById("btn-tattoo-svg");e.checked=this.useGPURenderer,e.addEventListener("change",g=>{const f=this.tattooRenderer.enabled;f&&this.tattooRenderer.setEnabled(!1),this.tattooRenderer.dispose&&this.tattooRenderer.dispose(),this.useGPURenderer=g.target.checked;try{this.useGPURenderer?(this.tattooRenderer=new U0(this.engine,this.blockManager),this.showNotification("GPU acceleration enabled","success",2e3)):(this.tattooRenderer=new na(this.engine,this.blockManager),this.showNotification("CPU rendering enabled","info",2e3))}catch(m){console.warn("Renderer switch failed:",m),this.tattooRenderer=new na(this.engine,this.blockManager),e.checked=!1,this.useGPURenderer=!1,this.showNotification("GPU not available, using CPU","warning",3e3)}f&&(this.tattooRenderer.setStyle(o.value),this.tattooRenderer.setInverted(n.checked),this.tattooRenderer.setGrayscale(s.checked),this.tattooRenderer.setShowFills(r.checked),this.tattooRenderer.setQuality(a.value),this.tattooRenderer.setEnabled(!0))}),t.addEventListener("change",g=>{if(this.tattooRenderer.setEnabled(g.target.checked),g.target.checked){const f=this.useGPURenderer?"GPU":"CPU";this.showNotification(`Stylized view enabled (${f})`,"info",2e3)}}),o.addEventListener("change",g=>{this.tattooRenderer.setStyle(g.target.value)}),n.addEventListener("change",g=>{this.tattooRenderer.setInverted(g.target.checked)}),s.addEventListener("change",g=>{this.tattooRenderer.setGrayscale(g.target.checked)}),r.addEventListener("change",g=>{this.tattooRenderer.setShowFills(g.target.checked)}),a.addEventListener("change",g=>{this.tattooRenderer.setQuality(g.target.value)}),l.addEventListener("input",g=>{const f=parseFloat(g.target.value);this.tattooRenderer.setThreshold(f),c.textContent=f.toFixed(2)}),p.addEventListener("input",g=>{const f=parseFloat(g.target.value);this.tattooRenderer.setLineWidth(f),h.textContent=f.toFixed(1)}),u.addEventListener("click",()=>{this.tattooRenderer.capturePNG("tattoo-design.png"),this.showNotification("PNG saved","success",2e3)}),d.addEventListener("click",()=>{this.tattooRenderer.exportSVG("tattoo-design.svg"),this.showNotification("SVG exported","success",2e3)}),document.getElementById("btn-flatten").addEventListener("click",()=>{this.flattenBlocks()})}flattenBlocks(){const t=this.blockManager.getAllBlocks();if(t.length===0){this.showNotification("No blocks to flatten","warning",2e3);return}const e=t.map(n=>n.toJSON()),o=this.blockFlattener.flattenAndApply();if(o.mergedCount>0){const n=o.mergedMeshes.map(s=>s.id);this.history.push(Jw(this.blockManager,e,n)),this.showNotification(`Flattened ${o.blocksRemoved} blocks into ${o.mergedCount} merged mesh(es)`,"success",3e3),this.updateBlockCount(),this.debouncedAutoSave(),this.tattooRenderer.enabled&&this.tattooRenderer.render()}else this.showNotification("No blocks were flattened","info",2e3)}updateColorSwatchSelection(){document.querySelectorAll(".color-swatch").forEach(t=>{const e=this.rgbToHex(t.style.background);t.classList.toggle("active",e===this.currentColor.toLowerCase())})}rgbToHex(t){if(t.startsWith("#"))return t.toLowerCase();const e=t.match(/\d+/g);return e?"#"+e.slice(0,3).map(o=>{const n=parseInt(o).toString(16);return n.length===1?"0"+n:n}).join(""):t}generateColorPalette(){var p;const t=new Set;for(const h of this.blockManager.getAllBlocks())t.add(h.color.toLowerCase()),(p=h.emissive)!=null&&p.enabled&&t.add(h.emissive.color.toLowerCase());const e=Array.from(t),o=32,n=8,s=Math.ceil(e.length/n),r=n*o,a=Math.max(s*o+20,o+20),l=document.createElement("canvas");l.width=r,l.height=a;const c=l.getContext("2d");return c.fillStyle="#1a1a1a",c.fillRect(0,0,r,a),c.fillStyle="#ffffff",c.font="12px monospace",c.fillText(`Color Palette (${e.length} colors)`,4,14),e.forEach((h,u)=>{const d=u%n,y=Math.floor(u/n),g=d*o,f=20+y*o;c.fillStyle=h,c.fillRect(g+2,f+2,o-4,o-4),c.strokeStyle="#333333",c.strokeRect(g+2,f+2,o-4,o-4)}),l}updateSelectionUI(t=null){const e=this.blockManager.getSelectedBlocks(),o=e.length;if(o===0){this.selectionProps.style.display="none";return}if(this.selectionProps.style.display="block",o===1){const n=e[0];document.getElementById("prop-type").textContent=n.type,document.getElementById("prop-position").textContent=`${n.gridPosition.x}, ${n.gridPosition.y}, ${n.gridPosition.z}`,document.getElementById("prop-rotation").textContent=`${n.rotation.y}`}else document.getElementById("prop-type").textContent=`${o} blocks`,document.getElementById("prop-position").textContent="multiple",document.getElementById("prop-rotation").textContent="various";document.getElementById("btn-copy").onclick=()=>{o===1?this.clipboard=e[0].toJSON():this.clipboard=e.map(n=>n.toJSON())},document.getElementById("btn-delete-sel").onclick=()=>{this.deleteSelectedBlocks()},this.updateKeyframeMarkers()}deleteSelectedBlocks(){const t=this.blockManager.getSelectedBlocks();if(t.length!==0){for(const e of t)this.history.push(Xc(this.blockManager,e)),this.blockManager.removeBlock(e.id);this.updateSelectionUI()}}setupMenuBar(){document.getElementById("btn-new").addEventListener("click",()=>{confirm("Create new project? Unsaved changes will be lost.")&&(this.projectManager.newProject(),this.updateAnimationSelect(),this.updateLayerUI())}),document.getElementById("btn-save").addEventListener("click",()=>{this.projectManager.save()}),document.getElementById("btn-load").addEventListener("click",()=>{this.fileInput.click()}),document.getElementById("btn-clear").addEventListener("click",()=>{this.clearProject()}),this.setupTemplateMenu(),this.fileInput.addEventListener("change",async n=>{const s=n.target.files[0];if(s)try{await this.projectManager.load(s),this.updateAnimationSelect(),this.updateLayerUI(),this.updateBlockVisibility(),this.showNotification(`Project "${this.projectManager.currentProjectName}" loaded successfully`,"success")}catch{}this.fileInput.value=""}),document.getElementById("btn-export").addEventListener("click",()=>{this.showExportModal()}),this.setupExportModal(),document.getElementById("btn-bake").addEventListener("click",()=>{const n=this.blockManager.getAllBlocks().filter(u=>{var d;return(d=u.emissive)==null?void 0:d.enabled});if(n.length===0){alert('No emissive blocks found. Add blocks with "Enable Glow" checked to bake lighting.');return}console.log("Starting texture-based light bake...");const s=performance.now(),{texture:r,uvData:a,atlasWidth:l,atlasHeight:c}=this.textureBaker.bake(this.blockManager);this.bakedTexture=r,this.bakedUVData=a;const p=this.lightBaker.bake(this.blockManager);this.lightBaker.apply(this.blockManager,p);const h=(performance.now()-s).toFixed(1);console.log(`Light bake completed in ${h}ms (atlas: ${l}x${c})`),alert(`Lighting baked from ${n.length} emissive block(s) in ${h}ms.
Texture atlas: ${l}x${c}
Export to see the result in Blender/Godot.`)}),document.getElementById("btn-clear-bake").addEventListener("click",()=>{this.lightBaker.clear(this.blockManager),this.bakedTexture=null,this.bakedUVData=null,console.log("Baked lighting cleared")}),document.getElementById("btn-undo").addEventListener("click",()=>{this.history.undo()}),document.getElementById("btn-redo").addEventListener("click",()=>{this.history.redo()});const t=document.getElementById("timeline-panel"),e=document.getElementById("btn-toggle-timeline");localStorage.getItem("timelineHidden")==="true"?(t.style.display="none",e.classList.remove("active")):e.classList.add("active"),e.addEventListener("click",()=>{const n=t.style.display==="none";t.style.display=n?"":"none",e.classList.toggle("active",n),localStorage.setItem("timelineHidden",!n)})}toggleUIVisibility(){this.uiHidden===void 0&&(this.uiHidden=!1),this.uiHidden=!this.uiHidden;const t=this.uiHidden?"none":"";["menubar","toolbar","right-panel","timeline-panel","info"].forEach(o=>{const n=document.getElementById(o);n&&(n.style.display=t)}),localStorage.setItem("uiHidden",this.uiHidden),this.uiHidden&&this.showNotification("UI hidden. Press U to restore.","info",3e3)}setupTimeline(){const t=document.getElementById("anim-select"),e=document.getElementById("timeline-slider"),o=document.getElementById("time-display"),n=document.getElementById("anim-loop");document.getElementById("keyframes-container");const s=document.getElementById("anim-duration"),r=document.getElementById("anim-speed"),a=document.getElementById("anim-curve");document.getElementById("btn-add-anim").addEventListener("click",()=>{const l=prompt("Animation name:","Animation");if(l){const c=parseInt(s.value)||2e3,p=this.animator.createAnimation(l,c);this.updateAnimationSelect(),t.value=p.id,this.animator.setCurrentAnimation(p.id),e.max=p.duration,this.showNotification(`Created animation "${l}"`,"success",2e3)}}),document.getElementById("btn-delete-anim").addEventListener("click",()=>{if(this.animator.currentAnimation){const l=this.animator.currentAnimation.name;confirm(`Delete animation "${l}"?`)&&(this.animator.deleteAnimation(this.animator.currentAnimation.id),this.updateAnimationSelect(),t.value="",this.updateKeyframeMarkers(),this.showNotification(`Deleted animation "${l}"`,"info",2e3))}else this.showNotification("No animation selected","warning",2e3)}),t.addEventListener("change",()=>{const l=t.value;if(l){this.animator.setCurrentAnimation(l);const c=this.animator.currentAnimation;e.max=c.duration,s.value=c.duration,n.checked=c.loop,a.value=c.curve||"easeInOut",this.updateKeyframeMarkers()}else this.animator.currentAnimation=null,this.updateKeyframeMarkers()}),s.addEventListener("change",()=>{if(this.animator.currentAnimation){const l=Math.max(100,parseInt(s.value)||2e3);s.value=l,this.animator.currentAnimation.duration=l,e.max=l,this.updateKeyframeMarkers()}}),r.addEventListener("change",()=>{this.animator.playbackSpeed=parseFloat(r.value)}),document.getElementById("btn-play").addEventListener("click",()=>{this.animator.isPlaying?this.animator.pause():this.animator.play()}),document.getElementById("btn-stop").addEventListener("click",()=>{this.animator.stop()}),n.addEventListener("change",()=>{this.animator.currentAnimation&&(this.animator.currentAnimation.loop=n.checked)}),a.addEventListener("change",()=>{this.animator.currentAnimation&&(this.animator.currentAnimation.curve=a.value)}),e.addEventListener("input",()=>{this.animator.setTime(parseInt(e.value))}),document.getElementById("btn-add-keyframe").addEventListener("click",()=>{if(this.animator.currentAnimation){const l=this.blockManager.getSelectedBlocks();if(l.length>0){const c=this.animator.addKeyframesForSelection(l);this.updateKeyframeMarkers();const p=(this.animator.currentTime/1e3).toFixed(2);this.showNotification(`Added keyframe${c>1?"s":""} for ${c} block${c>1?"s":""} at ${p}s`,"success",2e3)}else this.showNotification("Select blocks to add keyframes","warning",2e3)}else this.showNotification("Create an animation first","warning",2e3)}),document.getElementById("btn-remove-keyframe").addEventListener("click",()=>{if(this.animator.currentAnimation){const l=this.blockManager.getSelectedBlocks();if(l.length>0){const c=l.map(h=>h.id),p=this.animator.removeKeyframesForSelection(c);if(this.updateKeyframeMarkers(),p>0){const h=(this.animator.currentTime/1e3).toFixed(2);this.showNotification(`Removed ${p} keyframe${p>1?"s":""} at ${h}s`,"info",2e3)}else this.showNotification("No keyframes at current time for selected blocks","warning",2e3)}else this.showNotification("Select blocks to remove keyframes","warning",2e3)}}),this.animator.onTimeUpdate=l=>{e.value=l,o.textContent=(l/1e3).toFixed(2)+"s"},this.animator.onPlayStateChange=l=>{document.getElementById("btn-play").textContent=l?"":""}}updateAnimationSelect(){const t=document.getElementById("anim-select");t.innerHTML='<option value="">-- No Animation --</option>';for(const e of this.animator.getAllAnimations()){const o=document.createElement("option");o.value=e.id,o.textContent=e.name,t.appendChild(o)}}updateKeyframeMarkers(){const t=document.getElementById("keyframes-container");if(t.innerHTML="",!this.animator.currentAnimation)return;const e=this.animator.currentAnimation.duration,o=this.animator.currentAnimation.keyframes,n=new Set(this.blockManager.getSelectedBlocks().map(r=>r.id)),s=new Map;for(const r of o){s.has(r.time)||s.set(r.time,{total:0,selected:0});const a=s.get(r.time);a.total++,n.has(r.blockId)&&a.selected++}for(const[r,a]of s){const l=document.createElement("div");l.className="keyframe-marker",a.selected>0&&l.classList.add("selected"),l.style.left=`${r/e*100}%`,l.title=`${r}ms - ${a.total} block${a.total>1?"s":""}${a.selected>0?` (${a.selected} selected)`:""}`,l.addEventListener("click",()=>{this.animator.setTime(r)}),t.appendChild(l)}}setupKeyboardShortcuts(){window.addEventListener("keydown",t=>{if(!(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA")){switch(t.key.toLowerCase()){case"1":this.setTool("place");break;case"2":this.setTool("delete");break;case"3":this.setTool("select");break;case"4":this.setTool("paint");break;case"5":this.setTool("pick");break;case"6":this.setTool("shape");break;case"r":this.rotateBlock();break;case"u":this.toggleUIVisibility();break;case"z":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.history.undo());break;case"y":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.history.redo());break;case"c":if((t.ctrlKey||t.metaKey)&&this.blockManager.getSelectionCount()>0){const e=this.blockManager.getSelectedBlocks();e.length===1?this.clipboard=e[0].toJSON():this.clipboard=e.map(o=>o.toJSON())}break;case"v":if((t.ctrlKey||t.metaKey)&&this.clipboard)if(Array.isArray(this.clipboard))for(const e of this.clipboard){const o={...e};o.position={x:o.position.x+1,y:o.position.y,z:o.position.z+1},delete o.id;const n=this.blockManager.addBlock(o);n&&this.history.push(Us(this.blockManager,o,n))}else{const e={...this.clipboard};e.position={x:e.position.x+1,y:e.position.y,z:e.position.z+1},delete e.id;const o=this.blockManager.addBlock(e);o&&this.history.push(Us(this.blockManager,e,o))}break;case"delete":case"backspace":this.blockManager.getSelectionCount()>0&&(t.preventDefault(),this.deleteSelectedBlocks());break;case" ":t.preventDefault(),this.animator.currentAnimation&&(this.animator.isPlaying?this.animator.pause():this.animator.play());break;case"k":case"+":case"=":if(this.animator.currentAnimation){const e=this.blockManager.getSelectedBlocks();if(e.length>0){const o=this.animator.addKeyframesForSelection(e);this.updateKeyframeMarkers();const n=(this.animator.currentTime/1e3).toFixed(2);this.showNotification(`Added keyframe${o>1?"s":""} for ${o} block${o>1?"s":""} at ${n}s`,"success",2e3)}else this.showNotification("Select blocks to add keyframes","warning",2e3)}else this.showNotification("Create an animation first (+ Anim button)","warning",2e3);break;case"-":case"_":if(this.animator.currentAnimation){const e=this.blockManager.getSelectedBlocks();if(e.length>0){const o=e.map(s=>s.id),n=this.animator.removeKeyframesForSelection(o);if(this.updateKeyframeMarkers(),n>0){const s=(this.animator.currentTime/1e3).toFixed(2);this.showNotification(`Removed ${n} keyframe${n>1?"s":""} at ${s}s`,"info",2e3)}else this.showNotification("No keyframes at current time for selected blocks","warning",2e3)}else this.showNotification("Select blocks to remove keyframes","warning",2e3)}break}switch(t.key){case"ArrowUp":t.preventDefault(),this.moveSelectedBlock(0,0,-1);break;case"ArrowDown":t.preventDefault(),this.moveSelectedBlock(0,0,1);break;case"ArrowLeft":t.preventDefault(),this.moveSelectedBlock(-1,0,0);break;case"ArrowRight":t.preventDefault(),this.moveSelectedBlock(1,0,0);break;case"PageUp":t.preventDefault(),this.moveSelectedBlock(0,1,0);break;case"PageDown":t.preventDefault(),this.moveSelectedBlock(0,-1,0);break}}})}autoSave(){try{const t={blocks:this.blockManager.toJSON(),animations:this.animator.toJSON(),layers:this.layerManager.toJSON(),cameraBookmarks:this.cameraBookmarks.toJSON(),currentColor:this.currentColor,currentBlockType:this.currentBlockType,currentRotation:this.currentRotation};localStorage.setItem("blocksProject",JSON.stringify(t))}catch(t){console.warn("Auto-save failed:",t)}}autoLoad(){try{const t=localStorage.getItem("blocksProject");if(!t)return;const e=JSON.parse(t);e.layers&&(this.layerManager.fromJSON(e.layers),this.updateLayerUI()),e.blocks&&e.blocks.length>0&&(this.blockManager.fromJSON(e.blocks),this.updateBlockVisibility()),e.animations&&(this.animator.fromJSON(e.animations),this.updateAnimationSelect()),e.cameraBookmarks&&(this.cameraBookmarks.fromJSON(e.cameraBookmarks),this.updateCameraBookmarksUI()),e.currentColor&&(this.currentColor=e.currentColor,this.colorInput.value=e.currentColor),e.currentBlockType&&(this.currentBlockType=e.currentBlockType,this.setBlockType(e.currentBlockType)),e.currentRotation!==void 0&&(this.currentRotation=e.currentRotation),console.log("Project loaded from localStorage")}catch(t){console.warn("Auto-load failed:",t)}}showNotification(t,e="info",o=5e3){if(!this.notificationsEl)return;const n={info:"i",success:"",warning:"!",error:""},s=document.createElement("div");return s.className=`notification ${e}`,s.innerHTML=`
      <span class="icon">${n[e]||n.info}</span>
      <span class="message">${t}</span>
      <button class="close-btn">&times;</button>
    `,s.querySelector(".close-btn").addEventListener("click",()=>{this.dismissNotification(s)}),this.notificationsEl.appendChild(s),o>0&&setTimeout(()=>{this.dismissNotification(s)},o),s}dismissNotification(t){!t||!t.parentNode||(t.classList.add("fade-out"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300))}clearProject(){confirm("Clear all blocks? This cannot be undone.")&&(this.blockManager.clear(),this.animator.clear(),this.layerManager.clear(),this.cameraBookmarks.clear(),this.history.clear(),localStorage.removeItem("blocksProject"),this.updateAnimationSelect(),this.updateLayerUI(),this.updateCameraBookmarksUI(),this.updateSelectionUI(null))}setupTemplateMenu(){const t=document.getElementById("templates-modal"),e=document.getElementById("templates-list");TM().forEach((n,s)=>{const r=document.createElement("div");r.className="template-category",s>2&&r.classList.add("collapsed");const a=document.createElement("div");a.className="template-category-header",a.innerHTML=`
        <span class="arrow"></span>
        <span class="label">${n.label}</span>
        <span class="count">${n.templates.length}</span>
      `,a.addEventListener("click",()=>{r.classList.toggle("collapsed")}),r.appendChild(a);const l=document.createElement("div");l.className="template-category-content",n.templates.forEach(c=>{const p=document.createElement("button");p.className="template-item",p.innerHTML=`
          <span class="template-name">${c.name}</span>
          <span class="template-desc">${c.description}</span>
        `,p.addEventListener("click",()=>{this.loadTemplate(c.id),this.hideTemplatesModal()}),l.appendChild(p)}),r.appendChild(l),e.appendChild(r)}),document.getElementById("btn-templates").addEventListener("click",()=>{this.showTemplatesModal()}),document.getElementById("templates-modal-close").addEventListener("click",()=>{this.hideTemplatesModal()}),t.addEventListener("click",n=>{n.target===t&&this.hideTemplatesModal()})}showTemplatesModal(){document.getElementById("templates-modal").style.display="flex"}hideTemplatesModal(){document.getElementById("templates-modal").style.display="none"}loadTemplate(t){const e=CM(t);if(!e)return;(this.blockManager.getBlockCount()>0?confirm(`Add "${e.name}" to existing blocks?

Click OK to add, Cancel to replace all.`):!1)||(this.blockManager.clear(),this.history.clear());let n=0;for(const s of e.blocks){const r={type:s.type||"cube",position:{...s.position},color:s.color||this.currentColor,rotation:s.rotation||{x:0,y:0,z:0},emissive:s.emissive||null};this.blockManager.wouldOverlapAt(r.type,r.position)||this.blockManager.addBlock(r)&&n++}console.log(`Placed ${n}/${e.blocks.length} blocks from template "${e.name}"`)}showExportModal(){const t=document.getElementById("export-modal");t.style.display="flex",this.updateExportStats()}hideExportModal(){const t=document.getElementById("export-modal");t.style.display="none"}updateExportStats(){const t=document.getElementById("opt-face-cull").checked,e=document.getElementById("opt-merge-cubes").checked,o=this.exporter.getOptimizationStats(this.blockManager,{cullFaces:t,mergeCubes:e});document.getElementById("stat-blocks").textContent=o.blockCount,document.getElementById("stat-faces").textContent=o.originalFaces,document.getElementById("stat-optimized").textContent=`${o.optimizedFaces} (-${o.reduction}%)`}setupExportModal(){const t=document.getElementById("export-modal");document.getElementById("export-modal-close").addEventListener("click",()=>{this.hideExportModal()}),document.getElementById("export-cancel").addEventListener("click",()=>{this.hideExportModal()}),t.addEventListener("click",e=>{e.target===t&&this.hideExportModal()}),document.getElementById("opt-face-cull").addEventListener("change",()=>{this.updateExportStats()}),document.getElementById("opt-merge-cubes").addEventListener("change",()=>{this.updateExportStats()}),document.getElementById("export-confirm").addEventListener("click",async()=>{await this.performExport()})}async performExport(){const t=document.querySelector('input[name="export-format"][value="glb"]').checked,e=document.getElementById("opt-face-cull").checked,o=document.getElementById("opt-merge-cubes").checked,n=document.getElementById("opt-material-batch").checked,s=document.getElementById("opt-deduplicate").checked,r=document.getElementById("opt-merge-all").checked,a=document.getElementById("opt-instancing").checked,l=document.getElementById("inc-animations").checked,c=document.getElementById("inc-baked-lighting").checked,p=document.getElementById("dbg-lightmap").checked,h=document.getElementById("dbg-colors").checked,u=document.getElementById("dbg-palette").checked,d=document.getElementById("dbg-json").checked,y=document.getElementById("export-confirm"),g=y.textContent;y.textContent="Exporting...",y.disabled=!0;try{const f=await this.exporter.exportScene(this.blockManager,{binary:t,includeAnimations:l,animator:this.animator,bakedTexture:c?this.bakedTexture:null,uvData:c?this.bakedUVData:null,cullFaces:e,mergeCubes:o,batchMaterials:n,deduplicateVertices:s,mergeAll:r,useInstancing:a}),m=t?"model.glb":"model.gltf";if(this.exporter.downloadFile(f,m,t),d&&t){const b=await this.exporter.exportScene(this.blockManager,{binary:!1,includeAnimations:l,animator:this.animator,bakedTexture:c?this.bakedTexture:null,uvData:c?this.bakedUVData:null});this.exporter.downloadFile(b,"model.gltf",!1)}if(p&&this.bakedTexture&&this.lightBaker.downloadCanvasAsPNG(this.bakedTexture,"baked_lightmap.png"),h){const b=this.lightBaker.generateDebugTexture(this.blockManager);this.lightBaker.downloadCanvasAsPNG(b,"debug_colors.png")}if(u){const b=this.generateColorPalette();this.lightBaker.downloadCanvasAsPNG(b,"color_palette.png")}console.log("Export completed successfully"),this.hideExportModal(),this.showNotification("Export completed successfully","success")}catch(f){this.showNotification("Export failed: "+f.message,"error"),console.error("Export error:",f)}finally{y.textContent=g,y.disabled=!1}}}const dS=new uS;window.appInstance=dS})();
